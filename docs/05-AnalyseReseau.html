<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes d’analyse spatiale : un grand bol d’R - 5&nbsp; Mesures d’accessibilité spatiale selon différents modes de transport</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-AnalyseReseauEvenements.html" rel="next">
<link href="./04-AgregatsSpatiaux.html" rel="prev">
<link href="./images/introduction/Couverture_16_01-01.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-AnalyseReseau.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mesures d'accessibilité spatiale selon différents modes de transport</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes d’analyse spatiale : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Données spatiales et R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-ManipulationDonneesSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manipulation des données spatiales dans&nbsp;R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Autocorrélation spatiale</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Autocorrelation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Autocorrélation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Méthodes de répartition ponctuelle et de détections d’agrégats spatiaux</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-MethodesRepartitionPonctuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Méthodes de répartition ponctuelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-AgregatsSpatiaux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Méthodes de détection d’agrégats spatiaux et spatio-temporels</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Analyses de données avec des réseaux de transport</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-AnalyseReseau.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mesures d’accessibilité spatiale selon différents modes de transport</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-AnalyseReseauEvenements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyses d’évènements localisés sur un réseau</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Régressions spatiales et classifications spatiales</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-RegressionSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ClassificationsSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Exercices et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Exercices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Correction des exercices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-051" id="toc-sec-051" class="nav-link active" data-scroll-target="#sec-051"><span class="header-section-number">5.1</span> Notions relatives à l’analyse de réseau</a>
  <ul class="collapse">
<li><a href="#sec-0511" id="toc-sec-0511" class="nav-link" data-scroll-target="#sec-0511"><span class="header-section-number">5.1.1</span> Définition d’un réseau</a></li>
  <li><a href="#sec-0512" id="toc-sec-0512" class="nav-link" data-scroll-target="#sec-0512"><span class="header-section-number">5.1.2</span> Principaux problèmes résolus en analyse de réseau</a></li>
  <li><a href="#sec-0513" id="toc-sec-0513" class="nav-link" data-scroll-target="#sec-0513"><span class="header-section-number">5.1.3</span> Analyse de réseau et entités polygonales</a></li>
  </ul>
</li>
  <li>
<a href="#sec-052" id="toc-sec-052" class="nav-link" data-scroll-target="#sec-052"><span class="header-section-number">5.2</span> Construction d’un réseau avec R5R</a>
  <ul class="collapse">
<li><a href="#sec-0521" id="toc-sec-0521" class="nav-link" data-scroll-target="#sec-0521"><span class="header-section-number">5.2.1</span> Extraction des données spatiales pour R5R</a></li>
  <li><a href="#sec-0522" id="toc-sec-0522" class="nav-link" data-scroll-target="#sec-0522"><span class="header-section-number">5.2.2</span> Construction du réseau avec R5R</a></li>
  <li><a href="#sec-0523" id="toc-sec-0523" class="nav-link" data-scroll-target="#sec-0523"><span class="header-section-number">5.2.3</span> Calcul d’itinéraires avec R5R selon le mode de transport</a></li>
  <li><a href="#sec-0524" id="toc-sec-0524" class="nav-link" data-scroll-target="#sec-0524"><span class="header-section-number">5.2.4</span> Délimitation d’isochrones avec R5R selon le mode de transport</a></li>
  <li><a href="#sec-0525" id="toc-sec-0525" class="nav-link" data-scroll-target="#sec-0525"><span class="header-section-number">5.2.5</span> Calcul de matrices OD selon différents modes de transport</a></li>
  </ul>
</li>
  <li>
<a href="#sec-053" id="toc-sec-053" class="nav-link" data-scroll-target="#sec-053"><span class="header-section-number">5.3</span> Mesures d’accessibilité</a>
  <ul class="collapse">
<li><a href="#sec-0531" id="toc-sec-0531" class="nav-link" data-scroll-target="#sec-0531"><span class="header-section-number">5.3.1</span> Notion d’accessibilité</a></li>
  <li><a href="#sec-0532" id="toc-sec-0532" class="nav-link" data-scroll-target="#sec-0532"><span class="header-section-number">5.3.2</span> Accessibilité spatiale potentielle</a></li>
  </ul>
</li>
  <li>
<a href="#sec-054" id="toc-sec-054" class="nav-link" data-scroll-target="#sec-054"><span class="header-section-number">5.4</span> Mesures d’accessibilité spatiale potentielle dans R</a>
  <ul class="collapse">
<li><a href="#sec-0541" id="toc-sec-0541" class="nav-link" data-scroll-target="#sec-0541"><span class="header-section-number">5.4.1</span> Accessibilité spatiale potentielle aux supermarchés</a></li>
  <li><a href="#sec-0542" id="toc-sec-0542" class="nav-link" data-scroll-target="#sec-0542"><span class="header-section-number">5.4.2</span> Accessibilité spatiale potentielle aux patinoires extérieures</a></li>
  </ul>
</li>
  <li><a href="#sec-055" id="toc-sec-055" class="nav-link" data-scroll-target="#sec-055"><span class="header-section-number">5.5</span> Quiz de révision du chapitre</a></li>
  <li><a href="#sec-056" id="toc-sec-056" class="nav-link" data-scroll-target="#sec-056"><span class="header-section-number">5.6</span> Exercices de révision</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap05" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mesures d’accessibilité spatiale selon différents modes de transport</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Dans ce chapitre, nous voyons comment construire un réseau multimode (voiture, marche, vélo, transport en commun) pour calculer différentes mesures d’accessibilité dans R. Aussi, nous discutons de la notion d’accessibilité à un service, notamment des cinq dimensions identifiées par Penchansky et Thomas <span class="citation" data-cites="penchansky1981concept">(<a href="references.html#ref-penchansky1981concept" role="doc-biblioref">1981</a>)</span>, de l’accessibilité réelle versus l’accessibilité potentielle et de l’accessibilité spatiale versus l’accessibilité aspatiale <span class="citation" data-cites="luo2003measures">(<a href="references.html#ref-luo2003measures" role="doc-biblioref">Luo et Wang 2003</a>)</span>.</p>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour importer et manipuler des fichiers géographiques&nbsp;:
<ul>
<li>
<code>sf</code> pour importer et manipuler des données vectorielles.</li>
<li>
<code>terra</code> pour importer et manipuler des données matricielles.</li>
</ul>
</li>
<li>Pour construire des cartes et des graphiques&nbsp;:
<ul>
<li>
<code>tmap</code> est certainement le meilleur <em>package</em> pour la cartographie.</li>
<li>
<code>ggplot2</code> pour construire des graphiques.</li>
</ul>
</li>
<li>Pour construire un réseau&nbsp;:
<ul>
<li>
<code>osmextract</code> pour extraire des fichiers OpenStreetMap.</li>
<li>
<code>gtfstools</code> pour valider la structure d’un fichier GTFS.</li>
<li>
<code>R5R</code> pour calculer des trajets et des matrices origines-destinations selon différents modes de transport.</li>
</ul>
</li>
<li>Pour manipuler les données&nbsp;:
<ul>
<li>
<code>dplyr</code> pour calculer des moyennes pondérées.</li>
</ul>
</li>
</ul>
</div>
</div>
<section id="sec-051" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="sec-051">
<span class="header-section-number">5.1</span> Notions relatives à l’analyse de réseau</h2>
<section id="sec-0511" class="level3" data-number="5.1.1"><h3 data-number="5.1.1" class="anchored" data-anchor-id="sec-0511">
<span class="header-section-number">5.1.1</span> Définition d’un réseau</h3>
<p>Un réseau est un ensemble de lignes connectées par des nœuds –&nbsp;voies ferrées, voies routières, canalisations d’eau ou de gaz, fleuves et affluents drainant une région, etc.&nbsp;– reliant un territoire (<a href="#fig-fig1Reseau">figure&nbsp;<span>5.1</span></a>). Pour un réseau routier, l’information sémantique rattachée tant aux lignes (sens de circulation, vitesse autorisée, rues piétonnières, pistes cyclables, etc.) qu’aux nœuds (types d’intersection, autorisation de virage à gauche, etc.) est utilisée pour modéliser un réseau.</p>
<div id="fig-fig1Reseau" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/Reseau.png" class="img-fluid figure-img" style="width:15.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.1: Réseau : un ensemble de lignes connectées par des nœuds</figcaption></figure>
</div>
</section><section id="sec-0512" class="level3" data-number="5.1.2"><h3 data-number="5.1.2" class="anchored" data-anchor-id="sec-0512">
<span class="header-section-number">5.1.2</span> Principaux problèmes résolus en analyse de réseau</h3>
<p>L’analyse de réseau permet de résoudre trois principaux problèmes (<a href="#fig-fig2PrincipauxPbs">figure&nbsp;<span>5.2</span></a>)&nbsp;:</p>
<ul>
<li><p>Trouver le trajet le plus court ou le plus rapide entre deux points, basé sur <a href="https://fr.wikipedia.org/wiki/Algorithme_de_Dijkstra">l’algorithme de Dijkstra</a> <span class="citation" data-cites="dijkstra1959note">(<a href="references.html#ref-dijkstra1959note" role="doc-biblioref">1959</a>)</span>.</p></li>
<li><p>Trouver la route optimale comprenant plusieurs arrêts (<a href="https://fr.wikipedia.org/wiki/Probl%C3%A8me_du_voyageur_de_commerce#:~:text=En%20informatique%2C%20le%20probl%C3%A8me%20du,une%20et%20une%20seule%20fois.">problème du voyageur de commerce</a>).</p></li>
<li><p>Définir des zones de desserte autour d’une origine, basé aussi sur l’algorithme de Dijkstra.</p></li>
</ul>
<div id="fig-fig2PrincipauxPbs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/PrincipauxProblemes.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.2: Trois principaux problèmes résolus en analyse de réseau</figcaption></figure>
</div>
<p>À cela s’ajoutent quatre autres problèmes&nbsp;:</p>
<ul>
<li><p>Trouver les <em>k</em> services les plus proches à partir d’une origine (<a href="#fig-fig3AutresPrincipauxPbs">figure&nbsp;<span>5.3</span></a>, a).</p></li>
<li><p>Construire une matrice de distance origines-destinations (<a href="#fig-fig3AutresPrincipauxPbs">figure&nbsp;<span>5.3</span></a>, b), dont l’intérêt principal est de permettre par la suite le calcul de n’importe quelle mesure d’accessibilité.</p></li>
<li><p>Résoudre le <a href="https://fr.wikipedia.org/wiki/Probl%C3%A8me_de_tourn%C3%A9es_de_v%C3%A9hicules">problème de tournées de véhicules</a> dont l’objectif est d’optimiser les tournées d’une flotte de véhicules en fonction des ressources disponibles, de la localisation des clients, des lieux de dépôt de marchandises, etc.</p></li>
<li><p>Réaliser un <a href="https://en.wikipedia.org/wiki/Location-allocation">modèle localisation-affectation</a> dont l’objectif est d’optimiser la localisation d’un ou plusieurs nouveaux équipements en fonction de la demande, et ce, en minimisant la distance agrégée entre les points d’offre et de demande. Par exemple, une région ayant 15 hôpitaux desservant deux millions d’habitants souhaiterait ajouter trois autres établissements. En fonction de l’offre existante (hôpitaux pondérés par le nombre de lits), de la distribution spatiale de la population et de la localisation des sites potentiels des trois hôpitaux, il s’agit de choisir ceux qui minimisent la distance entre les points d’offre et de demande.</p></li>
</ul>
<div id="fig-fig3AutresPrincipauxPbs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/PrincipauxAutresProblemes.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.3: Autres problèmes résolus en analyse de réseau</figcaption></figure>
</div>
<p>Ces problèmes peuvent être résolus selon différents modes de transport, à savoir le chemin le plus rapide en véhicule motorisé, à pied, en vélo et en transport en commun (<a href="#fig-TypesDistancesTransport">figure&nbsp;<span>5.4</span></a>).</p>
<div id="fig-TypesDistancesTransport" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/TypesDistances.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.4: Chemin le plus rapide selon différents modes de transport</figcaption></figure>
</div>
</section><section id="sec-0513" class="level3" data-number="5.1.3"><h3 data-number="5.1.3" class="anchored" data-anchor-id="sec-0513">
<span class="header-section-number">5.1.3</span> Analyse de réseau et entités polygonales</h3>
<p>Vous avez compris que les problèmes présentés plus haut sont réalisés à partir d’entités spatiales ponctuelles. Pour estimer le trajet le plus court ou le plus rapide entre un point et un polygone (un parc urbain par exemple), il faut préalablement le convertir en point. Plusieurs solutions sont envisageables <span class="citation" data-cites="apparicio2006measuring">(<a href="references.html#ref-apparicio2006measuring" role="doc-biblioref">Apparicio et Séguin 2006</a>)</span>&nbsp;:</p>
<ul>
<li><p>Calculer le trajet entre le point et le centroïde du parc (<a href="#fig-ReseauPointPolygone">figure&nbsp;<span>5.5</span></a>, a). Le centroïde est alors rattaché au tronçon de rue le plus proche. Cette solution est peu précise&nbsp;: plus la superficie du polygone est grande, plus l’imprécision augmente.</p></li>
<li><p>Si le parc a plusieurs entrées, il suffit de les positionner le long du périmètre et de calculer les trajets à partir de ces points.</p></li>
<li><p>Si le parc n’a pas d’entrée, il convient de positionner des points le long du périmètre, espacés d’une distance prédéterminée (<a href="#fig-ReseauPointPolygone">figure&nbsp;<span>5.5</span></a>, b). Bien qu’elle soit longue à calculer, cette solution est bien plus précise. Par exemple, avec des points espacés de 20&nbsp;mètres le long du périmètre du parc, l’erreur maximale est de 10&nbsp;mètres.</p></li>
</ul>
<div id="fig-ReseauPointPolygone" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/ReseauPointPolygone.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.5: Méthode pour déterminer le trajet le plus court entre une entité ponctuelle et une entité polygonale</figcaption></figure>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Modélisation d’un réseau dans un logiciel SIG (systèmes d’information géographique)</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Il est aussi possible de construire un réseau dans un logiciel SIG (QGIS et ArcGIS&nbsp;Pro par exemple). Pour une description détaillée de la construction d’un réseau selon différents modes de transport (voiture, marche, vélo et transport en commun) dans un SIG, consultez l’article d’Apparicio <em>et al.</em> <span class="citation" data-cites="ApparicioGelbrevisited">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">2017</a>)</span>.</p>
</div>
</div>
</section></section><section id="sec-052" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="sec-052">
<span class="header-section-number">5.2</span> Construction d’un réseau avec R5R</h2>
<p>Pour construire un réseau pour différents modes de transport dans R, nous utilisons le <em>package</em> <code>R5R</code> <span class="citation" data-cites="packageR5R">(<a href="references.html#ref-packageR5R" role="doc-biblioref">Pereira et al. 2021</a>)</span>. Il existe d’autres <em>packages</em>, notamment <code>opentripplanner</code> <span class="citation" data-cites="packageOpenTripPlanner">(<a href="references.html#ref-packageOpenTripPlanner" role="doc-biblioref">Morgan et al. 2019</a>)</span> qui a été largement utilisé ces dernières années. Étant plus rapide, <code>R5R</code> s’impose actuellement comme la solution la plus efficace pour calculer des trajets à travers un réseau de rues selon différents modes de transport.</p>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Documentation du <em>package</em><code>R5R</code></strong></p>
</div>
<div class="bloc_notes-body">
<p>Nous vous conseillons vivement de lire la documentation de <code>R5R</code> sur <a href="https://cran.r-project.org/web/packages/r5r/index.html">le site de CRAN</a>, notamment les nombreuses vignettes présentant des exemples d’analyses avec du code R très bien documenté.</p>
</div>
</div>
<section id="sec-0521" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="sec-0521">
<span class="header-section-number">5.2.1</span> Extraction des données spatiales pour R5R</h3>
<p>Pour construire un réseau multimode, <code>R5R</code> a besoin de trois fichiers qui doivent être localisés dans le même dossier (<a href="#fig-DonneesReseauR5R">figure&nbsp;<span>5.6</span></a>)&nbsp;:</p>
<ol type="1">
<li>un fichier <em>pbf</em> (<em>Protocolbuffer Binary Format</em>) pour les données d’OpenStreetMap.</li>
<li>un ou plusieurs fichiers <em>GTFS</em> (<em>General Transit Feed Specification</em>) pour les flux relatifs aux transports en commun.</li>
<li>un fichier <em>GeoTIFF</em> d’élévation.</li>
</ol>
<p>Notez que ce dernier fichier est optionnel. Toutefois, pour calculer des trajets à pied ou à vélo, il est préférable de tenir compte de la pente, surtout dans une ville comme Sherbrooke!</p>
<div id="fig-DonneesReseauR5R" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/DonneesPourR5R.png" class="img-fluid figure-img" style="width:55.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.6: Trois types de données nécessaires pour modéliser un réseau dans R5R</figcaption></figure>
</div>
<section id="sec-05212" class="level4" data-number="5.2.1.1"><h4 data-number="5.2.1.1" class="anchored" data-anchor-id="sec-05212">
<span class="header-section-number">5.2.1.1</span> Extraction d’un fichier OpenStreetMap</h4>
<p>Pour récupérer un fichier OpenStreetMap (OSM, format <em>pbf</em>), nous utilisons deux fonctions du <em>package</em> <code>osmextract</code> <span class="citation" data-cites="osmextractpackage">(<a href="references.html#ref-osmextractpackage" role="doc-biblioref">Gilardi et Lovelace 2022</a>)</span>&nbsp;:</p>
<ul>
<li>
<code>oe_match</code> pour repérer le fichier OSM pour la région de l’Estrie.</li>
<li>
<code>oe_download</code> pour télécharger le fichier OSM pour la région de l’Estrie.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/">osmextract</a></span><span class="op">)</span></span>
<span><span class="co">## Identification du fichier OSM (format pbf) pour l'Estrie</span></span>
<span><span class="va">Estrie</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_match.html">oe_match</a></span><span class="op">(</span>place<span class="op">=</span><span class="st">"Estrie"</span>, provider <span class="op">=</span> <span class="st">"openstreetmap_fr"</span><span class="op">)</span></span>
<span><span class="co">## Téléchargement du fichier OSM (format pbf) pour l'Estrie</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_download.html">oe_download</a></span><span class="op">(</span></span>
<span>  file_url <span class="op">=</span> <span class="va">Estrie</span><span class="op">$</span><span class="va">url</span>,</span>
<span>  file_size <span class="op">=</span> <span class="va">Estrie</span><span class="op">$</span><span class="va">file_size</span>,</span>
<span>  provider <span class="op">=</span> <span class="st">"openstreetmap_fr"</span>,</span>
<span>  download_directory <span class="op">=</span> <span class="st">"data/chap05/__TempOSM"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le fichier OSM téléchargé plus haut couvre la région de l’Estrie. À notre connaissance, il n’existe pas de solution pour découper un fichier <em>pbf</em> dans R. Par conséquent, nous récupérons les coordonnées minimales et maximales de l’enveloppe d’une zone tampon de 5000&nbsp;mètres autour de la couche de la ville de Sherbrooke. Puis, pour découper le fichier <em>pbf</em>, nous utilisons l’outil <a href="https://wiki.openstreetmap.org/wiki/Osmconvert"><strong>osmconvert64-0.8.8p.exe</strong></a>. Le code ci-dessous renvoie les quatre coordonnées de l’enveloppe.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span></span>
<span><span class="co">## Importation du polygone pour la ville de Sherbrooke avec sf</span></span>
<span><span class="va">Sherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Sherbrooke.shp"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Création d'une zone tampon de 5 km</span></span>
<span><span class="va">zone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">Sherbrooke</span>, dist <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="co">## Changement de la projection en 4326</span></span>
<span><span class="va">zone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">zone</span>, <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">## Création de l'enveloppe autour de la couche</span></span>
<span><span class="va">enveloppe</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">zone</span><span class="op">)</span></span>
<span><span class="co">## Visualisation des coordonnées minimales et maximales</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Minimum longitude : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">enveloppe</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>           <span class="st">"\n Minimum latitude : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">enveloppe</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>           <span class="st">"\n Maximum longitude : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">enveloppe</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>           <span class="st">"\n Maximum latitude : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">enveloppe</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum longitude : -72.1537
 Minimum latitude : 45.2683
 Maximum longitude : -71.7576
 Maximum latitude : 45.5554</code></pre>
</div>
</div>
<p>L’application <strong>Osmconvert</strong> est disponible pour <a href="https://wiki.openstreetmap.org/wiki/Osmconvert#Windows">Windows</a> et <a href="https://wiki.openstreetmap.org/wiki/Osmconvert#Linux">Linux</a>. Pour découper un fichier avec les coordonnées latitude/longitude minimales et maximales avec <strong>Osmconvert</strong>, nous écrivons une commande système et l’exécutons avec la fonction <code>system</code>. Pour utiliser le code ci-dessous, vous devez avoir préalablement téléchargé <strong>Osmconvert</strong> et connaitre son emplacement.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Préparation des chemins</span></span>
<span><span class="va">path_to_osm_convert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/data/chap05/__TempOSM/osmconvert64-0.8.8p.exe'</span><span class="op">)</span></span>
<span><span class="va">path_to_big_osm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/data/chap05/__TempOSM/openstreetmap_fr_estrie-latest.osm.pbf'</span><span class="op">)</span></span>
<span><span class="va">path_to_small_osm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/data/chap05/__TempOSM/openstreetmap_fr_estrie-latest.osm_01.pbf'</span><span class="op">)</span></span>
<span><span class="co">## Écriture de la commande</span></span>
<span><span class="va">commande</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'"'</span>,<span class="va">path_to_osm_convert</span>, <span class="st">'" "'</span>,</span>
<span>                   <span class="va">path_to_big_osm</span>, <span class="st">'" -b='</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">enveloppe</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">','</span><span class="op">)</span>, </span>
<span>                   <span class="st">' -o="'</span>,<span class="va">path_to_small_osm</span>,<span class="st">'"'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Une fois que la commande est écrite, nous l’exécutons.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">commande</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notez qu’il est possible d’obtenir le même résultat avec l’application <a href="https://wiki.openstreetmap.org/wiki/Osmosis"><strong>Osmosis</strong></a>. Il s’agit d’un outil rédigé en <strong>Java</strong> et qui dispose de fonctionnalités similaires à celles de <strong>Osmconvert</strong>. Puisqu’il est rédigé en <strong>Java</strong>, il peut être utilisé sur davantage de plateformes qu’<strong>Osmconvert</strong>.</p>
</section><section id="sec-05213" class="level4" data-number="5.2.1.2"><h4 data-number="5.2.1.2" class="anchored" data-anchor-id="sec-05213">
<span class="header-section-number">5.2.1.2</span> Construction d’un fichier <em>GeoTIFF</em> pour l’élévation</h4>
<p>Pour créer un fichier <em>GeoTIFF</em> pour l’élévation, nous utilisons les modèles numériques de terrain (MNT) du <a href="https://www.donneesquebec.ca/recherche/dataset/modeles-numeriques-d-altitude-a-l-echelle-de-1-20-000">ministère des Ressources naturelles et des Forêts</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/">terra</a></span><span class="op">)</span></span>
<span><span class="co">## Couche polygonale sf pour la ville de Sherbrooke</span></span>
<span><span class="co"># Shapefile pour les régions du Québec au 1/20000</span></span>
<span><span class="co"># https://www.donneesquebec.ca/recherche/dataset/decoupages-administratifs/resource/b368d470-71d6-40a2-8457-e4419de2f9c0</span></span>
<span><span class="va">Sherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Sherbrooke.shp"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Sherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">Sherbrooke</span>, dist <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="co">## Feuillets pour les MNT au 1/20000</span></span>
<span><span class="co">## Importation du shapefile des feuillets</span></span>
<span><span class="co">## (https://www.donneesquebec.ca/recherche/dataset/modeles-numeriques-d-altitude-a-l-echelle-de-1-20-000/resource/2df157af-74cf-4b53-af9d-1d3ccee0d6e1)</span></span>
<span><span class="va">Feuillets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Index_MNT20k.shp"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">### Nous nous assurons que les deux couches ont la même projection, soit EPSG 4326</span></span>
<span><span class="va">Sherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">Sherbrooke</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">Feuillets</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">### Sélection des feuillets qui intersectent le polygone de l'Estrie</span></span>
<span><span class="va">RequeteSpatiale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_intersects</a></span><span class="op">(</span><span class="va">Feuillets</span>, <span class="va">Sherbrooke</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Feuillets</span><span class="op">$</span><span class="va">Intersect</span> <span class="op">&lt;-</span>  <span class="va">RequeteSpatiale</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">FeuilletsSherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">Feuillets</span>,<span class="va">Intersect</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Téléchargement des GRIDS</span></span>
<span><span class="co">### Création d'un dossier temporaire pour les MNT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/chap05/AutresDonnees/MNT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grids</span> <span class="op">&lt;-</span> <span class="va">FeuilletsSherbrooke</span><span class="op">$</span><span class="va">GRID</span></span>
<span><span class="va">i</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">grids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="va">i</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="co"># Téléchargement</span></span>
<span>  <span class="va">Fichier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">e</span>, <span class="fl">88</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Chemin</span> <span class="op">&lt;-</span>  <span class="st">"data/chap05/AutresDonnees/MNT"</span></span>
<span>  <span class="va">CheminFichier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">Chemin</span>, <span class="st">"/"</span>, <span class="va">Fichier</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">e</span>, destfile <span class="op">=</span> <span class="va">CheminFichier</span><span class="op">)</span></span>
<span>  <span class="co"># Décompression du fichier zip</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="va">CheminFichier</span>, exdir <span class="op">=</span> <span class="va">Chemin</span><span class="op">)</span></span>
<span>  <span class="co"># suppression du zip</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="va">CheminFichier</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Importation des GRIDS avec le package Terra</span></span>
<span><span class="va">Fichier1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">grids</span>, <span class="fl">88</span>, <span class="fl">98</span><span class="op">)</span></span>
<span><span class="va">Fichier2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">Fichier1</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Fichier1</span>, <span class="fl">9</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">NomsFichiers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/chap05/AutresDonnees/MNT/"</span>,</span>
<span>                        <span class="va">Fichier1</span>, <span class="st">"/"</span>,</span>
<span>                        <span class="va">Fichier2</span><span class="op">)</span></span>
<span><span class="va">rlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">NomsFichiers</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span> <span class="va">rasterGrid</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span> <span class="va">rlist</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rlist</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rasterGrid</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Création d'une mosaique avec les GRIDS</span></span>
<span><span class="va">rsrc</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/src.html">sprc</a></span><span class="op">(</span><span class="va">rlist</span><span class="op">)</span></span>
<span><span class="va">MosaicSherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/mosaic.html">mosaic</a></span><span class="op">(</span><span class="va">rsrc</span><span class="op">)</span></span>
<span><span class="va">MosaicSherbrooke</span></span>
<span></span>
<span><span class="co"># Pour réduire la taille du fichier d’élévation, nous arrondissons les valeurs au mètre</span></span>
<span><span class="va">MosaicSherbrooke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">MosaicSherbrooke</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Exporter en GeoTIFF</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">MosaicSherbrooke</span>, </span>
<span>                  <span class="st">"data/chap05/_DataReseau/Elevation.tif"</span>,</span>
<span>                  filetype <span class="op">=</span> <span class="st">"GTiff"</span>, </span>
<span>                  datatype <span class="op">=</span> <span class="st">'INT2U'</span>,</span>
<span>                  overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Suppression des GRIDS</span></span>
<span><span class="va">dossier</span> <span class="op">&lt;-</span> <span class="st">"data/chap05/AutresDonnees/MNT/"</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">dossier</span>, include.dirs <span class="op">=</span> <span class="cn">FALSE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.dirs</a></span><span class="op">(</span><span class="va">dossier</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="va">d</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le fichier d’élévation ainsi construit est présenté à la <a href="#fig-figMNT">figure&nbsp;<span>5.7</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MosaicSherbrooke</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="st">"data/chap05/_DataReseau/Elevation.tif"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">MosaicSherbrooke</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-figMNT" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="05-AnalyseReseau_files/figure-html/fig-figMNT-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.7: Modèle numérique d’élévation au 1/20000 pour la région de Sherbrooke</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong><em>Package</em> <code>elevatr</code> pour extraire des images d’élévation pour une région donnée</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Plus haut, nous avons utilisé des modèles numériques de terrain (MNT) du <a href="https://www.donneesquebec.ca/recherche/dataset/modeles-numeriques-d-altitude-a-l-echelle-de-1-20-000">ministère des Ressources naturelles et des Forêts</a> pour construire un fichier <em>GeoTIFF</em> pour l’élévation pour la ville de Sherbrooke (Québec). Pour d’autres régions du monde, vous pouvez aussi utiliser le <em>package</em> <code>elevatr</code> <span class="citation" data-cites="hollister2017elevatr">(<a href="references.html#ref-hollister2017elevatr" role="doc-biblioref">Hollister et al. 2023</a>)</span> pour extraire une image d’élévation à partir de l’<a href="https://opentopography.org/developers/">API OpenTopography</a>.</p>
<p>Pour plus d’information, consultez cette <a href="https://cran.r-project.org/web/packages/elevatr/vignettes/introduction_to_elevatr.html">vignette</a>,</p>
</div>
</div>
</section><section id="sec-05214" class="level4" data-number="5.2.1.3"><h4 data-number="5.2.1.3" class="anchored" data-anchor-id="sec-05214">
<span class="header-section-number">5.2.1.3</span> Extraction et validation d’un fichier GTFS</h4>
<p>Le fichier GTFS pour la Société de Transport de Sherbrooke est disponible à l’adresse suivante&nbsp;: <a href="https://gtfs.sts.qc.ca:8443/gtfs/client/GTFS_clients.zip" class="uri">https://gtfs.sts.qc.ca:8443/gtfs/client/GTFS_clients.zip</a>. Pour le télécharger, nous utilisons la fonction <code>download.file</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://gtfs.sts.qc.ca:8443/gtfs/client/GTFS_clients.zip"</span></span>
<span><span class="va">destfile</span> <span class="op">&lt;-</span> <span class="st">"data/chap05/_DataReseau/GTFS_clients.zip"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">destfile</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour s’assurer du bon fonctionnement d’un GTFS dans <code>r5r</code>, il faut préalablement valider la structure du fichier. Dans un premier temps, vous pouvez valider la structure générale de votre GTFS en utilisant l’outil en ligne <a href="https://gtfs-validator.mobilitydata.org/">gtfs-validator</a> proposé par l’organisation <em>MobilityData</em>. Dans un second temps, il convient de s’assurer que les types de lignes utilisés font partie des types standards définis par <a href="https://developers.google.com/transit/gtfs/reference?hl=fr#routestxt">Google</a>, soit avec l’un des numéros suivants&nbsp;: 0, 1, 2, 3, 4, 5, 6, 7, 11, 12. Si votre GTFS contient des lignes de transport en commun provenant par exemple des <a href="https://developers.google.com/transit/gtfs/reference/extended-route-types?hl=fr">types étendus</a>, <code>r5r</code> renverra une erreur.</p>
<p>Nous vous proposons ci-dessous une fonction qui remplace les types problématiques dans un GTFS. Le plus simple est de les remplacer par un type <em>bus</em> (3), ce qui n’affectera pas les trajets estimés.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/gtfstools/">gtfstools</a></span><span class="op">)</span></span>
<span><span class="co">## Fonction</span></span>
<span><span class="va">clean_gtfs_types</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gtfs_file</span>, <span class="va">replace_by</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Lecture du GTFS</span></span>
<span>  <span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu">gtfstools</span><span class="fu">::</span><span class="fu"><a href="https://ipeagit.github.io/gtfstools/reference/read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">gtfs_file</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html">unique</a></span><span class="op">(</span><span class="va">seed</span><span class="op">$</span><span class="va">routes</span><span class="op">$</span><span class="va">route_type</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Vérification des types de routes</span></span>
<span>  <span class="va">seed</span><span class="op">$</span><span class="va">routes</span><span class="op">$</span><span class="va">route_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="va">seed</span><span class="op">$</span><span class="va">routes</span><span class="op">$</span><span class="va">route_type</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span>,<span class="fl">11</span>,<span class="fl">12</span><span class="op">)</span>,</span>
<span>    <span class="va">seed</span><span class="op">$</span><span class="va">routes</span><span class="op">$</span><span class="va">route_type</span>,</span>
<span>    <span class="va">replace_by</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Réécriture du fichier GTFS avec la modification</span></span>
<span>  <span class="fu">gtfstools</span><span class="fu">::</span><span class="fu"><a href="https://ipeagit.github.io/gtfstools/reference/write_gtfs.html">write_gtfs</a></span><span class="op">(</span><span class="va">seed</span>, <span class="va">gtfs_file</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Appel de la fonction</span></span>
<span><span class="va">destfile</span> <span class="op">&lt;-</span> <span class="st">"data/chap05/_DataReseau/GTFS_clients.zip"</span></span>
<span><span class="fu">clean_gtfs_types</span><span class="op">(</span><span class="va">destfile</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>Pour ce fichier, le seul type de ligne utilisé est le numéro 3, soit des lignes de bus.</p>
</section></section><section id="sec-0522" class="level3" data-number="5.2.2"><h3 data-number="5.2.2" class="anchored" data-anchor-id="sec-0522">
<span class="header-section-number">5.2.2</span> Construction du réseau avec R5R</h3>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong><code>R5R</code> et JDK Java et allocation de la mémoire</strong></p>
</div>
<div class="bloc_attention-body">
<p>Le <em>package</em> <code>R5R</code> utilise la version 21 de la JDK de Java (<em>Java Development Kit</em>). Vous devez préalablement la <a href="https://adoptium.net/">télécharger</a> et l’installer sur votre ordinateur. Les deux lignes de code ci-dessous permettent de vérifier si elle est bien installée sur votre ordinateur.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Vérification que la JDK version 21 est bien installée</span></span>
<span><span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jinit.html">.jinit</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jcall.html">.jcall</a></span><span class="op">(</span><span class="st">"java.lang.System"</span>, <span class="st">"S"</span>, <span class="st">"getProperty"</span>, <span class="st">"java.version"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "21.0.3"</code></pre>
</div>
</div>
<p>Il est fortement conseillé d’augmenter la mémoire allouée au processus JAVA, surtout si vous souhaitez calculer des matrices origines-destinations de grande taille. Par exemple, la commande <code>options(java.parameters = "-Xmx2G")</code> permet d’augmenter la mémoire disponible pour JAVA à deux gigaoctets. Si votre ordinateur ne manque pas de mémoire vive (16, 32 ou 64&nbsp;gigaoctets), n’hésitez pas à augmenter ce paramètre (par exemple, <code>options(java.parameters = "-Xmx8G")</code>).</p>
</div>
</div>
<p>Nous utilisons la fonction <code>setup_r5</code> pour construire un réseau multimode à partir des trois fichiers&nbsp;:</p>
<ul>
<li><p>Le fichier OSM (<code>openstreetmap_fr_sherbrooke.pbf</code>).</p></li>
<li><p>Le fichier GTFS pour la Société de Transport de Sherbrooke (<code>GTFS_clients.zip</code>).</p></li>
<li><p>Le fichier d’élévation pour la région de Sherbrooke (<code>Elevation.tif</code>).</p></li>
</ul>
<p>Notez les paramètres suivants pour la fonction <code>setup_r5</code>&nbsp;:</p>
<ul>
<li><p><code>data_path</code> pour définir le dossier dans lequel sont présents les trois fichiers.</p></li>
<li><p><code>elevation = "TOBLER"</code> pour utiliser la fonction d’impédance de Tobler pour la marche et le vélo qui prend en compte la pente.</p></li>
<li><p><code>overwrite = FALSE</code> pour ne pas écraser le réseau s’il est déjà construit. La construction d’un réseau peut être très longue dépendamment de la taille des trois fichiers (OSM, GTFS, élévation). Par conséquent, n’oubliez pas de spécifier cette option si votre réseau a déjà été construit.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/r5r">r5r</a></span><span class="op">)</span></span>
<span><span class="co">## Allocation de la mémoire pour Java</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="st">"-Xmx2G"</span><span class="op">)</span></span>
<span><span class="co">## Construction du réseau R5R</span></span>
<span><span class="va">r5r_core</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/setup_r5.html">setup_r5</a></span><span class="op">(</span>data_path <span class="op">=</span> <span class="st">"data/chap05/_DataReseau/"</span>,</span>
<span>                     elevation <span class="op">=</span> <span class="st">"TOBLER"</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="cn">FALSE</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La fonction <code>setup_r5</code> a créé deux nouveaux fichiers (<em>network.dat</em> et <em>network_settings.json</em>) qui sont utilisés par le <em>package</em> <code>r5r</code> pour les analyses de réseau.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Liste des fichiers dans le dossier </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"data/chap05/_DataReseau/"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Elevation.tif"                          
[2] "GTFS_clients.zip"                       
[3] "network.dat"                            
[4] "network_settings.json"                  
[5] "openstreetmap_fr_sherbrooke.pbf"        
[6] "openstreetmap_fr_sherbrooke.pbf.mapdb"  
[7] "openstreetmap_fr_sherbrooke.pbf.mapdb.p"</code></pre>
</div>
</div>
</section><section id="sec-0523" class="level3" data-number="5.2.3"><h3 data-number="5.2.3" class="anchored" data-anchor-id="sec-0523">
<span class="header-section-number">5.2.3</span> Calcul d’itinéraires avec R5R selon le mode de transport</h3>
<p>Pour calculer un trajet, nous utilisons la fonction <code>detailed_itineraries</code> dont les paramètres sont décrits dans l’encadré ci-dessous.</p>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Paramètres de la fonction <code>detailed_itineraries</code></strong></p>
</div>
<div class="bloc_attention-body">
<ul>
<li>
<strong><code>r5r_core</code></strong>: le réseau créé avec la fonction <code><a href="https://rdrr.io/pkg/r5r/man/setup_r5.html">setup_r5()</a></code> décrite plus haut.</li>
<li>
<strong><code>origins</code></strong>: un point <code>sf</code> projeté en WGS84 ou un <code>data.frame</code> comprenant les colonnes <code>id</code>, <code>lon</code> et <code>lat</code>.</li>
<li>
<strong><code>destinations</code></strong>: un point <code>sf</code> projeté en WGS84 ou un <code>data.frame</code> comprenant les colonnes <code>id</code>, <code>lon</code> et <code>lat</code>.</li>
<li>
<strong><code>mode</code></strong>: un vecteur de type caractères définissant les modes de transport dont les principaux sont&nbsp;:
<ul>
<li>
<code>"WALK"</code> pour la marche.</li>
<li>
<code>"BICYCLE"</code> pour le vélo.</li>
<li>
<code>"CAR"</code> pour l’automobile.</li>
<li>
<code>"c("WALK",TRANSIT")</code> pour la marche et le transport en commun.</li>
</ul>
</li>
<li>
<strong><code>departure_datetime</code></strong>: un objet <code>POSIXct</code> définissant la date et l’heure de départ à utiliser si vous souhaitez calculer un trajet en transport en commun.</li>
<li>
<strong><code>max_walk_time=inf</code></strong>: un nombre entier définissant le temps de marche maximal en minutes pour chaque segment du trajet. La valeur par défaut est sans limite (<code>Inf</code>).</li>
<li>
<strong><code>max_bike_time = Inf</code></strong>: un nombre entier définissant le temps maximal à vélo en minutes.</li>
<li>
<strong><code>max_car_time = Inf</code></strong>: un nombre entier définissant le temps maximal en automobile en minutes.</li>
<li>
<strong><code>max_trip_duration = 120</code></strong>: un nombre entier définissant le temps maximal du trajet qui est fixé à 120&nbsp;minutes par défaut. Par conséquent, tout trajet d’une durée supérieure à ce seuil ne sera pas calculé.</li>
<li>
<strong><code>walk_speed = 3.6</code></strong>: une valeur numérique définissant la vitesse moyenne de marche qui est fixée par défaut à 3,6&nbsp;km/h. Ce seuil est très conservateur et pourrait être augmenté à 4,5&nbsp;km/h.</li>
<li>
<strong><code>bike_speed = 12</code></strong>: une valeur numérique définissant la vitesse moyenne à vélo qui est fixée par défaut à 12&nbsp;km/h. Ce seuil est aussi très conservateur et pourrait être augmenté à 15 ou 16&nbsp;km/h.</li>
<li>
<strong><code>max_lts = 2</code></strong>: un nombre entier de 1 à 4 qui indique le niveau de stress lié à la circulation que les cyclistes sont prêts à tolérer. Une valeur de 1 signifie que les cyclistes n’emprunteront que les rues les plus calmes, tandis qu’une valeur de 4 indique que les cyclistes peuvent emprunter n’importe quelle route.
<ul>
<li>
<code>max_lts = 1</code>: tolérable pour les enfants.</li>
<li>
<code>max_lts = 2</code>: tolérable pour la population adulte en général.</li>
<li>
<code>max_lts = 3</code>: tolérable pour les cyclistes enthousiastes et confiants.</li>
<li>
<code>max_lts = 4</code>: tolérable uniquement pour les cyclistes intrépides.</li>
</ul>
</li>
<li>
<strong><code>drop_geometry = FALSE</code></strong>: si ce paramètre est fixé à TRUE, la géométrie du trajet ne sera pas incluse.</li>
</ul>
</div>
</div>
<section id="sec-05231" class="level4" data-number="5.2.3.1"><h4 data-number="5.2.3.1" class="anchored" data-anchor-id="sec-05231">
<span class="header-section-number">5.2.3.1</span> Calcul d’itinéraires selon les modes de transport actif</h4>
<p>Dans un premier temps, nous calculons des trajets à vélo entre les deux localisations suivantes&nbsp;:</p>
<ul>
<li><p>Le point <code>Pt.W</code> situé à l’intersection de la rue Wellington et de la Côte de l’Acadie (45,38947; -71,88393).</p></li>
<li><p>Le point <code>Pt.D</code> situé à l’intersection des rues Darche et Dorval (45,38353; -71,89169).</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Création d'une couche sf avec les deux points</span></span>
<span><span class="va">Pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rue Wellington S."</span>, <span class="st">"Rue Darche"</span><span class="op">)</span>,</span>
<span>                         lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="fl">45.38947</span>,  <span class="fl">45.38353</span><span class="op">)</span>,</span>
<span>                         lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">71.88393</span>, <span class="op">-</span><span class="fl">71.89169</span><span class="op">)</span></span>
<span>                         <span class="op">)</span></span>
<span><span class="va">Pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">Pts</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">Pt.W</span> <span class="op">&lt;-</span> <span class="va">Pts</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">Pt.D</span> <span class="op">&lt;-</span> <span class="va">Pts</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Avec la fonction <code>detailed_itineraries</code>, les durées sont estimées à respectivement six et huit minutes (<a href="#fig-TrajetsVelo">figure&nbsp;<span>5.8</span></a>). Bien que le chemin emprunté soit le même, cet écart s’explique par la Côte de l’Acadie, soit l’un des tronçons de rue les plus pentus de la ville de Sherbrooke.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Trajets en vélo</span></span>
<span><span class="va">velo.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                               origins <span class="op">=</span> <span class="va">Pt.W</span>,</span>
<span>                               destinations <span class="op">=</span> <span class="va">Pt.D</span>,</span>
<span>                               mode <span class="op">=</span> <span class="st">"BICYCLE"</span>, <span class="co"># Vélo</span></span>
<span>                               bike_speed <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                               shortest_path <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                               drop_geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">velo.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                               origins <span class="op">=</span> <span class="va">Pt.D</span>,</span>
<span>                               destinations <span class="op">=</span> <span class="va">Pt.W</span>,</span>
<span>                               mode <span class="op">=</span> <span class="st">"BICYCLE"</span>, <span class="co"># Vélo</span></span>
<span>                               bike_speed <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                               shortest_path <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                               drop_geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">velo.1</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 16 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -71.89191 ymin: 45.3835 xmax: -71.88387 ymax: 45.38955
Geodetic CRS:  WGS 84
            from_id from_lat  from_lon      to_id   to_lat    to_lon option
1 Rue Wellington S. 45.38947 -71.88393 Rue Darche 45.38353 -71.89169      1
  departure_time total_duration total_distance segment    mode segment_duration
1       15:18:25            8.1           1215       1 BICYCLE              8.1
  wait distance route                       geometry
1    0     1215       LINESTRING (-71.88396 45.38...</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">velo.2</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 16 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -71.89191 ymin: 45.3835 xmax: -71.88387 ymax: 45.38955
Geodetic CRS:  WGS 84
     from_id from_lat  from_lon             to_id   to_lat    to_lon option
1 Rue Darche 45.38353 -71.89169 Rue Wellington S. 45.38947 -71.88393      1
  departure_time total_duration total_distance segment    mode segment_duration
1       15:18:25            6.8           1215       1 BICYCLE              6.8
  wait distance route                       geometry
1    0     1215       LINESTRING (-71.89191 45.38...</code></pre>
</div>
</div>
<p>Pour visualiser les trajets, nous utilisons le <em>package</em> <code>tmap</code> en mode <code>view</code>. Notez qu’un clic sur le trajet fait apparaître une fenêtre surgissante.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span></span>
<span><span class="co"># Cartographie des trajets avec tmap</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">velo.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, </span>
<span>           popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"segment_duration"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Pt.W</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Pt.D</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">velo.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>           popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"segment_duration"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Pt.D</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Pt.W</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-TrajetsVelo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/TrajetsVelo.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.8: Trajets à vélo entre les deux destinations</figcaption></figure>
</div>
<p>Dans un second temps, nous calculons les trajets à pied avec les deux mêmes localisations qui sont estimées à 16 et 21&nbsp;minutes (<a href="#fig-TrajetsMarche">figure&nbsp;<span>5.9</span></a>).</p>
<div id="fig-TrajetsMarche" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/TrajetsMarche.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.9: Trajets à pied entre les deux destinations</figcaption></figure>
</div>
</section><section id="sec-05232" class="level4" data-number="5.2.3.2"><h4 data-number="5.2.3.2" class="anchored" data-anchor-id="sec-05232">
<span class="header-section-number">5.2.3.2</span> Calcul d’itinéraires en automobile</h4>
<p>Nous calculons ici l’itinéraire entre le campus principal de l’<a href="https://www.usherbrooke.ca/">Université de Sherbrooke</a> et une localisation (45,4220308; -71,881828). Nous fixons alors <code>mode = "CAR"</code> pour la fonction <code>detailed_itineraries</code>. Les trajets sont respectivement estimés à 21,7 et 18,8&nbsp;minutes à destination et au départ du campus principal.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">UDeS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"Campus principal"</span>, lon <span class="op">=</span> <span class="op">-</span><span class="fl">71.929526</span>, lat <span class="op">=</span> <span class="fl">45.378017</span><span class="op">)</span></span>
<span><span class="va">UDeS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">UDeS</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">Point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"Départ"</span>, lon <span class="op">=</span> <span class="op">-</span><span class="fl">71.881828</span>, lat <span class="op">=</span> <span class="fl">45.4220308</span><span class="op">)</span></span>
<span><span class="va">Point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">Point</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Auto.Aller</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                 origins <span class="op">=</span> <span class="va">Point</span>,</span>
<span>                                 destinations <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                                 mode <span class="op">=</span> <span class="st">"CAR"</span>, <span class="co"># Automobile</span></span>
<span>                                 shortest_path <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 drop_geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Auto.Retour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                               origins <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                               destinations <span class="op">=</span> <span class="va">Point</span>,</span>
<span>                               mode <span class="op">=</span> <span class="st">"CAR"</span>, <span class="co"># Automobile</span></span>
<span>                               shortest_path <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                               drop_geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Auto.Aller</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 16 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -71.93373 ymin: 45.37722 xmax: -71.88129 ymax: 45.42365
Geodetic CRS:  WGS 84
  from_id from_lat  from_lon            to_id   to_lat    to_lon option
1  Départ 45.42203 -71.88183 Campus principal 45.37802 -71.92953      1
  departure_time total_duration total_distance segment mode segment_duration
1       15:18:26             22          11352       1  CAR               22
  wait distance route                       geometry
1    0    11352       LINESTRING (-71.88129 45.42...</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Auto.Retour</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 16 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -71.93312 ymin: 45.37759 xmax: -71.87607 ymax: 45.42234
Geodetic CRS:  WGS 84
           from_id from_lat  from_lon  to_id   to_lat    to_lon option
1 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
  departure_time total_duration total_distance segment mode segment_duration
1       15:18:26           19.2           9685       1  CAR             19.2
  wait distance route                       geometry
1    0     9685       LINESTRING (-71.92952 45.37...</code></pre>
</div>
</div>
<p>Bien entendu, les deux trajets sont différents en raison des sens de circulation (<a href="#fig-TrajetsAuto">figure&nbsp;<span>5.10</span></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cartographie des trajets avec tmap</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Auto.Aller</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>           popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"segment_duration"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Point</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Auto.Retour</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>           popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"segment_duration"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Point</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="co"># Figure avec les deux cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-TrajetsAuto" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/TrajetsAuto.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.10: Trajets en voiture entre les deux destinations</figcaption></figure>
</div>
</section><section id="sec-05233" class="level4" data-number="5.2.3.3"><h4 data-number="5.2.3.3" class="anchored" data-anchor-id="sec-05233">
<span class="header-section-number">5.2.3.3</span> Calcul d’itinéraires en transport en commun</h4>
<p>Pour le calcul d’itinéraires en transport en commun, nous devons fixer une heure de départ et un temps de marche maximal pour chaque segment du trajet réalisé à pied, soit&nbsp;:</p>
<ul>
<li>du domicile à l’arrêt de bus le plus proche;</li>
<li>entre deux arrêts de bus de lignes différentes;</li>
<li>du dernier arrêt de bus à la destination finale.</li>
</ul>
<p>Dans le code ci-dessous, nous fixons les heures de départ et d’arrivée à 8&nbsp;h et à 18&nbsp;h pour le 28 février 2024 et un temps de marche maximal de 20&nbsp;minutes.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">### Définition de la journée et de l'heure de départ</span></span>
<span><span class="va">dateheure.matin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"28-02-2024 08:05:00"</span>,</span>
<span>                              format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dateheure.soir</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"28-02-2024 18:00:00"</span>,</span>
<span>                              format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span><span class="co">### Définition du temps de marche maximal</span></span>
<span><span class="va">minutes_marches_max</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Toujours avec la fonction <code>detailed_itineraries</code>, nous modifions les paramètres comme suit&nbsp;:</p>
<ul>
<li><p><code>mode = c("WALK", "TRANSIT")</code> pour le transport en commun.</p></li>
<li><p><code>walk_speed = 4.5</code> pour une vitesse moyenne à la marche de 4,5&nbsp;km/h.</p></li>
<li><p><code>departure_datetime = dateheure.matin</code> pour un départ le 28&nbsp;février 2024 à 8&nbsp;h.</p></li>
<li><p><code>departure_datetime = dateheure.soir</code> pour un départ le 28&nbsp;février 2024 à 18&nbsp;h.</p></li>
<li><p><code>max_walk_time = minutes_marches_max</code> pour un temps maximal de marche de 20&nbsp;minutes.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TC.Aller</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                   origins <span class="op">=</span> <span class="va">Point</span>,</span>
<span>                                   destinations <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                                   mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,</span>
<span>                                   max_walk_time <span class="op">=</span> <span class="va">minutes_marches_max</span>,</span>
<span>                                   walk_speed <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>                                   departure_datetime <span class="op">=</span> <span class="va">dateheure.matin</span>,</span>
<span>                                   shortest_path <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                   drop_geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">TC.Retour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/detailed_itineraries.html">detailed_itineraries</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                    origins <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                                    destinations <span class="op">=</span> <span class="va">Point</span>,</span>
<span>                                    mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,</span>
<span>                                    max_walk_time <span class="op">=</span> <span class="va">minutes_marches_max</span>,</span>
<span>                                    walk_speed <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>                                    departure_datetime <span class="op">=</span> <span class="va">dateheure.soir</span>,</span>
<span>                                    shortest_path <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    drop_geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour l’option&nbsp;1, la durée du trajet à 8&nbsp;h vers l’Université de Sherbrooke est estimée à 50,8&nbsp;minutes avec trois segments&nbsp;:</p>
<ul>
<li><p>Un premier segment de 8,6&nbsp;minutes et 661&nbsp;mètres à pied.</p></li>
<li><p>Un second de 39,0&nbsp;minutes et 10,862&nbsp;km en autobus.</p></li>
<li><p>Un troisième de 1,8&nbsp;minutes et 127&nbsp;mètres à pied.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TC.Aller</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 16 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
 [1] from_id          from_lat         from_lon         to_id           
 [5] to_lat           to_lon           option           departure_time  
 [9] total_duration   total_distance   segment          mode            
[13] segment_duration wait             distance         route           
[17] geometry        
&lt;0 lignes&gt; (ou 'row.names' de longueur nulle)</code></pre>
</div>
</div>
<p>Pour l’option&nbsp;1, la durée du trajet à 18&nbsp;h au départ de l’Université de Sherbrooke est estimée à 53,5&nbsp;minutes avec trois segments&nbsp;:</p>
<ul>
<li><p>Un premier segment de 1,3&nbsp;minutes et 102&nbsp;mètres à pied.</p></li>
<li><p>Un second de 19,8&nbsp;minutes et 7,060&nbsp;km en autobus.</p></li>
<li><p>Un troisième de 18,4&nbsp;minutes et 1,183&nbsp;km à pied.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TC.Retour</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 16 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
 [1] from_id          from_lat         from_lon         to_id           
 [5] to_lat           to_lon           option           departure_time  
 [9] total_duration   total_distance   segment          mode            
[13] segment_duration wait             distance         route           
[17] geometry        
&lt;0 lignes&gt; (ou 'row.names' de longueur nulle)</code></pre>
</div>
</div>
<p>Les deux trajets en transport en commun sont représentés à la <a href="#fig-TrajetsTC">figure&nbsp;<span>5.11</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">TC.Aller</span>, <span class="va">option</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"mode"</span>, lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                     popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, </span>
<span>                                    <span class="st">"segment_duration"</span>, <span class="st">"distance"</span>,</span>
<span>                                    <span class="st">"total_duration"</span>, <span class="st">"total_distance"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Point</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_view.html">tm_view</a></span><span class="op">(</span>view.legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">TC.Retour</span>, <span class="va">option</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"mode"</span>, lwd <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                       popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, </span>
<span>                                      <span class="st">"segment_duration"</span>, <span class="st">"distance"</span>,</span>
<span>                                      <span class="st">"total_duration"</span>, <span class="st">"total_distance"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Point</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"green"</span>, size <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_view.html">tm_view</a></span><span class="op">(</span>view.legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-TrajetsTC" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/TrajetsTC.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.11: Trajets en transport en commun entre les deux destinations</figcaption></figure>
</div>
</section></section><section id="sec-0524" class="level3" data-number="5.2.4"><h3 data-number="5.2.4" class="anchored" data-anchor-id="sec-0524">
<span class="header-section-number">5.2.4</span> Délimitation d’isochrones avec R5R selon le mode de transport</h3>
<p>Le fonction <code>isochrone</code> du <em>package</em> <code>R5R</code> permet de délimiter des zones de desserte selon la distance-temps et différents modes de transport. Ses paramètres sont d’ailleurs les mêmes que ceux de la fonction <code>detailed_itineraries</code>, à l’exception de&nbsp;:</p>
<ul>
<li><p>Il n’y a pas de paramètre <code>destinations</code> puisque l’isochrone est uniquement délimité à partir de points d’origines (<code>origins</code>).</p></li>
<li><p>Le paramètre <code>cutoffs = c(0, 15, 30)</code> permet de définir différentes isochrones en minutes.</p></li>
<li><p>Le paramètre <code>sample_size</code> est utilisé pour tracer les isochrones. Variant de 0,2 à 1, sa valeur par défaut de 0,8 signifie que 80&nbsp;% des nœuds du réseau de transport sont utilisés pour tracer l’isochrone. Plus cette valeur est proche de 1, plus l’isochrone est précise, mais plus sa vitesse de calcul est longue.</p></li>
</ul>
<p>Dans l’exemple ci-dessous, nous calculons plusieurs isochrones à partir du campus principal de l’Université de Sherbrooke en fonction du mode transport (<a href="#fig-Isochrones">figure&nbsp;<span>5.12</span></a>)&nbsp;:</p>
<ol type="1">
<li><p>Trois isochrones de 10, 20 et 30&nbsp;minutes à pied.</p></li>
<li><p>Trois isochrones de 10, 20 et 30&nbsp;minutes en vélo.</p></li>
<li><p>Trois isochrones de 5, 10 et 20&nbsp;minutes en automobile.</p></li>
<li><p>Deux isochrone de 20 et 40&nbsp;minutes en transport en commun le 28&nbsp;février&nbsp;2024 à 18&nbsp;h avec un durée maximale de marche de 15&nbsp;minutes.</p></li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Point pour l'université de Sherbrooke</span></span>
<span><span class="va">UDeS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"Campus principal"</span>, lon <span class="op">=</span> <span class="op">-</span><span class="fl">71.929526</span>, lat <span class="op">=</span> <span class="fl">45.378017</span><span class="op">)</span></span>
<span><span class="va">UDeS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">UDeS</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_options.html">tmap_options</a></span><span class="op">(</span>check.and.fix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Trois isochrones à pied de 10, 20 et 30 minutes</span></span>
<span><span class="va">Isochrome.marche</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/isochrone.html">isochrone</a></span><span class="op">(</span><span class="va">r5r_core</span>,</span>
<span>                      origins <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                      mode <span class="op">=</span> <span class="st">"WALK"</span>,</span>
<span>                      cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                      sample_size <span class="op">=</span> <span class="fl">.8</span>,</span>
<span>                      time_window <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte.Marche</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Isochrome.marche</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"isochrone"</span>, </span>
<span>                            alpha <span class="op">=</span> <span class="fl">.4</span>, </span>
<span>                            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                            title <span class="op">=</span><span class="st">"Marche"</span>,</span>
<span>                            legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Trois isochrones à vélo de 10, 20 et 30 minutes</span></span>
<span><span class="va">Isochrome.velo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/isochrone.html">isochrone</a></span><span class="op">(</span><span class="va">r5r_core</span>,</span>
<span>                      origins <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                      mode <span class="op">=</span> <span class="st">"BICYCLE"</span>,</span>
<span>                      cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                      sample_size <span class="op">=</span> <span class="fl">.8</span>,</span>
<span>                      time_window <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carto.Velo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Isochrome.velo</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"isochrone"</span>, </span>
<span>                            alpha <span class="op">=</span> <span class="fl">.4</span>, </span>
<span>                            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                            title <span class="op">=</span><span class="st">"Vélo"</span>,</span>
<span>                            legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Trois isochrones en auto de 5, 10 et 20 minutes</span></span>
<span><span class="va">Isochrome.auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/isochrone.html">isochrone</a></span><span class="op">(</span><span class="va">r5r_core</span>,</span>
<span>                      origins <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                      mode <span class="op">=</span> <span class="st">"CAR"</span>,</span>
<span>                      cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                      sample_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      time_window <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carto.Auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Isochrome.auto</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"isochrone"</span>, </span>
<span>                            alpha <span class="op">=</span> <span class="fl">.4</span>, </span>
<span>                            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                            title <span class="op">=</span><span class="st">"Automobile"</span>,</span>
<span>                            legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Deux isochrones en transport en commun de 20, 40 et 60 minutes</span></span>
<span><span class="va">dateheure.soir</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"28-02-2024 18:00:00"</span>,</span>
<span>                              format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span><span class="va">Isochrome.tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/isochrone.html">isochrone</a></span><span class="op">(</span><span class="va">r5r_core</span>,</span>
<span>                      origins <span class="op">=</span> <span class="va">UDeS</span>,</span>
<span>                      mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,</span>
<span>                      max_walk_time <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                      departure_datetime <span class="op">=</span> <span class="va">dateheure.soir</span>,</span>
<span>                      cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>                      sample_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      time_window <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carto.TC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Isochrome.tc</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"isochrone"</span>, </span>
<span>                            alpha <span class="op">=</span> <span class="fl">.4</span>, </span>
<span>                            breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>                            title <span class="op">=</span><span class="st">"Transport en commun"</span>,</span>
<span>                            legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">UDeS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span><span class="co">## Figure avec les quatre cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte.Marche</span>, <span class="va">Carto.Velo</span>,</span>
<span>             <span class="va">Carto.Auto</span>, <span class="va">Carto.TC</span>,</span>
<span>             ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-Isochrones" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/Isochrones.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.12: Isochrones selon les quatre modes de transport</figcaption></figure>
</div>
</section><section id="sec-0525" class="level3" data-number="5.2.5"><h3 data-number="5.2.5" class="anchored" data-anchor-id="sec-0525">
<span class="header-section-number">5.2.5</span> Calcul de matrices OD selon différents modes de transport</h3>
<p>Pour calculer des matrices origines-destinations selon différents modes de transport, nous utilisons la fonction <code>travel_time_matrix</code> dont les paramètres sont quasi les mêmes que la <code>detailed_itineraries</code> (<a href="#sec-0523">section&nbsp;<span>5.2.3</span></a>). Dans le code ci-dessous, nous importons 284&nbsp;adresses tirées aléatoirement et les supermarchés présents sur le territoire de la ville de Sherbrooke.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Importation des couches</span></span>
<span><span class="va">Adresses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/Chap05/AutresDonnees/Commerces.gpkg"</span>,</span>
<span>                        layer <span class="op">=</span> <span class="st">"AdressesAleatoires"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">supermarches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/Chap05/AutresDonnees/Commerces.gpkg"</span>,</span>
<span>                        layer <span class="op">=</span> <span class="st">"supermarche"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Nombre de distances à calculer</span></span>
<span><span class="va">nO</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span></span>
<span><span class="va">nD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">supermarches</span><span class="op">)</span></span>
<span><span class="va">NOD</span> <span class="op">=</span> <span class="va">nO</span> <span class="op">*</span> <span class="va">nD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Origines (O) :"</span>, <span class="va">nO</span>, <span class="st">"adresses"</span>,</span>
<span>    <span class="st">"\n Destinations (D) :"</span>, <span class="va">nD</span>, <span class="st">"supermarchés"</span>,</span>
<span>    <span class="st">"\n Distances OD à calculer = "</span>, <span class="va">NOD</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Origines (O) : 184 adresses 
 Destinations (D) : 27 supermarchés 
 Distances OD à calculer =  4968</code></pre>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Origines et destinations</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="va">Adresses</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="va">supermarches</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">supermarches</span><span class="op">$</span><span class="va">osm_id</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">supermarches</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">supermarches</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"id"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Par la suite, nous calculons les différentes matrices OD&nbsp;:</p>
<ul>
<li><p><strong><code>matriceOD.Auto</code></strong> avec <code>mode = "CAR"</code>.</p></li>
<li><p><strong><code>matriceOD.Marche</code></strong> avec <code>mode = "WALK"</code>, <code>walk_speed = 4.5</code> et <code>max_trip_duration = 60</code>. La durée du trajet est limitée à 60&nbsp;minutes avec une vitesse moyenne de 4,5&nbsp;km/h.</p></li>
<li><p><strong><code>matriceOD.Velo</code></strong> avec <code>mode = "BICYCLE"</code>, <code>bike_speed = 15</code> et <code>max_trip_duration = 60</code>. La durée du trajet est limitée à 60&nbsp;minutes avec une vitesse moyenne de 15&nbsp;km/h.</p></li>
<li><p><strong><code>matriceOD.TC</code></strong> avec <code>mode = "c("WALK", "TRANSIT")"</code>, <code>walk_speed = 4.5</code>, <code>max_walk_time = 30</code>, <code>max_trip_duration = 120</code> et <code>departure_datetime = dateheure.soir</code>. La durée du trajet est limitée à 60&nbsp;minutes avec une vitesse moyenne de marche de 4,5&nbsp;km/h et une durée maximale de 30&nbsp;minutes pour chaque segment à la marche. L’heure de départ a été fixée comme suit&nbsp;: <code>dateheure.soir  &lt;- as.POSIXct("04-05-2023 18:00:00", format = "%d-%m-%Y %H:%M:%S")</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice OD en voiture</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">matriceOD.Auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                     origins <span class="op">=</span> <span class="va">Origines</span>,</span>
<span>                                     destinations <span class="op">=</span> <span class="va">Destinations</span>,</span>
<span>                                     mode <span class="op">=</span> <span class="st">"CAR"</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">duree.auto</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">t1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="co">## Matrice OD à la marche</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">matriceOD.Marche</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                       origins <span class="op">=</span> <span class="va">Origines</span>,</span>
<span>                                       destinations <span class="op">=</span> <span class="va">Destinations</span>,</span>
<span>                                       mode <span class="op">=</span> <span class="st">"WALK"</span>,</span>
<span>                                       walk_speed <span class="op">=</span> <span class="fl">4.5</span>,  <span class="co"># valeur par défaut 3.6</span></span>
<span>                                       max_trip_duration <span class="op">=</span> <span class="fl">60</span>, <span class="co"># 1 heure de marche maximum</span></span>
<span>                                       max_walk_time <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">duree.marche</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">t1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="co">## Matrice OD en vélo</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">matriceOD.Velo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                     origins <span class="op">=</span> <span class="va">Origines</span>,</span>
<span>                                     destinations <span class="op">=</span> <span class="va">Destinations</span>,</span>
<span>                                     mode <span class="op">=</span> <span class="st">"BICYCLE"</span>,</span>
<span>                                     bike_speed <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                     max_trip_duration <span class="op">=</span> <span class="fl">60</span>,</span>
<span>                                     max_bike_time <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">duree.velo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">t1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="co">## Matrice OD en transport en commun</span></span>
<span><span class="va">dateheure.soir</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"04-05-2023 18:00:00"</span>,</span>
<span>                              format <span class="op">=</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span><span class="op">)</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">matriceOD.TC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                   origins <span class="op">=</span> <span class="va">Origines</span>,</span>
<span>                                   destinations <span class="op">=</span> <span class="va">Destinations</span>,</span>
<span>                                   mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WALK"</span>, <span class="st">"TRANSIT"</span><span class="op">)</span>,</span>
<span>                                   walk_speed <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>                                   max_walk_time <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                   max_trip_duration <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                                   departure_datetime <span class="op">=</span> <span class="va">dateheure.soir</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">duree.tc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">t1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les temps de calcul des différentes matrices sont reportés ci-dessous.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Temps de calcul des matrices :"</span>, </span>
<span>     <span class="st">"\n Voiture : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.auto</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"secondes"</span>,</span>
<span>     <span class="st">"\n Marche : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.marche</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"secondes"</span>,</span>
<span>     <span class="st">"\n Vélo : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.velo</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"secondes"</span>,</span>
<span>     <span class="st">"\n Transport en commun : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.tc</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"secondes"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de calcul des matrices : 
 Voiture :  8.62 secondes 
 Marche :  0.33 secondes 
 Vélo :  2.88 secondes 
 Transport en commun :  0.26 secondes</code></pre>
</div>
</div>
<p>Une fois les matrices obtenues, nous les enregistrons dans un fichier <code>Rdata</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">matriceOD.Auto</span>, <span class="va">matriceOD.Marche</span>, </span>
<span>     <span class="va">matriceOD.Velo</span>, <span class="va">matriceOD.TC</span>,</span>
<span>     file<span class="op">=</span><span class="st">"data/chap05/Resultats/MatricesOD.Rdata"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Libération de la mémoire allouée à JAVA</strong></p>
</div>
<div class="bloc_attention-body">
<p>Une fois les calculs avec <code>R5R</code> terminés, il convient de détruire l’objet <code>r5r_core</code> et d’arrêter le processus JAVA avec les deux lignes de code ci-dessous.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/r5r/man/stop_r5.html">stop_r5</a></span><span class="op">(</span><span class="va">r5r_core</span><span class="op">)</span></span>
<span><span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jgc.html">.jgc</a></span><span class="op">(</span>R.gc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>À partir de ces matrices, nous extrayons la valeur minimale pour chacune des adresses pour les quatre modes de transport. Puis, nous opérons une jointure attributaire avec la couche des adresses aléatoires avec la fonction <code>merge</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Création d'un vecteur pour la distance au supermarché le plus proche </span></span>
<span><span class="va">SupermarchePlusProche.Auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">travel_time_p50</span> <span class="op">~</span> <span class="va">from_id</span>, <span class="va">matriceOD.Auto</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="va">SupermarchePlusProche.Pied</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">travel_time_p50</span> <span class="op">~</span> <span class="va">from_id</span>, <span class="va">matriceOD.Marche</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="va">SupermarchePlusProche.Velo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">travel_time_p50</span> <span class="op">~</span> <span class="va">from_id</span>, <span class="va">matriceOD.Velo</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="va">SupermarchePlusProche.tc</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">travel_time_p50</span> <span class="op">~</span> <span class="va">from_id</span>, <span class="va">matriceOD.TC</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="co">## Changement des noms des champs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">SupermarchePlusProche.Auto</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"SupPlusProcheAuto"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">SupermarchePlusProche.Pied</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"SupPlusProchePied"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">SupermarchePlusProche.Velo</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"SupPlusProcheVelo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">SupermarchePlusProche.tc</span><span class="op">)</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"SupPlusProcheTC"</span><span class="op">)</span></span>
<span><span class="co">## Jointure avec la couche des adresses</span></span>
<span><span class="va">Adresses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">Adresses</span>, <span class="va">SupermarchePlusProche.Auto</span>, by <span class="op">=</span><span class="st">"id"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Adresses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">Adresses</span>, <span class="va">SupermarchePlusProche.Pied</span>, by <span class="op">=</span><span class="st">"id"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Adresses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">Adresses</span>, <span class="va">SupermarchePlusProche.Velo</span>, by <span class="op">=</span><span class="st">"id"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Adresses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">Adresses</span>, <span class="va">SupermarchePlusProche.tc</span>, by <span class="op">=</span><span class="st">"id"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalement, nous utilisons le <em>package</em> <code>tmap</code> pour cartographier les résultats et réaliser une figure avec la fonction <code>tmap_arrange</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Importation des arrondissements de la ville de Sherbrooke</span></span>
<span><span class="va">arrondissements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/Chap05/AutresDonnees/Arrondissements.shp"</span>, </span>
<span>                           quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Construction des cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="va">max.auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">$</span><span class="va">SupPlusProcheAuto</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SupPlusProcheAuto"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="va">max.auto</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                    legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    title<span class="op">=</span><span class="st">"Voiture"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">max.pied</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">$</span><span class="va">SupPlusProchePied</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SupPlusProchePied"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">45</span>, <span class="va">max.pied</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                    title<span class="op">=</span><span class="st">"Marche"</span>,</span>
<span>                    textNA <span class="op">=</span> <span class="st">"Plus de 60"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">max.velo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">$</span><span class="va">SupPlusProcheVelo</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SupPlusProcheVelo"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">45</span>,<span class="va">max.velo</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                    title<span class="op">=</span><span class="st">"Vélo"</span>,</span>
<span>                    textNA <span class="op">=</span> <span class="st">"Plus de 60"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">max.tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">$</span><span class="va">SupPlusProcheTC</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Adresses</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SupPlusProcheTC"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">25</span>,<span class="va">max.tc</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                    title<span class="op">=</span><span class="st">"Bus"</span>,</span>
<span>                    textNA <span class="op">=</span> <span class="st">"Plus de 60"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Figure avec les quatre cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, <span class="va">Carte3</span>, <span class="va">Carte4</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CartoAdressesSupPlusProche" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="05-AnalyseReseau_files/figure-html/fig-CartoAdressesSupPlusProche-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.13: Supermarché le plus proche en minutes selon le mode de transport</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-053" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="sec-053">
<span class="header-section-number">5.3</span> Mesures d’accessibilité</h2>
<section id="sec-0531" class="level3" data-number="5.3.1"><h3 data-number="5.3.1" class="anchored" data-anchor-id="sec-0531">
<span class="header-section-number">5.3.1</span> Notion d’accessibilité</h3>
<p>Dans un article fondateur intitulé <em>The concept of access: definition and relationship to consumer satisfaction</em>, Roy Penchansky et William Thomas <span class="citation" data-cites="penchansky1981concept">(<a href="references.html#ref-penchansky1981concept" role="doc-biblioref">1981</a>)</span> ont identifié cinq dimensions fondamentales au concept d’accessibilité aux services de santé&nbsp;:</p>
<ol type="1">
<li><p><strong>L’accessibilité spatiale</strong> (<em>accessibility</em>) renvoie à la proximité géographique du service par rapport à la population.</p></li>
<li><p><strong>La disponibilité</strong> (<em>availability</em>) renvoie à la quantité et aux types de services offerts selon les besoins des individus.</p></li>
<li><p><strong>L’organisation</strong> (<em>accommodation</em>) renvoie au fonctionnement du service (horaires, délais d’attente, prises de rendez-vous, etc.).</p></li>
<li><p><strong>L’accessibilité financière</strong> (<em>affordability</em>) renvoie aux coûts du service qui peuvent constituer une barrière financière pour les personnes défavorisées.</p></li>
<li><p><strong>L’accessibilité socioculturelle</strong> (<em>acceptability</em>) renvoie à l’acceptation et à l’adaptation des services aux différences sociales, culturelles ou linguistiques des personnes.</p></li>
</ol>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Les cinq dimensions de l’accessibilité et le type de service analysé</strong></p>
</div>
<div class="bloc_objectif-body">
<p>L’importance accordée à chacune des cinq dimensions identifiées par Roy Penchansky et William Thomas <span class="citation" data-cites="penchansky1981concept">(<a href="references.html#ref-penchansky1981concept" role="doc-biblioref">1981</a>)</span> varie en fonction du type de service à l’étude. Prenons l’exemple des parcs urbains&nbsp;:</p>
<ol type="1">
<li><p>L’<strong>accessibilité spatiale</strong>, soit la proximité géographique est sans aucun doute une dimension très importante.</p></li>
<li><p>La <strong>disponibilité</strong> (<em>availability</em>) renvoie à différents équipements (aires de jeu pour enfants, terrains de sports, etc.) présents dans le parc.</p></li>
<li><p>La dimension de l’<strong>organisation</strong> (<em>accommodation</em>) risque d’être moins importante puisque les heures d’ouverture et les modalités de réservation de certains types de terrain de sport (comme un terrain de tennis) ne varient habituellement pas d’un parc à l’autre au sein d’une même ville.</p></li>
<li><p>La dimension de l’<strong>accessibilité financière</strong> (<em>affordability</em>) risque aussi d’être moins importante puisque l’accès au parc et à ses équipements est gratuit, à l’exception de certains terrains de sport très spécialisés.</p></li>
<li><p>L’<strong>accessibilité socioculturelle</strong> (<em>acceptability</em>) peut être une dimension très importante et renvoie à l’acceptation des différences sociales, générationnelles et ethnoculturelles des personnes utilisatrices des parcs.</p></li>
</ol>
</div>
</div>
<p>Plus récemment, la notion d’accessibilité à un service a été définie selon deux dimensions, soit <strong>réelle (ou révélée)</strong> ou <strong>potentielle</strong> et <strong>spatiale</strong> ou <strong>aspatiale</strong> <span class="citation" data-cites="guagliardo2004spatial luo2003measures khan1992integrated">(<a href="references.html#ref-guagliardo2004spatial" role="doc-biblioref">Guagliardo 2004</a>; <a href="references.html#ref-luo2003measures" role="doc-biblioref">Luo et Wang 2003</a>; <a href="references.html#ref-khan1992integrated" role="doc-biblioref">Khan 1992</a>)</span>&nbsp;:</p>
<ol type="1">
<li><p>L’accessibilité réelle renvoie à l’utilisation effective des services tandis que l’accessibilité potentielle renvoie à leur utilisation probable.</p></li>
<li><p>L’accessibilité spatiale renvoie à l’importance de la séparation spatiale entre l’offre et la demande de services en tant que barrière ou facilitateur, et l’accessibilité aspatiale (dimensions financière, socioculturelle, organisationnelle) se concentre sur les barrières ou facilitateurs non géographiques <span class="citation" data-cites="luo2003measures ngui2011optimizing">(<a href="references.html#ref-luo2003measures" role="doc-biblioref">Luo et Wang 2003</a>; <a href="references.html#ref-ngui2011optimizing" role="doc-biblioref">Ngui et Apparicio 2011</a>)</span>.</p></li>
</ol>
<p>Par conséquent, la notion d’accessibilité aux services de santé englobe quatre catégories principales : <strong>l’accessibilité spatiale réelle</strong>, <strong>l’accessibilité aspatiale réelle</strong>, <strong>l’accessibilité spatiale potentielle</strong> et <strong>l’accessibilité aspatiale potentielle</strong> <span class="citation" data-cites="khan1992integrated">(<a href="references.html#ref-khan1992integrated" role="doc-biblioref">Khan 1992</a>)</span>. Par exemple, si nous questionnons un groupe de personnes sur la localisation des parcs qu’elles fréquentent habituellement, nous pourrions dresser un portrait sur leur accessibilité spatiale réelle aux parcs. Par contre, si nous calculons le nombre d’hectares de parcs présents dans un rayon de 20&nbsp;minutes de marche autour de leur domicile, nous pourrions évaluer leur accessibilité spatiale potentielle aux parcs.</p>
</section><section id="sec-0532" class="level3" data-number="5.3.2"><h3 data-number="5.3.2" class="anchored" data-anchor-id="sec-0532">
<span class="header-section-number">5.3.2</span> Accessibilité spatiale potentielle</h3>
<p>Dans le cadre de cette section, nous abordons l’accessibilité spatiale potentielle qui suppose de paramétrer quatre éléments&nbsp;: l’unité spatiale de référence, la méthode d’agrégation, la ou les mesures d’accessibilité et le type de distance <span class="citation" data-cites="ApparicioGelbrevisited">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">Apparicio et al. 2017</a>)</span>.</p>
<section id="sec-05321" class="level4" data-number="5.3.2.1"><h4 data-number="5.3.2.1" class="anchored" data-anchor-id="sec-05321">
<span class="header-section-number">5.3.2.1</span> Unité spatiale de référence</h4>
<p>L’entité spatiale de référence correspond aux entités spatiales pour lesquelles l’accessibilité sera évaluée et cartographiée qui pourrait être&nbsp;:</p>
<ul>
<li><p>Les centroïdes des bâtiments résidentiels d’une ville donnée.</p></li>
<li><p>Des entités polygonales représentant des zones résidentielles comme des <a href="https://www150.statcan.gc.ca/n1/pub/92-195-x/2011001/geo/da-ad/def-fra.htm">aires de diffusion</a> (comprenant de 400 à 700 habitants) ou des <a href="https://www150.statcan.gc.ca/n1/pub/92-195-x/2011001/geo/ct-sr/ct-sr-fra.htm">secteurs de recensement</a> (de 2500 à 8000 habitants).</p></li>
</ul>
<p>L’aire de diffusion et surtout le secteur de recensement sont souvent choisis puisqu’une panoplie de variables socioéconomiques, sociodémographiques et relatives au logement sont rattachées à ces entités spatiales pour les différents recensements de Statistique Canada. La sélection de ces entités spatiales (aire de diffusion ou secteur de recensement) permet alors d’évaluer les relations entre les mesures d’accessibilité et les variables socioéconomiques ou sociodémographiques. Néanmoins, cela nécessite de recourir à méthodes d’agrégation afin de limiter les erreurs dans la mesure de l’accessibilité spatiale potentielle <span class="citation" data-cites="ApparicioGelbrevisited hewko2002measuring">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">Apparicio et al. 2017</a>; <a href="references.html#ref-hewko2002measuring" role="doc-biblioref">Hewko, Smoyer-Tomic et Hodgson 2002</a>)</span>.</p>
</section><section id="sec-05322" class="level4" data-number="5.3.2.2"><h4 data-number="5.3.2.2" class="anchored" data-anchor-id="sec-05322">
<span class="header-section-number">5.3.2.2</span> Méthodes d’agrégation</h4>
<p>Dans un article méthodologique sur la comparaison des approches pour évaluer l’accessibilité spatiale potentielle, Apparicio <em>et al.</em> <span class="citation" data-cites="ApparicioGelbrevisited">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">2017</a>)</span> ont répertorié quatre principales méthodes d’agrégation pour évaluer une mesure d’accessibilité pour les secteurs de recensement. Ces approches, de la moins à la plus précise, sont les suivantes&nbsp;:</p>
<ul>
<li><p>La première approche consiste à calculer la distance entre le centroïde du secteur de recensement et le service (<a href="#fig-MethodesAgregations">figure&nbsp;<span>5.14</span></a>, a). Plus la taille du secteur de recensement est grande, plus l’erreur d’agrégation (l’imprécision de la mesure d’accessibilité) risque d’être importante puisqu’elle ne tient pas compte de la distribution spatiale de la population à l’intérieur du secteur de recensement. Autrement dit, cette approche revient à supposer que toute la population réside en son centroïde.</p></li>
<li><p>La seconde approche consiste à calculer la distance entre les services et les centroïdes d’entités spatiales entièrement incluses dans les secteurs de recensement, puis à calculer la moyenne de ces distances pondérée par la population totale de chaque entité spatiale. Cette approche est réalisée avec les aires de diffusion et les îlots inclus dans les secteurs de recensement (<a href="#fig-MethodesAgregations">figure&nbsp;<span>5.14</span></a>, b et c). Bien entendu, les résultats sont plus précis avec les îlots de diffusion que les aires de diffusion puisqu’ils sont de taille plus réduite.</p></li>
<li><p>La troisième approche consiste à ajuster la localisation des centroïdes des îlots en ne retenant que la partie résidentielle avec une carte d’occupation du sol (<a href="#fig-MethodesAgregations">figure&nbsp;<span>5.14</span></a>, d).</p></li>
<li><p>Finalement, la quatrième approche consiste à utiliser le rôle d’évaluation foncière. Nous calculons alors les distances entre chaque unité d’évaluation foncière et les services, puis la moyenne pondérée de ces distances par le nombre de logements. Cette approche est sans aucun doute la plus précise, mais elle est bien plus chronophage. En effet, à la <a href="#fig-MethodesAgregations">figure&nbsp;<span>5.14</span></a>, nous avons respectivement 4&nbsp;secteurs de recensement (a), 23&nbsp;aires de diffusion (b), 69&nbsp;îlots (c et d) et 3497&nbsp;unités d’évaluation foncière (e).</p></li>
</ul>
<div id="fig-MethodesAgregations" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/MethodesAgregation.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.14: Méthodes d’agrégation et erreurs potentielles</figcaption></figure>
</div>
</section><section id="sec-05323" class="level4" data-number="5.3.2.3"><h4 data-number="5.3.2.3" class="anchored" data-anchor-id="sec-05323">
<span class="header-section-number">5.3.2.3</span> Mesures d’accessibilité</h4>
<p>Différentes mesures renvoyant à différentes conceptualisations de l’accessibilité peuvent être utilisées pour évaluer l’accessibilité spatiale potentielle; les principales sont reportées au <a href="#tbl-ConceptualisationAccessibilite">tableau&nbsp;<span>5.1</span></a>. Pour une description détaillée de ces mesures et de leurs formules, consultez l’article d’Apparicio <em>et al.</em> <span class="citation" data-cites="ApparicioGelbrevisited">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">2017</a>)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-ConceptualisationAccessibilite" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;5.1: Liste des formats avec le <em>package</em> <code>sf</code> (<code>st_drivers</code>)</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 58%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Conceptualisation</th>
<th style="text-align: left;">Mesures d’accessibilité</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Proximité immédiate</td>
<td style="text-align: left;">Distance entre l’origine et le service le plus proche</td>
</tr>
<tr class="even">
<td style="text-align: left;">Offre de services dans l’environnement immédiat</td>
<td style="text-align: left;">Nombre de services présents à moins de <em>n</em> mètres ou minutes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Coût moyen pour atteindre tous les services</td>
<td style="text-align: left;">Distance moyenne entre une origine et tous les services</td>
</tr>
<tr class="even">
<td style="text-align: left;">Coût moyen pour atteindre toutes les <em>n</em> destinations</td>
<td style="text-align: left;">Distance moyenne entre une origine et <em>n</em> services</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Accessibilité en fonction de l’offre et la demande</td>
<td style="text-align: left;">Modèles gravitaires et méthodes <em>two-step floating catchment area</em> (2SFCA)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Source&nbsp;: Apparicio <em>et al.</em> <span class="citation" data-cites="ApparicioGelbrevisited">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">2017</a>)</span>.</p>
<p>Pour poser un diagnostic d’accessibilité spatiale potentielle à un service pour un territoire donné, plusieurs chercheuses et chercheurs recommandent d’utiliser plusieurs mesures d’accessibilité.</p>
<p>Par exemple, dans une étude sur les déserts alimentaires à Montréal, Apparicio <em>et al.</em> <span class="citation" data-cites="apparicio2007case">(<a href="references.html#ref-apparicio2007case" role="doc-biblioref">2007</a>)</span> utilisent trois mesures d’accessibilité&nbsp;: la distance au supermarché le plus proche (proximité immédiate), le nombre de supermarchés dans un rayon de 1000&nbsp;mètres (offre dans l’environnement immédiat) et la distance moyenne aux trois supermarchés d’enseignes différentes (diversité en termes d’offre et de prix) à travers le réseau de rues.</p>
<p>Dans une autre étude portant sur l’accessibilité spatiale potentielle aux parcs urbains à Montréal, Jepson <em>et al.</em> <span class="citation" data-cites="jepson2022environmental">(<a href="references.html#ref-jepson2022environmental" role="doc-biblioref">2022</a>)</span> utilisent deux mesures d’accessibilité&nbsp;: la distance au parc le plus proche (proximité immédiate) et la mesure E2FCA (congestion potentielle en fonction de l’offre et la demande) calculées pour les aires de diffusion de la Communauté métropolitaine de Montréal (<a href="#fig-ESFSCAParcs">figure&nbsp;<span>5.15</span></a>). Concernant la proximité immédiate, le niveau d’accessibilité est bien élevé sur l’île de Montréal et inversement, plus faible à Laval et dans la Rive-Nord et la Rive-Sud (<a href="#fig-ESFSCAParcs">figure&nbsp;<span>5.15</span></a>, a). En effet, la quasi-totalité des aires de diffusion de l’île de Montréal a un parc à moins de 200&nbsp;mètres de marche. Concernant la congestion potentielle des parcs, le portrait est tout autre&nbsp;: le niveau de congestion potentielle est faible dans les zones suburbaines (Laval et les deux Rives) tandis qu’il est élevé dans les quartiers centraux de l’île de Montréal (<a href="#fig-ESFSCAParcs">figure&nbsp;<span>5.15</span></a>, b). Autrement dit, les habitants des quartiers centraux de la ville de Montréal vivent plus près d’un parc, mais ce dernier est potentiellement plus congestionné. Or, une surutilisation des parcs peut entraîner une dégradation accélérée des équipements (aires de jeu, terrains de sports, etc.), voire décourager certaines personnes à visiter un parc durant les périodes plus achalandées.</p>
<div id="fig-ESFSCAParcs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap05/2SFCAParcs.png" class="img-fluid figure-img" style="width:110.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.15: Deux mesures d’accessibilité spatiale potentielle aux parcs, aires de diffusion de la Communauté métropolitaine de Montréal, 2016</figcaption></figure>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Le 2SFCA et ses fonctions de pondération</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Les mesures appartenant à la famille des <em>Two Step Floating Catchement Area</em> (TSFCA) permettent d’évaluer l’accessibilité à des services en tenant comptant à la fois de l’offre (taille du service, par exemple le nombre de lits dans un hôpital) et de la demande (population résidant à la proximité des services).</p>
<p>Tel le nom l’indique, le calcul des mesures du TSFCA comprend deux étapes. Si nous reprenons l’exemple des parcs, la première étape consiste à calculer un ratio <span class="math inline">\(R_j\)</span> pour chaque parc, indiquant le nombre d’hectares de parcs pour 1000&nbsp;personnes résidant dans un rayon de <em>n</em>&nbsp;mètres ou minutes du parc&nbsp;:</p>
<p><span id="eq-TSFCARj"><span class="math display">\[
R_{j} = \frac{S_j}{\sum_{j \in \{ d_{ij} \leq d_0\} }{P_i \times W(d_{ij}) }}
\tag{5.1}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(j\)</span>, un parc.</li>
<li>
<span class="math inline">\(S_j\)</span> la capacité du parc <span class="math inline">\(j\)</span> (ici, la superficie en hectares).</li>
<li>
<span class="math inline">\(i\)</span>, une entité géographique (ici, une aire de diffusion).</li>
<li>
<span class="math inline">\(d_{ij}\)</span>, la distance entre l’entité géographique <span class="math inline">\(i\)</span> et le parc <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(d_0\)</span>, le seuil de distance maximale (par exemple un kilomètre ou trente minutes).</li>
<li>
<span class="math inline">\(P_i\)</span>, la population totale résidant dans <span class="math inline">\(i\)</span>. Cette population est habituellement exprimée en milliers d’habitants, soit <span class="math inline">\(P_i/1000\)</span>.</li>
<li>
<span class="math inline">\(W\)</span>, une fonction de pondération permettant de contrôler le fait qu’un parc plus éloigné est moins attractif et contribue moins à la valeur finale de la mesure d’accessibilité.</li>
</ul>
<p>En résumé, <span class="math inline">\(R_j\)</span> est le ratio entre la superficie du parc et la population ayant accès au parc dans un rayon <em>n</em>&nbsp;mètres ou minutes (<span class="math inline">\(d_0\)</span>).</p>
<p>La deuxième étape consiste à calculer la somme pour chaque aire de diffusion <span class="math inline">\(i\)</span> de la disponibilité des parcs à proximité.</p>
<p><span id="eq-TSFCAAi"><span class="math display">\[
A_{i} = \sum^{m}_{j=1}{R_j \times W(d_{ji}) }
\tag{5.2}\]</span></span></p>
<p>Nous obtenons au final <span class="math inline">\(A_i\)</span>, soit pour chaque aire de diffusion le nombre total d’hectares de parcs disponible pour 1000&nbsp;habitants.</p>
<p>Notez que la fonction <span class="math inline">\(W\)</span> joue un rôle très important dans la formulation du 2SFCA. Elle peut prendre plusieurs formes, la plus simple étant une fonction binaire donnant un poids de&nbsp;1 aux parcs situés en-dessous d’une certaine distance. Par exemple, la fonction R ci-dessous donne un poids de&nbsp;1 à des parcs situés à moins de 500&nbsp;mètres et 0 au-delà.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">w_binaire</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le problème de cette formulation est qu’elle implique que l’accessibilité au parc est la même que l’on habite à 25 ou 500&nbsp;mètres du parc. Il a donc été proposé d’améliorer la méthode en ajoutant une fonction de pondération par palier qui accorde un poids différent selon des seuils de distances prédéfinis. Les fonctions R ci-dessous font ainsi varier le poids dans trois catégories de distance selon une pondération appelée <em>slow decay</em> et <em>fast decay</em> <span class="citation" data-cites="luo2009enhanced">(<a href="references.html#ref-luo2009enhanced" role="doc-biblioref">Luo et Qi 2009</a>)</span> et des paliers de 150, 300 et 500&nbsp;mètres.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">w_slow_decay</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">150</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">d</span> <span class="op">&gt;</span> <span class="fl">150</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">300</span> <span class="op">~</span> <span class="fl">0.68</span>,</span>
<span>    <span class="va">d</span> <span class="op">&gt;</span> <span class="fl">300</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">500</span> <span class="op">~</span> <span class="fl">0.22</span>,</span>
<span>    <span class="va">d</span> <span class="op">&gt;</span> <span class="fl">500</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">w_fast_decay</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">150</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">d</span> <span class="op">&gt;</span> <span class="fl">150</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">300</span> <span class="op">~</span> <span class="fl">0.42</span>,</span>
<span>    <span class="va">d</span> <span class="op">&gt;</span> <span class="fl">300</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;=</span> <span class="fl">500</span> <span class="op">~</span> <span class="fl">0.09</span>,</span>
<span>    <span class="va">d</span> <span class="op">&gt;</span> <span class="fl">500</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalement, il a aussi été proposé d’utiliser des fonctions de pondération continues et décroissantes. Les fonctions R ci-dessous illustrent une fonction incluant un effet de palier tel que proposé par McGrail <span class="citation" data-cites="mcgrail2012spatial">(<a href="references.html#ref-mcgrail2012spatial" role="doc-biblioref">2012</a>)</span> et une fonction logistique décroissante.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># palier à 125 mètres, maximum à 500 mètres</span></span>
<span><span class="va">W_cont_palier</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">125</span>, <span class="fl">1</span>,<span class="op">(</span><span class="op">(</span><span class="fl">500</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">500</span> <span class="op">-</span> <span class="fl">125</span><span class="op">)</span><span class="op">)</span><span class="op">**</span><span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="va">w</span><span class="op">[</span><span class="va">x</span>  <span class="op">&gt;</span> <span class="fl">500</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">logit_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">a</span>,<span class="va">b</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">b</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">a</span><span class="op">)</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">b</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">w_logit1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu">logit_fun</span><span class="op">(</span><span class="va">x</span>, <span class="fl">250</span>, <span class="fl">80</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">w_logit2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu">logit_fun</span><span class="op">(</span><span class="va">x</span>, <span class="fl">250</span>, <span class="fl">40</span><span class="op">)</span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Concernant la fonction logistique, elle comporte deux paramètre, <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span>. Le premier paramètre permet de contrôler la distance à laquelle la pondération atteindra la valeur de 0,5. Le second contrôle la vitesse de décroissance de la courbe. La figure ci-dessous illustre les poids obtenus selon chacune de ces fonctions de pondération.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">600</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  distance <span class="op">=</span> <span class="va">d</span>,</span>
<span>  binaire <span class="op">=</span> <span class="fu">w_binaire</span><span class="op">(</span><span class="va">d</span><span class="op">)</span>,</span>
<span>  slow_decay <span class="op">=</span> <span class="fu">w_slow_decay</span><span class="op">(</span><span class="va">d</span><span class="op">)</span>,</span>
<span>  fast_decay <span class="op">=</span> <span class="fu">w_fast_decay</span><span class="op">(</span><span class="va">d</span><span class="op">)</span>,</span>
<span>  palier <span class="op">=</span> <span class="fu">W_cont_palier</span><span class="op">(</span><span class="va">d</span><span class="op">)</span>,</span>
<span>  logistique1 <span class="op">=</span> <span class="fu">w_logit1</span><span class="op">(</span><span class="va">d</span><span class="op">)</span>,</span>
<span>  logistique2 <span class="op">=</span> <span class="fu">w_logit2</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pond_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'distance'</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">pond_cols</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">distance</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span>, group <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'distance (m)'</span>, </span>
<span>       y <span class="op">=</span> <span class="st">'pondération'</span>,</span>
<span>       color <span class="op">=</span> <span class="st">'fonction'</span></span>
<span>       <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05-AnalyseReseau_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Le choix d’une fonction de pondération doit avant tout reposer sur des considérations théoriques et représenter correctement la décroissance de l’attractivité d’un service en fonction de la distance d’éloignement. Idéalement, ces fonctions devraient être ajustées en fonction de données sur les habitudes de déplacement des individus.</p>
</div>
</div>
</section><section id="sec-05324" class="level4" data-number="5.3.2.4"><h4 data-number="5.3.2.4" class="anchored" data-anchor-id="sec-05324">
<span class="header-section-number">5.3.2.4</span> Types de distance</h4>
<p>Tel que décrit à la <a href="#sec-0512">section&nbsp;<span>5.1.2</span></a>, les mesures d’accessibilité peuvent être calculées en fonction de trajets les plus rapides selon différents modes de transport, soit en automobile, à pied, en vélo et en transport en commun (<a href="#fig-TypesDistancesTransport">figure&nbsp;<span>5.4</span></a>).</p>
</section></section></section><section id="sec-054" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="sec-054">
<span class="header-section-number">5.4</span> Mesures d’accessibilité spatiale potentielle dans R</h2>
<section id="sec-0541" class="level3" data-number="5.4.1"><h3 data-number="5.4.1" class="anchored" data-anchor-id="sec-0541">
<span class="header-section-number">5.4.1</span> Accessibilité spatiale potentielle aux supermarchés</h3>
<p>Dans ce premier exemple applicatif dans R, nous élaborons un diagnostic de l’accessibilité spatiale potentielle aux supermarchés dans la ville de Sherbrooke avec les quatre paramètres suivants&nbsp;:</p>
<ol type="1">
<li><p><strong>Unité spatiale de référence</strong>&nbsp;: aires de diffusion (AD) de 2021 de la ville de Sherbrooke.</p></li>
<li><p><strong>Méthode d’agrégation</strong>&nbsp;: calcul des moyennes pondérées par le nombre de logements des <a href="https://www.donneesquebec.ca/recherche/dataset/roles-d-evaluation-fonciere-du-quebec/resource/62c46738-6c05-4971-b598-d114db4e32cb">immeubles du rôle d’évaluation foncière</a> compris dans les AD.</p></li>
<li><p><strong>Trois mesures d’accessibilité</strong>&nbsp;: le supermarché le plus proche (en minutes), le nombre de supermarchés à 30&nbsp;minutes et moins, la distance moyenne aux trois supermarchés les plus proches.</p></li>
<li><p><strong>Type de distance</strong>&nbsp;: chemin le plus rapide à la marche.</p></li>
</ol>
<p><strong>Étape&nbsp;1.</strong> Importation des trois couches géographiques.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Unités d'évaluation foncière</span></span>
<span><span class="va">Role</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Role2022Sherb.gdb"</span>,</span>
<span>                layer <span class="op">=</span> <span class="st">"rol_unite_Sherbrooke"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Aires de diffusion</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Commerces.gpkg"</span>,</span>
<span>                        layer <span class="op">=</span> <span class="st">"AD_Sherbrooke"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Supermarchés</span></span>
<span><span class="va">Supermarches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Commerces.gpkg"</span>,</span>
<span>                        layer <span class="op">=</span> <span class="st">"supermarche"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Changement de projection</span></span>
<span><span class="va">Supermarches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">Supermarches</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">Role</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">Role</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">AD</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;2.</strong> Réalisation d’une jointure spatiale pour attribuer à chaque unité d’évaluation l’identifiant de l’aire de diffusion (champ <code>ADIDU</code>) dans laquelle elle est comprise.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Jointure spatiale entre le Role et les AD</span></span>
<span><span class="va">Role</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">Role</span>, <span class="va">AD</span><span class="op">[</span>,<span class="st">"ADIDU"</span><span class="op">]</span>, join <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span></span>
<span><span class="va">Role</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">Role</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ADIDU</span><span class="op">)</span><span class="op">==</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## Nombre de distances à calculer</span></span>
<span><span class="va">nO</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">Role</span><span class="op">)</span></span>
<span><span class="va">nD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">Supermarches</span><span class="op">)</span></span>
<span><span class="va">NOD</span> <span class="op">=</span> <span class="va">nO</span> <span class="op">*</span> <span class="va">nD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Origines (O) :"</span>, <span class="va">nO</span>, <span class="st">"îlots"</span>,</span>
<span>    <span class="st">"\n Destinations (D) :"</span>, <span class="va">nD</span>, <span class="st">"supermarchés"</span>,</span>
<span>    <span class="st">"\n Distances OD = "</span>, <span class="va">NOD</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Origines (O) : 46534 îlots 
 Destinations (D) : 27 supermarchés 
 Distances OD =  1256418</code></pre>
</div>
</div>
<p><strong>Étape&nbsp;3.</strong> Création des points d’origine et de destination.</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Rattacher les points aux tronçons de rue</strong></p>
</div>
<div class="bloc_attention-body">
<p>Puisque nous utilisons le trajet le plus court à pied, les points d’origine et de destination doivent être rattachés à des tronçons de rues qui ne sont pas des autoroutes ou tout autre tronçon interdit à la marche. Pour ce faire, le <em>package</em> <code>R5R</code> dispose d’une fonction très intéressante&nbsp;:</p>
<p><code>find_snap(r5r_core, points, mode = "WALK")</code>.</p>
<p>Sans le recours à cette fonction, un point d’origine ou de destination risque d’être rattaché à un tronçon autoroutier, faisant en sorte que le trajet ne pourra être calculé à la marche.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Origines</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="va">Role</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Origines</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Origines</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">$</span><span class="va">mat18</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/find_snap.html">find_snap</a></span><span class="op">(</span><span class="va">r5r_core</span>, <span class="va">Origines</span>, mode <span class="op">=</span> <span class="st">"WALK"</span><span class="op">)</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">$</span><span class="va">snap_lat</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">$</span><span class="va">snap_lon</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point_id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Origines</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span></span>
<span><span class="co">## Destinations</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="va">Supermarches</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"id"</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/find_snap.html">find_snap</a></span><span class="op">(</span><span class="va">r5r_core</span>, <span class="va">Destinations</span>, mode <span class="op">=</span> <span class="st">"WALK"</span><span class="op">)</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">Destinations</span><span class="op">$</span><span class="va">snap_lat</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">Destinations</span><span class="op">$</span><span class="va">snap_lon</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="va">Destinations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point_id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;4.</strong> Construction de la matrice origines-destinations avec la fonction <code>travel_time_matrix</code> et sauvegarde dans un fichier <code>Rdata</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice OD à la marche</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">matriceOD.Marche</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                       origins <span class="op">=</span> <span class="va">Origines</span>,</span>
<span>                                       destinations <span class="op">=</span> <span class="va">Destinations</span>,</span>
<span>                                       mode <span class="op">=</span> <span class="st">"WALK"</span>,</span>
<span>                                       walk_speed <span class="op">=</span> <span class="fl">4.5</span>,  <span class="co"># valeur par défaut 3.6</span></span>
<span>                                       max_trip_duration <span class="op">=</span> <span class="fl">240</span>,</span>
<span>                                       max_walk_time <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">duree.marche</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">t1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"mins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Temps de calcul :"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.marche</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"minutes"</span><span class="op">)</span></span>
<span><span class="co">## Enregistrement des résultats dans un fichier Rdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">duree.marche</span>, <span class="va">matriceOD.Marche</span>,</span>
<span>     file<span class="op">=</span><span class="st">"data/chap05/Resultats/MatricesMarcheRoleSupermarche.Rdata"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;5.</strong> Calcul des trois mesures d’accessibilité pour les unités d’évaluation.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Chargement du fichier Rdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap05/Resultats/MatricesMarcheRoleSupermarche.Rdata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Temps de calcul pour la matrice :"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.marche</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"minutes"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de calcul pour la matrice : 4.53 minutes</code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Supermarché le plus proche</span></span>
<span><span class="va">Supermarche.PlusProche</span> <span class="op">&lt;-</span> <span class="va">matriceOD.Marche</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">from_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    plus_proche <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">travel_time_p50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Nombre de supermarchés à moins de 30 minutes</span></span>
<span><span class="va">Supermarche.N30mins</span> <span class="op">&lt;-</span> <span class="va">matriceOD.Marche</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">travel_time_p50</span> <span class="op">&lt;=</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">from_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    nb_30_min <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Distance moyenne aux trois supermarchés les plus proches</span></span>
<span><span class="va">Supermarche.3</span> <span class="op">&lt;-</span> <span class="va">matriceOD.Marche</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">from_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dist_rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">travel_time_p50</span>, decreasing<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dist_rank</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            sum_dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">travel_time_p50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Notez ici que nous pouvons avoir des origines pour lesquelles</span></span>
<span><span class="co"># n'avons pas trois supermarchés à moins de 240 minutes.</span></span>
<span><span class="co"># Pour ces quelques cas, nous ajoutons des temps de 240 minutes pour les </span></span>
<span><span class="co"># origines avec des supermarchés manquants.</span></span>
<span><span class="va">Supermarche.3</span><span class="op">$</span><span class="va">sum_dist</span> <span class="op">&lt;-</span> <span class="va">Supermarche.3</span><span class="op">$</span><span class="va">sum_dist</span> <span class="op">+</span> <span class="fl">240</span> <span class="op">*</span> <span class="op">(</span><span class="fl">3</span> <span class="op">-</span> <span class="va">Supermarche.3</span><span class="op">$</span><span class="va">nb</span><span class="op">)</span></span>
<span><span class="va">Supermarche.3</span><span class="op">$</span><span class="va">mean_n3</span> <span class="op">&lt;-</span> <span class="va">Supermarche.3</span><span class="op">$</span><span class="va">sum_dist</span> <span class="op">/</span> <span class="fl">3</span></span>
<span><span class="va">Supermarche.3</span><span class="op">$</span><span class="va">nb</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">Supermarche.3</span><span class="op">$</span><span class="va">sum_dist</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Nous pouvons à présent fusionner nos différent dataframes avec les </span></span>
<span><span class="co"># indicateurs d'accessibilité</span></span>
<span><span class="va">Role</span> <span class="op">&lt;-</span> <span class="va">Role</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">Supermarche.PlusProche</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'mat18'</span> <span class="op">=</span> <span class="st">'from_id'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">Supermarche.N30mins</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'mat18'</span> <span class="op">=</span> <span class="st">'from_id'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">Supermarche.3</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'mat18'</span> <span class="op">=</span> <span class="st">'from_id'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>      SupPlusProcheMin <span class="op">=</span> <span class="st">'plus_proche'</span>,</span>
<span>      SupN30min <span class="op">=</span> <span class="st">'nb_30_min'</span>,</span>
<span>      Moy3Sup <span class="op">=</span> <span class="st">'mean_n3'</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Certaines observations n'ont pas de supermarchés à 30 minutes</span></span>
<span><span class="co"># Nous mettons alors les valeurs à 0</span></span>
<span><span class="va">Role</span><span class="op">$</span><span class="va">SupN30min</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Role</span><span class="op">$</span><span class="va">SupN30min</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;6.</strong> Calcul des moyennes pondérées par le nombre de logements (champ <code>Logements</code>) pour les aires de diffusion avec le <em>package</em> <code>dplyr</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">## Création d'un DataFrame temporaire sans la géométrie</span></span>
<span><span class="va">Role.Temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">Role</span><span class="op">)</span></span>
<span><span class="co">## Moyennes pondérées pour les trois indicateurs d'accessibilité</span></span>
<span><span class="va">MesureAcc</span> <span class="op">&lt;-</span> <span class="va">Role.Temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ADIDU</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>                  SupPlusProcheMin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">SupPlusProcheMin</span>, <span class="va">Logements</span><span class="op">)</span>,</span>
<span>                  SupN30min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">SupN30min</span>, <span class="va">Logements</span><span class="op">)</span>,</span>
<span>                  Moy3Sup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">Moy3Sup</span>, <span class="va">Logements</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span></span>
<span><span class="co">## Fusion avec la couche des AD</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">AD</span>, <span class="va">MesureAcc</span>, by<span class="op">=</span><span class="st">"ADIDU"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;7.</strong> Cartographie des résultats avec le <em>package</em> <code>tmap</code>.</p>
<p>Tout d’abord, nous analysons les statistiques univariées pour repérer les valeurs minimales et maximales pour les trois mesures d’accessibilité avec la fonction <code>summary</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">TroisMesures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SupPlusProcheMin"</span>,<span class="st">"SupN30min"</span>,<span class="st">"Moy3Sup"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">AD</span><span class="op">[</span>, <span class="va">TroisMesures</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> SupPlusProcheMin    SupN30min        Moy3Sup                   geom    
 Min.   :  4.528   Min.   :0.000   Min.   :  6.149   MULTIPOLYGON :254  
 1st Qu.: 10.995   1st Qu.:1.000   1st Qu.: 17.416   epsg:4326    :  0  
 Median : 16.244   Median :2.536   Median : 23.555   +proj=long...:  0  
 Mean   : 21.903   Mean   :2.774   Mean   : 32.007                      
 3rd Qu.: 24.413   3rd Qu.:4.518   3rd Qu.: 33.837                      
 Max.   :130.615   Max.   :7.333   Max.   :139.209                      
 NA's   :2                         NA's   :2                            </code></pre>
</div>
</div>
<p>Une fois les valeurs maximales et minimales analysées, réalisons les cartes (<a href="#fig-CartoSuperm">figure&nbsp;<span>5.16</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Importation des arrondissements de la ville de Sherbrooke</span></span>
<span><span class="va">arrondissements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/Chap05/AutresDonnees/Arrondissements.shp"</span>, </span>
<span>                           quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Construction des cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="co"># Carte pour les supermarchés</span></span>
<span><span class="va">Carte0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Supermarches</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    title <span class="op">=</span> <span class="st">"Supermarché"</span>,</span>
<span>                    title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Carte pour le supermarché le plus proche</span></span>
<span><span class="va">max.acc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AD</span><span class="op">$</span><span class="va">SupPlusProcheMin</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">AD</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SupPlusProcheMin"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="va">max.acc1</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"-YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                              legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    textNA <span class="op">=</span> <span class="st">"Sans données"</span>,</span>
<span>                              title<span class="op">=</span><span class="st">"Plus proche"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Carte pour le nombre de supermarchés à 30 minutes ou moins</span></span>
<span><span class="va">max.acc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AD</span><span class="op">$</span><span class="va">SupN30min</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">AD</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SupN30min"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="va">max.acc2</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                              legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                            textNA <span class="op">=</span> <span class="st">"Sans données"</span>,</span>
<span>                    title<span class="op">=</span><span class="st">"Sup. à 30 min"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Carte pour la distance moyenne aux trois supermarchés les plus proches</span></span>
<span><span class="va">max.acc3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AD</span><span class="op">$</span><span class="va">Moy3Sup</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">AD</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"Moy3Sup"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="va">max.acc3</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"-YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                            legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                            textNA <span class="op">=</span> <span class="st">"Sans données"</span>,</span>
<span>                    title<span class="op">=</span><span class="st">"Moy. 3 plus proches"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Figure avec les quatre cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte0</span>, <span class="va">Carte1</span>, <span class="va">Carte2</span>, <span class="va">Carte3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CartoSuperm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="05-AnalyseReseau_files/figure-html/fig-CartoSuperm-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.16: Accessibilité spatiale potentielle à pied aux supermarchés (en minutes), aires de diffusion de la ville de Sherbrooke, 2021</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0542" class="level3" data-number="5.4.2"><h3 data-number="5.4.2" class="anchored" data-anchor-id="sec-0542">
<span class="header-section-number">5.4.2</span> Accessibilité spatiale potentielle aux patinoires extérieures</h3>
<p>Dans ce second exemple applicatif dans R, nous élaborons un diagnostic de l’accessibilité spatiale potentielle aux patinoires extérieures dans la ville de Sherbrooke avec les quatre paramètres suivants&nbsp;:</p>
<ol type="1">
<li><p><strong>Unité spatiale de référence</strong>&nbsp;: aires de diffusion (AD) de 2021 de la ville de Sherbrooke.</p></li>
<li><p><strong>Méthode d’agrégation</strong>&nbsp;: calcul des moyennes pondérées par la population totale des îlots compris dans les AD.</p></li>
<li><p><strong>Deux mesures d’accessibilité</strong>&nbsp;: patinoire la plus proche (en minutes); E2SFCA (<em>Enhanced two-step floating catchment area</em>), soit le nombre de patinoires pour 1000&nbsp;habitants dans un rayon de 30&nbsp;minutes de marche.</p></li>
<li><p><strong>Type de distance</strong>&nbsp;: chemin le plus rapide à la marche.</p></li>
</ol>
<p><strong>Étape&nbsp;1.</strong> Importation des trois couches géographiques.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Unités d'évaluation foncière</span></span>
<span><span class="va">Patinoires</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Patinoires.shp"</span>,</span>
<span>                      quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Aires de diffusion</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Commerces.gpkg"</span>,</span>
<span>              layer <span class="op">=</span> <span class="st">"AD_Sherbrooke"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Ilots de recensements</span></span>
<span><span class="va">Ilots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap05/AutresDonnees/Commerces.gpkg"</span>,</span>
<span>                 layer <span class="op">=</span> <span class="st">"Ilots"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Changement de projection</span></span>
<span><span class="va">Patinoires</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">Patinoires</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">AD</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">Ilots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">Ilots</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;2.</strong> Réalisation d’une jointure spatiale pour attribuer à chaque îlot l’identifiant de l’aire de diffusion (champ <code>ADIDU</code>) dans laquelle il est compris.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Jointure spatiale entre le Rôle et les AD</span></span>
<span><span class="va">Ilots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">Ilots</span><span class="op">)</span>, <span class="va">AD</span><span class="op">[</span>,<span class="st">"ADIDU"</span><span class="op">]</span>, join <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span></span>
<span><span class="va">Ilots</span> <span class="op">&lt;-</span> <span class="va">Ilots</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>,<span class="st">"pop2021"</span>,<span class="st">"ADIDU"</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;3.</strong> Création des points d’origine et de destination.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Origines</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="va">Ilots</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Origines</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Origines</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/find_snap.html">find_snap</a></span><span class="op">(</span><span class="va">r5r_core</span>, <span class="va">Origines</span>, mode <span class="op">=</span> <span class="st">"WALK"</span><span class="op">)</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">$</span><span class="va">snap_lat</span></span>
<span><span class="va">Origines</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">$</span><span class="va">snap_lon</span></span>
<span><span class="va">Origines</span> <span class="op">&lt;-</span> <span class="va">Origines</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point_id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Origines</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span></span>
<span><span class="co">## Destinations</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="va">Patinoires</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/find_snap.html">find_snap</a></span><span class="op">(</span><span class="va">r5r_core</span>, <span class="va">Destinations</span>, mode <span class="op">=</span> <span class="st">"WALK"</span><span class="op">)</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">Destinations</span><span class="op">$</span><span class="va">snap_lat</span></span>
<span><span class="va">Destinations</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">Destinations</span><span class="op">$</span><span class="va">snap_lon</span></span>
<span><span class="va">Destinations</span> <span class="op">&lt;-</span> <span class="va">Destinations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"point_id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Destinations</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"distance"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;4.</strong> Construction de la matrice origines-destinations avec la fonction <code>travel_time_matrix</code> et sauvegarde dans un fichier <code>Rdata</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice OD à la marche</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">matriceODPatinoire.Marche</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/r5r/man/travel_time_matrix.html">travel_time_matrix</a></span><span class="op">(</span>r5r_core <span class="op">=</span> <span class="va">r5r_core</span>,</span>
<span>                                                origins <span class="op">=</span> <span class="va">Origines</span>,</span>
<span>                                                destinations <span class="op">=</span> <span class="va">Destinations</span>,</span>
<span>                                                mode <span class="op">=</span> <span class="st">"WALK"</span>,</span>
<span>                                                walk_speed <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>                                                max_trip_duration <span class="op">=</span> <span class="fl">240</span>,</span>
<span>                                                max_walk_time <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">duree.marche</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">t1</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"mins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Temps de calcul :"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.marche</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"minutes"</span><span class="op">)</span></span>
<span><span class="co">## Enregistrement des résultats dans un fichier Rdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">duree.marche</span>, <span class="va">matriceODPatinoire.Marche</span>,</span>
<span>     file<span class="op">=</span><span class="st">"data/chap05/Resultats/matriceODPatinoire.Rdata"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;5.</strong> Calcul des deux mesures d’accessibilité pour les îlots.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Chargement du fichier Rdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap05/Resultats/matriceODPatinoire.Rdata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Temps de calcul pour la matrice :"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">duree.marche</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"minutes"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de calcul pour la matrice : 0.37 minutes</code></pre>
</div>
</div>
<p>Le code ci-dessous permet de calculer la distance à la patinoire la plus proche pour les aires de diffusion.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Patinoire la plus proche</span></span>
<span><span class="va">Patinoire.PlusProche</span> <span class="op">&lt;-</span> <span class="va">matriceODPatinoire.Marche</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">from_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>PatinoirePlusProche <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">travel_time_p50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Fusion avec la couche des îlots</span></span>
<span><span class="va">Ilots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">Ilots</span>, <span class="va">Patinoire.PlusProche</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">'from_id'</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puis, nous calculons la version de la méthode du E2SFCA avec une fonction de gradient continue <span class="citation" data-cites="mcgrail2009measuring">(<a href="references.html#ref-mcgrail2009measuring" role="doc-biblioref">McGrail et Humphreys 2009</a>)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"code_complementaire/E2SFCA.R"</span><span class="op">)</span></span>
<span><span class="co">## Ajout des champs de population dans la matrice</span></span>
<span><span class="va">TempIlots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">Ilots</span><span class="op">)</span></span>
<span><span class="va">matriceODPatinoire</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">matriceODPatinoire.Marche</span>, </span>
<span>                   <span class="va">TempIlots</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>,<span class="st">"pop2021"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   by.x <span class="op">=</span> <span class="st">"from_id"</span>, by.y<span class="op">=</span><span class="st">"id"</span><span class="op">)</span></span>
<span><span class="va">matriceODPatinoire</span><span class="op">$</span><span class="va">Wd</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">matriceODPatinoire</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"Marche"</span>, <span class="st">"Wo"</span>, <span class="st">"Wd"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">matriceODPatinoire</span>, n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       from_id to_id Marche  Wo Wd
1: 24430011001     1     90 180  1
2: 24430011001     2    159 180  1</code></pre>
</div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Utilisation de la pondération de gradient continu du E2SFCA</span></span>
<span><span class="va">Wfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">5</span>, <span class="fl">1</span>,<span class="op">(</span><span class="op">(</span><span class="fl">30</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">30</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">**</span><span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="va">w</span><span class="op">[</span><span class="va">x</span>  <span class="op">&gt;</span> <span class="fl">30</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Calcul du résultat en milliers d'habitants</span></span>
<span><span class="va">matriceODPatinoire</span><span class="op">$</span><span class="va">Wo</span> <span class="op">&lt;-</span> <span class="va">matriceODPatinoire</span><span class="op">$</span><span class="va">Wo</span> <span class="op">/</span> <span class="fl">1000</span></span>
<span><span class="va">MesureE2SFCA</span> <span class="op">&lt;-</span> <span class="fu">GTSFCA</span><span class="op">(</span>dist_mat <span class="op">=</span> <span class="va">matriceODPatinoire</span>,</span>
<span>                        Wfun <span class="op">=</span> <span class="va">Wfun</span>,</span>
<span>                        IDorigine <span class="op">=</span> <span class="st">"from_id"</span>,</span>
<span>                        IDdestination <span class="op">=</span> <span class="st">"to_id"</span>,</span>
<span>                        CoutDistance <span class="op">=</span> <span class="st">"Marche"</span>,</span>
<span>                        Wo <span class="op">=</span> <span class="st">"Wo"</span>,</span>
<span>                        Wd <span class="op">=</span> <span class="st">"Wd"</span>,</span>
<span>                        ChampSortie <span class="op">=</span> <span class="st">"E2SFCA_G"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MesureE2SFCA</span><span class="op">$</span><span class="va">E2SFCA_G</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">MesureE2SFCA</span><span class="op">$</span><span class="va">E2SFCA_G</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">Ilots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">Ilots</span>, <span class="va">MesureE2SFCA</span>, by.x <span class="op">=</span><span class="st">"id"</span>, by<span class="op">=</span><span class="st">"from_id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Ilots</span><span class="op">$</span><span class="va">E2SFCA_G</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Ilots</span><span class="op">$</span><span class="va">E2SFCA_G</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;6.</strong> Calcul des moyennes pondérées par la population des îlots (champ <code>pop2021</code>) pour les aires de diffusion avec le <em>package</em> <code>dplyr</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Création d'un DataFrame temporaire sans la géométrie</span></span>
<span><span class="va">Ilots.Temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">Ilots</span><span class="op">)</span></span>
<span><span class="co">## Moyenne pondérées pour la patinoire la plus proche</span></span>
<span><span class="va">MesureAcc1</span> <span class="op">&lt;-</span> <span class="va">Ilots.Temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ADIDU</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>PatinoirePlusProche <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">PatinoirePlusProche</span>, <span class="va">pop2021</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Moyenne non pondérée pour le E2SFCA, car la population est déjà prise en compte</span></span>
<span><span class="va">MesureAcc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">E2SFCA_G</span> <span class="op">~</span> <span class="va">ADIDU</span>, <span class="va">Ilots.Temp</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">## Fusion avec la couche des îlots</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">AD</span>, <span class="va">MesureAcc1</span>, by<span class="op">=</span><span class="st">"ADIDU"</span><span class="op">)</span></span>
<span><span class="va">AD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html">merge</a></span><span class="op">(</span><span class="va">AD</span>, <span class="va">MesureAcc2</span>, by<span class="op">=</span><span class="st">"ADIDU"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Étape&nbsp;7.</strong> Cartographie des résultats avec le <em>package</em> <code>tmap</code>.</p>
<p>Tout d’abord, nous analysons les statistiques univariées pour repérer les valeurs minimales et maximales pour les trois mesures d’accessibilité.</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">DeuxMesures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PatinoirePlusProche"</span>,<span class="st">"E2SFCA_G"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">AD</span><span class="op">[</span>, <span class="va">DeuxMesures</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> PatinoirePlusProche    E2SFCA_G                geometry  
 Min.   : 1.00       Min.   :0.00000   MULTIPOLYGON :254  
 1st Qu.: 9.28       1st Qu.:0.09836   epsg:4326    :  0  
 Median :14.50       Median :0.19188   +proj=long...:  0  
 Mean   :17.29       Mean   :0.22520                      
 3rd Qu.:19.83       3rd Qu.:0.30166                      
 Max.   :85.58       Max.   :1.26495                      
 NA's   :2                                                </code></pre>
</div>
</div>
<p>Une fois avoir pris connaissance des valeurs maximales et minimales, nous pouvons réaliser les cartes (<a href="#fig-CartoPatinoires">figure&nbsp;<span>5.17</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Importation des arrondissements de la ville de Sherbrooke</span></span>
<span><span class="va">arrondissements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/Chap05/AutresDonnees/Arrondissements.shp"</span>, </span>
<span>                           quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Construction des cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="co"># Carte pour les patinoires</span></span>
<span><span class="va">Carte0p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Patinoires</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    title <span class="op">=</span> <span class="st">"Patinoire extérieure"</span>,</span>
<span>                    title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Carte pour la patinoire la plus proche</span></span>
<span><span class="va">max.acc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AD</span><span class="op">$</span><span class="va">PatinoirePlusProche</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte1p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">AD</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"PatinoirePlusProche"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="va">max.acc1</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"-YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                    legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    textNA <span class="op">=</span> <span class="st">"Sans données"</span>,</span>
<span>                    title<span class="op">=</span><span class="st">"Plus proche (min)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Carte pour le 2ESFCA</span></span>
<span><span class="va">AD2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">AD</span>, <span class="va">E2SFCA_G</span> <span class="op">!=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">min.acc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">AD2</span><span class="op">$</span><span class="va">E2SFCA_G</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">max.acc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">AD2</span><span class="op">$</span><span class="va">E2SFCA_G</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte2p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">AD</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">AD2</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"E2SFCA_G"</span>, </span>
<span>                    border.lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">min.acc2</span>,<span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span>,<span class="fl">1</span>,<span class="va">max.acc2</span><span class="op">)</span>,</span>
<span>                    palette<span class="op">=</span><span class="st">"YlOrRd"</span>,</span>
<span>                    size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>                    legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    title<span class="op">=</span><span class="st">"Patinoire pour 1000 hab."</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">arrondissements</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Figure avec les trois cartes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte0p</span>, <span class="va">Carte1p</span>, <span class="va">Carte2p</span>,</span>
<span>             nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## Arrêt de Java</span></span>
<span><span class="fu">r5r</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/r5r/man/stop_r5.html">stop_r5</a></span><span class="op">(</span><span class="va">r5r_core</span><span class="op">)</span></span>
<span><span class="fu">rJava</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rJava/man/jgc.html">.jgc</a></span><span class="op">(</span>R.gc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CartoPatinoires" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="05-AnalyseReseau_files/figure-html/fig-CartoPatinoires-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;5.17: Accessibilité spatiale potentielle à pied aux patinoires extérieures, aires de diffusion de la ville de Sherbrooke, 2021</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-055" class="level2" data-number="5.5"><h2 data-number="5.5" class="anchored" data-anchor-id="sec-055">
<span class="header-section-number">5.5</span> Quiz de révision du chapitre</h2>
<div id="Chap05" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chap05;
  window.onload = function() {
    quizz_Chap05 = new Quiz('Chap05', [['1', '2', '3'],['1', '2', '4', '5'],['1', '2', '4'],'2','1','2','1','4','2']);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les trois principaux problèmes résolus en analyse de réseau?
</div>
<div>
Relisez au besoin la <a href="#sec-0512">section&nbsp;<span>5.1.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Trouver le trajet le plus court ou le plus rapide entre deux points (algorithme de Dijkstra)</label>
</td>
<td>
<input type="checkbox" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>Trouver la route optimale comprenant plusieurs arrêts (problème du voyageur de commerce)</label>
</td>
<td>
<input type="checkbox" name="q1" value="2">
</td>
</tr>
<tr>
<td>
<label>Définir des zones de desserte autour d’une origine (algorithme de Dijkstra)</label>
</td>
<td>
<input type="checkbox" name="q1" value="3">
</td>
</tr>
<tr>
<td>
<label>Mesurer la dépendance spatiale</label>
</td>
<td>
<input type="checkbox" name="q1" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les quatre autres problèmes résolus en analyse de réseau?
</div>
<div>
Relisez au besoin la <a href="#sec-0512">section&nbsp;<span>5.1.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Trouver les k services les plus proches à partir d’une origine</label>
</td>
<td>
<input type="checkbox" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>Construire une matrice de distance origines-destinations</label>
</td>
<td>
<input type="checkbox" name="q2" value="2">
</td>
</tr>
<tr>
<td>
<label>Répartir aléatoirement des points dans un territoire donné</label>
</td>
<td>
<input type="checkbox" name="q2" value="3">
</td>
</tr>
<tr>
<td>
<label>Résoudre le problème de tournées de véhicules</label>
</td>
<td>
<input type="checkbox" name="q2" value="4">
</td>
</tr>
<tr>
<td>
<label>Réaliser un modèle localisation-affectation</label>
</td>
<td>
<input type="checkbox" name="q2" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les trois fichiers nécessaires pour construire un réseau multimode avec R5R?
</div>
<div>
Relisez au besoin le début de la <a href="#sec-0512">section&nbsp;<span>5.1.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Un fichier pbf pour les données d’OpenStreetMap</label>
</td>
<td>
<input type="checkbox" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>Un ou plusieurs fichiers GTFS</label>
</td>
<td>
<input type="checkbox" name="q3" value="2">
</td>
</tr>
<tr>
<td>
<label>Un fichier pour les bâtiments</label>
</td>
<td>
<input type="checkbox" name="q3" value="3">
</td>
</tr>
<tr>
<td>
<label>Un fichier GeoTIFF d’élévation</label>
</td>
<td>
<input type="checkbox" name="q3" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelle fonction de R5R permet de construire un réseau multimode?
</div>
<div>
Relisez au besoin la <a href="#sec-0523">section&nbsp;<span>5.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>detailed_itineraries()</label>
</td>
<td>
<input type="radio" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>setup_r5()</label>
</td>
<td>
<input type="radio" name="q4" value="2">
</td>
</tr>
<tr>
<td>
<label>travel_time_matrix()</label>
</td>
<td>
<input type="radio" name="q4" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelle fonction de R5R permet de construire un itinéraire?
</div>
<div>
Relisez au besoin la <a href="#sec-0523">section&nbsp;<span>5.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>detailed_itineraries()</label>
</td>
<td>
<input type="radio" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>setup_r5()</label>
</td>
<td>
<input type="radio" name="q5" value="2">
</td>
</tr>
<tr>
<td>
<label>travel_time_matrix()</label>
</td>
<td>
<input type="radio" name="q5" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelle fonction de R5R permet de construire une matrice origine-destination?
</div>
<div>
Relisez au besoin la <a href="#sec-0523">section&nbsp;<span>5.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>detailed_itineraries()</label>
</td>
<td>
<input type="radio" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>setup_r5()</label>
</td>
<td>
<input type="radio" name="q6" value="2">
</td>
</tr>
<tr>
<td>
<label>travel_time_matrix()</label>
</td>
<td>
<input type="radio" name="q6" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour évaluer l’accessibilité selon la conceptualisation de la proximité immédiate, quelle mesure d’accessibilité utilisez-vous?
</div>
<div>
Relisez au besoin la <a href="#sec-05323">section&nbsp;<span>5.3.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Distance entre l’origine et le service le plus proche</label>
</td>
<td>
<input type="radio" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>Nombre de services présents à moins de n mètres ou minutes</label>
</td>
<td>
<input type="radio" name="q7" value="2">
</td>
</tr>
<tr>
<td>
<label>Distance moyenne entre une origine et n services</label>
</td>
<td>
<input type="radio" name="q7" value="3">
</td>
</tr>
<tr>
<td>
<label>Modèles gravitaires et méthodes two-step floating catchment area (2SFCA)</label>
</td>
<td>
<input type="radio" name="q7" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour évaluer l’accessibilité selon la conceptualisation de l’offre et la demande, quelle mesure d’accessibilité utilisez-vous?
</div>
<div>
Relisez au besoin la <a href="#sec-05323">section&nbsp;<span>5.3.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Distance entre l’origine et le service le plus proche</label>
</td>
<td>
<input type="radio" name="q8" value="1">
</td>
</tr>
<tr>
<td>
<label>Nombre de services présents à moins de n mètres ou minutes</label>
</td>
<td>
<input type="radio" name="q8" value="2">
</td>
</tr>
<tr>
<td>
<label>Distance moyenne entre une origine et n services</label>
</td>
<td>
<input type="radio" name="q8" value="3">
</td>
</tr>
<tr>
<td>
<label>Modèles gravitaires et méthodes two-step floating catchment area (2SFCA)</label>
</td>
<td>
<input type="radio" name="q8" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour évaluer l’accessibilité selon l’offre de services dans l’environnement immédiat, quelle mesure d’accessibilité utilisez-vous?
</div>
<div>
Relisez au besoin la <a href="#sec-05323">section&nbsp;<span>5.3.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Distance entre l’origine et le service le plus proche</label>
</td>
<td>
<input type="radio" name="q9" value="1">
</td>
</tr>
<tr>
<td>
<label>Nombre de services présents à moins de n mètres ou minutes</label>
</td>
<td>
<input type="radio" name="q9" value="2">
</td>
</tr>
<tr>
<td>
<label>Distance moyenne entre une origine et n services</label>
</td>
<td>
<input type="radio" name="q9" value="3">
</td>
</tr>
<tr>
<td>
<label>Modèles gravitaires et méthodes two-step floating catchment area (2SFCA)</label>
</td>
<td>
<input type="radio" name="q9" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chap05);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>
</section><section id="sec-056" class="level2" data-number="5.6"><h2 data-number="5.6" class="anchored" data-anchor-id="sec-056">
<span class="header-section-number">5.6</span> Exercices de révision</h2>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 1.</strong> Calcul de trajets selon différents modes de transport</p>
</div>
<div class="bloc_exercice-body">
<p>Complétez le code ci-dessous pour réaliser les étapes suivantes&nbsp;:</p>
<ol type="1">
<li><p>Construisez un réseau R5R pour la région de Laval avec un fichier OMS (pbf), un fichier d’élévation et un fichier GTFS.</p></li>
<li><p>Créez deux points&nbsp;: l’un pour la station de métro Morency (-73.7199, 45.5585) l’autre pour une adresse fictive (-73.7183, 45.5861).</p></li>
<li>
<p>Calculez les trajets en automobile, à vélo, à pied, et en transport en commun de l’adresse vers la station de métro et l’inverse avec (10 points)&nbsp;:</p>
<ul>
<li><p>Une vitesse de 15 km/h pour le vélo.</p></li>
<li><p>Une vitesse de 4,5 km/h pour la marche.</p></li>
<li><p>Un trajet aller le 12-02-2024 à 8h de l’adresse vers la station de métro.</p></li>
<li><p>Un trajet retour le 12-02-2024 à 18h de la station de métro vers l’adresse.</p></li>
</ul>
</li>
<li>
<p>Réalisez deux figures&nbsp;:</p>
<ul>
<li><p>Une figure avec quatre cartes des trajets aller (marche, vélo, auto, transport en commun).</p></li>
<li><p>Une figure avec quatre cartes des trajets retour (marche, vélo, auto, transport en commun).</p></li>
</ul>
</li>
<li><p>Arrêtez java.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(r5r)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"data/chap05/Laval"</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jinit</span>()</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">java.parameters =</span> <span class="st">"-Xmx2G"</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Construction du réseau</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>dossierdata <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/_DataReseau"</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(dossierdata)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>r5r_core <span class="ot">&lt;-</span> <span class="fu">setup_r5</span>(à compléter)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Création de deux points</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>Pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">"Station Morency"</span>, <span class="st">"Adresse 1"</span>),</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lon =</span> <span class="fu">c</span>(à compléter),</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lat =</span> <span class="fu">c</span>(à compléter))</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>Pts <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(Pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>StationMorency <span class="ot">&lt;-</span> Pts[<span class="dv">1</span>,]</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>Adresse1 <span class="ot">&lt;-</span> Pts[<span class="dv">2</span>,]</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.1. Trajets en automobile</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>Auto<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">origins =</span> Adresse1,</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">destinations =</span> StationMorency,</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">mode =</span> <span class="st">"CAR"</span>,</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>Auto<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>                               <span class="at">origins =</span> StationMorency,</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>                               <span class="at">destinations =</span> Adresse1,</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mode =</span> <span class="st">"CAR"</span>,</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>                               <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>                               <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.2. Trajets en vélo</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>velo<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(à compléter)</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>velo<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(à compléter)</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.3. Trajets à pied</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>marche<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(à compléter)</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>marche<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(à compléter)</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 2.4. Trajets en transport en commun</span></span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>dateheure.matin <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">"12-02-2024 08:00:00"</span>,</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>                              <span class="at">format =</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span>)</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>dateheure.soir  <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">"12-02-2024 18:00:00"</span>,</span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>                              <span class="at">format =</span> <span class="st">"%d-%m-%Y %H:%M:%S"</span>)</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a><span class="do">### Définir le temps de marche maximal</span></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a>minutes_marches_max <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a>TC<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(à compléter)</span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a>TC<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(à compléter)</span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Cartographie</span></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map1.Aller : Marche (de la résidence à la station de métro)</span></span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map2.Aller : Vélo (de la résidence à la station de métro)</span></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map3.Aller : Auto (de la résidence à la station de métro)</span></span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map4.Aller : Transport en commun (de la résidence à la station de métro)</span></span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(view)</span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a>Map1.Aller <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(marche<span class="fl">.1</span>)<span class="sc">+</span><span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"mode"</span>, <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>,</span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"segment_duration"</span>, <span class="st">"distance"</span>,</span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">"total_duration"</span>, <span class="st">"total_distance"</span>))<span class="sc">+</span></span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tm_shape</span>(Adresse1)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"green"</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tm_shape</span>(StationMorency)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a>Map2.Aller <span class="ot">&lt;-</span> à compléter</span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a>Map3.Aller <span class="ot">&lt;-</span> à compléter</span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true" tabindex="-1"></a>Map4.Aller <span class="ot">&lt;-</span> à compléter</span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Map1.Aller, Map2.Aller, Map3.Aller, Map4.Aller, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb79-71"><a href="#cb79-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-72"><a href="#cb79-72" aria-hidden="true" tabindex="-1"></a><span class="do">## Réaliser une figure avec quatre figures pour les trajets retour :</span></span>
<span id="cb79-73"><a href="#cb79-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map1.Retour : Marche (de la station de métro à la résidence)</span></span>
<span id="cb79-74"><a href="#cb79-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map2.Retour : Vélo (de la station de métro à la résidence)</span></span>
<span id="cb79-75"><a href="#cb79-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map3.Retour : Auto (de la station de métro à la résidence)</span></span>
<span id="cb79-76"><a href="#cb79-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - Map4.Retour : Transport en commun (de la station de métro à la résidence)</span></span>
<span id="cb79-77"><a href="#cb79-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-78"><a href="#cb79-78" aria-hidden="true" tabindex="-1"></a>Map1.Retour <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(marche<span class="fl">.2</span>)<span class="sc">+</span><span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"mode"</span>, <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb79-79"><a href="#cb79-79" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">"mode"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>,</span>
<span id="cb79-80"><a href="#cb79-80" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">"segment_duration"</span>, <span class="st">"distance"</span>,</span>
<span id="cb79-81"><a href="#cb79-81" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">"total_duration"</span>, <span class="st">"total_distance"</span>))<span class="sc">+</span></span>
<span id="cb79-82"><a href="#cb79-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Adresse1)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb79-83"><a href="#cb79-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(StationMorency)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"green"</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb79-84"><a href="#cb79-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-85"><a href="#cb79-85" aria-hidden="true" tabindex="-1"></a>Map2.Retour <span class="ot">&lt;-</span> à compléter</span>
<span id="cb79-86"><a href="#cb79-86" aria-hidden="true" tabindex="-1"></a>Map3.Retour <span class="ot">&lt;-</span> à compléter</span>
<span id="cb79-87"><a href="#cb79-87" aria-hidden="true" tabindex="-1"></a>Map4.Retour <span class="ot">&lt;-</span> à compléter</span>
<span id="cb79-88"><a href="#cb79-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-89"><a href="#cb79-89" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Map1.Retour, Map2.Retour, Map3.Retour, Map4.Retour, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb79-90"><a href="#cb79-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-91"><a href="#cb79-91" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.  Arrêt de java</span></span>
<span id="cb79-92"><a href="#cb79-92" aria-hidden="true" tabindex="-1"></a>r5r<span class="sc">::</span><span class="fu">stop_r5</span>(r5r_core)</span>
<span id="cb79-93"><a href="#cb79-93" aria-hidden="true" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jgc</span>(<span class="at">R.gc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="10-Exercices.html#sec-10051">section&nbsp;<span>9.5.1</span></a>.</p>
</div>
</div>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 2.</strong> Calcul d’isochrones</p>
</div>
<div class="bloc_exercice-body">
<p>Complétez le code ci-dessous pour réaliser les étapes suivantes&nbsp;:</p>
<ol type="1">
<li><p>Calculez des isochrones à pied de 5, 10 et 15 minutes.</p></li>
<li><p>Calculez des isochrones à vélo de 5, 10 et 15 minutes.</p></li>
<li><p>Cartographiez les résultats.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(r5r)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Construction du réseau</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"data/chap05/Laval"</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jinit</span>()</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">java.parameters =</span> <span class="st">"-Xmx2G"</span>)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>dossierdata <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/_DataReseau"</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(dossierdata)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>r5r_core <span class="ot">&lt;-</span> <span class="fu">setup_r5</span>(<span class="at">data_path =</span> dossierdata,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">elevation =</span> <span class="st">"TOBLER"</span>,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">overwrite =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Point pour la Station Morency</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>StationMorency <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="st">"Station Morency"</span>,</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lon =</span> <span class="sc">-</span><span class="fl">73.7199</span>,</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lat =</span> <span class="fl">45.5585</span>,  <span class="fl">45.5861</span>)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>StationMorency <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(StationMorency, </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Calcul d'isochrones à pied de 5, 10 et 15 minutes</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>Iso.Marche <span class="ot">&lt;-</span> <span class="fu">isochrone</span>(à compléter)</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2. Isochrone à vélo de 5, 10 et 15 minutes</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>Iso.Velo <span class="ot">&lt;-</span> <span class="fu">isochrone</span>(à compléter)</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Cartographie les résultats</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>Carte.Marche <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(à compléter)<span class="sc">+</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tm_fill</span>(à compléter)<span class="sc">+</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tm_shape</span>(StationMorency)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"darkred"</span>, <span class="at">size =</span> .<span class="dv">25</span>)</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>Carte.Velo <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(à compléter)<span class="sc">+</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tm_fill</span>(à compléter)<span class="sc">+</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tm_shape</span>(StationMorency)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"darkred"</span>, <span class="at">size =</span> .<span class="dv">25</span>)</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Carte.Marche, Carte.Velo, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Arrêt de java</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>r5r<span class="sc">::</span><span class="fu">stop_r5</span>(r5r_core)</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jgc</span>(<span class="at">R.gc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="10-Exercices.html#sec-10052">section&nbsp;<span>9.5.2</span></a>.</p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-apparicio2007case" class="csl-entry" role="listitem">
Apparicio, Philippe, Marie-Soleil Cloutier et Richard Shearmur. 2007. <span>«&nbsp;The case of Montreal’s missing food deserts: evaluation of accessibility to food supermarkets.&nbsp;»</span> <em>International journal of health geographics</em> 6 (1): 1‑13. <a href="https://doi.org/10.1186/1476-072X-6-4">https://doi.org/10.1186/1476-072X-6-4</a>.
</div>
<div id="ref-ApparicioGelbrevisited" class="csl-entry" role="listitem">
Apparicio, Philippe, Jérémy Gelb, Anne-Sophie Dubé, Simon Kingham, Lise Gauvin et Éric Robitaille. 2017. <span>«&nbsp;The approaches to measuring the potential spatial access to urban health services revisited: distance types and aggregation-error issues.&nbsp;»</span> <em>International journal of health geographics</em> 16 (1): 32. <a href="https://doi.org/10.1186/s12942-017-0105-9">https://doi.org/10.1186/s12942-017-0105-9</a>.
</div>
<div id="ref-apparicio2006measuring" class="csl-entry" role="listitem">
Apparicio, Philippe et Anne-Marie Séguin. 2006. <span>«&nbsp;Measuring the accessibility of services and facilities for residents of public housing in Montreal.&nbsp;»</span> <em>Urban studies</em> 43 (1): 187‑211. <a href="http://dx.doi.org/10.1080/00420980500409334">http://dx.doi.org/10.1080/00420980500409334</a>.
</div>
<div id="ref-dijkstra1959note" class="csl-entry" role="listitem">
Dijkstra, Edsger Wybe. 1959. <span>«&nbsp;A note on two problems in connexion with graphs:(Numerische Mathematik, 1 (1959), p 269-271).&nbsp;»</span> Stichting Mathematisch Centrum.
</div>
<div id="ref-osmextractpackage" class="csl-entry" role="listitem">
Gilardi, Andrea et Robin Lovelace. 2022. <em>osmextract: Download and Import Open Street Map Data Extracts</em>. s.n. <a href="https://CRAN.R-project.org/package=osmextract">https://CRAN.R-project.org/package=osmextract</a>.
</div>
<div id="ref-guagliardo2004spatial" class="csl-entry" role="listitem">
Guagliardo, Mark F. 2004. <span>«&nbsp;Spatial accessibility of primary care: concepts, methods and challenges.&nbsp;»</span> <em>International journal of health geographics</em> 3 (1): 1‑13. <a href="https://doi.org/10.1186/1476-072x-3-3">https://doi.org/10.1186/1476-072x-3-3</a>.
</div>
<div id="ref-hewko2002measuring" class="csl-entry" role="listitem">
Hewko, Jared, Karen E Smoyer-Tomic et M John Hodgson. 2002. <span>«&nbsp;Measuring neighbourhood spatial accessibility to urban amenities: does aggregation error matter?&nbsp;»</span> <em>Environment and Planning A</em> 34 (7): 1185‑1206. <a href="https://doi.org/10.1016/0038-0121(92)90004-O">https://doi.org/10.1016/0038-0121(92)90004-O</a>.
</div>
<div id="ref-hollister2017elevatr" class="csl-entry" role="listitem">
Hollister, Jeffrey, Tarak Shah, Alec L Robitaille, Marcus W Beck et Mike Johnson. 2023. <em>elevatr: Access Elevation Data from Various APIs</em>. s.n. <a href="https://github.com/jhollist/elevatr/">https://github.com/jhollist/elevatr/</a>.
</div>
<div id="ref-jepson2022environmental" class="csl-entry" role="listitem">
Jepson, Victoria, Philippe Apparicio et Thi-Thanh-Hien Pham. 2022. <span>«&nbsp;Environmental equity and access to parks in Greater Montreal: an analysis of spatial proximity and potential congestion issues.&nbsp;»</span> <em>Journal of Urbanism: International Research on Placemaking and Urban Sustainability</em>: 1‑19. <a href="http://dx.doi.org/10.1080/17549175.2022.2150271">http://dx.doi.org/10.1080/17549175.2022.2150271</a>.
</div>
<div id="ref-khan1992integrated" class="csl-entry" role="listitem">
Khan, Abdullah A. 1992. <span>«&nbsp;An integrated approach to measuring potential spatial access to health care services.&nbsp;»</span> <em>Socio-economic planning sciences</em> 26 (4): 275‑287. <a href="https://doi.org/10.1016/0038-0121(92)90004-O">https://doi.org/10.1016/0038-0121(92)90004-O</a>.
</div>
<div id="ref-luo2009enhanced" class="csl-entry" role="listitem">
Luo, Wei et Yi Qi. 2009. <span>«&nbsp;An enhanced two-step floating catchment area (E2SFCA) method for measuring spatial accessibility to primary care physicians.&nbsp;»</span> <em>Health &amp; Place</em> 15 (4). Elsevier: 1100‑1107. <a href="https://doi.org/10.1016/j.healthplace.2009.06.002">https://doi.org/10.1016/j.healthplace.2009.06.002</a>.
</div>
<div id="ref-luo2003measures" class="csl-entry" role="listitem">
Luo, Wei et Fahui Wang. 2003. <span>«&nbsp;Measures of spatial accessibility to health care in a GIS environment: synthesis and a case study in the Chicago region.&nbsp;»</span> <em>Environment and planning B: planning and design</em> 30 (6): 865‑884. <a href="https://doi.org/10.1068/b29120">https://doi.org/10.1068/b29120</a>.
</div>
<div id="ref-mcgrail2012spatial" class="csl-entry" role="listitem">
McGrail, Matthew R. 2012. <span>«&nbsp;Spatial accessibility of primary health care utilising the two step floating catchment area method: an assessment of recent improvements.&nbsp;»</span> <em>International Journal of Health Geographics</em> 11. Springer: 1‑12. <a href="https://doi.org/10.1186/1476-072X-11-50">https://doi.org/10.1186/1476-072X-11-50</a>.
</div>
<div id="ref-mcgrail2009measuring" class="csl-entry" role="listitem">
McGrail, Matthew R et John S Humphreys. 2009. <span>«&nbsp;Measuring spatial accessibility to primary care in rural areas: Improving the effectiveness of the two-step floating catchment area method.&nbsp;»</span> <em>Applied geography</em> 29 (4): 533‑541. <a href="https://doi.org/10.1016/j.apgeog.2008.12.003">https://doi.org/10.1016/j.apgeog.2008.12.003</a>.
</div>
<div id="ref-packageOpenTripPlanner" class="csl-entry" role="listitem">
Morgan, Malcolm, Young Marcus, Robin Lovelace et Layik Hama. 2019. <span>«&nbsp;OpenTripPlanner for R.&nbsp;»</span> <em>Journal of Open Source Software</em> 4 (44): 1926. <a href="https://10.21105/joss.01926">https://10.21105/joss.01926</a>.
</div>
<div id="ref-ngui2011optimizing" class="csl-entry" role="listitem">
Ngui, André Ngamini et Philippe Apparicio. 2011. <span>«&nbsp;Optimizing the two-step floating catchment area method for measuring spatial accessibility to medical clinics in Montreal.&nbsp;»</span> <em>BMC health services research</em> 11 (1): 1‑12. <a href="https://doi.org/10.1186/1472-6963-11-166">https://doi.org/10.1186/1472-6963-11-166</a>.
</div>
<div id="ref-penchansky1981concept" class="csl-entry" role="listitem">
Penchansky, Roy et J William Thomas. 1981. <span>«&nbsp;The concept of access: definition and relationship to consumer satisfaction.&nbsp;»</span> <em>Medical care</em>: 127‑140. <a href="https://doi.org/10.1097/00005650-198102000-00001">https://doi.org/10.1097/00005650-198102000-00001</a>.
</div>
<div id="ref-packageR5R" class="csl-entry" role="listitem">
Pereira, Rafael H. M., Marcus Saraiva, DanielHerszenhut, Carlos Kaue Vieira Braga et Matthew Wigginton Conway. 2021. <span>«&nbsp;r5r: Rapid Realistic Routing on Multimodal Transport Networks with R5 in R.&nbsp;»</span> <em>Findings</em>. <a href="https://doi.org/10.32866/001c.21262">https://doi.org/10.32866/001c.21262</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04-AgregatsSpatiaux.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Méthodes de détection d’agrégats spatiaux et spatio-temporels</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-AnalyseReseauEvenements.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyses d’évènements localisés sur un réseau</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes d’analyse spatiale : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>