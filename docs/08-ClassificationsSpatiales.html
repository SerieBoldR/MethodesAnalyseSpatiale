<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes d’analyse spatiale : un grand bol d’R - 8&nbsp; Méthodes de classification non supervisée spatiale</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-EchantillonnageSpatial.html" rel="next">
<link href="./07-RegressionSpatiales.html" rel="prev">
<link href="./images/introduction/Couverture_16_01-01.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-ClassificationsSpatiales.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes d’analyse spatiale : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Données spatiales et R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-ManipulationDonneesSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manipulation des données spatiales dans&nbsp;R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Autocorrélation spatiale</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Autocorrelation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Autocorrélation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Méthodes de répartition ponctuelle et de détections d’agrégats spatiaux</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-MethodesRepartitionPonctuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Méthodes de répartition ponctuelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-AgregatsSpatiaux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Méthodes de détection d’agrégats spatiaux et spatio-temporels</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Analyses de données avec des réseaux de transport</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-AnalyseReseau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mesures d’accessibilité spatiale selon différents modes de transport</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-AnalyseReseauEvenements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyses d’évènements localisés sur un réseau</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Régressions spatiales et classifications spatiales</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-RegressionSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ClassificationsSpatiales.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Échantillonnage, interpolation et désagrégation spatiales</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-EchantillonnageSpatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Méthodes d’échantillonnage spatial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-InterpolationSpatiale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Méthodes d’interpolation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-DesagregationSpatiale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Méthodes de déségrégation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 7. Exercices et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Exercices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Correction des exercices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-081" id="toc-sec-081" class="nav-link active" data-scroll-target="#sec-081"><span class="header-section-number">8.1</span> Méthodes de classification non supervisée avec contrainte spatiale</a>
  <ul class="collapse">
<li><a href="#sec-0811" id="toc-sec-0811" class="nav-link" data-scroll-target="#sec-0811"><span class="header-section-number">8.1.1</span> Algorithmes AZP</a></li>
  <li><a href="#sec-0812" id="toc-sec-0812" class="nav-link" data-scroll-target="#sec-0812"><span class="header-section-number">8.1.2</span> Algorithme SKATER</a></li>
  <li><a href="#sec-0813" id="toc-sec-0813" class="nav-link" data-scroll-target="#sec-0813"><span class="header-section-number">8.1.3</span> Algorithmes REDCAP</a></li>
  <li><a href="#sec-0814" id="toc-sec-0814" class="nav-link" data-scroll-target="#sec-0814"><span class="header-section-number">8.1.4</span> Algorithme du <em>max-p-regions problem</em></a></li>
  </ul>
</li>
  <li>
<a href="#sec-082" id="toc-sec-082" class="nav-link" data-scroll-target="#sec-082"><span class="header-section-number">8.2</span> Méthodes de classification non supervisée avec une dimension spatiale</a>
  <ul class="collapse">
<li><a href="#sec-0821" id="toc-sec-0821" class="nav-link" data-scroll-target="#sec-0821"><span class="header-section-number">8.2.1</span> Classification ascendante hiérarchique spatiale (<em>ClustGeo</em>)</a></li>
  <li><a href="#sec-0822" id="toc-sec-0822" class="nav-link" data-scroll-target="#sec-0822"><span class="header-section-number">8.2.2</span> <em>Spatial fuzzy c-means</em></a></li>
  </ul>
</li>
  <li><a href="#sec-083" id="toc-sec-083" class="nav-link" data-scroll-target="#sec-083"><span class="header-section-number">8.3</span> Quiz de révision du chapitre</a></li>
  <li><a href="#sec-084" id="toc-sec-084" class="nav-link" data-scroll-target="#sec-084"><span class="header-section-number">8.4</span> Exercices de révision</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap08" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Les méthodes de classification visent à regrouper des observations d’un jeu de données en plusieurs classes en fonction de leurs caractéristiques évaluées à partir de plusieurs variables. Appliquées à une couche spatiale (polygones, points, lignes), il s’agit alors de classifier les unités spatiales sur la base de plusieurs de leurs attributs mesurés à partir de variables. Dans le cadre de ce chapitre, nous abordons deux principales familles de méthodes de classification non supervisée&nbsp;: <strong>celle avec une contrainte spatiale</strong> (algorithmes AZP, SKATER, REDCAP) et <strong>celle avec une dimension spatiale</strong> (<em>ClustGeo</em> et classification floue c-moyennes spatiale).</p>
<p>Sommairement, les deux dernières méthodes sont des extensions spatiales de la classification ascendante hiérarchique (CAH) et de l’algorithme flou c-moyennes. Par conséquent, la lecture de ce chapitre nécessite de bien maîtriser le fonctionnement de la CAH et des k-moyennes (<em>k-means</em>). Si ce n’est pas le cas, nous vous invitons vivement à lire le <a href="https://serieboldr.github.io/MethodesQuantitatives/13-MethodeClassification.html">chapitre suivant</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>.</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Bref retour sur les méthodes de classification</strong></p>
</div>
<div class="bloc_attention-body">
<p>Il existe de nombreuses méthodes de classification. Nous distinguons habituellement plusieurs familles de méthodes de classification, celles non supervisées versus supervisées et celles strictes versus floues&nbsp;:</p>
<ul>
<li><p><strong>Les méthodes de classification non supervisée</strong> «&nbsp;[…] relèvent de la statistique exploratoire multidimensionnelle et permettent de regrouper automatiquement les observations sans avoir de connaissance préalable sur la nature des classes présentes dans l’ensemble de données <span class="citation" data-cites="lebart1995statistique">(<a href="references.html#ref-lebart1995statistique" role="doc-biblioref">Lebart, Morineau et Piron 1995</a>)</span>. Les méthodes les plus connues dans ce domaine sont l’algorithme de Classification ascendante hiérarchique (CAH) et la méthode des k-moyennes (<em>k-means</em>)&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 1</a>)</span>. À cela s’ajoutent d’autres méthodes comme les k-médianes <span class="citation" data-cites="jain1988algorithms">(<a href="references.html#ref-jain1988algorithms" role="doc-biblioref">Jain et Dubes 1988</a>)</span> ou encore les k-médoïdes <span class="citation" data-cites="kaufman1990partitioning">(<a href="references.html#ref-kaufman1990partitioning" role="doc-biblioref">Kaufman 1990</a>)</span> et la classification mixte combinant k-moyennes et CAH <span class="citation" data-cites="lebart1995statistique">(<a href="references.html#ref-lebart1995statistique" role="doc-biblioref">Lebart, Morineau et Piron 1995</a>)</span>. Pour regrouper les observations, ces méthodes (CAH, k-moyennes, k-médianes, k-médoïdes, classification mixte) sont basées sur la distance (proximité) entre les observations tandis que d’autres méthodes sont basées sur la densité des observations (algorithmes DBSCAN, HDBSCAN, STDBSCAN, OPTICS abordés à la <a href="04-AgregatsSpatiaux.html#sec-041">section&nbsp;<span>4.1</span></a>).</p></li>
<li><p><strong>Les méthodes de classification supervisée</strong> «&nbsp;[…] permettent d’affecter des observations à partir d’un échantillon déjà classifié, souvent appelé classe d’entraînement. Parmi les méthodes supervisées les plus connues, on retrouve les forêts d’arbres décisionnels, les réseaux de neurones artificiels et l’analyse factorielle discriminante&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 1</a>)</span>. Plus exactement, ces méthodes visent à apprendre des règles basées sur les attributs des observations pour déterminer à quel groupe chaque observation doit être attribuée. Ces règles peuvent ensuite être utilisées pour déterminer la catégorie de nouvelles observations.</p></li>
<li><p>Que la classification soit ou non supervisée, «&nbsp;on distingue généralement les <strong>méthodes strictes</strong> (ou de partition) des <strong>méthodes floues</strong>. […] Dans une classification stricte, chaque observation appartient à une seule classe&nbsp;: mathématiquement, l’appartenance à une classe donnée est binaire (0 ou 1), tandis que dans une classification floue, chaque observation a une probabilité d’appartenance variant de 0 à 1 pour chacune des classes&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 1‑2</a>)</span>.</p></li>
</ul>
</div>
</div>
<p><strong>Pourquoi recourir à des méthodes de classification non supervisée spatiale?</strong></p>
<p>Dans un article récent, Gelb et Apparicio <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">2021</a>)</span> identifient deux principales limites à l’application d’une méthode de classification non supervisée a-spatiale (comme le CAH et le <em>k-means</em>) sur des données spatiales&nbsp;:</p>
<ol type="1">
<li>
<strong>La non-prise en compte de la dimension spatiale constitue une perte d’information&nbsp;:</strong> «&nbsp;[…]&nbsp; une partie de l’information propre aux données, à savoir leur localisation, n’est pas prise en compte dans le processus de classification. Or, la dimension géographique est souvent très structurante; par conséquent, l’occulter revient à perdre une quantité non négligeable d’information. Il convient toutefois de nuancer quelque peu ce propos. Généralement, la cartographie des méthodes de classification non supervisée a-spatiale (CAH et <em>k-means</em>) révèlent des effets de voisinage, d’autant plus que les variables introduites dans la classification sont fortement autocorrélées positivement&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 6</a>)</span>.</li>
<li>
<strong>Limiter l’effet de mitage</strong>&nbsp;: «&nbsp;[…] dans un contexte d’autocorrélation spatiale positive, des observations proches spatialement devraient plus vraisemblablement appartenir au même groupe. Avec les méthodes de classification a-spatiale, il est fréquent d’observer des phénomènes de mitage, c’est-à-dire des observations appartenant à un groupe <em>b</em> et isolées au milieu d’un ensemble d’observations appartenant au groupe <em>a</em>. Ce phénomène peut s’expliquer par la présence ici et là d’autocorrélation spatiale locale négative, c’est-à-dire des observations dont les caractéristiques sémantiques diffèrent de leurs voisines. Souvent, la dissimilarité sémantique entre ces observations est négligeable et ne justifie pas cette rupture spatiale&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 6</a>)</span>.</li>
</ol>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour importer et manipuler des fichiers géographiques&nbsp;:
<ul>
<li>
<code>sf</code> pour importer et manipuler des données vectorielles.</li>
<li>
<code>spdep</code> pour construire des matrices de pondération spatiale.</li>
</ul>
</li>
<li>Pour construire des cartes et des graphiques&nbsp;:
<ul>
<li>
<code>tmap</code> est certainement le meilleur <em>package</em> pour la cartographie.</li>
<li>
<code>ggplot2</code> pour construire des graphiques.</li>
<li>
<code>ggpubr</code> pour combiner des graphiques.</li>
</ul>
</li>
<li>Pour les méthodes de classification avec une contrainte spatiale&nbsp;:
<ul>
<li>
<code>rgeoda</code> pour les algorithmes AZP, SKATER et REDCAP.</li>
<li>
<code>spdep</code> pour l’algorithme SKATER.</li>
</ul>
</li>
<li>Pour les méthodes de classification avec une dimension spatiale&nbsp;:
<ul>
<li>
<code>ClustGeo</code> pour la méthode ClustGeo.</li>
<li>
<code>geocmeans</code> pour la classification k-moyennes floue et spatiale.</li>
</ul>
</li>
</ul>
</div>
</div>
<section id="sec-081" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="sec-081">
<span class="header-section-number">8.1</span> Méthodes de classification non supervisée avec contrainte spatiale</h2>
<p>Nous avons vu que l’objectif d’une méthode non supervisée appliquée à des données spatiales est de regrouper en <em>n</em> classes les unités spatiales d’une couche géographique. Prenons l’exemple de quatre variables environnementales cartographiées à la <a href="#fig-figVarEnv">figure&nbsp;<span>8.1</span></a> pour les IRIS de la ville de Lyon, dont trois considérées comme des nuisances (bruit, dioxyde d’azote et particules fines) et une considérée comme avantageuse (végétation).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-figVarEnv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-figVarEnv-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.1: Cartographie des variables environnementales</figcaption></figure>
</div>
</div>
</div>
<p>Il est possible de regrouper les unités spatiales avec ou sans contrainte spatiale&nbsp;:</p>
<ul>
<li><p><strong>Sans contrainte spatiale</strong>, nous cherchons à regrouper les IRIS (unités spatiales) avec des valeurs similaires pour les quatre variables retenues (L<sub>den</sub>, NO<sub>2</sub>, PM<sub>2,5</sub> et pourcentage de canopée). Cette approche est illustrée à la <a href="#fig-figKmeansSkater">figure&nbsp;<span>8.2</span></a> (a) avec l’algorithme k-moyennes (<em>k-means</em> en anglais) avec cinq classes.</p></li>
<li><p><strong>Avec contrainte spatiale</strong>, nous cherchons à regrouper les IRIS (unités spatiales) avec des valeurs similaires pour les quatre variables retenues, tout en nous assurant que les regroupements forment des régions avec une absence de mitage. Cette approche est illustrée à la <a href="#fig-figKmeansSkater">figure&nbsp;<span>8.2</span></a> (b) avec l’algorithme SKATER (<em>Spatial ’K’luster Analysis by Tree Edge Removal</em>) avec cinq classes. Autrement dit, l’objectif des méthodes de classification non supervisée avec contrainte spatiale est d’agréger <em>n</em>&nbsp;unités spatiales en <em>m</em>&nbsp;régions non discontinues (avec <em>n</em>&nbsp;&lt;&nbsp;<em>m</em>) et cohérentes du point de vue de leurs attributs <span class="citation" data-cites="openshaw1995algorithms">(<a href="references.html#ref-openshaw1995algorithms" role="doc-biblioref">Openshaw et Rao 1995, 428</a>)</span>.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-figKmeansSkater" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-figKmeansSkater-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.2: Classification non supervisée avec et sans contrainte spatiale</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_objectif">
<div class="bloc_objectif-header">
<div class="bloc_objectif-icon">

</div>
<p><strong>Intérêt et limites des méthodes de classification avec une contrainte spatiale</strong></p>
</div>
<div class="bloc_objectif-body">
<p>Selon Gelb et Apparicio <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">2021, 7</a>)</span>, le résultat d’une méthode de classification avec une contrainte spatiale est «&nbsp;la création de régions très cohérentes spatialement, c’est-à-dire avec une absence de mitage. Autrement dit, avec ces méthodes, il n’est pas possible d’identifier de groupes qui seraient spatialement discontinus, c’est-à-dire composés de plusieurs ensembles régionaux séparés. L’impossibilité d’obtenir du mitage au sein des différentes régions peut masquer la présence de valeurs fortement dissemblables localement, malgré la prise en compte de l’espace. Or, ces observations systématiquement différentes de leurs voisines doivent faire l’objet d’une attention particulière dans les exercices de classification intégrant l’espace, ce que ne permettent pas ces méthodes d’agrégation spatiale.</p>
<p>Les limites de ces méthodes, particulièrement celles relatives au mitage, ont conduit plus récemment à la mise au point de nouvelles méthodes incluant l’espace dans le processus de classification, sans imposer une contrainte de contiguïté. Plus spécifiquement, ces nouvelles méthodes sont des modifications des algorithmes classiques, tels que la CAH ou le FCM, pour intégrer la dimension spatiale en parallèle à la dimension sémantique des données. En d’autres termes, l’espace n’est plus intégré comme une contrainte dans les algorithmes de classification, mais plutôt comme une donnée supplémentaire&nbsp;».</p>
</div>
</div>
<p>Les principaux algorithmes de classification non supervisée avec contrainte spatiale (<em>Spatially Constrained Clustering Methods</em> en anglais) sont&nbsp;:</p>
<ul>
<li><p>La méthode de zonage automatique (<em>Automatic Zoning Procedure</em> en anglais) (AZP) proposée par Openshaw <span class="citation" data-cites="openshaw1977geographical">(<a href="references.html#ref-openshaw1977geographical" role="doc-biblioref">1977</a>)</span>, puis améliorée par Openshaw et Rao <span class="citation" data-cites="openshaw1995algorithms">(<a href="references.html#ref-openshaw1995algorithms" role="doc-biblioref">1995</a>)</span>.</p></li>
<li><p>L’algorithme SKATER (<em>Spatial ’K’luster Analysis by Tree Edge Removal</em>) <span class="citation" data-cites="assunccao2006efficient">(<a href="references.html#ref-assunccao2006efficient" role="doc-biblioref">Assunção et al. 2006</a>)</span>.</p></li>
<li><p>L’algorithme REDCAP (<em>Regionalization with dynamically constrained agglomerative clustering and partitioning</em>) <span class="citation" data-cites="guo2008regionalization">(<a href="references.html#ref-guo2008regionalization" role="doc-biblioref">Guo 2008</a>)</span>.</p></li>
<li><p>L’algorithme du <em>max-p-regions problem</em> <span class="citation" data-cites="duque2012max">(<a href="references.html#ref-duque2012max" role="doc-biblioref">Duque, Anselin et Rey 2012</a>)</span>.</p></li>
</ul>
<p>Pour mettre en œuvre ces différents algorithmes, nous utilisons le <em>package</em> <code>rgeoda</code> <span class="citation" data-cites="packagergeoda">(<a href="references.html#ref-packagergeoda" role="doc-biblioref">Li et Anselin 2023</a>)</span>. Notez que l’algorithme SKATER est aussi implémenté dans le <em>package</em> <code>spded</code> (fonction <code>skater</code>).</p>
<section id="sec-0811" class="level3" data-number="8.1.1"><h3 data-number="8.1.1" class="anchored" data-anchor-id="sec-0811">
<span class="header-section-number">8.1.1</span> Algorithmes AZP</h3>
<p>L’algorithme AZP (<em>Automatic Zoning Problem</em>) est une approche itérative et heuristique visant à regrouper des polygones adjacents en <em>m</em> régions, tout en maximisant la variance interrégionale (variance interclasse) et en minimisant la variance intrarégionale (variance intraclasse) calculées sur les <em>p</em> variables. Autrement dit, il vise à créer des régions non discontinues les plus homogènes possibles et les plus dissemblables entre elles sur la base des <em>p</em> variables. Pour utiliser l’AZP, il faut spécifier le nombre de régions (<em>m</em>) désiré. Notez qu’il existe trois algorithmes pour l’AZP&nbsp;:</p>
<ol type="1">
<li>AZP (<em>Automatic Zoning Procedure</em>), soit la première version par Stan Openshaw <span class="citation" data-cites="openshaw1977geographical">(<a href="references.html#ref-openshaw1977geographical" role="doc-biblioref">1977</a>)</span>.</li>
<li>AZP-SA (<em>A simulated annealing AZP method</em>) <span class="citation" data-cites="openshaw1995algorithms">(<a href="references.html#ref-openshaw1995algorithms" role="doc-biblioref">Openshaw et Rao 1995</a>)</span>.</li>
<li>AZP-TABU (<em>A tabu search heuristic version of AZP</em>) <span class="citation" data-cites="openshaw1995algorithms">(<a href="references.html#ref-openshaw1995algorithms" role="doc-biblioref">Openshaw et Rao 1995</a>)</span>.</li>
</ol>
<p>Pour une description détaillée de ces trois algorithmes, vous pouvez consulter Openshaw et Rao <span class="citation" data-cites="openshaw1995algorithms">(<a href="references.html#ref-openshaw1995algorithms" role="doc-biblioref">1995</a>)</span> ou encore le <a href="https://geodacenter.github.io/workbook/9d_spatial4/lab9d.html#principle">lien suivant</a>.</p>
<p>Appliquons ces algorithmes aux 506&nbsp;IRIS de la ville de Lyon avec les quatre variables environnementales préalablement centrées réduites (bruit, dioxyde d’azote, particules fines et pourcentage de végétation) et une matrice de contiguïté selon le partage d’un nœud. Le <em>package</em> <code>rgeoda</code> comprend trois fonctions pour l’AZP&nbsp;: <code>azp_greedy</code> (AZP), <code>azp_sa</code> (AZP-SA), <code>azp_tabu</code> (AZP-TABU). Pour l’exercice, nous fixons le nombre de régions à&nbsp;5. Notez que par défaut, les variables seront centrées réduites (moyenne&nbsp;=&nbsp;0 et écart-type&nbsp;=&nbsp;1) avec le paramètre <code>scale_method="standardize"</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geodacenter/rgeoda/">rgeoda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span><span class="co">## Variables</span></span>
<span><span class="va">VarsEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>, <span class="st">"NO2"</span>, <span class="st">"PM25"</span>, <span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Dataframe sans la géométrie et les quatre variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap08/DonneesLyon.Rdata"</span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Création d'une matrice de contiguïté avec rgeoda</span></span>
<span><span class="va">queen_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="co">## Calcul des trois algorithmes</span></span>
<span><span class="va">azp</span> <span class="op">&lt;-</span> <span class="fu">rgeoda</span><span class="fu">::</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/azp_greedy.html">azp_greedy</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">5</span>,       <span class="co"># Nombre de régions</span></span>
<span>                          w<span class="op">=</span><span class="va">queen_w</span>, <span class="co"># Matrice contiguïté</span></span>
<span>                          df<span class="op">=</span><span class="va">Data</span>,   <span class="co"># Tableau de données</span></span>
<span>                          scale_method <span class="op">=</span> <span class="st">"standardize"</span><span class="op">)</span> <span class="co"># cote z</span></span>
<span><span class="va">azp.sa</span> <span class="op">&lt;-</span> <span class="fu">rgeoda</span><span class="fu">::</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/azp_sa.html">azp_sa</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">5</span>, w<span class="op">=</span><span class="va">queen_w</span>, df<span class="op">=</span><span class="va">Data</span>, cooling_rate <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="va">azp.tab</span> <span class="op">&lt;-</span> <span class="fu">rgeoda</span><span class="fu">::</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/azp_tabu.html">azp_tabu</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">5</span>, w<span class="op">=</span><span class="va">queen_w</span>, df<span class="op">=</span><span class="va">Data</span>, tabu_length <span class="op">=</span> <span class="fl">10</span>, conv_tabu <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">## Création des trois champs dans la couche de Lyon</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Azp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">azp</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Azp_sa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">azp.sa</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Azp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">azp.tab</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cartographions les résultats des trois algorithmes AZP (<a href="#fig-CartoAZP">figure&nbsp;<span>8.3</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Cartographie des résultats</span></span>
<span><span class="va">Carte.AZP1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"Azp"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"a. AZP"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.AZP2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"Azp_sa"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"b. AZP Simulated Annealing"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.AZP3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"Azp_tab"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"c. AZP Tabu Search"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte.AZP1</span>, <span class="va">Carte.AZP2</span>, <span class="va">Carte.AZP3</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CartoAZP" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-CartoAZP-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.3: Regroupements des 505 IRIS en cinq régions selon les trois algorithmes AZP</figcaption></figure>
</div>
</div>
</div>
<p>Par la suite, nous comparons les résultats obtenus des trois algorithmes en reportant&nbsp;:</p>
<ol type="1">
<li><p>Les variances totale, intrarégionale et interrégionale, et surtout le ratio entre les variances intergroupe et totale. Ce ratio varie de 0 à 1 et exprime la proportion de la variance des variables qui est expliquée par les différentes régions obtenues; plus il est élevé, meilleur est le résultat. Par conséquent, il peut être utilisé pour identifier la solution optimale entre les trois algorithmes.</p></li>
<li><p>Le nombre d’observations par région.</p></li>
<li><p>Les valeurs moyennes des variables centrées réduites par région.</p></li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Calcul du ratio entre les variances intergroupe et totale</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Ratio des variances interrégionale et totale"</span>,</span>
<span>    <span class="st">"\nAZP : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">azp</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="st">"\nAZP-SA : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">azp.sa</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="st">"\nAZP-TABU : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">azp.tab</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio des variances interrégionale et totale 
AZP :  0.436 
AZP-SA :  0.518 
AZP-TABU :  0.428</code></pre>
</div>
</div>
<p>À la lecture des valeurs du ratio entre la variance interrégionale et la variance totale ci-dessus, la plus élevée est obtenue pour l’AZP-SA (0,518), suivie de celles de l’AZP (0,436) et de l’AZP-TABU (0,428). Nous retenons alors l’AZP-SA.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Nombre d'observations par région</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Azp</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
186 176 104  27  13 </code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Azp_sa</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
221 107  87  51  40 </code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Azp_tab</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
191 186  91  27  11 </code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Valeurs moyennes des variables centrées réduites par région</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Azp</span> <span class="op">&lt;-</span> <span class="va">azp</span><span class="op">$</span><span class="va">Clusters</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Azp_sa</span> <span class="op">&lt;-</span> <span class="va">azp.sa</span><span class="op">$</span><span class="va">Clusters</span></span>
<span><span class="va">Data</span><span class="op">$</span><span class="va">Azp_tab</span> <span class="op">&lt;-</span> <span class="va">azp.tab</span><span class="op">$</span><span class="va">Clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Lden</span>,<span class="va">NO2</span>,<span class="va">PM25</span>,<span class="va">VegHautPrt</span><span class="op">)</span> <span class="op">~</span> <span class="va">Azp</span>, data <span class="op">=</span> <span class="va">Data</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Azp     Lden      NO2     PM25 VegHautPrt
1   1 58.05464 35.21961 18.85212   15.45333
2   2 55.42159 26.45169 16.32884   13.98563
3   3 53.23122 23.63965 14.95293   30.42529
4   4 52.26742 22.99701 14.58065   20.39444
5   5 48.71652 18.24301 13.07043   33.07154</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Lden</span>,<span class="va">NO2</span>,<span class="va">PM25</span>,<span class="va">VegHautPrt</span><span class="op">)</span> <span class="op">~</span> <span class="va">Azp_sa</span>, data <span class="op">=</span> <span class="va">Data</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Azp_sa     Lden      NO2     PM25 VegHautPrt
1      1 57.41952 35.02151 18.80132   14.41317
2      2 55.11019 22.52804 15.55562   14.12178
3      3 51.08297 20.48809 14.16951   28.66000
4      4 54.23625 24.47389 14.96836   22.30059
5      5 58.40430 33.55155 17.08480   28.83775</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Lden</span>,<span class="va">NO2</span>,<span class="va">PM25</span>,<span class="va">VegHautPrt</span><span class="op">)</span> <span class="op">~</span> <span class="va">Azp_tab</span>, data <span class="op">=</span> <span class="va">Data</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Azp_tab     Lden      NO2     PM25 VegHautPrt
1       1 55.24285 26.04447 16.19300   14.67712
2       2 58.05464 35.21961 18.85212   15.45333
3       3 53.19298 23.97221 14.99671   31.90967
4       4 52.26742 22.99701 14.58065   20.39444
5       5 48.32861 17.74683 12.84853   31.68364</code></pre>
</div>
</div>
<p>Les résultats finaux de l’AZP-SA sont présentés au <a href="#tbl-dataAZPsa">tableau&nbsp;<span>8.1</span></a> et à la <a href="#fig-CartoAZPsa">figure&nbsp;<span>8.4</span></a>. L’analyse conjointe du tableau et de la carte permet ainsi d’interpréter chacune des classes. En guise d’exemple, nous pouvons conclure que&nbsp;:</p>
<ul>
<li><p><strong>La région 1</strong> comprend 221&nbsp;IRIS localisés au centre de la ville de Lyon et caractérisés par des niveaux moyens élevés de bruit (57,4), de dioxyde d’azote (35) et de particules fines (18,8) élevés et un faible pourcentage de canopée (14,4&nbsp;%).</p></li>
<li><p>Par contre, <strong>la région 2</strong> comprend 107&nbsp;IRIS localisés à l’extrême ouest de la ville et caractérisés par les plus faibles niveaux de polluants (51,1, 20,5 et 14,2) et une forte moyenne pour la canopée (28,7&nbsp;%).</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-dataAZPsa" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.1: Valeurs moyennes des variables pour les cinq régions obtenues par l’AZP-SA</caption>
<thead><tr class="header">
<th style="text-align: center;">Région</th>
<th style="text-align: center;">Lden</th>
<th style="text-align: center;">NO2</th>
<th style="text-align: center;">PM25</th>
<th style="text-align: center;">Végétation</th>
<th style="text-align: center;">Nombre d’IRIS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">57,4</td>
<td style="text-align: center;">35,0</td>
<td style="text-align: center;">18,8</td>
<td style="text-align: center;">14,4</td>
<td style="text-align: center;">221</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">55,1</td>
<td style="text-align: center;">22,5</td>
<td style="text-align: center;">15,6</td>
<td style="text-align: center;">14,1</td>
<td style="text-align: center;">107</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">51,1</td>
<td style="text-align: center;">20,5</td>
<td style="text-align: center;">14,2</td>
<td style="text-align: center;">28,7</td>
<td style="text-align: center;">87</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">54,2</td>
<td style="text-align: center;">24,5</td>
<td style="text-align: center;">15,0</td>
<td style="text-align: center;">22,3</td>
<td style="text-align: center;">51</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">58,4</td>
<td style="text-align: center;">33,6</td>
<td style="text-align: center;">17,1</td>
<td style="text-align: center;">28,8</td>
<td style="text-align: center;">40</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-CartoAZPsa" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-CartoAZPsa-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.4: Regroupement des IRIS en cinq régions selon l’AZP-TABU</figcaption></figure>
</div>
</div>
</div>
<p>Nous avons vu que pour les algorithmes AZP, il faut spécifier le nombre de régions. Nous l’avons fixé arbitrairement à&nbsp;5. Comme pour n’importe quelle méthode de classification non supervisée, déterminer le nombre de classes optimal est une étape cruciale qui peut s’appuyer sur différentes techniques, dont la méthode du coude basée sur l’inertie expliquée (ici le ratio entre les variances interrégionale et totale), l’indicateur de silhouette et la méthode GAP. Pour une description détaillée de ces méthodes, consultez la <a href="https://serieboldr.github.io/MethodesQuantitatives/13-MethodeClassification.html#sec-1332">section suivante</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>. Le code ci-dessous permet de réaliser un graphique avec les valeurs du ratio (inertie expliquée) obtenues avec l’algorithme AZP-TABU calculé pour 2 à 10 régions. À la lecture de la <a href="#fig-AZPCoude">figure&nbsp;<span>8.5</span></a>, nous observons deux ruptures (coudes) très nettes à 5 et 8.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">nregions</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">queen_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="va">inertie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">nregions</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># calcul de l'AZP-TABU avec k</span></span>
<span>  <span class="va">resultat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/azp_tabu.html">azp_tabu</a></span><span class="op">(</span>p<span class="op">=</span><span class="va">k</span>, w<span class="op">=</span><span class="va">queen_w</span>, df<span class="op">=</span><span class="va">Data</span>, tabu_length <span class="op">=</span> <span class="fl">10</span>, conv_tabu <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="co"># récupération du ratio</span></span>
<span>  <span class="va">ratios</span> <span class="op">&lt;-</span> <span class="va">resultat</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>k <span class="op">=</span> <span class="va">nregions</span>, ratio <span class="op">=</span> <span class="va">inertie</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">ratio</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Nombre de régions"</span>, y <span class="op">=</span> <span class="st">"Inertie expliquée (%)"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AZPCoude" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-AZPCoude-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.5: Méthode du coude reposant sur l’inertie expliquée pour l’AZP-TABU</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0812" class="level3" data-number="8.1.2"><h3 data-number="8.1.2" class="anchored" data-anchor-id="sec-0812">
<span class="header-section-number">8.1.2</span> Algorithme SKATER</h3>
<p>L’algorithme SKATER (<em>Spatial ’K’luster Analysis by Tree Edge Removal</em>) <span class="citation" data-cites="assunccao2006efficient">(<a href="references.html#ref-assunccao2006efficient" role="doc-biblioref">Assunção et al. 2006</a>)</span> permet aussi de créer des régions sans discontinuité, en recourant à une technique de la théorie des graphes, soit celle de l’arbre couvrant de poids minimal (<em>minimum spanning tree</em>). Succinctement, la classification est obtenue avec les étapes suivantes&nbsp;:</p>
<ol type="1">
<li><p>Création d’un graphe de connectivité pour les polygones de la couche géographique. Dans ce graphe, les nœuds sont les centroïdes des polygones et les arêtes représentent les liaisons entre deux entités spatiales voisines.</p></li>
<li><p>Pour chaque arête, nous calculons la dissimilarité (appelée coût) des deux polygones voisins en fonction des <em>p</em> variables.</p></li>
<li><p>Pour chaque polygone, nous retenons l’arête avec le coût minimal. Autrement dit, pour chaque polygone, nous retenons son polygone voisin qui lui est le plus semblable selon les <em>p</em> variables. Nous obtenons ainsi l’arbre couvrant de poids minimal.</p></li>
<li><p>Cet arbre est ensuite élagué en supprimant les arêtes avec les plus forts coûts et en créant ainsi des sous-graphes en <em>m</em> régions sans discontinuité.</p></li>
</ol>
<p>Pour une description plus détaillée de l’algorithme, consultez l’article d’Assunção <em>et al.</em> <span class="citation" data-cites="assunccao2006efficient">(<a href="references.html#ref-assunccao2006efficient" role="doc-biblioref">2006</a>)</span>.</p>
<p>Le code ci-dessous permet de centrer et de réduire les quatre variables (fonction <code>scale</code>) et de construire la matrice de voisinage entre les polygones de la couche <code>LyonIris</code> (fonction <code>poly2nb</code> de <code>spdep</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span><span class="co">## Variables</span></span>
<span><span class="va">VarsEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>, <span class="st">"NO2"</span>, <span class="st">"PM25"</span>, <span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Dataframe sans la géométrie et les quatre variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap08/DonneesLyon.Rdata"</span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Données centrées et réduites</span></span>
<span><span class="va">LyonIrisZscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrice voisinage</span></span>
<span><span class="va">Lyon.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculons les coûts pour les arêtes reliant les nœuds avec la fonction <code>nbcosts</code>. Nous constatons que le polygone&nbsp;1 est voisin des polygones 27, 26, 44 et 74 avec des coûts de 1,34, 1,74, 1,15 et 16,3. Par conséquent, parmi ses quatre voisins, le polygone 1 est le plus semblable au polygone 44 (coût minimal).</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Calcul des coûts pour les arêtes</span></span>
<span><span class="va">lcosts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nbcosts.html">nbcosts</a></span><span class="op">(</span><span class="va">Lyon.nb</span>, <span class="va">LyonIrisZscore</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Lyon.nb</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 27 36 44 73</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lcosts</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1.343210 1.735894 1.153787 1.632583</code></pre>
</div>
</div>
<p>À partir de ces coûts, nous pouvons trouver l’arbre couvrant de poids minimal (<em>minimum spanning tree</em>), objet dénommé ici <code>Lyon.mst</code> qui comprend trois colonnes&nbsp;:</p>
<ul>
<li>La première pour l’identifiant du polygone.</li>
<li>La seconde pour l’identifiant du polygone voisin.</li>
<li>La troisième pour la valeur du coût minimal (similarité selon les variables retenues).</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice de pondération spatiale avec les coûts</span></span>
<span><span class="va">Lyon.w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Lyon.nb</span>, <span class="va">lcosts</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span></span>
<span><span class="co">### Trouver l'arbre couvrant de poids minimal</span></span>
<span><span class="va">Lyon.mst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mstree.html">mstree</a></span><span class="op">(</span><span class="va">Lyon.w</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Lyon.mst</span>, n<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]      [,3]
[1,]  499  478 0.5025378
[2,]  478   46 0.4618205
[3,]   46    7 1.3665949</code></pre>
</div>
</div>
<p>Le code ci-dessous permet de visualiser le graphe de connectivité et l’arbre couvrant de poids minimal (<a href="#fig-ArbreMinimum">figure&nbsp;<span>8.6</span></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Visualisation du graphe de connectivité </span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Lyon.nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Visualisation de l'arbre couvrant de poids minimal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Lyon.mst</span>, <span class="va">coords</span>, col<span class="op">=</span><span class="st">"blue"</span>, cex.lab<span class="op">=</span><span class="fl">0.7</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-ArbreMinimum" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/ArbreMinimum.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.6: Graphe de connectivité et arbre couvrant de poids minimal</figcaption></figure>
</div>
<p>Le code ci-dessous permet de réaliser une classification SKATER avec cinq régions avec le <em>package</em> <code>spdep</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## SKATER avec le package spdep</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123456789</span><span class="op">)</span></span>
<span><span class="va">skater5.spdep</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/skater.html">skater</a></span><span class="op">(</span>edges <span class="op">=</span> <span class="va">Lyon.mst</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="co"># premières colonnes de l'arbre </span></span>
<span>                               data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">LyonIrisZscore</span><span class="op">)</span>,</span>
<span>                               method <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>                               ncuts <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>  <span class="co"># k-1 régions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">skater5.spdep</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
 48 215  89  57  97 </code></pre>
</div>
</div>
<p>Toutefois, il est plus simple d’utiliser la fonction <code>skater</code> de <code>rgeoda</code> qui ne nécessite pas de créer au préalable l’arbre couvrant de poids minimal.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## SKATER avec le package rgeoda</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geodacenter/rgeoda/">rgeoda</a></span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">queen_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="va">skater5.rgeoda</span> <span class="op">&lt;-</span> <span class="fu">rgeoda</span><span class="fu">::</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/skater.html">skater</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">5</span>,        <span class="co"># k-1 régions</span></span>
<span>                                 w <span class="op">=</span> <span class="va">queen_w</span>,  <span class="co"># matrice de contiguïté</span></span>
<span>                                 scale_method <span class="op">=</span> <span class="st">"standardize"</span>,</span>
<span>                                 df <span class="op">=</span> <span class="va">Data</span><span class="op">)</span>    <span class="co"># dataframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">skater5.rgeoda</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
248 125  51  48  34 </code></pre>
</div>
</div>
<p>La <a href="#fig-SkaterAB">figure&nbsp;<span>8.7</span></a> démontre que les résultats obtenus sont légèrement différents avec les deux <em>packages</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LyonIris</span><span class="op">$</span><span class="va">skater5spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">skater5.spdep</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">skater5rgeoda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">skater5.rgeoda</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte.SkaterA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"skater5spdep"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"a. SKATER spdep"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.SkaterB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"skater5rgeoda"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"b. SKATER rgeoda"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte.SkaterA</span>, <span class="va">Carte.SkaterB</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-SkaterAB" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-SkaterAB-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.7: Résultats de l’algorithme SKATER avec cinq classes obtenus avec les <em>packages</em> <code>spdep</code> et <code>rgeoda</code></figcaption></figure>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Algorithme SKATER avec un seuil minimal pour les classes</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Dans une classification non supervisée avec une contrainte spatiale, il est possible de fixer un seuil minimal pour chaque région à partir d’une variable. L’exemple le plus classique est l’obtention de <em>p</em> régions qui doivent au moins avoir un nombre d’habitants fixé par la personne utilisatrice. Pour ce faire, nous utilisons deux paramètres de la fonction <code><a href="https://r-spatial.github.io/spdep/reference/skater.html">spdep::skater</a></code>, soit <code>crit = 50000</code> pour fixer le seuil et <code>vec.crit = df$Population</code> pour indiquer le vecteur sur lequel est calculé le critère.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clus10_min</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/skater.html">skater</a></span><span class="op">(</span>edges <span class="op">=</span> <span class="va">ct_mst</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                     <span class="co"># dataframe avec les variables centrées réduites</span></span>
<span>                     data <span class="op">=</span> <span class="va">dfs</span>,               </span>
<span>                     <span class="co"># seuil fixé</span></span>
<span>                     crit <span class="op">=</span> <span class="fl">50000</span>,             </span>
<span>                     <span class="co"># variable population du dataframe</span></span>
<span>                     vec.crit <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">Population</span>, </span>
<span>                     ncuts <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Fonction <code>skater</code> : différences entre les <em>packages</em><code>rgeoda</code> et <code>spdep</code></strong></p>
<p>La fonction <code>skater</code> de <code>rgeoda</code> a deux principaux avantages&nbsp;:</p>
<ol type="1">
<li><p>Comme décrit précédemment, l’avantage de la fonction <code>skater</code> de <code>rgeoda</code> est qu’elle ne nécessite pas de calculer au préalable l’arbre couvrant de poids minimal.</p></li>
<li><p>scale_method = c(“raw”, “standardize”, “demean”, “mad”, “range_standardize”, “range_adjust”) permet de transformer directement les variables. La méthode par défaut est la cote z (moyenne&nbsp;=&nbsp;0 et écart-type&nbsp;=&nbsp;1).</p></li>
</ol>
<p>Avec la fonction <code>skater</code> de <code>spdep</code>, vous devez préalablement transformer vos variables et construire l’arbre couvrant de poids minimal. Par contre, elle intègre de nombreux types de distance pour évaluer la dissimilarité entre les unités spatiales avec le paramètre <code>method = c("euclidean",  "maximum", "manhattan", "canberra", "binary", "minkowski",  "mahalanobis")</code> tandis que le paramètre <code>distance_method = c("euclidean", "manhattan")</code> de <code>rgeoda</code> ne comprend que deux types de distance.</p>
</div>
</div>
</section><section id="sec-0813" class="level3" data-number="8.1.3"><h3 data-number="8.1.3" class="anchored" data-anchor-id="sec-0813">
<span class="header-section-number">8.1.3</span> Algorithmes REDCAP</h3>
<p>Les différentes versions de l’algorithme REDCAP (<em>Regionalization with dynamically constrained agglomerative clustering and partitioning</em>) proposé par Diansheng Guo <span class="citation" data-cites="guo2008regionalization">(<a href="references.html#ref-guo2008regionalization" role="doc-biblioref">2008</a>)</span> sont aussi basées sur la construction d’un arbre (<em>spanning tree</em>) dont l’élagage est obtenu de cinq différentes façons&nbsp;:</p>
<ul>
<li><p>Premier ordre et saut minimal (<em>First-order and Single-linkage</em>) qui fournit un résultat identique à l’algorithme SKATER.</p></li>
<li><p>Ordre complet et saut maximal (<em>Full-order and Complete-linkage</em>).</p></li>
<li><p>Ordre complet et saut moyen (<em>Full-order and Average-linkage</em>).</p></li>
<li><p>Ordre complet et saut minimal (<em>Full-order and Single-linkage</em>).</p></li>
<li><p>Ordre complet et critère de Ward (<em>Full-order and Ward-linkage</em>).</p></li>
</ul>
<p>Le code ci-dessous permet de calculer les cinq versions de l’algorithmes REDCAP avec cinq régions et de comparer leurs résultats à partir du ratio (entre les variances interrégionale et totale) et du nombre d’observations par région.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geodacenter/rgeoda/">rgeoda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co">## Préparation des données </span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">queen_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="co">## Algorithmes REDCAP</span></span>
<span><span class="va">redcap5.A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/redcap.html">redcap</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">5</span>, w <span class="op">=</span> <span class="va">queen_w</span>, scale_method <span class="op">=</span> <span class="st">"standardize"</span>, df <span class="op">=</span> <span class="va">Data</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"firstorder-singlelinkage"</span><span class="op">)</span></span>
<span><span class="va">redcap5.B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/redcap.html">redcap</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">5</span>, w <span class="op">=</span> <span class="va">queen_w</span>, scale_method <span class="op">=</span> <span class="st">"standardize"</span>, df <span class="op">=</span> <span class="va">Data</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"fullorder-completelinkage"</span><span class="op">)</span></span>
<span><span class="va">redcap5.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/redcap.html">redcap</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">5</span>, w <span class="op">=</span> <span class="va">queen_w</span>, scale_method <span class="op">=</span> <span class="st">"standardize"</span>, df <span class="op">=</span> <span class="va">Data</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"fullorder-averagelinkage"</span><span class="op">)</span></span>
<span><span class="va">redcap5.D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/redcap.html">redcap</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">5</span>, w <span class="op">=</span> <span class="va">queen_w</span>, scale_method <span class="op">=</span> <span class="st">"standardize"</span>, df <span class="op">=</span> <span class="va">Data</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"fullorder-singlelinkage"</span><span class="op">)</span></span>
<span><span class="va">redcap5.E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/redcap.html">redcap</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">5</span>, w <span class="op">=</span> <span class="va">queen_w</span>, scale_method <span class="op">=</span> <span class="st">"standardize"</span>, df <span class="op">=</span> <span class="va">Data</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"fullorder-wardlinkage"</span><span class="op">)</span></span>
<span><span class="co">## Comparaison des résultats</span></span>
<span><span class="va">Ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Methode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"firstorder-singlelinkage"</span>, </span>
<span>                                  <span class="st">"fullorder-completelinkage"</span>, </span>
<span>                                  <span class="st">"fullorder-averagelinkage"</span>,</span>
<span>                                  <span class="st">"fullorder-singlelinkage"</span>, </span>
<span>                                  <span class="st">"fullorder-wardlinkage"</span><span class="op">)</span>,</span>
<span>                      ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">redcap5.A</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>,</span>
<span>                                <span class="va">redcap5.B</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>,</span>
<span>                                <span class="va">redcap5.C</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>,</span>
<span>                                <span class="va">redcap5.D</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span>,</span>
<span>                                <span class="va">redcap5.E</span><span class="op">$</span><span class="va">`The ratio of between to total sum of squares`</span><span class="op">)</span></span>
<span>                      <span class="op">)</span></span>
<span><span class="va">Nobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">redcap5.A</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">redcap5.B</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">redcap5.C</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">redcap5.D</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">redcap5.E</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span><span class="op">)</span></span>
<span>              <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Nobs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>, <span class="st">"C4"</span>, <span class="st">"C5"</span><span class="op">)</span></span>
<span><span class="va">Ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Ratios</span>, <span class="va">Nobs</span><span class="op">)</span></span>
<span><span class="va">Ratios</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Methode     ratio  C1  C2  C3 C4 C5
1  firstorder-singlelinkage 0.4081577 248 125  51 48 34
2 fullorder-completelinkage 0.4728026 173 156 115 47 15
3  fullorder-averagelinkage 0.4993184 148 141 106 63 48
4   fullorder-singlelinkage 0.3976055 227 102  73 53 51
5     fullorder-wardlinkage 0.5185455 166 134 120 51 35</code></pre>
</div>
</div>
<p>À la lecture des valeurs du ratio ci-dessous, la meilleure classification serait celle obtenue avec un ordre complet et le critère de Ward. Cartographions les résultats des quatre versions de l’algorithme RECAP avec un ordre complet (<a href="#fig-CartoREDCAP">figure&nbsp;<span>8.8</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Ajout des champs dans la couche</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">RC5.FOcompletelinkage</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">redcap5.B</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">RC5.FOaveragelinkage</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">redcap5.C</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">RC5.FOsinglelinkage</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">redcap5.D</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">RC5.FOwardlinkage</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">redcap5.E</span><span class="op">$</span><span class="va">Clusters</span><span class="op">)</span></span>
<span><span class="co">## Cartographie des résultats</span></span>
<span><span class="va">Carte.RCb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"RC5.FOcompletelinkage"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"a. Saut maximal"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.RCc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"RC5.FOaveragelinkage"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"b. Saut moyen"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.RCd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"RC5.FOsinglelinkage"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"c. Saut minimal"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.RCe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"RC5.FOwardlinkage"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"d. Critère de Ward"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte.RCb</span>, <span class="va">Carte.RCc</span>, <span class="va">Carte.RCd</span>, <span class="va">Carte.RCe</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CartoREDCAP" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-CartoREDCAP-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.8: Regroupements des 505 IRIS en cinq régions selon les quatre versions de l’algorithme REDCAP avec un lien complet</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0814" class="level3" data-number="8.1.4"><h3 data-number="8.1.4" class="anchored" data-anchor-id="sec-0814">
<span class="header-section-number">8.1.4</span> Algorithme du <em>max-p-regions problem</em>
</h3>
<p>Cet algorithme, proposé par Duque <em>et al.</em> <span class="citation" data-cites="duque2012max">(<a href="references.html#ref-duque2012max" role="doc-biblioref">2012</a>)</span>, n’est pas décrit ici. Notez qu’il peut être calculé avec trois fonctions du <em>package</em> <code>rgeoda</code>, soit <code>maxp_greedy</code>, <code>maxp_sa</code> et <code>maxp_tabu</code>.</p>
</section></section><section id="sec-082" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="sec-082">
<span class="header-section-number">8.2</span> Méthodes de classification non supervisée avec une dimension spatiale</h2>
<p>Nous avons vu que les méthodes de classification avec une contrainte spatiale visent à obtenir des régions non discontinues, c’est-à-dire sans mitage spatial. L’objectif des méthodes de classification non supervisée avec une dimension spatiale est quelque peu différent&nbsp;: classifier les observations en tenant compte de l’espace (proximité, voisinage entre les unités spatiales) afin de limiter les effets de mitage, sans toutefois l’interdire.</p>
<p>Dans le cadre de cette section, nous décrivons deux de ces méthodes qui intègrent la dimension spatiale de manière différente&nbsp;:</p>
<ol type="1">
<li><p><strong>La méthode <em>ClustGeo</em></strong>, qui est une extension de la classification ascendante hiérarchique, est une méthode de classification non supervisée, spatiale et stricte. Cette méthode repose sur deux matrices de dissimilarité&nbsp;: une <strong>matrice des distances sémantiques (attributaires)</strong> calculée sur les valeurs de plusieurs variables caractérisant les observations et une <strong>matrice de distances</strong> (euclidienne le plus souvent) entre les entités géographiques. Nous cherchons ainsi à regrouper les observations qui se ressemblent à la fois selon leurs attributs et selon leur proximité spatiale.</p></li>
<li><p><strong>La méthode k-moyennes spatiale et floue (<em>Spatial fuzzy c-means</em>)</strong>, qui est une extension de la méthode k-moyennes, est une méthode de classification non supervisée, spatiale et floue. Cette méthode repose sur deux matrices de dissimilarité&nbsp;: une <strong>matrice sémantique</strong> calculée sur les valeurs de plusieurs variables caractérisant les entités géographiques et une <strong>matrice sémantique spatialement décalée</strong>. Nous cherchons ainsi à regrouper les observations qui se ressemblent à la fois selon leurs caractéristiques et celles de leurs unités spatiales adjacentes ou proches.</p></li>
</ol>
<p>Autrement dit, dans la méthode <em>ClustGeo</em>, l’espace est introduit sous la forme d’une matrice de distances entre les entités spatiales (<strong>agencement spatial</strong>) tandis que dans la méthode du <em>Spatial fuzzy c-means</em>, il est introduit sous la forme d’une matrice de données sémantiques spatialement décalées (<strong>information sémantique dans l’environnement immédiat</strong>).</p>
<section id="sec-0821" class="level3" data-number="8.2.1"><h3 data-number="8.2.1" class="anchored" data-anchor-id="sec-0821">
<span class="header-section-number">8.2.1</span> Classification ascendante hiérarchique spatiale (<em>ClustGeo</em>)</h3>
<section id="sec-08211" class="level4" data-number="8.2.1.1"><h4 data-number="8.2.1.1" class="anchored" data-anchor-id="sec-08211">
<span class="header-section-number">8.2.1.1</span> Description de la méthode <em>ClustGeo</em>
</h4>
<p>La méthode <em>ClustGeo</em>, proposée par Marie Chavent et ses collègues <span class="citation" data-cites="packageClustGeo">(<a href="references.html#ref-packageClustGeo" role="doc-biblioref">2018</a>)</span>, est une extension de la classification ascendante hiérarchique (CAH) qui intègre la dimension spatiale des entités géographiques. Cette méthode repose sur une idée brillante, soit de classer (regrouper) les observations (unités spatiales) en combinant deux matrices de dissimilarité&nbsp;:</p>
<ul>
<li><p>Une matrice sémantique calculée sur <em>p</em> variables caractérisant les unités spatiales (<span class="math inline">\(D_0\)</span>).</p></li>
<li>
<p>Une matrice spatiale calculée à partir des distances spatiales (habituellement euclidienne) entre les unités spatiales (<span class="math inline">\(D_1\)</span>). Ces deux matrices sont ensuite fusionnées en une seule matrice finale représentant la combinaison de la distance spatiale et de la dissimilarité sémantique (attributaire) entre les observations. Notez qu’un paramètre <span class="math inline">\(\alpha\)</span>, variant de 0 à 1, permet de définir le poids de la matrice spatiale comparativement à celui de la sémantique&nbsp;:</p>
<ul>
<li><p>Avec <span class="math inline">\(\alpha=0\)</span>, le poids accordé à la matrice spatiale est nul. Nous obtenons ainsi une CAH classique puisque seules les différences attributaires sont conservées.</p></li>
<li><p>Avec <span class="math inline">\(\alpha=1\)</span>, le poids accordé à la matrice spatiale est maximal; la classification est alors purement spatiale et ignore les différences attributaires.</p></li>
</ul>
</li>
</ul>
<p>Par conséquent, «&nbsp;[…] l’enjeu principal est de fixer la valeur du paramètre 𝛼, considérant qu’une augmentation de 𝛼 revient à améliorer l’inertie expliquée de la matrice spatiale, au détriment d’une perte de l’inertie expliquée sur le plan sémantique&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 16</a>)</span>.</p>
</section><section id="sec-08212" class="level4" data-number="8.2.1.2"><h4 data-number="8.2.1.2" class="anchored" data-anchor-id="sec-08212">
<span class="header-section-number">8.2.1.2</span> Calcul de la CAH classique</h4>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Retour sur la classification ascendante hiérarchique (CAH)</strong></p>
</div>
<div class="bloc_attention-body">
<p>Pour une description détaillée de la CAH, consultez la <a href="https://serieboldr.github.io/MethodesQuantitatives/13-MethodeClassification.html#sec-133">section suivante</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>.</p>
</div>
</div>
<p>Le code ci-dessous permet de construire l’arbre de classification selon le critère de Ward à partir de la matrice sémantique (<a href="#fig-Dendrogramme">figure&nbsp;<span>8.9</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Variables pour la CAH</span></span>
<span><span class="va">VarsEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>, <span class="st">"NO2"</span>, <span class="st">"PM25"</span>, <span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Dataframe sans la géométrie et les quatre variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap08/DonneesLyon.Rdata"</span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Centrage (moyenne = 0) et réduction des données (variance = 1)</span></span>
<span><span class="va">DataZscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrice sémantique : dissimilarité des observations selon les variables</span></span>
<span><span class="va">Matrice.Semantique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">DataZscore</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span>
<span><span class="co"># Calcul du dendrogramme avec le critère WARD</span></span>
<span><span class="va">Arbre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">Matrice.Semantique</span>, method <span class="op">=</span> <span class="st">"ward.D"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Arbre</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, label <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Dendrogramme \n(arbre de classification selon le critère de Ward)"</span>,</span>
<span>     sub <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"Hauteur"</span>, xlab <span class="op">=</span> <span class="st">""</span></span>
<span>     <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Dendrogramme" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-Dendrogramme-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.9: Arbre de classification (dendrogramme)</figcaption></figure>
</div>
</div>
</div>
<p>À la lecture de la <a href="#fig-CAHCoude">figure&nbsp;<span>8.10</span></a>, nous ne détectons pas de seuils marqués dans l’inertie expliquée en fonction du nombre de groupes. Par conséquent, nous fixons arbitrairement le nombre de groupes à 5.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Fonction pour l'inertie expliquée par les classes</span></span>
<span><span class="va">prop_inert_cutree</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">K</span>,<span class="va">tree</span>,<span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">tree</span>,k<span class="op">=</span><span class="va">K</span><span class="op">)</span></span>
<span>  <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">height</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="va">K</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">W</span><span class="op">/</span><span class="va">Tot</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Inertie expliquée par des CAH de 2 à 10 classes</span></span>
<span><span class="va">df.inertie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>NGroupes <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                         Inertie <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                                          <span class="va">prop_inert_cutree</span>,</span>
<span>                                          tree<span class="op">=</span><span class="va">Arbre</span>,</span>
<span>                                          n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">DataZscore</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df.inertie</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">NGroupes</span>,y<span class="op">=</span><span class="va">Inertie</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">NGroupes</span>,y<span class="op">=</span><span class="va">Inertie</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Inertie expliquée"</span>, x <span class="op">=</span> <span class="st">"Nombre de groupes"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CAHCoude" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-CAHCoude-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.10: Méthode du coude reposant sur l’inertie expliquée pour CAH</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons visualiser l’arbre avec une coupure à cinq classes.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Arbre</span>, labels <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Partition en 2, 5 ou 9 classes"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, sub <span class="op">=</span> <span class="st">""</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/rect.hclust.html">rect.hclust</a></span><span class="op">(</span><span class="va">Arbre</span>, <span class="fl">5</span>, border <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Coupure de l'arbre à cinq classes</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">CAH5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">Arbre</span>, k<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Nombre d'observations par classe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">CAH5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
 62 120  88  81 155 </code></pre>
</div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Valeurs moyennes des classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Lden</span>,<span class="va">NO2</span>,<span class="va">PM25</span>,<span class="va">VegHautPrt</span><span class="op">)</span> <span class="op">~</span> <span class="va">CAH5</span>, data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  CAH5     Lden      NO2     PM25 VegHautPrt
1    1 49.52246 19.11011 13.84968   34.64694
2    2 54.57170 22.29326 15.17248   12.34458
3    3 62.53950 37.18071 18.25763   18.25330
4    4 55.21535 25.85652 15.83278   26.67333
5    5 55.08405 34.17193 18.90686   13.44716</code></pre>
</div>
</div>
<p>Les résultats de la CAH sont cartographiés à la <a href="#fig-CAHCarto">figure&nbsp;<span>8.11</span></a> tandis que le nombre d’observations et les valeurs moyennes des classes sont reportés au tableau @tbl-dataCAHtab.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span><span class="co">## Cartographie des résultats</span></span>
<span><span class="va">Carte.CAH5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"CAH5"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                main.title <span class="op">=</span> <span class="st">"CAH (critère de Ward)"</span>, </span>
<span>                main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.CAH5</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CAHCarto" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-CAHCarto-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.11: CAH avec le critère de Ward avec cinq classes</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-dataCAHtab" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.2: Valeurs moyennes des variables pour les cinq classes obtenues avec la CAH</caption>
<thead><tr class="header">
<th style="text-align: center;">Classe</th>
<th style="text-align: center;">Lden</th>
<th style="text-align: center;">NO2</th>
<th style="text-align: center;">PM25</th>
<th style="text-align: center;">Végétation</th>
<th style="text-align: center;">Nombre d’IRIS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">49,5</td>
<td style="text-align: center;">19,1</td>
<td style="text-align: center;">13,8</td>
<td style="text-align: center;">34,6</td>
<td style="text-align: center;">62</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">54,6</td>
<td style="text-align: center;">22,3</td>
<td style="text-align: center;">15,2</td>
<td style="text-align: center;">12,3</td>
<td style="text-align: center;">120</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">62,5</td>
<td style="text-align: center;">37,2</td>
<td style="text-align: center;">18,3</td>
<td style="text-align: center;">18,3</td>
<td style="text-align: center;">88</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">55,2</td>
<td style="text-align: center;">25,9</td>
<td style="text-align: center;">15,8</td>
<td style="text-align: center;">26,7</td>
<td style="text-align: center;">81</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">55,1</td>
<td style="text-align: center;">34,2</td>
<td style="text-align: center;">18,9</td>
<td style="text-align: center;">13,4</td>
<td style="text-align: center;">155</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-08213" class="level4" data-number="8.2.1.3"><h4 data-number="8.2.1.3" class="anchored" data-anchor-id="sec-08213">
<span class="header-section-number">8.2.1.3</span> Calcul de la méthode <em>ClustGeo</em>
</h4>
<p><strong>Calcul des deux matrices (sémantique et spatiale)</strong></p>
<p>Dans un premier temps, nous créons les matrices sémantique (<span class="math inline">\(D_0\)</span>) et spatiale (<span class="math inline">\(D_1\)</span>). Notez ici que les distances spatiales utilisées correspondent aux distances euclidiennes entre les centroïdes des IRIS.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ClustGeo</span><span class="op">)</span></span>
<span><span class="co">## Variables</span></span>
<span><span class="va">VarsEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>, <span class="st">"NO2"</span>, <span class="st">"PM25"</span>, <span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Dataframe sans la géométrie et les quatre variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap08/DonneesLyon.Rdata"</span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Centrage (moyenne = 0) et réduction des données (variance = 1)</span></span>
<span><span class="va">DataZscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrice sémantique : dissimilarité des observations selon les variables</span></span>
<span><span class="va">Matrice.Semantique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">DataZscore</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span>
<span><span class="co">## Matrice spatiale entre les unités spatiales</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Matrice.Spatiale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">xy</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Optimisation de la valeur de</strong> <span class="math inline">\(\alpha\)</span></p>
<p>Pour la méthode <em>ClustGeo</em> (avec k&nbsp;=&nbsp;5), nous évaluons l’impact du paramètre α pour des valeurs de 0 à 1, avec un saut de 0,05. Pour ce faire, nous utilisons la fonction <code>choicealpha</code> du <em>package</em> <code>ClustGeo</code>. À la lecture de la <a href="#fig-GraphAlpha">figure&nbsp;<span>8.12</span></a>, nous constatons que&nbsp;:</p>
<ul>
<li><p>Plus la valeur de <span class="math inline">\(\alpha\)</span> augmente, plus l’inertie expliquée par la matrice sémantique diminue (trait noir) et inversement, plus l’inertie expliquée par la matrice spatiale est forte.</p></li>
<li><p>Avec <span class="math inline">\(\alpha = \text{0,30}\)</span>, l’inertie expliquée par la matrice spatiale est de 50&nbsp;% pour une perte d’inertie expliquée par la matrice sémantique de seulement 7&nbsp;%. Avec <span class="math inline">\(\alpha = \text{0,35}\)</span>, nous constatons une chute importante de l’inertie sémantique expliquée. Par conséquent, nous retenons la valeur de 0,30 pour la méthode <em>ClustGeo</em>. Ce choix donne un excellent compromis entre la préservation de l’inertie expliquée des données attributaires et la cohérence spatiale de la classification finale.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">alphas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ClustGeo/man/choicealpha.html">choicealpha</a></span><span class="op">(</span>D0 <span class="op">=</span> <span class="va">Matrice.Semantique</span>, <span class="co"># matrice sémantique</span></span>
<span>                      D1 <span class="op">=</span> <span class="va">Matrice.Spatiale</span>,   <span class="co"># matrice spatiale </span></span>
<span>                      range.alpha <span class="op">=</span> <span class="va">alphas</span>,    <span class="co"># valeurs de alpha</span></span>
<span>                      K <span class="op">=</span> <span class="fl">5</span>,                   <span class="co"># nombre de classes</span></span>
<span>                      wt <span class="op">=</span> <span class="cn">NULL</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, graph <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Graphique avec Alpha</span></span>
<span><span class="va">df.alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">Q</span><span class="op">)</span></span>
<span><span class="va">df.alpha</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">alphas</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df.alpha</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alphas</span>,y<span class="op">=</span> <span class="va">Q0</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alphas</span>,y<span class="op">=</span> <span class="va">Q0</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alphas</span>,y<span class="op">=</span> <span class="va">Q1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alphas</span>,y<span class="op">=</span> <span class="va">Q1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Pseudo-inertie"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"Paramètre alpha"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Matrice sémantique (noir) et matrice spatiale (rouge)"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GraphAlpha" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-GraphAlpha-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.12: Impact des deux matrices dans la classification</figcaption></figure>
</div>
</div>
</div>
<p><strong>Réalisation de la méthode <em>ClustGeo</em></strong></p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Dendrogramme avec ClustGeo</span></span>
<span><span class="va">Arbre.ClustGeo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ClustGeo/man/hclustgeo.html">hclustgeo</a></span><span class="op">(</span>D0 <span class="op">=</span> <span class="va">Matrice.Semantique</span>, D1 <span class="op">=</span> <span class="va">Matrice.Spatiale</span>, alpha <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span></span>
<span><span class="co">## Coupure de l'arbre à cinq classes</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">ClustGeo5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">Arbre.ClustGeo</span>, k<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Nombre d'observations par classe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">ClustGeo5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4   5 
101  73 102 145  85 </code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Valeurs moyennes des classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Lden</span>,<span class="va">NO2</span>,<span class="va">PM25</span>,<span class="va">VegHautPrt</span><span class="op">)</span> <span class="op">~</span> <span class="va">ClustGeo5</span>, </span>
<span>          data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ClustGeo5     Lden      NO2     PM25 VegHautPrt
1         1 51.99446 22.63948 14.69971   32.70396
2         2 55.46789 20.84670 15.00392   14.07849
3         3 61.41468 36.20785 18.23707   18.77059
4         4 54.98927 34.16558 18.93142   12.84883
5         5 54.05419 24.32165 15.45733   16.14224</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Cartographie des résultats</span></span>
<span><span class="va">Carte.ClusteGeo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"ClustGeo5"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span>, title <span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>                    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                      main.title <span class="op">=</span> <span class="st">"ClustGeo avec alpha = 0,30"</span>, </span>
<span>                      main.title.position <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                      main.title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte.ClusteGeo</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GraphAlpha2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-GraphAlpha2-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.13: Classification ClustGeo avec alpha = 0,30</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-dataClusteGeotab" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.3: Valeurs moyennes des variables pour cinq classes obtenues par la méthode ClustGeo (alpha = 0,30)</caption>
<thead><tr class="header">
<th style="text-align: center;">Classe</th>
<th style="text-align: center;">Lden</th>
<th style="text-align: center;">NO2</th>
<th style="text-align: center;">PM25</th>
<th style="text-align: center;">Végétation</th>
<th style="text-align: center;">Nombre d’IRIS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">52,0</td>
<td style="text-align: center;">22,6</td>
<td style="text-align: center;">14,7</td>
<td style="text-align: center;">32,7</td>
<td style="text-align: center;">101</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">55,5</td>
<td style="text-align: center;">20,8</td>
<td style="text-align: center;">15,0</td>
<td style="text-align: center;">14,1</td>
<td style="text-align: center;">73</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">61,4</td>
<td style="text-align: center;">36,2</td>
<td style="text-align: center;">18,2</td>
<td style="text-align: center;">18,8</td>
<td style="text-align: center;">102</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">55,0</td>
<td style="text-align: center;">34,2</td>
<td style="text-align: center;">18,9</td>
<td style="text-align: center;">12,8</td>
<td style="text-align: center;">145</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">54,1</td>
<td style="text-align: center;">24,3</td>
<td style="text-align: center;">15,5</td>
<td style="text-align: center;">16,1</td>
<td style="text-align: center;">85</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>La comparaison des typologies obtenues avec la CAH et la ClusteGeo démontre clairement que l’introduction d’une matrice spatiale dans la classification <em>ClustGeo</em> génère des classes qui sont moins discontinues spatialement (<a href="#fig-ComparaisonCAHClusteo">figure&nbsp;<span>8.14</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte.CAH5</span>, <span class="va">Carte.ClusteGeo</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ComparaisonCAHClusteo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-ComparaisonCAHClusteo-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.14: Impact des deux matrices dans la classification</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-0822" class="level3" data-number="8.2.2"><h3 data-number="8.2.2" class="anchored" data-anchor-id="sec-0822">
<span class="header-section-number">8.2.2</span> <em>Spatial fuzzy c-means</em>
</h3>
<p>La méthode SFCM (<em>Spatial fuzzy c-means</em>), proposée par Weiling Cai et ses collègues <span class="citation" data-cites="cai2007fast">(<a href="references.html#ref-cai2007fast" role="doc-biblioref">2007</a>)</span>, est une extension de FCM, soit une version floue de l’algorithme des k-moyennes. Le principe de base est le suivant&nbsp;:</p>
<p>«&nbsp;Comparativement au FCM classique, le SFCM introduit dans son calcul, en plus du jeu de données original (<span class="math inline">\(D_0\)</span>), une version spatialement décalée (<span class="math inline">\(D_s\)</span>) de ce dernier <span class="citation" data-cites="cai2007fast">(<a href="references.html#ref-cai2007fast" role="doc-biblioref">Cai, Chen et Zhang 2007</a>)</span>. En analyse d’image, cela revient à calculer <span class="math inline">\(D_s\)</span> en appliquant un filtre moyen ou médian à <span class="math inline">\(D_0\)</span> (la médiane étant moins sensible aux valeurs extrêmes locales). Ce processus peut facilement s’appliquer à des entités géographiques vectorielles, en créant une matrice de pondération spatiale <span class="math inline">\(W_{kl}\)</span> (<em>l</em> étant les voisins de <em>k</em> et la diagonale de cette matrice valant 0) <span class="citation" data-cites="getis2009spatial">(<a href="references.html#ref-getis2009spatial" role="doc-biblioref">Getis 2009</a>)</span> et en utilisant les poids de cette matrice dans le calcul d’une moyenne ou d’une médiane pondérée locale&nbsp;» <span class="citation" data-cites="ClassificationFloue">(<a href="references.html#ref-ClassificationFloue" role="doc-biblioref">Gelb et Apparicio 2021, 8</a>)</span>.</p>
<p>Comme pour la méthode <em>ClustGeo</em>, il est possible de fixer une pondération à la dimension spatiale (<span class="math inline">\(D_s\)</span>) avec un paramètre <span class="math inline">\(\alpha\)</span>, qui varie de 0 à <span class="math inline">\(\infty\)</span>. Une valeur de 0 signale qu’aucun poids n’est accordé à la dimension spatiale, ce qui revient à calculer un FCM classique. Si <span class="math inline">\(\alpha = \text{2}\)</span>, alors la version spatialement décalée aura deux fois plus de poids dans la classification que le jeu de données original.</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Retour sur une variable spatialement décalée et la classification k-moyennes</strong></p>
</div>
<div class="bloc_attention-body">
<p>La notion de variable spatialement décalée a été abordée au chapitre&nbsp;2 (<a href="02-Autocorrelation.html#fig-Chap02FigureVariableSpatialementDecalee">figure&nbsp;<span>2.29</span></a>). Pour une description détaillée de la classification k-moyennes, consultez la <a href="https://serieboldr.github.io/MethodesQuantitatives/13-MethodeClassification.html#sec-134">section suivante</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>.</p>
</div>
</div>
<section id="sec-08221" class="level4" data-number="8.2.2.1"><h4 data-number="8.2.2.1" class="anchored" data-anchor-id="sec-08221">
<span class="header-section-number">8.2.2.1</span> Calcul de la classification c-moyennes floue classique (<em>fuzzy c-means</em>)</h4>
<p>À des fins de comparaison avec la CAH, nous proposons de calculer une classification c-moyennes floue classique (<em>fuzzy c-means</em>) avec cinq classes (<em>k</em>&nbsp;=&nbsp;5). Puis, pour déterminer la valeur optimale de <em>m</em> (soit le degré de logique floue), nous calculons l’inertie expliquée et l’indice de silhouette pour des valeurs de <em>m</em> variant de 1,1 à 3 (avec un incrément de 0,1). Les résultats de ces deux indicateurs, présentés à la <a href="#fig-GraphCmeans">figure&nbsp;<span>8.15</span></a>, signalent que&nbsp;:</p>
<ul>
<li>Plus le paramètre <em>m</em> augmente, plus l’inertie expliquée diminue (<a href="#fig-GraphCmeans">figure&nbsp;<span>8.15</span></a>, a).</li>
<li>La valeur de l’indice de silhouette est maximale avec <em>m</em>&nbsp;=&nbsp;1,8 (<a href="#fig-GraphCmeans">figure&nbsp;<span>8.15</span></a>, b).</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JeremyGelb/geocmeans">geocmeans</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="co">## Variables pour la CAH</span></span>
<span><span class="va">VarsEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>, <span class="st">"NO2"</span>, <span class="st">"PM25"</span>, <span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Dataframe sans la géométrie et les quatre variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/chap08/DonneesLyon.Rdata"</span><span class="op">)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">VarsEnv</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Centrage (moyenne = 0) et réduction des données (variance = 1)</span></span>
<span><span class="va">DataZscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Dataframe pour les différents paramètres avec k = 5 et degré de flou</span></span>
<span><span class="va">FCM_selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/select_parameters.html">select_parameters</a></span><span class="op">(</span>algo <span class="op">=</span> <span class="st">"FCM"</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">DataZscore</span>,</span>
<span>                  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># nous pourrions ici tester avec k=2:10</span></span>
<span>                  m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1.1</span>,<span class="fl">3</span>,<span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  classidx <span class="op">=</span> <span class="cn">TRUE</span>, spconsist <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  tol <span class="op">=</span> <span class="fl">0.001</span>, seed <span class="op">=</span> <span class="fl">456</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "number of combinaisons to estimate :  20"</code></pre>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Graphique avec l'inertie expliquée</span></span>
<span><span class="va">G1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">FCM_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">Explained.inertia</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span>,  y <span class="op">=</span> <span class="va">Explained.inertia</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span><span class="st">"a. Variation des données expliquées"</span>,</span>
<span>           y <span class="op">=</span> <span class="st">"Inertie expliquée"</span>, x <span class="op">=</span> <span class="st">"Paramètre m"</span><span class="op">)</span></span>
<span><span class="co"># Graphique avec l'indice de silhouette</span></span>
<span><span class="va">G2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">FCM_selection</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">Silhouette.index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span>,  y <span class="op">=</span> <span class="va">Silhouette.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span><span class="st">"b. Consistance des groupes"</span>,</span>
<span>           y <span class="op">=</span> <span class="st">"Critère de silhouette floue"</span>, x <span class="op">=</span> <span class="st">"Paramètre m"</span><span class="op">)</span></span>
<span><span class="co"># Combinaison des deux graphiques dans la figure</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">G1</span>, <span class="va">G2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GraphCmeans" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-GraphCmeans-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.15: Évaluation de la qualité de la classification FCM avec cinq classes selon le degré de flou (m)</figcaption></figure>
</div>
</div>
</div>
<p>Réalisons la classification c-moyennes floue et cartographions les probabilités d’appartenance à chacune des classes (<a href="#fig-FigureCmeansProb">figure&nbsp;<span>8.16</span></a>), puis l’appartenance à une classe (<a href="#fig-FigureCmeansCluster">figure&nbsp;<span>8.17</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Classification du c-moyennes </span></span>
<span><span class="va">FCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/CMeans.html">CMeans</a></span><span class="op">(</span><span class="va">DataZscore</span>, k <span class="op">=</span> <span class="fl">5</span>, m <span class="op">=</span> <span class="fl">1.8</span>, tol <span class="op">=</span> <span class="fl">0.0001</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></span>
<span><span class="co">## Calcul des indicateurs de qualité</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">DataZscore</span>, <span class="va">FCM</span><span class="op">$</span><span class="va">Belongings</span>, <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Silhouette.index
[1] 0.5502472

$Partition.entropy
[1] 0.9663788

$Partition.coeff
[1] 0.5143427

$XieBeni.index
[1] 1.269992

$FukuyamaSugeno.index
[1] 158.1419

$Explained.inertia
[1] 0.3757482</code></pre>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Cartographie des probabilités d'appartenance à chaque classe</span></span>
<span><span class="va">Cartes.FCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/mapClusters.html">mapClusters</a></span><span class="op">(</span><span class="va">LyonIris</span>,<span class="va">FCM</span><span class="op">$</span><span class="va">Belongings</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Cartes.FCM</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ProbaMaps"   "ClusterPlot"</code></pre>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Cartes.FCM</span><span class="op">$</span><span class="va">ProbaMaps</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureCmeansProb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureCmeansProb-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.16: Cartographie des probabilités d’appartenance aux cinq classes avec la classification c-moyennes</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.FCM</span><span class="op">$</span><span class="va">ClusterPlot</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureCmeansCluster" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureCmeansCluster-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.17: Cartographie des classes issues de la classification c-moyennes</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-08222" class="level4" data-number="8.2.2.2"><h4 data-number="8.2.2.2" class="anchored" data-anchor-id="sec-08222">
<span class="header-section-number">8.2.2.2</span> Calcul de la classification c-moyennes floue et spatiale (<em>spatial fuzzy c-means</em>)</h4>
<p>Dans l’exemple ci-dessous, nous calculons une classification SFCM (<em>spatial fuzzy c-means</em>). Nous avons déterminé avec l’analyse du simple FCM que la valeur de 1,8 pour <em>m</em> semblait satisfaisante avec cinq groupes (<em>k</em>&nbsp;=&nbsp;5). Nous devons maintenant déterminer la valeur de <em>alpha</em>, soit le poids accordé aux variables spatialement décalées comparativement aux données originales.</p>
<p>Pour cela, nous calculons toutes les valeurs possibles d’<em>alpha</em> entre 0 et 2 avec un intervalle de 0,05. Nous comparons ensuite les valeurs des indices de silhouette (qualité sémantique de la classification) et d’incohérence spatiale des différentes solutions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Création d'une matrice de contiguïté standardisée</span></span>
<span><span class="va">Neighbours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">WMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Neighbours</span>, style<span class="op">=</span><span class="st">"W"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SFCM_selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/select_parameters.html">select_parameters</a></span><span class="op">(</span>algo <span class="op">=</span> <span class="st">"SFCM"</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">DataZscore</span>,</span>
<span>                  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                  m <span class="op">=</span> <span class="fl">1.8</span>,</span>
<span>                  nblistw <span class="op">=</span> <span class="va">WMat</span>,</span>
<span>                  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                  classidx <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  tol <span class="op">=</span> <span class="fl">0.001</span>, seed <span class="op">=</span> <span class="fl">456</span>,</span>
<span>                  spconsist  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "number of combinaisons to estimate :  41"</code></pre>
</div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">graph1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">SFCM_selection</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">Silhouette.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">Silhouette.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Alpha"</span>, y <span class="op">=</span> <span class="st">"Indice de silhouette"</span>, <span class="op">)</span></span>
<span></span>
<span><span class="va">graph2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">SFCM_selection</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">spConsistency</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">spConsistency</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Alpha"</span>, y <span class="op">=</span> <span class="st">"Indice d'incohérence spatiale"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">graph1</span>, <span class="va">graph2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-SFCMChoiceAlpha" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-SFCMChoiceAlpha-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.18: Comparaison de différentes valeurs d’alpha pour le SFCM</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-SFCMChoiceAlpha">figure&nbsp;<span>8.18</span></a> démontre que l’augmentation d’<em>alpha</em> a pour effet de réduire la qualité sémantique de la classification (indice de silhouette), mais aussi de limiter l’inconsistance spatiale des résultats produits. Nous constatons aussi que l’augmentation d’<em>alpha</em> a un effet quasiment linéaire sur la dégradation de l’indice de silhouette et un effet curvilinéaire sur l’inconsistance spatiale. Cette dernière est donc plus impactée par les premières augmentations d’<em>alpha</em>. Nous proposons ici de retenir une solution avec <span class="math inline">\(\alpha\)</span>&nbsp;=&nbsp;0,55, car elle correspond à une baisse relativement faible de l’indice de silhouette (0,55 versus 0,50) pour une augmentation importante de la cohérence spatiale des résultats (0,39 versus 0,22).</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du SFCM</span></span>
<span><span class="va">SFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/SFCMeans.html">SFCMeans</a></span><span class="op">(</span><span class="va">DataZscore</span>, <span class="va">WMat</span>, </span>
<span>                 k <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                 m <span class="op">=</span> <span class="fl">1.8</span>, </span>
<span>                 alpha <span class="op">=</span> <span class="fl">0.55</span>,</span>
<span>                 tol <span class="op">=</span> <span class="fl">0.0001</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Résultats des indicateurs de qualité du SFCM</strong></p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">DataZscore</span>, <span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>, <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Silhouette.index
[1] 0.4995905

$Partition.entropy
[1] 1.039552

$Partition.coeff
[1] 0.4726401

$XieBeni.index
[1] 2.011733

$FukuyamaSugeno.index
[1] 380.0203

$Explained.inertia
[1] 0.3371823</code></pre>
</div>
</div>
<p><strong>Cartographie des probabilités d’appartenance à chaque classe</strong></p>
<p>La cartographie des probabilité d’appartenance pour chacune des cinq classes est présentée aux figures <a href="#fig-FigureSFCMProb1"><span>8.19</span></a>, <a href="#fig-FigureSFCMProb2"><span>8.20</span></a>, <a href="#fig-FigureSFCMProb3"><span>8.21</span></a>, <a href="#fig-FigureSFCMProb4"><span>8.22</span></a> et <a href="#fig-FigureSFCMProb4"><span>8.22</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.SFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/mapClusters.html">mapClusters</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>, undecided <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span></span>
<span><span class="va">Cartes.SFCM</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureSFCMProb1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureSFCMProb1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.19: Cartographie des probabilités d’appartenance issues de la classification SFCM (classe 1)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.SFCM</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureSFCMProb2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureSFCMProb2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.20: Cartographie des probabilités d’appartenance issues de la classification SFCM (classe 2)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.SFCM</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureSFCMProb3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureSFCMProb3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.21: Cartographie des probabilités d’appartenance issues de la classification SFCM (classe 3)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.SFCM</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureSFCMProb4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureSFCMProb4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.22: Cartographie des probabilités d’appartenance issues de la classification SFCM (classe 4)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.SFCM</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureSFCMProb5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureSFCMProb5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.23: Cartographie des probabilités d’appartenance issues de la classification SFCM (classe 5)</figcaption></figure>
</div>
</div>
</div>
<p><strong>Cartographie des probabilités d’appartenance à chaque classe du SFCM (<a href="#fig-FigureSFCMCluster">figure&nbsp;<span>8.24</span></a>)</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Cartes.SFCM</span><span class="op">$</span><span class="va">ClusterPlot</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-FigureSFCMCluster" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-ClassificationsSpatiales_files/figure-html/fig-FigureSFCMCluster-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.24: Cartographie des classes issues de la classification SFCM</figcaption></figure>
</div>
</div>
</div>
<p>Il est intéressant de noter que les groupes construits par les deux algorithmes (ClustGeo et SFCM) produisent des solutions assez différentes. Nous retrouvons dans les deux classifications un groupe caractérisant les quartiers centraux, puis une distinction assez nette entre les secteurs est et ouest de l’agglomération. Cependant, <em>ClustGeo</em> regroupe les Iris du sud dans un groupe spécifique alors que SFCM a identifié deux groupes plus atypiques spatialement. Le groupe 5 correspond aux Iris situés le long du boulevard périphérique encerclant Lyon.</p>
<p>Le groupe 5 correspond donc à un ensemble d’Iris avec les plus hauts niveaux de concentration de pollutions atmosphérique et sonore (figure ci-dessous). Il est similaire en cela au groupe 1, qui est cependant marqué par des niveaux de bruit un peu moins élevés.</p>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/spiderPlots.html">spiderPlots</a></span><span class="op">(</span><span class="va">Data</span>,<span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>,</span>
<span>            chartcolors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange3"</span>,</span>
<span>                            <span class="st">"grey4"</span>,</span>
<span>                            <span class="st">"darkgreen"</span>,</span>
<span>                            <span class="st">"royalblue"</span>, </span>
<span>                            <span class="st">"blueviolet"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-43-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-43-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-43-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="08-ClassificationsSpatiales_files/figure-html/unnamed-chunk-43-6.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>De multiples saveurs du SFCM</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Plusieurs variantes du SFCM sont proposées par le <em>package</em> <code>geocmeans</code> qui offrent une grande flexibilité&nbsp;:</p>
<ul>
<li>La version généralisée du SFCM (appelée SFGCM) avec l’ajout d’un paramètre supplémentaire (<em>beta</em>) qui accélère la convergence du SFCM en limitant la probabilité attribuée au groupe le moins probable de chaque observation.</li>
<li>Les versions robustes du SFCM et SFGCM, qui normalisent les distances calculées entre les observations pour réaliser des classifications non sphériques.</li>
<li>L’ajout d’un groupe de résidus, permettant d’attribuer les observations très incertaines à un groupe «&nbsp;poubelle&nbsp;», ce qui évite d’influencer la cohérence des «&nbsp;vrais groupes&nbsp;» avec des observations très atypiques.</li>
</ul>
</div>
</div>
</section></section></section><section id="sec-083" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="sec-083">
<span class="header-section-number">8.3</span> Quiz de révision du chapitre</h2>
<div id="Chap08" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chap08;
  window.onload = function() {
    quizz_Chap08 = new Quiz('Chap08', [['1', '2', '4'],['3', '5'],'1','1','2',['1', '2'],['1', '3'],'1','2']);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelles sont les méthodes de classification non supervisée avec une contrainte spatiale?
</div>
<div>
Relisez l’introduction du <a href="#sec-chap08">chapitre&nbsp;<span>8</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Algorithmes AZP (Automatic Zoning Problem).</label>
</td>
<td>
<input type="checkbox" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>Algorithmes SKATER.</label>
</td>
<td>
<input type="checkbox" name="q1" value="2">
</td>
</tr>
<tr>
<td>
<label>Classification floue c-moyennes spatiale.</label>
</td>
<td>
<input type="checkbox" name="q1" value="3">
</td>
</tr>
<tr>
<td>
<label>Algorithmes REDCAP.</label>
</td>
<td>
<input type="checkbox" name="q1" value="4">
</td>
</tr>
<tr>
<td>
<label>Méthode ClustGeo.</label>
</td>
<td>
<input type="checkbox" name="q1" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelles sont les méthodes de classification non supervisée avec une dimensions spatiale?
</div>
<div>
Relisez l’introduction de la <a href="#sec-chap08">section&nbsp;<span>8</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Algorithmes AZP (Automatic Zoning Problem).</label>
</td>
<td>
<input type="checkbox" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>Algorithmes SKATER.</label>
</td>
<td>
<input type="checkbox" name="q2" value="2">
</td>
</tr>
<tr>
<td>
<label>Classification floue c-moyenne spatiale.</label>
</td>
<td>
<input type="checkbox" name="q2" value="3">
</td>
</tr>
<tr>
<td>
<label>Algorithmes REDCAP.</label>
</td>
<td>
<input type="checkbox" name="q2" value="4">
</td>
</tr>
<tr>
<td>
<label>Méthode ClustGeo.</label>
</td>
<td>
<input type="checkbox" name="q2" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La classification ascendante hiérarchique et la classification le k-moyennes sont des méthodes de classification non supervisée qui ne prennent pas en compte l’espace :
</div>
<div>
Relisez au besoin la <a href="#sec-chap08">section&nbsp;<span>8</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une méthode de classification avec contrainte spatiale produit des régions non discontinues (sans mitage spatial) :
</div>
<div>
Relisez au besoin la <a href="#sec-081">section&nbsp;<span>8.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q4" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
L’algorithme SKATER est basé sur :
</div>
<div>
Relisez au besoin la <a href="#sec-0812">section&nbsp;<span>8.1.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Une matrice de distances.</label>
</td>
<td>
<input type="radio" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>Un arbre couvrant de poids minimal.</label>
</td>
<td>
<input type="radio" name="q5" value="2">
</td>
</tr>
<tr>
<td>
<label>Le I de Moran.</label>
</td>
<td>
<input type="radio" name="q5" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La méthode ClustGeo est basée sur deux matrices :
</div>
<div>
Relisez au besoin la <a href="#sec-0821">section&nbsp;<span>8.2.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Une matrice sémantique calculée sur p variables caractérisant les unités spatiales (D0).</label>
</td>
<td>
<input type="checkbox" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>Une matrice spatiale calculée à partir des distances euclidiennes entre les unités spatiales (D1).</label>
</td>
<td>
<input type="checkbox" name="q6" value="2">
</td>
</tr>
<tr>
<td>
<label>Une matrice spatialement décalée de la matrice sémantique original (Ds).</label>
</td>
<td>
<input type="checkbox" name="q6" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La méthode c-moyennes spatiale floue est :
</div>
<div>
Relisez au besoin la <a href="#sec-0812">section&nbsp;<span>8.1.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Une matrice sémantique calculée sur p variables caractérisant les unités spatiales (D0).</label>
</td>
<td>
<input type="checkbox" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>Une matrice spatiale calculée à partir des distances euclidiennes entre les unités spatiales (D1).</label>
</td>
<td>
<input type="checkbox" name="q7" value="2">
</td>
</tr>
<tr>
<td>
<label>Une matrice spatialement décalée de la matrice sémantique original (Ds).</label>
</td>
<td>
<input type="checkbox" name="q7" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le paramètre alpha de la méthode ClustGeo permet de définir le poids accordé à la matrice spatiale. Son intervalle de variation est de :
</div>
<div>
Relisez le deuxième encadré à la <a href="#sec-08211">section&nbsp;<span>8.2.1.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>0 à 1.</label>
</td>
<td>
<input type="radio" name="q8" value="1">
</td>
</tr>
<tr>
<td>
<label>0 à l’infini.</label>
</td>
<td>
<input type="radio" name="q8" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le paramètre alpha de la classification c-moyennes spatiale floue permet de définir le poids accordé à la matrice spatialement décalée. Son intervalle de variation est de :
</div>
<div>
Relisez le deuxième encadré à la <a href="#sec-08211">section&nbsp;<span>8.2.1.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>0 à 1.</label>
</td>
<td>
<input type="radio" name="q9" value="1">
</td>
</tr>
<tr>
<td>
<label>0 à l’infini.</label>
</td>
<td>
<input type="radio" name="q9" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chap08);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>
</section><section id="sec-084" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="sec-084">
<span class="header-section-number">8.4</span> Exercices de révision</h2>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 1.</strong> Réalisation de classification avec contrainte spatiale avec des variables socioéconomiques</p>
</div>
<div class="bloc_exercice-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeoda)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Préparation des données</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/chap08/DonneesLyon.Rdata"</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>VarSocioEco <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pct0_14"</span>, <span class="st">"Pct_65"</span>, <span class="st">"Pct_Img"</span>, <span class="st">"Pct_brevet"</span>, <span class="st">"NivVieMed"</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>Data2 <span class="ot">&lt;-</span> <span class="fu">st_drop_geometry</span>(LyonIris[VarSocioEco])</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>queen_w <span class="ot">&lt;-</span> <span class="fu">queen_weights</span>(LyonIris)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Classification avec k = 4</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>azp5_sa  <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>azp5_tab <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>skater5  <span class="ot">&lt;-</span> rgeoda<span class="sc">::</span><span class="fu">skater</span>(à compléter)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>redcap5  <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Cartographie des résultats</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>SE.azp4_sa  <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>SE.azp4_tab <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>SE.skater4 <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>SE.recap4  <span class="ot">&lt;-</span> à compléter</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>Carte1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(LyonIris)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col=</span><span class="st">"SE.azp4_sa"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">title =</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame=</span><span class="cn">FALSE</span>,  <span class="at">main.title =</span> <span class="st">"a. AZP-SA"</span>,</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>Carte2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(LyonIris)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col=</span><span class="st">"SE.azp4_tab"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">title =</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame=</span><span class="cn">FALSE</span>,  <span class="at">main.title =</span> <span class="st">"b. AZP-TABU"</span>,</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>)</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>Carte3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(LyonIris)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col=</span><span class="st">"SE.skater4"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">title =</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame=</span><span class="cn">FALSE</span>,  <span class="at">main.title =</span> <span class="st">"c. Skater"</span>,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>)</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>Carte4 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(LyonIris)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">col=</span><span class="st">"gray"</span>, <span class="at">lwd=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col=</span><span class="st">"SE.recap4"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">title =</span><span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame=</span><span class="cn">FALSE</span>,  <span class="at">main.title =</span> <span class="st">"d. RECAP"</span>,</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>, <span class="at">main.title.size =</span> <span class="dv">1</span>)</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(à compléter)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="12-Exercices.html#sec-12081">section&nbsp;<span>12.8.1</span></a>.</p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-RBoldAir" class="csl-entry" role="listitem">
Apparicio, Philippe et Jérémy Gelb. 2022. <em>Méthodes quantitatives en sciences sociales : un grand bol d’R</em>. FabriqueREL, Licence CC BY-SA. <a href="https://serieboldr.github.io/MethodesQuantitatives/">https://serieboldr.github.io/MethodesQuantitatives/</a>.
</div>
<div id="ref-assunccao2006efficient" class="csl-entry" role="listitem">
Assunção, Renato M, Marcos Corrêa Neves, Gilberto Câmara et Corina da Costa Freitas. 2006. <span>«&nbsp;Efficient regionalization techniques for socio-economic geographical units using minimum spanning trees.&nbsp;»</span> <em>International Journal of Geographical Information Science</em> 20 (7): 797‑811. <a href="https://doi.org/10.1080/13658810600665111">https://doi.org/10.1080/13658810600665111</a>.
</div>
<div id="ref-cai2007fast" class="csl-entry" role="listitem">
Cai, Weiling, Songcan Chen et Daoqiang Zhang. 2007. <span>«&nbsp;Fast and robust fuzzy c-means clustering algorithms incorporating local information for image segmentation.&nbsp;»</span> <em>Pattern recognition</em> 40 (3): 825‑838. <a href="https://doi.org/10.1016/j.patcog.2006.07.011">https://doi.org/10.1016/j.patcog.2006.07.011</a>.
</div>
<div id="ref-packageClustGeo" class="csl-entry" role="listitem">
Chavent, Marie, Vanessa Kuentz-Simonet, Amaury Labenne et Jérôme Saracco. 2018. <span>«&nbsp;ClustGeo: an R package for hierarchical clustering with spatial constraints.&nbsp;»</span> <em>Computational Statistics</em> 33 (4): 1799‑1822. <a href="https://doi.org/10.1007/s00180-018-0791-1">https://doi.org/10.1007/s00180-018-0791-1</a>.
</div>
<div id="ref-duque2012max" class="csl-entry" role="listitem">
Duque, Juan C, Luc Anselin et Sergio J Rey. 2012. <span>«&nbsp;The max-p-regions problem.&nbsp;»</span> <em>Journal of Regional Science</em> 52 (3): 397‑419. <a href="https://doi.org/10.1111/j.1467-9787.2011.00743.x">https://doi.org/10.1111/j.1467-9787.2011.00743.x</a>.
</div>
<div id="ref-ClassificationFloue" class="csl-entry" role="listitem">
Gelb, Jérémy et Philippe Apparicio. 2021. <span>«&nbsp;Apport de la classification floue c-means spatiale en géographie: essai de taxinomie socio-résidentielle et environnementale à Lyon.&nbsp;»</span> <em>Cybergeo: European Journal of Geography</em>. <a href="https://doi.org/10.4000/cybergeo.36414">https://doi.org/10.4000/cybergeo.36414</a>.
</div>
<div id="ref-getis2009spatial" class="csl-entry" role="listitem">
Getis, Arthur. 2009. <span>«&nbsp;Spatial weights matrices.&nbsp;»</span> <em>Geographical Analysis</em> 41 (4): 404‑410. <a href="https://doi.org/10.1111/j.1538-4632.2009.00768.x">https://doi.org/10.1111/j.1538-4632.2009.00768.x</a>.
</div>
<div id="ref-guo2008regionalization" class="csl-entry" role="listitem">
Guo, Diansheng. 2008. <span>«&nbsp;Regionalization with dynamically constrained agglomerative clustering and partitioning (REDCAP).&nbsp;»</span> <em>International Journal of Geographical Information Science</em> 22 (7): 801‑823. <a href="https://doi.org/10.1080/13658810600665111">https://doi.org/10.1080/13658810600665111</a>.
</div>
<div id="ref-jain1988algorithms" class="csl-entry" role="listitem">
Jain, Anil K et Richard C Dubes. 1988. <em>Algorithms for clustering data</em>. Prentice-Hall, Inc.
</div>
<div id="ref-kaufman1990partitioning" class="csl-entry" role="listitem">
Kaufman, Leonard. 1990. <span>«&nbsp;Partitioning around medoids (program pam).&nbsp;»</span> <em>Finding groups in data</em> 344: 68‑125. <a href="https://doi.org/10.1002/9780470316801.ch2">https://doi.org/10.1002/9780470316801.ch2</a>.
</div>
<div id="ref-lebart1995statistique" class="csl-entry" role="listitem">
Lebart, Ludovic, Alain Morineau et Marie Piron. 1995. <em>Statistique exploratoire multidimensionnelle</em>. Dunod.
</div>
<div id="ref-packagergeoda" class="csl-entry" role="listitem">
Li, Xun et Luc Anselin. 2023. <em>rgeoda: R Library for Spatial Data Analysis</em>. s.n. <a href="https://CRAN.R-project.org/package=rgeoda">https://CRAN.R-project.org/package=rgeoda</a>.
</div>
<div id="ref-openshaw1977geographical" class="csl-entry" role="listitem">
Openshaw, Stan. 1977. <span>«&nbsp;A geographical solution to scale and aggregation problems in region-building, partitioning and spatial modelling.&nbsp;»</span> <em>Transactions of the institute of british geographers</em>: 459‑472. <a href="https://doi.org/10.2307/622300">https://doi.org/10.2307/622300</a>.
</div>
<div id="ref-openshaw1995algorithms" class="csl-entry" role="listitem">
Openshaw, Stan et Liang Rao. 1995. <span>«&nbsp;Algorithms for reengineering 1991 Census geography.&nbsp;»</span> <em>Environment and planning A</em> 27 (3): 425‑446. <a href="https://doi.org/10.1068/a270425">https://doi.org/10.1068/a270425</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./07-RegressionSpatiales.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-EchantillonnageSpatial.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Méthodes d’échantillonnage spatial</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes d’analyse spatiale : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>