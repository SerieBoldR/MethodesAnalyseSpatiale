<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes d’analyse spatiale : un grand bol d’R - 2&nbsp; Autocorrélation spatiale</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-MethodesRepartitionPonctuelle.html" rel="next">
<link href="./01-ManipulationDonneesSpatiales.html" rel="prev">
<link href="./images/introduction/Couverture_16_01-01.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="site_libs/jquery-1.12.4/jquery.min.js"></script><link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script><link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script><script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="site_libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-Autocorrelation.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Autocorrélation spatiale</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes d’analyse spatiale : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Données spatiales et R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-ManipulationDonneesSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manipulation des données spatiales dans&nbsp;R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Autocorrélation spatiale</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Autocorrelation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Autocorrélation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Méthodes de répartition ponctuelle et de détections d’agrégats spatiaux</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-MethodesRepartitionPonctuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Méthodes de répartition ponctuelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-AgregatsSpatiaux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Méthodes de détection d’agrégats spatiaux et spatio-temporels</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Analyses de données avec des réseaux de transport</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-AnalyseReseau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mesures d’accessibilité spatiale selon différents modes de transport</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-AnalyseReseauEvenements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyses d’évènements localisés sur un réseau</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Régressions spatiales et classifications spatiales</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-RegressionSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ClassificationsSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Exercices et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Exercices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Correction des exercices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li><a href="#sec-021" id="toc-sec-021" class="nav-link active" data-scroll-target="#sec-021"><span class="header-section-number">2.1</span> Notion d’autocorrélation spatiale</a></li>
  <li>
<a href="#sec-022" id="toc-sec-022" class="nav-link" data-scroll-target="#sec-022"><span class="header-section-number">2.2</span> Matrices de pondération spatiale</a>
  <ul class="collapse">
<li><a href="#sec-0221" id="toc-sec-0221" class="nav-link" data-scroll-target="#sec-0221"><span class="header-section-number">2.2.1</span> Matrices de contiguïté</a></li>
  <li><a href="#sec-0222" id="toc-sec-0222" class="nav-link" data-scroll-target="#sec-0222"><span class="header-section-number">2.2.2</span> Matrices de proximité spatiale</a></li>
  <li><a href="#sec-0223" id="toc-sec-0223" class="nav-link" data-scroll-target="#sec-0223"><span class="header-section-number">2.2.3</span> Standardisation des matrices de pondération spatiale en ligne</a></li>
  <li><a href="#sec-0224" id="toc-sec-0224" class="nav-link" data-scroll-target="#sec-0224"><span class="header-section-number">2.2.4</span> Construction de matrices de pondération spatiale dans R</a></li>
  </ul>
</li>
  <li>
<a href="#sec-023" id="toc-sec-023" class="nav-link" data-scroll-target="#sec-023"><span class="header-section-number">2.3</span> Autocorrélation spatiale globale</a>
  <ul class="collapse">
<li><a href="#sec-0231" id="toc-sec-0231" class="nav-link" data-scroll-target="#sec-0231"><span class="header-section-number">2.3.1</span> Statistique du <em>I</em> de Moran</a></li>
  <li><a href="#sec-0232" id="toc-sec-0232" class="nav-link" data-scroll-target="#sec-0232"><span class="header-section-number">2.3.2</span> Statistiques de comptage de jointure (<em>Join Count Statistics</em>)</a></li>
  <li><a href="#sec-0233" id="toc-sec-0233" class="nav-link" data-scroll-target="#sec-0233"><span class="header-section-number">2.3.3</span> Indice de Lee&nbsp;: autocorrélation spatiale dans un contexte bivarié</a></li>
  </ul>
</li>
  <li>
<a href="#sec-024" id="toc-sec-024" class="nav-link" data-scroll-target="#sec-024"><span class="header-section-number">2.4</span> Autocorrélation spatiale locale</a>
  <ul class="collapse">
<li><a href="#sec-0241" id="toc-sec-0241" class="nav-link" data-scroll-target="#sec-0241"><span class="header-section-number">2.4.1</span> Statistiques locales de Getis et Ord&nbsp;: repérer les points chauds et froids pour une variable continue</a></li>
  <li><a href="#sec-0242" id="toc-sec-0242" class="nav-link" data-scroll-target="#sec-0242"><span class="header-section-number">2.4.2</span> Version locale du <em>I</em> de Moran</a></li>
  <li><a href="#sec-0243" id="toc-sec-0243" class="nav-link" data-scroll-target="#sec-0243"><span class="header-section-number">2.4.3</span> Typologie basée sur le diagramme de Moran</a></li>
  <li><a href="#sec-0244" id="toc-sec-0244" class="nav-link" data-scroll-target="#sec-0244"><span class="header-section-number">2.4.4</span> Version locale des statistiques de comptage de jointure (<em>Join Count Statistics</em>)</a></li>
  <li><a href="#sec-0245" id="toc-sec-0245" class="nav-link" data-scroll-target="#sec-0245"><span class="header-section-number">2.4.5</span> Version locale de l’indice de Lee</a></li>
  <li><a href="#sec-0246" id="toc-sec-0246" class="nav-link" data-scroll-target="#sec-0246"><span class="header-section-number">2.4.6</span> Typologie basée sur le diagramme de Moran dans un contexte bivarié</a></li>
  <li><a href="#sec-0247" id="toc-sec-0247" class="nav-link" data-scroll-target="#sec-0247"><span class="header-section-number">2.4.7</span> Autocorrélation locale pour une variable qualitative (catégorielle)&nbsp;: l’indicateur ELSA</a></li>
  </ul>
</li>
  <li><a href="#sec-025" id="toc-sec-025" class="nav-link" data-scroll-target="#sec-025"><span class="header-section-number">2.5</span> Quiz de révision du chapitre</a></li>
  <li><a href="#sec-026" id="toc-sec-026" class="nav-link" data-scroll-target="#sec-026"><span class="header-section-number">2.6</span> Exercices de révision</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap02" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Autocorrélation spatiale</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Première loi de la géographie proposée par Waldo Tobler</strong></p>
</div>
<div class="bloc_notes-body">
<p>«&nbsp;Tout interagit avec tout, mais les objets proches ont plus de chance de le faire que les objets éloignés [<em>Everything is related to everything else, but near things are more related than distant things</em>]&nbsp;» <span class="citation" data-cites="tobler1970computer">(<a href="references.html#ref-tobler1970computer" role="doc-biblioref">Tobler 1970</a>)</span>.</p>
</div>
</div>
<p>Dans ce chapitre, nous mettons en œuvre dans&nbsp;R différentes méthodes qui permettent d’évaluer la dépendance spatiale d’une variable, soit les mesures d’autocorrélation spatiale globale et locale. Préalablement, nous voyons comment définir des matrices de pondération spatiale –&nbsp;selon la contiguïté et la proximité spatiale&nbsp;– qui sont utilisées dans les mesures d’autocorrélation spatiale, mais aussi dans les modèles spatiaux autorégressifs (<a href="07-RegressionSpatiales.html">chapitre&nbsp;<span>7</span></a>).</p>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour importer et manipuler des fichiers géographiques&nbsp;:
<ul>
<li>
<code>sf</code> pour importer et manipuler des données vectorielles.</li>
<li>
<code>terra</code> pour importer et manipuler des données matricielles.</li>
</ul>
</li>
<li>Pour calculer des mesures d’autocorrélation spatiale&nbsp;:
<ul>
<li>
<code>spdep</code> pour construire des matrices spatiales et calculer des mesures d’autocorrélation spatiale.</li>
<li>
<code>rgeoda</code> pour calculer des mesures d’autocorrélation spatiale.</li>
<li>
<code>geocmeans</code> pour calculer l’indicateur ELSA.</li>
</ul>
</li>
<li>Pour construire des cartes et des graphiques&nbsp;:
<ul>
<li>
<code>tmap</code> pour construire des cartes thématiques.</li>
<li>
<code>ggplot2</code> pour construire des graphiques.</li>
<li>
<code>ggpubr</code> pour réaliser une figure combinant plusieurs graphiques construits avec <code>ggplot2</code>.</li>
</ul>
</li>
<li>Pour manipuler des données&nbsp;:
<ul>
<li>
<code>dplyr</code> est un <em>package</em> facilitant la manipulation des données.</li>
</ul>
</li>
</ul>
</div>
</div>
<section id="sec-021" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="sec-021">
<span class="header-section-number">2.1</span> Notion d’autocorrélation spatiale</h2>
<p>Comprendre la configuration spatiale d’un phénomène donné est une démarche fondamentale en analyse spatiale. Or, l’autocorrélation spatiale permet d’estimer la corrélation d’une variable par rapport à sa localisation dans l’espace, soit la dépendance spatiale. Autrement dit, elle permet de vérifier si les entités proches ou voisines ont tendance à être (dis)semblables en fonction d’un phénomène donné (soit une variable). Tel qu’illustré à la <a href="#fig-Chap02NotionAutocorrSpatiale">figure&nbsp;<span>2.1</span></a> (données fictives), on distingue trois formes d’autocorrélation spatiale&nbsp;:</p>
<ul>
<li><p><strong>(a) Autocorrélation spatiale positive</strong>&nbsp;: lorsque les entités spatiales voisines ou proches se ressemblent davantage que celles non contiguës ou éloignées. Cela renvoie ainsi à la première loi de la géographie&nbsp;: «&nbsp;tout interagit avec tout, mais les objets proches ont plus de chance de le faire que les objets éloignés&nbsp;» (traduction libre) <span class="citation" data-cites="tobler1970computer">(<a href="references.html#ref-tobler1970computer" role="doc-biblioref">Tobler 1970</a>)</span>.</p></li>
<li><p><strong>(b) Autocorrélation spatiale négative</strong>&nbsp;: lorsque les entités spatiales voisines ou proches ont tendance à être dissemblables, comparativement à celles non contiguës ou éloignées.</p></li>
<li><p><strong>(c) Absence d’autocorrélation spatiale</strong>&nbsp;: lorsque les valeurs de la variable sont distribuées aléatoirement dans l’espace; autrement dit, lorsqu’il n’y a pas de relation entre le voisinage ou la proximité des entités spatiales et leur degré de ressemblance.</p></li>
</ul>
<div id="fig-Chap02NotionAutocorrSpatiale" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/NotionAutocorrSpatiale.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.1: Autocorrélation spatiale</figcaption></figure>
</div>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Analyse de la <a href="#fig-FigureExo1">figure&nbsp;<span>2.2</span></a></strong></p>
</div>
<div class="bloc_exercice-body">
<p>Quelle est la variable pour laquelle le voisinage joue un rôle important dans sa distribution? L’autocorrélation pour cette variable est-elle positive ou négative? Pourquoi?</p>
<div id="fig-FigureExo1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureExo1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.2: Illustration de l’autocorrélation spatiale de deux variables pour les aires de diffusion de la ville de Sherbrooke</figcaption></figure>
</div>
<p><em>Réponse&nbsp;:</em> L’autocorrélation spatiale semble bien plus forte pour le pourcentage des logements construits avant 1960. Les aires de diffusion (AD) contiguës ou proches dans la partie centrale de la ville ont clairement des pourcentages élevés (rouge foncé) tandis que celles voisines ou proches dans les périphéries présentent des pourcentages faibles. Cela traduit donc une forte autocorrélation spatiale positive. Par contre, la distribution spatiale du pourcentage de personnes de 65&nbsp;ans et plus semble plus aléatoire, traduisant ainsi une faible autocorrélation spatiale (dépendance spatiale).</p>
</div>
</div>
<p>Vous avez compris que la simple cartographie d’une variable vous donne une indication de l’autocorrélation spatiale. Pour contre, pour «&nbsp;chiffrer&nbsp;» l’intensité de l’autocorrélation spatiale, il convient de&nbsp;: 1)&nbsp;choisir une matrice de pondération spatiale (selon le voisinage ou la distance) (<a href="#sec-022">section&nbsp;<span>2.2</span></a>), 2)&nbsp;calculer une mesure d’autocorrélation spatiale à partir de cette matrice (comme l’indice de Moran) (<a href="#sec-023">section&nbsp;<span>2.3</span></a>).</p>
</section><section id="sec-022" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="sec-022">
<span class="header-section-number">2.2</span> Matrices de pondération spatiale</h2>
<p>Les mesures d’autocorrélation spatiale visent à vérifier si les entités spatiales contiguës ou proches ont tendance à être semblables (autocorrélation positive) ou dissemblables (autocorrélation négative) en fonction d’un phénomène donné (en fonction d’une variable). Il convient donc avant tout de définir la manière de mesurer la relation d’adjacence ou de proximité entre deux entités spatiales.</p>
<p>Il existe huit principales matrices de pondération spatiale regroupées en deux grandes catégories&nbsp;: celles de contiguïté (basées sur l’adjacence) et celles de proximité (basées sur la distance) (<a href="#tbl-TabMatricesSpatiales">tableau&nbsp;<span>2.1</span></a>). Lorsque la couche géographique est composée de points, seules les matrices de proximité peuvent être utilisées.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TabMatricesSpatiales" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.1: Matrices de pondération spatiale selon la géométrie</caption>
<colgroup>
<col style="width: 60%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Matrice</th>
<th style="text-align: center;">Points</th>
<th style="text-align: center;">Lignes</th>
<th style="text-align: center;">Polyg.</th>
<th style="text-align: center;"><em>Raster</em></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Partage d’un nœud (<em>Queen</em>)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;">Partage d’un segment (<em>Rook</em>)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Partage d’un nœud et ordre d’adjacence (<em>Queen</em>)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;">Partage d’un segment et ordre d’adjacence (<em>Rook</em>)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Connectivité selon la distance</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;">Inverse de la distance</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inverse de la distance au carré</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nombre de plus proches voisins</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-0221" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-0221">
<span class="header-section-number">2.2.1</span> Matrices de contiguïté</h3>
<p>La relation d’adjacence (de contiguïté) vise à déterminer si deux entités spatiales sont ou non voisines selon le partage soit d’un nœud, soit d’un segment (frontière commune). La contiguïté est liée à la notion de topologie qui prend en compte les relations de voisinage entre des entités spatiales, sans tenir compte de leurs tailles et de leurs formes géométriques. Elle peut être représentée à partir d’une <strong>matrice de contiguïté</strong> (avec une valeur de&nbsp;1 quand deux entités sont voisines et de 0 pour une situation inverse) ou d’un <strong>graphe</strong> (formé de points représentant les entités spatiales et de lignes reliant les entités voisines) (<a href="#fig-Chap02Contiguity1">figure&nbsp;<span>2.3</span></a>).</p>
<div id="fig-Chap02Contiguity1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureTopologie.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.3: Relation topologique entre des entités spatiales polygonales</figcaption></figure>
</div>
<p>Trois évaluations de la contiguïté sont représentées à la <a href="#fig-Chap02Contiguity2">figure&nbsp;<span>2.4</span></a>&nbsp;:</p>
<ul>
<li><p><strong>Adjacence selon le partage d’un segment</strong>, soit d’une frontière commune entre les polygones (A).</p></li>
<li><p><strong>Adjacence selon le partage d’un nœud</strong> (B).</p></li>
<li>
<p><strong>Ordre d’adjacence selon le partage d’un segment</strong> (C). L’ordre d’adjacence indique le nombre de frontières à traverser pour se rendre à l’entité spatiale contiguë, soit :</p>
<ul>
<li><p><strong>Ordre 1</strong>&nbsp;: une frontière à traverser pour se rendre dans l’entité spatiale adjacente.</p></li>
<li><p><strong>Ordre 2</strong>&nbsp;: deux frontières à traverser pour atteindre les entités de la deuxième couronne.</p></li>
<li><p><strong>Ordre 3</strong>&nbsp;: trois frontières à traverser pour atteindre les entités de la troisième couronne.</p></li>
<li><p>Etc.</p></li>
</ul>
</li>
</ul>
<p>Bien entendu, les ordres d’adjacence peuvent être également définis selon le partage d’un nœud commun.</p>
<div id="fig-Chap02Contiguity2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureAdjacence.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.4: Relations de voisinage et évaluation de la contiguïté</figcaption></figure>
</div>
<div class="bloc_astuce">
<div class="bloc_astuce-header">
<div class="bloc_astuce-icon">

</div>
<p><strong>Applicabilité des ordres d’adjacence</strong></p>
</div>
<div class="bloc_astuce-body">
<p>Les matrices d’adjacence sont souvent utilisées dans les analyses de diffusion spatiale. Prenons un exemple concret : imaginons que le polygone en gris à la <a href="#fig-Chap02Contiguity2">figure&nbsp;<span>2.4</span></a> est un parc. Nous pourrions évaluer le prix moyen des maisons dans les îlots qui font face au parc (ordre&nbsp;1), toutes choses étant égales par ailleurs (superficie du terrain, superficie habitable, nombre de pièces, etc.). Puis, nous pourrions comparer ce prix moyen à ceux calculés pour les ordres suivants. Il est probable que le prix au premier ordre soit significativement plus élevé qu’au deuxième ordre, voire au troisième ordre. Autre exemple, nous pourrions réaliser un exercice similaire pour des maisons dans des îlots adjacents à un tronçon autoroutier. La relation est probablement inverse&nbsp;: un prix moyen plus bas à l’ordre&nbsp;1 comparativement aux ordres suivants.</p>
</div>
</div>
<p>Habituellement appelée <span class="math inline">\(W\)</span>, la matrice de contiguïté est binaire selon le partage tant d’un nœud (<em>Queen</em> en anglais) (<a href="#eq-ContiguiteQueen">équation&nbsp;<span>2.1</span></a>) que d’un segment commun (<em>Rook</em> en anglais) (<a href="#eq-ContiguiteRook">équation&nbsp;<span>2.2</span></a>).</p>
<p><span id="eq-ContiguiteQueen"><span class="math display">\[
w_{ij} =
\begin{cases}
   1 &amp; \text{si les entités spatiales }i \text{ et }j \text{ ont au moins un nœud commun; } i   \ne j\\
   0 &amp; \text{sinon}
  \end{cases}
\tag{2.1}\]</span></span></p>
<p><span id="eq-ContiguiteRook"><span class="math display">\[
w_{ij} =
\begin{cases}
   1 &amp; \text{si les entités spatiales }i \text{ et }j \text{ partagent une frontière commune; } i   \ne j\\
   0 &amp; \text{sinon}
  \end{cases}
\tag{2.2}\]</span></span></p>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 1.</strong> Compléter des matrices de contiguïté</p>
</div>
<div class="bloc_exercice-body">
<p>Petit conseil pour la partie A&nbsp;: une matrice de contiguïté est symétrique c’est-à-dire que si le polygone&nbsp;A est voisin du polygone&nbsp;B, alors B est voisin de A! Par conséquent, pour gagner du temps, complétez une ligne et transposez-la en colonne.</p>
<div id="fig-ExoMatriceDeContiguiteCorrection" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/ExoMatriceDeContiguite.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.5: Exercice sur la contiguïté et les ordres d’adjacence</figcaption></figure>
</div>
<p>Correction à la <a href="10-Exercices.html#sec-10021">section&nbsp;<span>9.2.1</span></a>.</p>
</div>
</div>
</section><section id="sec-0222" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-0222">
<span class="header-section-number">2.2.2</span> Matrices de proximité spatiale</h3>
<section id="sec-02221" class="level4" data-number="2.2.2.1"><h4 data-number="2.2.2.1" class="anchored" data-anchor-id="sec-02221">
<span class="header-section-number">2.2.2.1</span> Bref retour sur les différents types de distance</h4>
<p>Pour calculer des mesures d’autocorrélation spatiale, nous pouvons aussi utiliser des matrices de pondération spatiale basées sur la proximité spatiale. Cette fois, nous ne cherchons pas à vérifier si les entités spatiales adjacentes se ressemblent, mais plutôt à vérifier si les entités spatiales proches les unes des autres se ressemblent. Pour ce faire, nous devons calculer les distances entre les entités spatiales.</p>
<p>Pour construire une matrice de pondération spatiale selon la proximité, nous pouvons utiliser plusieurs types de distance <span class="citation" data-cites="ApparicioGelbrevisited">(<a href="references.html#ref-ApparicioGelbrevisited" role="doc-biblioref">Apparicio et al. 2017</a>)</span> : certaines sont cartésiennes, d’autres, dites réticulaires, sont calculées à partir d’un réseau de rues (<a href="#fig-Chap02TypesDistances">figure&nbsp;<span>2.6</span></a>).</p>
<p>Les distances cartésiennes –&nbsp;euclidienne et de Manhattan (<a href="#eq-DistEuc">équation&nbsp;<span>2.3</span></a> et <a href="#eq-DistManh">équation&nbsp;<span>2.4</span></a>)&nbsp;– sont facilement calculables à partir des coordonnées géographiques (<em>x</em>,<em>y</em>) dans un SIG ou dans n’importe quel logiciel tableur, de statistique ou de gestion de base de données, etc. Pour cela, la couche géographique doit être dans un système de projection plane. La distance euclidienne représente ainsi la distance à vol d’oiseau entre deux points, tandis que la distance de Manhattan est la somme des deux côtés formant l’angle droit d’un triangle rectangle (l’hypoténuse, le plus grand des côtés du triangle, étant la distance euclidienne) (<a href="#fig-Chap02TypesDistances">figure&nbsp;<span>2.6</span></a>, a). Si la projection de la couche est sphérique (longitude/latitude), il convient d’utiliser la formule de haversine (basée sur la trigonométrie sphérique) pour obtenir la distance à vol d’oiseau (<a href="#eq-DistLongLat">équation&nbsp;<span>2.5</span></a>).</p>
<p>Par contre, comme leurs noms l’indiquent, les distances réticulaires nécessitent un réseau de rues dans un SIG (notamment avec l’extension <em>Network Analyst</em> d’ArcGIS&nbsp;Pro) ou dans R (notamment avec le <em>package</em> R5R) pour calculer le chemin le plus rapide (<a href="05-AnalyseReseau.html">chapitre&nbsp;<span>5</span></a>).</p>
<p><span id="eq-DistEuc"><span class="math display">\[
d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2}
\tag{2.3}\]</span></span></p>
<p><span id="eq-DistManh"><span class="math display">\[
d_{ij} = \lvert x_i-x_j \rvert + \lvert y_i-y_j \rvert
\tag{2.4}\]</span></span></p>
<p><span id="eq-DistLongLat"><span class="math display">\[
d_{ij} = 2R \cdot \text{ arcsin} \left( \sqrt{\text{sin}^2 \left( \frac{\delta _i - \delta _j}{2} \right) + \text{cos }\delta _i \cdot \text{cos }\delta _j \cdot \text{sin}^2 \left( \frac{\phi _i - \phi _j}{2} \right)} \right)
\tag{2.5}\]</span></span></p>
<p>avec <span class="math inline">\(R\)</span> étant le rayon de la terre; <span class="math inline">\(\delta _i\)</span> et <span class="math inline">\(\delta _j\)</span> les coordonnées de longitude pour les points <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>; <span class="math inline">\(\phi _i\)</span> et <span class="math inline">\(\phi _j\)</span> les coordonnées de latitude pour les points <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>.</p>
<div id="fig-Chap02TypesDistances" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureDistances.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.6: Les différents types de distance</figcaption></figure>
</div>
</section><section id="sec-02222" class="level4" data-number="2.2.2.2"><h4 data-number="2.2.2.2" class="anchored" data-anchor-id="sec-02222">
<span class="header-section-number">2.2.2.2</span> Matrice de distance binaire (de connectivité)</h4>
<p>À partir d’une matrice de distance entre les entités spatiales d’une couche géographique, il est possible de créer une matrice de pondération binaire (<a href="#eq-MatriceDistanceNonBinaire">équation&nbsp;<span>2.6</span></a>). Ce type de matrice est habituellement appelée <strong>matrice de connectivité</strong>. Il convient alors de fixer un seuil de distance maximal. Par exemple, avec un seuil de 500&nbsp;mètres, <span class="math inline">\(w_{ij}=1\)</span> si la distance entre les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span> est inférieure ou égale à 500&nbsp;mètres; sinon <span class="math inline">\(w_{ij}=0\)</span>. Notez que pour des lignes et des polygones, la distance est habituellement calculée à partir de leurs centroïdes.</p>
<p><span id="eq-MatriceDistanceNonBinaire"><span class="math display">\[
w_{ij} =
\begin{cases}
   1 &amp; \text{si }d_{ij}\leq{\bar{d}}\text{; } i \ne j\\
   0 &amp; \text{sinon}
  \end{cases}
\tag{2.6}\]</span></span></p>
<p>avec <span class="math inline">\(d_{ij}\)</span> étant la distance entre les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>, et <span class="math inline">\(\bar{d}\)</span> étant un seuil de distance maximal fixé par la personne utilisatrice (par exemple, 500&nbsp;mètres).</p>
<p>En guise d’exemple, à la <a href="#fig-Connectivite">figure&nbsp;<span>2.7</span></a>, seuls les polygones jaunes seraient considérés comme voisins du polygone bleu avec un seuil de distance maximal fixé à 2,5&nbsp;kilomètres (valeur de&nbsp;1); les roses se verraient affecter la valeur de&nbsp;0.</p>
<div id="fig-Connectivite" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureConnectivite.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.7: Illustration de la connectivité basée sur la distance</figcaption></figure>
</div>
</section><section id="sec-02223" class="level4" data-number="2.2.2.3"><h4 data-number="2.2.2.3" class="anchored" data-anchor-id="sec-02223">
<span class="header-section-number">2.2.2.3</span> Matrices basées sur la distance</h4>
<p>À partir d’une matrice de distance entre les entités spatiales, les pondérations peuvent être calculées avec l’inverse de la distance (<span class="math inline">\(1/d_{ij}\)</span>) ou l’inverse de la distance au carré (<span class="math inline">\(1/d_{ij^2}\)</span>) (<a href="#eq-MatriceDistance1">équation&nbsp;<span>2.7</span></a>). Analysons le graphique à la <a href="#fig-PonderationInvDistInvDist2">figure&nbsp;<span>2.8</span></a>.</p>
<ul>
<li><p>Premièrement, nous constatons que plus la distance est grande, plus la valeur de la pondération est faible et inversement. De la sorte, nous accordons un rôle plus important aux entités spatiales proches les unes des autres que celles éloignées.</p></li>
<li><p>Deuxièmement, les pondérations chutent beaucoup plus rapidement avec l’inverse de la distance au carré qu’avec l’inverse de la distance. Autrement dit, le recours à une matrice de pondération calculée avec l’inverse de la distance au carré a comme effet d’accorder un poids plus important aux entités géographiques très proches.</p></li>
</ul>
<p><span id="eq-MatriceDistance1"><span class="math display">\[
w_{ij} =
\begin{cases}
  \frac{1}{d_{ij}^{\gamma}} &amp;\\
   0 &amp; \text{si } i=j
  \end{cases}
\tag{2.7}\]</span></span></p>
<p>avec <span class="math inline">\(\gamma = 1\)</span> pour une matrice de l’inverse de la distance et <span class="math inline">\(\gamma = 2\)</span> pour l’inverse de la distance au carré.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-PonderationInvDistInvDist2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-PonderationInvDistInvDist2-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.8: Comparaison des matrices inverse de la distance et inverse de la distance au carré</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Pondération avec l’exponentielle inverse</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Dans un excellent livre intitulé <em>Économétrie spatiale appliquée des microdonnées</em>, Jean Dubé et Diego Legros <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014</a>)</span> proposent de transformer la matrice des distances avec l’inverse de l’exponentielle (ou l’exponentielle négative de la distance) (<a href="#eq-MatriceDistancEexp">équation&nbsp;<span>2.8</span></a>). Comparativement à l’inverse de la distance au carré, cette opération fait chuter encore plus rapidement les pondérations.</p>
<p><span id="eq-MatriceDistancEexp"><span class="math display">\[
w_{ij} =
\begin{cases}
  \frac{1}{e^{d_{ij}}} = e^{-d_{ij}} &amp;\\
   0 &amp; \text{si } i=j
  \end{cases}
\tag{2.8}\]</span></span></p>
</div>
</div>
<p>Notez que l’<a href="#eq-MatriceDistance1">équation&nbsp;<span>2.7</span></a> peut être légèrement modifiée en introduisant un seuil maximal de la distance au-delà duquel les pondérations sont mises à 0 (<a href="#eq-MatriceDistance2">équation&nbsp;<span>2.9</span></a>). Autrement dit, cela permet de ne pas tenir compte des entités spatiales distantes à plus d’un seuil fixé par l’analyste, ce qui est particulièrement intéressant lorsque vous analysez un phénomène dont la diffusion (ou propagation) cesse ou est très minime au-delà d’une certaine distance. Par exemple, pour la propagation du bruit routier, le seuil de 300&nbsp;mètres est souvent utilisé. Par conséquent, une mesure d’autocorrélation spatiale sur des mesures de bruit routier devrait probablement recourir à un seuil maximal de 300&nbsp;mètres. Autre exemple, la superficie du territoire vital diffère selon les espèces animales (cerf, caribou, ours et loup, par exemple). Par conséquent, une ou un biologiste calculant des mesures d’autocorrélation spatiale risque aussi de fixer un seuil maximal différent selon l’espèce étudiée.</p>
<p><span id="eq-MatriceDistance2"><span class="math display">\[
w_{ij} =
\begin{cases}
   \frac{1}{d_{ij}^{\gamma}} &amp; \text{si }d_{ij}\leq{\bar{d}}\\
   0 &amp; \text{si }d_{ij}&gt;{\bar{d}}\\
   0 &amp; \text{si } i=j
  \end{cases}
\tag{2.9}\]</span></span></p>
<div class="bloc_astuce">
<div class="bloc_astuce-header">
<div class="bloc_astuce-icon">

</div>
<p><strong>Calculer le rayon maximal à partir d’une aire</strong></p>
</div>
<div class="bloc_astuce-body">
<p>Admettons que la superficie du territoire vital d’une espèce soit de 50&nbsp;hectares, soit 0,5&nbsp;km<sup>2</sup> ou 500&nbsp;000&nbsp;m<sup>2</sup>. La formule bien connue pour calculer la superficie d’un cercle est <span class="math inline">\(S = \pi r^2\)</span> avec <span class="math inline">\(S\)</span> et <span class="math inline">\(r\)</span> étant respectivement la superficie et le rayon. Par conséquent, celle du rayon est <span class="math inline">\(r = \sqrt{\frac{S}{\pi}}\)</span>. Pour trouver le rayon, vous devez taper <code>sqrt(500000 / pi)</code> dans la console de R et obtenir ainsi une distance de <code>398.9423</code> qui pourrait être arrondie à 400&nbsp;mètres.</p>
</div>
</div>
</section><section id="sec-02224" class="level4" data-number="2.2.2.4"><h4 data-number="2.2.2.4" class="anchored" data-anchor-id="sec-02224">
<span class="header-section-number">2.2.2.4</span> Matrices selon le critère des plus proches voisins</h4>
<p>Une autre façon très utilisée pour définir une matrice de proximité à partir d’une matrice de distance consiste à retenir uniquement les <em>n</em> plus proches voisins. La matrice est aussi binaire avec les valeurs de&nbsp;1 si les observations sont parmi les <em>n</em> plus proches de l’entité spatiale <span class="math inline">\(i\)</span> et de 0 pour une situation inverse.</p>
</section></section><section id="sec-0223" class="level3" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-0223">
<span class="header-section-number">2.2.3</span> Standardisation des matrices de pondération spatiale en ligne</h3>
<p>Il est recommandé de standardiser les matrices de pondération en ligne. La somme de la matrice de pondération sera alors égale au nombre d’entités spatiales de la couche géographique.</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Quel est l’intérêt de la standardisation?</strong></p>
</div>
<div class="bloc_attention-body">
<p>Nous verrons dans les sections suivantes que ces matrices sont utilisées pour évaluer le degré d’autocorrélation spatiale globale et locale. Or, il est fréquent de comparer les valeurs des mesures d’autocorrélation spatiale obtenues avec différentes matrices d’adjacence et de proximité (contiguïté selon le partage d’un nœud, d’une frontière commune; inverse de la distance, inverse de la distance au carré, etc.). Autrement dit, la standardisation des matrices de pondération spatiale permet de vérifier si le degré de (dis)ressemblance des entités spatiales en fonction d’une variable donnée est plus fort avec une matrice de contiguïté, d’inverse de la distance ou encore d’inverse de la distance au carré, etc.</p>
</div>
</div>
<p>Pour illustrer comment réaliser une standardisation, nous utilisons une couche géographique comprenant peu d’entités spatiales, soit celle des quatre arrondissements de la ville de Sherbrooke (<a href="#fig-Arrond">figure&nbsp;<span>2.9</span></a>).</p>
<div id="fig-Arrond" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/Arrondissements.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.9: Arrondissements de la ville de Sherbrooke</figcaption></figure>
</div>
<p>Au <a href="#tbl-StandardisationMatrice">tableau&nbsp;<span>2.2</span></a>, différentes matrices de contiguïté et de distance ont été calculées, puis standardisées. Voici comment interpréter les différentes sections du tableau&nbsp;:</p>
<ul>
<li><p><strong>Contiguïté selon le partage d’une frontière commune.</strong> La valeur de&nbsp;1 signale que deux arrondissements sont voisins, sinon la valeur est à&nbsp;0. Tel qu’indiqué aux <a href="#eq-ContiguiteQueen">équation&nbsp;<span>2.1</span></a> et <a href="#eq-ContiguiteRook">équation&nbsp;<span>2.2</span></a>, un arrondissement ne peut être voisin de lui-même (ex.: valeur de&nbsp;0 pour la cellule <code>Bro.</code> et <code>Bro.</code>). L’arrondissement de Brompton–Rock Forest–Saint-Élie–Deauville (<code>Bro.</code>) a deux voisins, soit ceux des Nations et de Fleurimont (<code>Nat.</code> et <code>Fle.</code>), comme indiqué par la valeur&nbsp;2 dans la colonne <code>total</code>. Par contre, les arrondissements des Nations et de Fleurimont sont voisins de tous les autres (valeur de&nbsp;3 dans la colonne <code>total</code>).</p></li>
<li><p><strong>Standardisation de la matrice de contiguïté.</strong> Il suffit de diviser chaque valeur de la matrice de contiguïté par la somme de la ligne correspondante. De la sorte, la somme de chaque ligne est égale à&nbsp;1 et la somme de l’ensemble des valeurs de la matrice est égale au nombre d’entités spatiales (ici&nbsp;4).</p></li>
<li><p><strong>Distance (km).</strong> Nous avons calculé la distance euclidienne en kilomètres entre les centroïdes des arrondissements.</p></li>
<li><p><strong>Inverse de la distance.</strong> Les valeurs sont obtenues avec la formule <span class="math inline">\(1/_{dij}\)</span>. Par exemple, entre <code>Bro.</code> et <code>Nat.</code>, nous avons <span class="math inline">\(1/7,9930 = 0,1251\)</span>.</p></li>
<li><p><strong>Inverse de la distance au carré.</strong> Les valeurs sont obtenues avec la formule <span class="math inline">\(1/_{dij^2}\)</span>. Par exemple, entre <code>Bro.</code> et <code>Nat.</code>, nous avons <span class="math inline">\(1/7,9930^2 = 0,0160\)</span>.</p></li>
<li><p><strong>Standardisation de l’inverse de la distance.</strong> Comme précédemment, il suffit de diviser chaque valeur de la matrice par la somme de la ligne correspondante. Par exemple, pour <code>Bro.</code> et <code>Nat.</code>, nous avons <span class="math inline">\(0,1251 / 0,3241 = 0,3860\)</span>. Remarquez que la somme des lignes est bien égale à&nbsp;1.</p></li>
<li><p><strong>Standardisation de l’inverse de la distance au carré.</strong> Comme précédemment, il suffit de diviser chaque valeur de la matrice par la somme de la ligne correspondante. Par exemple, pour <code>Bro.</code> et <code>Nat.</code>, nous avons <span class="math inline">\(0,0160 / 0,0360 = 0,4440\)</span>. Remarquez que la somme des lignes est bien égale à&nbsp;1.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-StandardisationMatrice" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.2: Standardisation de matrices de pondération spatiale</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Arrondissement</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bro.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Nat.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Len.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fle.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Somme (lignes)</th>
</tr></thead>
<tbody>
<tr class="odd" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Matrice de contiguïté selon le partage d'une frontière commune</strong></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">2,0000</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">3,0000</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">2,0000</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">1,0000</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">3,0000</td>
</tr>
<tr class="even" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Standardisation de la matrice de contiguïté</strong></td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,5000</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,5000</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,5000</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,5000</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="odd" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Distance (km)</strong></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">7,9930</td>
<td style="text-align: right;">18,9940</td>
<td style="text-align: right;">16,1140</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">7,9930</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">11,1190</td>
<td style="text-align: right;">9,1650</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">18,9940</td>
<td style="text-align: right;">11,1190</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">9,2590</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">16,1140</td>
<td style="text-align: right;">9,1650</td>
<td style="text-align: right;">9,2590</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Matrice selon l'inverse de la distance</strong></td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,1251</td>
<td style="text-align: right;">0,0526</td>
<td style="text-align: right;">0,0621</td>
<td style="text-align: right;">0,2398</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">0,1251</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,0899</td>
<td style="text-align: right;">0,1091</td>
<td style="text-align: right;">0,3241</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">0,0526</td>
<td style="text-align: right;">0,0899</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,1080</td>
<td style="text-align: right;">0,2505</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">0,0621</td>
<td style="text-align: right;">0,1091</td>
<td style="text-align: right;">0,1080</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,2792</td>
</tr>
<tr class="odd" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Matrice selon l'inverse de la distance au carré</strong></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,0160</td>
<td style="text-align: right;">0,0030</td>
<td style="text-align: right;">0,0040</td>
<td style="text-align: right;">0,0230</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">0,0160</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,0080</td>
<td style="text-align: right;">0,0120</td>
<td style="text-align: right;">0,0360</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">0,0030</td>
<td style="text-align: right;">0,0080</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,0120</td>
<td style="text-align: right;">0,0230</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">0,0040</td>
<td style="text-align: right;">0,0120</td>
<td style="text-align: right;">0,0120</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,0280</td>
</tr>
<tr class="even" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Standardisation de l'inverse de la distance</strong></td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,5220</td>
<td style="text-align: right;">0,2190</td>
<td style="text-align: right;">0,2590</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">0,3860</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,2770</td>
<td style="text-align: right;">0,3370</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">0,2100</td>
<td style="text-align: right;">0,3590</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,4310</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">0,2220</td>
<td style="text-align: right;">0,3910</td>
<td style="text-align: right;">0,3870</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="odd" data-grouplength="4">
<td colspan="6" style="border-bottom: 1px solid"><strong>Standardisation de l'inverse de la distance au carré</strong></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Bro.</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,6960</td>
<td style="text-align: right;">0,1300</td>
<td style="text-align: right;">0,1740</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Nat.</td>
<td style="text-align: right;">0,4440</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,2220</td>
<td style="text-align: right;">0,3330</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Len.</td>
<td style="text-align: right;">0,1300</td>
<td style="text-align: right;">0,3480</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">0,5220</td>
<td style="text-align: right;">1,0000</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1">Fle.</td>
<td style="text-align: right;">0,1430</td>
<td style="text-align: right;">0,4290</td>
<td style="text-align: right;">0,4290</td>
<td style="text-align: right;">0,0000</td>
<td style="text-align: right;">1,0000</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section><section id="sec-0224" class="level3" data-number="2.2.4"><h3 data-number="2.2.4" class="anchored" data-anchor-id="sec-0224">
<span class="header-section-number">2.2.4</span> Construction de matrices de pondération spatiale dans R</h3>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Construction des matrices dans R&nbsp; avec le <em>package</em><code>spdep</code></strong>.</p>
</div>
<div class="bloc_attention-body">
<p>Le package <code>spdep</code> dispose de différentes fonctions pour construire des matrices de contiguïté, de connectivité et de distance&nbsp;:</p>
<ul>
<li><p><code>poly2nb</code> pour des matrices de contiguïté (<a href="#sec-02241">section&nbsp;<span>2.2.4.1</span></a>);</p></li>
<li><p><code>nblag</code> et <code>nblag_cumul</code> pour des matrices de contiguïté avec des ordres d’adjacence (<a href="#sec-02242">section&nbsp;<span>2.2.4.2</span></a>);</p></li>
<li><p><code>dnearneigh</code> pour des matrices de connectivité (<a href="#sec-02243">section&nbsp;<span>2.2.4.3</span></a>);</p></li>
<li><p><code>as.matrix(dist(coords))</code> et <code>mat2listw</code> pour des matrices de distance (<a href="#sec-02244">section&nbsp;<span>2.2.4.4</span></a>);</p></li>
<li><p><code>knn2nb</code> pour des matrices selon le critère des plus proches voisins (<a href="#sec-02245">section&nbsp;<span>2.2.4.5</span></a>).</p></li>
</ul>
</div>
</div>
<section id="sec-02241" class="level4" data-number="2.2.4.1"><h4 data-number="2.2.4.1" class="anchored" data-anchor-id="sec-02241">
<span class="header-section-number">2.2.4.1</span> Matrices de pondération spatiale selon la contiguïté</h4>
<p>Pour créer des matrices de pondération spatiale selon la contiguïté décrites à la <a href="#sec-0221">section&nbsp;<span>2.2.1</span></a>, nous utilisons deux fonctions du <em>package</em> <code>spdep</code>&nbsp;:</p>
<ul>
<li><p><code>poly2nb(Nom de l'objet sf, queen=TRUE)</code> crée une matrice de contiguïté sous la forme d’une classe <code>nb</code> (<em>A neighbours list with class nb</em>). Avec le paramètre <code>queen=TRUE</code>, la contiguïté est évaluée selon le partage d’un nœud; avec <code>queen=FALSE</code>, la contiguïté est évaluée selon le partage d’un segment (frontière). La matrice spatiale comprend une ligne par secteur de recensement avec les index des polygones adjacents. Par exemple, <code>Queen[[1]]</code> renvoie la liste des polygones voisins à la première entité spatiale, soit <code>2 14 15 16 23 32</code>, c’est-à-dire six voisins.</p></li>
<li><p><code>nb2listw(objet nb, zero.policy=TRUE, style = "W")</code> crée une matrice de pondération spatiale à partir de n’importe quelle matrice spatiale (de contiguïté ou de distance). Le <code>paramètre style = "W"</code>, qui est par défaut, permet de standardiser la matrice en ligne. Par exemple, <code>W.Queen$weights[[1]]</code> renvoie les valeurs des pondérations pour la première entité spatiale, soit <code>0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667</code> (0,1666667 = 1&nbsp;/&nbsp;6 voisin). Pour obtenir une matrice non standardisée, vous devez écrire <code>style = "B"</code>, alors <code>W.Queen$weights[[1]]</code> renverra les valeurs de <code>1 1 1 1 1 1</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>    <span class="co"># pour importer des couches géographiques</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span> <span class="co"># pour construire les matrices de pondération</span></span>
<span><span class="co">## Importation de la couche des secteurs de recensement de la ville de Sherbrooke</span></span>
<span><span class="va">SR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap02/Recen2021Sherbrooke.gpkg"</span>,</span>
<span>              layer <span class="op">=</span> <span class="st">"DR_SherbSRDonnees2021"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Matrice selon le partage d'un nœud (Queen)</span></span>
<span><span class="co"># Création de la matrice spatiale</span></span>
<span><span class="va">Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">SR</span>, queen<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Affichage de la première ligne de la matrice</span></span>
<span><span class="va">Queen</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2 14 15 16 23 32</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Création de la matrice de pondération avec une standardisation en ligne</span></span>
<span><span class="va">W.Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co"># Affichage de la première ligne des pondérations</span></span>
<span><span class="va">W.Queen</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"La somme de la première ligne de la matrice de pondération est égale à"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">W.Queen</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La somme de la première ligne de la matrice de pondération est égale à 1</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice selon le partage d'un segment (Rook)</span></span>
<span><span class="va">Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">SR</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">W.Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">##  Comparaison des deux matrices de contiguïté</span></span>
<span><span class="co"># Résultat de la matrice de pondération (Queen)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">W.Queen</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 50 
Number of nonzero links: 272 
Percentage nonzero weights: 10.88 
Average number of links: 5.44 
Link number distribution:

 1  2  3  4  5  6  7  8 10 
 1  2  2  9 13  9  8  5  1 
1 least connected region:
41 with 1 link
1 most connected region:
29 with 10 links

Weights style: W 
Weights constants summary:
   n   nn S0      S1       S2
W 50 2500 50 20.3056 205.5251</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Résultat de la matrice de pondération (Rook)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">W.Rook</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 50 
Number of nonzero links: 248 
Percentage nonzero weights: 9.92 
Average number of links: 4.96 
Link number distribution:

 1  2  3  4  5  6  7  9 
 1  2  4  9 17 11  5  1 
1 least connected region:
41 with 1 link
1 most connected region:
29 with 9 links

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 50 2500 50 21.84674 205.0781</code></pre>
</div>
</div>
<p>La syntaxe ci-dessous permet de visualiser et de comparer les graphes selon le partage d’un nœud (<em>Queen</em>) ou d’un segment commun (<em>Rook</em>).</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># permet d'avoir quatre graphiques (2x2)</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Graphe selon le partage d'un nœud</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Queen</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Queen"</span>, font.main<span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Graphe selon le partage d'une frontière commune</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Rook</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Rook"</span>, font.main<span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-Autocorrelation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="sec-02242" class="level4" data-number="2.2.4.2"><h4 data-number="2.2.4.2" class="anchored" data-anchor-id="sec-02242">
<span class="header-section-number">2.2.4.2</span> Matrices de pondération spatiale selon la contiguïté et un ordre d’adjacence</h4>
<p>Pour décrire la construction des matrices de contiguïté avec un ordre d’adjacence (décrites à la <a href="#sec-0221">section&nbsp;<span>2.2.1</span></a>), nous utilisons une couche géographique comprenant peu d’entités spatiales, soit celle des quatre arrondissements de la ville de Sherbrooke (figure 1). Le code ci-dessous permet d’obtenir les résultats suivants&nbsp;:</p>
<ul>
<li><p><code>Rook &lt;- poly2nb(Arrondissements, queen=TRUE)</code>: matrice d’ordre&nbsp;1 selon le partage d’un segment.</p></li>
<li><p><code>str(Rook)</code>: pour chaque arrondissement, la liste des arrondissements adjacents d’ordre&nbsp;1.</p></li>
<li><p><code>Rook.Ordre2 &lt;- nblag(Rook, 2)</code>: création d’une matrice d’ordre&nbsp;2 avec la fonction <code>nblag</code>.</p></li>
<li><p><code>str(Rook.Ordre2[[1]])</code>: liste des voisins d’ordre&nbsp;1. Bien entendu, le résultat est identique à <code>str(Rook)</code>.</p></li>
<li><p><code>str(Rook.Ordre2[[2]])</code>: liste des voisins d’ordre&nbsp;2.</p></li>
<li><p><code>Rook.Ordre2Cumule &lt;- nblag_cumul(Rook.Ordre2)</code>: fusion des deux listes en une seule avec la fonction <code>nblag_cumul</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Arrondissements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/chap02/Arrondissements.shp"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Matrice de contiguïté d'ordre 1 selon le partage d'un segment (Rook)</span></span>
<span><span class="va">Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">Arrondissements</span>, queen<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Rook</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : int [1:2] 2 4
 $ : int [1:3] 1 3 4
 $ : int [1:2] 2 4
 $ : int [1:3] 1 2 3
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:4] "1" "2" "3" "4"
 - attr(*, "call")= language poly2nb(pl = Arrondissements, queen = TRUE)
 - attr(*, "type")= chr "queen"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice de contiguïté d'ordre 2 selon le partage d'un segment (Rook)</span></span>
<span><span class="va">Rook.Ordre2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Rook</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## Rook.Ordre2 comprend deux listes : l'une pour l'ordre 1 et l'autre pour l'autre 2.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Rook.Ordre2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : int [1:2] 2 4
 $ : int [1:3] 1 3 4
 $ : int [1:2] 2 4
 $ : int [1:3] 1 2 3
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:4] "1" "2" "3" "4"
 - attr(*, "call")= language poly2nb(pl = Arrondissements, queen = TRUE)
 - attr(*, "type")= chr "queen"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Rook.Ordre2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : int 3
 $ : int 0
 $ : int 1
 $ : int 0
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:4] "1" "2" "3" "4"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## La fonction nblag_cumul permet de combiner les deux ordres dans une seule liste</span></span>
<span><span class="va">Rook.Ordre2Cumule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="va">Rook.Ordre2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Rook.Ordre2Cumule</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : int [1:3] 2 3 4
 $ : int [1:3] 1 3 4
 $ : int [1:3] 1 2 4
 $ : int [1:3] 1 2 3
 - attr(*, "region.id")= chr [1:4] "1" "2" "3" "4"
 - attr(*, "call")= language nblag_cumul(nblags = Rook.Ordre2)
 - attr(*, "class")= chr "nb"</code></pre>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Création de la matrice de pondération spatiale standardisée</span></span>
<span><span class="va">WRook.Ordre2Cumule</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook.Ordre2Cumule</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <a href="#fig-ArrondOrdre1et2">figure&nbsp;<span>2.10</span></a> permet de constater qu’au second ordre, chacun des arrondissements est relié aux trois autres.</p>
<div id="fig-ArrondOrdre1et2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureOrdre1et2.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.10: Adjacence de premier et de second ordre</figcaption></figure>
</div>
<p>Reprenons la couche des secteurs de recensement de la ville de Sherbrooke pour construire des matrices d’adjacence d’ordre&nbsp;1 à&nbsp;3.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Création des matrices d'ordre 1, 2 et 3</span></span>
<span><span class="va">Queen1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">SR</span>, queen<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Queen2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Queen1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Queen3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Queen1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Création des matrices</span></span>
<span><span class="va">W.Queen1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.Queen2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen2</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.Queen3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen3</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-02243" class="level4" data-number="2.2.4.3"><h4 data-number="2.2.4.3" class="anchored" data-anchor-id="sec-02243">
<span class="header-section-number">2.2.4.3</span> Matrice de connectivité (matrice distance binaire)</h4>
<p>La fonction <code>dnearneigh(sf points, d1=, d2=)</code> crée une matrice de connectivité (décrite à la <a href="#sec-0222">section&nbsp;<span>2.2.2</span></a>) à partir d’une couche de points. Les paramètres <code>d1</code> et <code>d2</code> permettent de spécifier le rayon de recherche (ex.&nbsp;: avec <code>d1 = 0</code> et <code>d2 = 2500</code>, le seuil maximal de distance est de 2500&nbsp;mètres).</p>
<p>Si votre couche <code>sf</code> comprend des <code>lignes</code> ou des <code>polygones</code>, utilisez la fonction <code>st_centroid</code> ou <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_point_on_surface()</a></code> pour les convertir en points (<a href="01-ManipulationDonneesSpatiales.html#sec-0122">section&nbsp;<span>1.2.2</span></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Conversion des polygones en points avec st_centroid</span></span>
<span><span class="va">SR.centroides</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span></span>
<span><span class="co">## Matrice binaire avec un seuil de 2500 mètres</span></span>
<span><span class="va">Connect2500m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">SR.centroides</span>, d1 <span class="op">=</span> <span class="fl">0</span>, d2 <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span>
<span><span class="co">## Matrice de pondération spatiale standardisée en ligne</span></span>
<span><span class="va">W.Connect2500m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Connect2500m</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-02244" class="level4" data-number="2.2.4.4"><h4 data-number="2.2.4.4" class="anchored" data-anchor-id="sec-02244">
<span class="header-section-number">2.2.4.4</span> Matrices de pondération spatiale selon l’inverse de la distance et l’inverse de la distance au carré</h4>
<p>Dans la <a href="#sec-0223">section&nbsp;<span>2.2.3</span></a>, nous avons présenté les matrices de l’inverse de la distance et de l’inverse de la distance au carré. Le code ci-dessous, qui permet de les créer, comprend les étapes suivantes&nbsp;:</p>
<ul>
<li><p>Récupération des coordonnées géographiques des entités spatiales.</p></li>
<li><p>Création de la matrice de distance euclidienne <span class="math inline">\(n \times n\)</span> (<span class="math inline">\(n\)</span> étant le nombre d’entités spatiales de la couche).</p></li>
<li><p>Calcul des matrices d’inverse de la distance et d’inverse de la distance au carré.</p></li>
<li><p>Standardisation de ces deux matrices et transformation dans des objets <code>listw</code> avec la fonction <code>mat2listw</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Coordonnées des centroïdes des entités spatiales</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">SR.centroides</span><span class="op">)</span></span>
<span><span class="co">## Création de la matrice de distance</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">coords</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># S'assurer que la diagonale de la matrice est à 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">## Matrices inverse de la distance et inverse de la distance au carré</span></span>
<span><span class="va">InvDistances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span>, <span class="va">distances</span><span class="op">)</span></span>
<span><span class="va">InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span><span class="op">^</span><span class="fl">2</span>, <span class="va">distances</span><span class="op">)</span></span>
<span><span class="co">## Matrices de pondération spatiale standardisées en ligne</span></span>
<span><span class="va">W_InvDistances</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances2</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Visualisation des valeurs des pondération pour la première entité spatiale</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">W_InvDistances</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="fl">4</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.0688 0.0505 0.0377 0.0330 0.0220 0.0191 0.0152 0.0116 0.0155 0.0220
[11] 0.0303 0.0382 0.0582 0.0677 0.0661 0.0366 0.0373 0.0316 0.0248 0.0123
[21] 0.0178 0.0241 0.0055 0.0084 0.0083 0.0084 0.0106 0.0232 0.0125 0.0231
[31] 0.0425 0.0192 0.0164 0.0049 0.0086 0.0071 0.0062 0.0061 0.0054 0.0049
[41] 0.0078 0.0050 0.0032 0.0043 0.0036 0.0030 0.0035 0.0042 0.0037</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># La somme de la ligne est bien égale à 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">W_InvDistances</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="bloc_astuce">
<div class="bloc_astuce-header">
<div class="bloc_astuce-icon">

</div>
<p><strong>Intégration d’autres types de distance</strong></p>
</div>
<div class="bloc_astuce-body">
<p>À la <a href="#sec-02221">section&nbsp;<span>2.2.2.1</span></a>, nous avons vu que plusieurs types de distances peuvent être utilisés&nbsp;: cartésiennes (euclidienne et de Manhattan) et réticulaires (chemin le plus rapide à pied, à vélo, en automobile et en transport en commun).</p>
<p>Pour construire une matrice de distance de Manhattan, vous devez changer la valeur du paramètre <code>method</code> de la fonction <code>dist</code> comme suit&nbsp;: <code>as.matrix(dist(coords, method = "manhattan"))</code>.</p>
<p>Pour intégrer une distance réticulaire, vous devez la calculer, soit dans R (<a href="05-AnalyseReseau.html">chapitre&nbsp;<span>5</span></a>), soit dans un logiciel SIG (ArcGIS&nbsp;Pro avec l’extension <em>Network Analyst</em> par exemple) et l’importer dans R. Le reste du code sera alors identique.</p>
</div>
</div>
<p>Nous avons vu qu’il est possible d’utiliser une matrice de distance en fixant une distance maximale au-delà de laquelle les pondérations sont mises à 0 (<a href="#eq-MatriceDistance2">équation&nbsp;<span>2.9</span></a> à la <a href="#sec-02221">section&nbsp;<span>2.2.2.1</span></a>). Le code ci-dessous permet de créer des matrices de pondération standardisées avec l’inverse de la distance et l’inverse de la distance au carré avec des seuils de 2500 et de 5000&nbsp;mètres.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Coordonnées des centroïdes des entités spatiales</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">SR.centroides</span><span class="op">)</span></span>
<span><span class="co">## Création de la matrice de distance</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">coords</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Création de différentes matrices avec différents seuils</span></span>
<span><span class="va">InvDistances.2500m</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">2500</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">InvDistances.5000m</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">5000</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">InvDistances2.2500m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">2500</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">InvDistances2.5000m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">5000</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## Matrices de pondération spatiale standardisées en ligne</span></span>
<span><span class="va">W_InvDistances.2500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances.2500m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_InvDistances.5000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances.5000m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_InvDistances2.2500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances2.2500m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_InvDistances2.5000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances2.5000m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Spécifier un seuil de distance peut toutefois être problématique. Par exemple, sur les 50&nbsp;secteurs de recensement de la ville de Sherbrooke, 19&nbsp;n’ont pas de voisins à 2500&nbsp;mètres, indiqués par le résultat suivant&nbsp;:</p>
<p><code>## 19 regions with no links:</code></p>
<p><code>## 23 24 25 30 34 35 36 37 38 39 40 41 42 43 44 45 47 49 50</code></p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">W_InvDistances.2500</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 50 
Number of nonzero links: 188 
Percentage nonzero weights: 7.52 
Average number of links: 3.76 
19 regions with no links:
23 24 25 30 34 35 36 37 38 39 40 41 42 43 44 45 47 49 50
Link number distribution:

 0  1  2  3  4  6  7  8  9 10 11 12 13 
19  6  2  2  4  2  2  3  4  1  2  1  2 
6 least connected regions:
21 26 31 33 46 48 with 1 link
2 most connected regions:
12 13 with 13 links

Weights style: W 
Weights constants summary:
   n  nn S0       S1       S2
W 31 961 31 19.09079 128.6954</code></pre>
</div>
</div>
<p>Même avec un seuil de 5000&nbsp;mètres, il reste encore 11&nbsp;SR sans voisins.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">W_InvDistances.5000</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 50 
Number of nonzero links: 532 
Percentage nonzero weights: 21.28 
Average number of links: 10.64 
11 regions with no links:
35 36 37 39 40 41 42 43 47 49 50
Link number distribution:

 0  1  2  3  5  6  7  8  9 10 11 16 18 19 20 21 22 23 
11  2  2  4  2  1  1  2  1  1  1  2  2  4  2  4  7  1 
2 least connected regions:
24 30 with 1 link
1 most connected region:
12 with 23 links

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 39 1521 39 12.11283 162.9801</code></pre>
</div>
</div>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Réduction de la taille des matrices de distance</strong></p>
</div>
<div class="bloc_attention-body">
<p>Plusieurs logiciels (notamment ArcGIS&nbsp;Pro et GeoDa) réduisent par défaut la taille des matrices de distance de la façon suivante&nbsp;: 1)&nbsp;construction d’une matrice de distance uniquement pour l’entité la plus proche (la matrice résultante est donc de dimension <span class="math inline">\(n \times 1\)</span>); 2)&nbsp;obtention de la distance maximale dans cette matrice, soit la distance la plus grande entre une entité spatiale et celle la plus proche; 3)&nbsp;construction de la matrice de distance finale avec comme seuil la distance maximale obtenue à l’étape précédente.</p>
<p>Cette réduction procure deux avantages importants&nbsp;:</p>
<ul>
<li><p><strong>Une diminution considérable des temps de calcul</strong>, surtout pour les couches géographiques comprenant un nombre très élevé d’entités spatiales. Par exemple, avec une couche de 50&nbsp;entités spatiales, la matrice des distances comprendra 2500 valeurs (50&nbsp;<span class="math inline">\(\times\)</span>&nbsp;50&nbsp;=&nbsp;2500) tandis qu’avec 1000&nbsp;entités spatiales, elle en comprendra un million (1000&nbsp;<span class="math inline">\(\times\)</span>&nbsp;1000&nbsp;=&nbsp;1&nbsp;000&nbsp;000).</p></li>
<li><p>Comme décrit plus haut, il est préférable d’<strong>éviter d’avoir une matrice de distance avec des entités spatiales sans voisins</strong>, puisque cela a un impact négatif sur les mesures d’autocorrélation spatiale.</p></li>
</ul>
</div>
</div>
<p>La syntaxe ci-dessous permet ainsi de construire des matrices de pondération (inverse de la distance et inverse de la distance au carré) à partir de la distance maximale et un SR et son voisin le plus proche.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Coordonnées des centroïdes des entités spatiales</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">SR.centroides</span><span class="op">)</span></span>
<span><span class="co">## Trouver le plus proche voisin</span></span>
<span><span class="va">k1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Affichage des distances pour les 50 SR au le plus proche</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">k1</span>,<span class="va">coords</span><span class="op">)</span><span class="op">)</span>,<span class="fl">0</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1352   563   563   659   833  1275  1275  1299  2136  1553  1171   833
[13]   953   953  1024  1024   936   936  1149  1242  2378  1473  3863  4963
[25]  2841  1755  1755  2294  1507  4002  1843  1710  2486  2977 10953  6965
[37]  5331  4077  6717  6892  6892  6335  5639  3530  4202  1636  6662  1636
[49] 10745 10034</code></pre>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Trouver la distance maximale       </span></span>
<span><span class="va">plusprochevoisin.max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">k1</span>,<span class="va">coords</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Distance maximale au plus proche voisin :"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">plusprochevoisin.max</span>,<span class="fl">0</span><span class="op">)</span>, <span class="st">"mètres"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Distance maximale au plus proche voisin : 10953 mètres</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice de distance avec la valeur maximale</span></span>
<span><span class="co"># les voisins les plus proches avec le seuil de distance maximal</span></span>
<span><span class="va">Voisins.DistMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">coords</span>, <span class="fl">0</span>, <span class="va">plusprochevoisin.max</span><span class="op">)</span></span>
<span><span class="co"># Distances avec le seuil maximum</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">Voisins.DistMax</span>, <span class="va">coords</span><span class="op">)</span></span>
<span><span class="co"># Inverse de la distance</span></span>
<span><span class="va">InvDistances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">distances</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Inverse de la distance au carré</span></span>
<span><span class="va">InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">distances</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrices de pondération spatiale standardisées en ligne</span></span>
<span><span class="va">W_InvDistances</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Voisins.DistMax</span>, glist <span class="op">=</span> <span class="va">InvDistances</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Voisins.DistMax</span>, glist <span class="op">=</span> <span class="va">InvDistances2</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-02245" class="level4" data-number="2.2.4.5"><h4 data-number="2.2.4.5" class="anchored" data-anchor-id="sec-02245">
<span class="header-section-number">2.2.4.5</span> Matrices de pondération spatiale selon le critère des plus proches voisins</h4>
<p>La fonction <code>knearneigh</code> du <em>package</em> <code>spdep</code> crée des matrices de distance selon le critère des plus proches voisins (décrit à la <a href="#sec-02224">section&nbsp;<span>2.2.2.4</span></a>), dont le nombre est fixé avec le paramètre <code>k</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Coordonnées géographiques des centroïdes des polygones</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrices des plus proches voisins de 2 à 5</span></span>
<span><span class="va">k2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrices de pondération spatiale standardisées en ligne</span></span>
<span><span class="va">W.k2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k2</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.k3</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k3</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.k4</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k4</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.k5</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k5</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La syntaxe ci-dessous permet de comparer les matrices des plus proches voisins de <em>k</em>&nbsp;=&nbsp;2 à 5 (<a href="#fig-PlusProcheVoisins">figure&nbsp;<span>2.11</span></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">k2</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"k = 2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">k3</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"k = 3"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">k4</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"k = 4"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">SR</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"gray"</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">k5</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"k = 5"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-PlusProcheVoisins" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigurePlusProcheVoisins.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.11: Matrices selon le critère des plus proches voisins</figcaption></figure>
</div>
</section></section></section><section id="sec-023" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="sec-023">
<span class="header-section-number">2.3</span> Autocorrélation spatiale globale</h2>
<p>Dans le cadre de cette section, nous présentons uniquement les mesures d’autocorrélation spatiale globale les plus utilisées, à savoir le <em>I</em> de Moran pour évaluer l’autocorrélation spatiale d’une variable continue (<a href="#sec-0231">section&nbsp;<span>2.3.1</span></a>), les statistiques de comptage de jointure (<em>Join Count Statistics</em>) pour une variable binaire ou catégorielle (<a href="#sec-0232">section&nbsp;<span>2.3.2</span></a>) et l’indice de Lee pour évaluer l’autocorrélation spatiale de deux variables continues (<a href="#sec-0233">section&nbsp;<span>2.3.3</span></a>).</p>
<section id="sec-0231" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="sec-0231">
<span class="header-section-number">2.3.1</span> Statistique du <em>I</em> de Moran</h3>
<section id="sec-02311" class="level4" data-number="2.3.1.1"><h4 data-number="2.3.1.1" class="anchored" data-anchor-id="sec-02311">
<span class="header-section-number">2.3.1.1</span> Formulation du <em>I</em> de Moran</h4>
<p>Pour évaluer le degré d’autocorrélation spatiale d’une variable continue, les deux principales statistiques utilisées sont le <em>I</em> de Moran <span class="citation" data-cites="moran1950test">(<a href="references.html#ref-moran1950test" role="doc-biblioref">1950</a>)</span> et le <em>c</em> de Geary <span class="citation" data-cites="geary1954contiguity">(<a href="references.html#ref-geary1954contiguity" role="doc-biblioref">1954</a>)</span>. Puisqu’elles renvoient une seule valeur pour la variable continue de la couche géographique étudiée, elles sont qualifiées de mesures globales de l’autocorrélation spatiale, par opposition aux mesures locales qui renvoient une valeur par entité spatiale (<a href="#sec-024">section&nbsp;<span>2.4</span></a>).</p>
<p>Nous présentons ici uniquement le <em>I</em> de Moran pour deux raisons principales. Premièrement, étant basée sur la covariance, son interprétation est bien plus facile que celle du <em>c</em> de Geary (basé sur la variance des écarts), c’est-à-dire qu’elle est très similaire au bien connu <a href="https://laeq.github.io/LivreMethoQuantBolR/sect043.html">coefficient de corrélation de Pearson</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>. Deuxièmement, elle constitue la mesure la plus utilisée. Le <em>I</em> de Moran s’écrit&nbsp;:</p>
<p><span id="eq-MoranIa"><span class="math display">\[
I = \frac{n}{\Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij}} \frac{\Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij}(x_i-\bar{x})(x_j-\bar{x})}{\Sigma_{i=1}^n (x_i-\bar{x})^2} \text{ avec :}
\tag{2.10}\]</span></span></p>
<ul>
<li><p><em>n</em>, le nombre d’entités spatiales dans la couche géographique;</p></li>
<li><p><span class="math inline">\(w_{ij}\)</span>, la valeur de la pondération spatiale entre les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>;</p></li>
<li><p><span class="math inline">\(x_i\)</span> et <span class="math inline">\(x_j\)</span>, les valeurs de la variable continue pour les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>;</p></li>
<li><p><span class="math inline">\(\bar{x}\)</span>, la valeur moyenne de la variable <span class="math inline">\(X\)</span> à l’étude.</p></li>
</ul>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Standardisation de la matrice de pondération et <em>I</em> de Moran</strong></p>
</div>
<div class="bloc_notes-body">
<p>Nous avons vu que si la matrice de pondération spatiale est standardisée en ligne (<a href="#sec-0223">section&nbsp;<span>2.2.3</span></a>), alors chaque ligne de la matrice vaut&nbsp;1 et la somme de l’ensemble des valeurs de la matrice est égale au nombre d’entités spatiales (<span class="math inline">\(n\)</span>). Or, dans l’<a href="#eq-MoranIa">équation&nbsp;<span>2.10</span></a>), <span class="math inline">\(\Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij}\)</span> représente la somme des pondérations de la matrice, soit <span class="math inline">\(n\)</span> si elles sont standardisées en ligne. Puisque <span class="math inline">\(\frac{n}{n}=1\)</span>, alors l’équation du <em>I</em> de Moran est simplifiée comme suit&nbsp;:</p>
<p><span id="eq-MoranIb"><span class="math display">\[
I = \frac{\Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij}(x_i-\bar{x})(x_j-\bar{x})}{\Sigma_{i=1}^n (x_i-\bar{x})^2}
\tag{2.11}\]</span></span></p>
<p>Comme évoqué dans la <a href="#sec-0223">section&nbsp;<span>2.2.3</span></a>, cela démontre l’intérêt de la standardisation&nbsp;: la comparaison des valeurs du <em>I</em> de Moran obtenues avec différentes matrices de contiguïté afin de sélectionner (éventuellement) celle avec laquelle la dépendance spatiale est la plus forte.</p>
</div>
</div>
</section><section id="sec-02312" class="level4" data-number="2.3.1.2"><h4 data-number="2.3.1.2" class="anchored" data-anchor-id="sec-02312">
<span class="header-section-number">2.3.1.2</span> Interprétation du <em>I</em> de Moran</h4>
<p>Avec une matrice standardisée, la statistique du <em>I</em> de Moran varie de -1 à 1 et s’interprète de la façon suivante :</p>
<ul>
<li><p>quand <span class="math inline">\(I &gt; 0\)</span>, l’autocorrélation est positive, c’est-à-dire que les entités géographiques ont tendance à se ressembler d’autant plus qu’elles sont voisines ou proches;</p></li>
<li><p>quand <span class="math inline">\(I = 0\)</span>, l’autocorrélation est nulle, c’est-à-dire que la contiguïté ou la proximité spatiale des zones ne jouent aucun rôle;</p></li>
<li><p>quand <span class="math inline">\(I &lt; 0\)</span>, l’autocorrélation est négative, c’est-à-dire que les entités géographiques ont tendance à être dissemblables d’autant plus qu’elles sont voisines ou proches.</p></li>
</ul>
<p>Les limites de -1 et 1 sont les maximums théoriques du <em>I</em> de Moran. Dans la pratique, elles sont limitées par la matrice spatiale utilisée dans le calcul. En effet, selon la matrice spatiale, le maximum du <em>I</em> de Moran peut être inférieur à 1, et son minimum supérieur à -1. Le calcul de ces bornes propres à chaque matrice spatiale peut se faire en utilisant les maximums et minimums des valeurs propres de <span class="math inline">\(\frac{W+W^T}{2}\)</span>, quand la matrice spatiale est standardisée.</p>
<p>À titre d’exemple, nous calculons ci-dessous les maximums et minimums possibles pour une matrice de contiguïté selon le partage d’un nœud (<em>Queen</em>) de nos secteurs de recensement.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Matrice de contiguïté selon le partage d'un nœud (Queen)</span></span>
<span><span class="va">Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">SR</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">WQueen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, style <span class="op">=</span> <span class="st">'W'</span><span class="op">)</span></span>
<span><span class="va">QueenMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2mat.html">listw2mat</a></span><span class="op">(</span><span class="va">WQueen</span><span class="op">)</span></span>
<span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="op">(</span><span class="va">QueenMat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">QueenMat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">values</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.74  1.02</code></pre>
</div>
</div>
<p>Il apparaît ainsi que pour la matrice matrice de contiguïté selon le partage d’un nœud (<em>Queen</em>), quelle soit la variable analysée, la valeur de <em>I</em> de Moran ne pourra pas dépasser les limites -0,74 et 1,02.</p>
</section><section id="sec-02313" class="level4" data-number="2.3.1.3"><h4 data-number="2.3.1.3" class="anchored" data-anchor-id="sec-02313">
<span class="header-section-number">2.3.1.3</span> Significativité du <em>I</em> de Moran</h4>
<p>Comme pour le coefficient de corrélation calculé entre deux variables, il est possible de tester la significativité de la valeur du <em>I</em> de Moran obtenue. Sans que nous détaillions les calculs de significativité, notez qu’il existe trois manières de tester la significativité :</p>
<ul>
<li><p>selon l’hypothèse de la normalité;</p></li>
<li><p>selon l’hypothèse de la randomisation;</p></li>
<li><p>selon des permutations Monte-Carlo (habituellement avec 999 échantillons).</p></li>
</ul>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Comment calculer les trois tests de significativité du <em>I</em> de Moran?</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Pour une description détaillée du calcul des trois tests, consultez l’ouvrage de Jean Dubé et Diego Legros <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014</a>)</span>.</p>
</div>
</div>
</section><section id="sec-02314" class="level4" data-number="2.3.1.4"><h4 data-number="2.3.1.4" class="anchored" data-anchor-id="sec-02314">
<span class="header-section-number">2.3.1.4</span> Mise en œuvre dans R</h4>
<div class="bloc_objectif">
<div class="bloc_objectif-header">
<div class="bloc_objectif-icon">

</div>
<p><strong>Calcul du <em>I</em> de Moran dans R</strong></p>
</div>
<div class="bloc_objectif-body">
<p>Pour illustrer le calcul de <em>I</em> de Moran dans R, nous utilisons une couche des aires de diffusion (AD) de la ville de Sherbrooke. Les étapes suivantes sont réalisées :</p>
<ol type="1">
<li>Construire une panoplie de matrices de pondération spatiale selon la contiguïté, la connectivité, la proximité et le critère des plus proches voisins.</li>
<li>Comparer les valeurs de significativité (<em>p</em>) pour une variable continue (<code>HabKm2</code>).</li>
<li>Pour cette même variable, trouver avec quelle matrice la valeur du <em>I</em> de Moran est la plus forte.</li>
<li>Comparer les valeurs du <em>I</em> de Moran calculées sur plusieurs variables.</li>
</ol>
</div>
</div>
<section id="sec-023141" class="level5" data-number="2.3.1.4.1"><h5 data-number="2.3.1.4.1" class="anchored" data-anchor-id="sec-023141">
<span class="header-section-number">2.3.1.4.1</span> Étape 1. Construction des matrices de pondération spatiale</h5>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span>
<span><span class="co">## Importation de la couche des aires de diffusion de la ville de Sherbrooke</span></span>
<span><span class="va">AD.DR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/chap02/Recen2021Sherbrooke.gpkg"</span>,</span>
<span>              layer <span class="op">=</span> <span class="st">"DR_SherbADDonnees2021"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Matrices de contiguïté</span></span>
<span><span class="co">##############################################</span></span>
<span><span class="co">## Partage d'un nœud (Queen)</span></span>
<span><span class="va">Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">AD.DR</span>, queen<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">W.Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Partage d'un segment (Rook)</span></span>
<span><span class="va">Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">AD.DR</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">W.Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Partage d'un segment (Rook) et ordres d'adjacence de 2 à 5</span></span>
<span><span class="va">Rook2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Rook</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Rook3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Rook</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Rook4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Rook</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Rook5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag_cumul</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Rook</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">W.Rook2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook2</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.Rook3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook3</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.Rook4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook4</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.Rook5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook5</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Matrice de connectivité</span></span>
<span><span class="co">##############################################</span></span>
<span><span class="co">## Matrice binaire avec un seuil de 2500 mètres</span></span>
<span><span class="va">Connect2500m</span> <span class="op">&lt;-</span>   <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span>, d1 <span class="op">=</span> <span class="fl">0</span>, d2 <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span>
<span><span class="va">W.Connect2500m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Connect2500m</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Matrices de proximité</span></span>
<span><span class="co">##############################################</span></span>
<span><span class="co">## Coordonnées géographiques et matrice de distance</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">coords</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">## Matrices inverse de la distance et inverse de la distance au carré</span></span>
<span><span class="va">InvDistances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span>, <span class="va">distances</span><span class="op">)</span></span>
<span><span class="va">InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span><span class="op">^</span><span class="fl">2</span>, <span class="va">distances</span><span class="op">)</span></span>
<span><span class="co">## Matrices de pondération spatiale standardisées en ligne</span></span>
<span><span class="va">W.InvDistances</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances2</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Création de différentes matrices avec différents seuils</span></span>
<span><span class="va">InvDistances.2500m</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">2500</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">InvDistances.5000m</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">5000</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">InvDistances2.2500m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">2500</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">InvDistances2.5000m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distances</span><span class="op">&lt;=</span><span class="fl">5000</span> <span class="op">&amp;</span> <span class="va">distances</span><span class="op">!=</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="va">distances</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">W.InvDistances_2500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances.2500m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.InvDistances_5000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances.5000m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.InvDistances2_2500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances2.2500m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.InvDistances2_5000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/mat2listw.html">mat2listw</a></span><span class="op">(</span><span class="va">InvDistances2.5000m</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Matrice de distance réduite standardisée</span></span>
<span><span class="va">k1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plusprochevoisin.max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">k1</span>,<span class="va">coords</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Voisins.DistMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">coords</span>, <span class="fl">0</span>, <span class="va">plusprochevoisin.max</span><span class="op">)</span>                            </span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">Voisins.DistMax</span>, <span class="va">coords</span><span class="op">)</span></span>
<span><span class="va">InvDistances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">distances</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">InvDistances2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">distances</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">W_InvDistancesReduite</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Voisins.DistMax</span>, glist <span class="op">=</span> <span class="va">InvDistances</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_InvDistances2Reduite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Voisins.DistMax</span>, glist <span class="op">=</span> <span class="va">InvDistances2</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Matrice selon le critère des plus proches voisins</span></span>
<span><span class="co">#####################################################</span></span>
<span><span class="co">## Matrices des plus proches voisins de 2 à 5</span></span>
<span><span class="va">k2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Matrices de pondération spatiale standardisées en ligne</span></span>
<span><span class="va">W.k2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k2</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.k3</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k3</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.k4</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k4</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W.k5</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">k5</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-023142" class="level5" data-number="2.3.1.4.2"><h5 data-number="2.3.1.4.2" class="anchored" data-anchor-id="sec-023142">
<span class="header-section-number">2.3.1.4.2</span> Étape 2. Calcul du <em>I</em> de Moran et des trois tests de significativité</h5>
<p>Calculons la statistique du <em>I</em> de Moran sur la variable continue cartographiée à la <a href="#fig-CartoADDRSherbrooke">figure&nbsp;<span>2.12</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-CartoADDRSherbrooke" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-CartoADDRSherbrooke-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.12: Densité de population, aires de diffusion de la ville de Sherbrooke</figcaption></figure>
</div>
</div>
</div>
<p>Les fonctions <code>moran.test</code> et <code>moran.mc</code> du <em>package</em> <code>spdep</code> permettent de calculer le <em>I</em> de Moran selon les trois façons de tester la significativité&nbsp;:</p>
<ul>
<li>
<p>selon l’hypothèse de la normalité avec le paramètre <code>randomisation = FALSE</code></p>
<ul>
<li><code>moran.test(ObjetSf$Variable, listw=MatriceW, zero.policy=TRUE, randomisation = FALSE)</code></li>
</ul>
</li>
<li>
<p>selon l’hypothèse de la randomisation avec le paramètre <code>randomisation = TRUE</code></p>
<ul>
<li><code>moran.test(ObjetSf$Variable, listw=MatriceW, zero.policy=TRUE, randomisation = TRUE)</code></li>
</ul>
</li>
<li>
<p>selon des permutations Monte-Carlo (ci-dessus avec 999&nbsp;permutations)</p>
<ul>
<li><code>moran.mc(ObjetSf$Variable, listw=MatriceW, zero.policy=TRUE, nsim=999)</code></li>
</ul>
</li>
</ul>
<p>Bien entendu, dans les sorties des trois méthodes, la valeur du <em>I</em> de Moran est la même, contrairement à la valeur de <em>p</em> qui peut varier.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">HabKm2</span>,          <span class="co"># nom de l'objet sf et de la variable continue</span></span>
<span>           listw<span class="op">=</span><span class="va">W.Queen</span>,         <span class="co"># nom de la matrice de pondération spatiale</span></span>
<span>           zero.policy<span class="op">=</span><span class="cn">TRUE</span>,    </span>
<span>           randomisation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># significativité selon l’hypothèse de la normalité</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under normality

data:  AD.DR$HabKm2  
weights: W.Queen    

Moran I statistic standard deviate = 11.724, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.433714579      -0.004032258       0.001394035 </code></pre>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">HabKm2</span>,          <span class="co"># nom de l'objet sf et de la variable continue</span></span>
<span>           listw<span class="op">=</span><span class="va">W.Queen</span>,         <span class="co"># nom de la matrice de pondération spatiale</span></span>
<span>           zero.policy<span class="op">=</span><span class="cn">TRUE</span>,    </span>
<span>           randomisation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># significativité selon l’hypothèse de la randomisation</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  AD.DR$HabKm2  
weights: W.Queen    

Moran I statistic standard deviate = 11.761, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.433714579      -0.004032258       0.001385364 </code></pre>
</div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">HabKm2</span>,            <span class="co"># nom de l'objet sf et de la variable continue</span></span>
<span>         listw<span class="op">=</span><span class="va">W.Queen</span>,           <span class="co"># nom de la matrice de pondération spatiale </span></span>
<span>         zero.policy<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>         nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span>                <span class="co"># 999 permutations</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  AD.DR$HabKm2 
weights: W.Queen  
number of simulations + 1: 1000 

statistic = 0.43371, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Nous calculons la mesure du <em>I</em> de Moran sur la variable continue cartographiée à la <a href="#fig-IMoranLoiNormale">figure&nbsp;<span>2.13</span></a>.</p>
<p>La statistique du <em>I</em> de Moran (<em>I</em> = 0,43, <em>p</em>&nbsp;&lt;&nbsp;0,001) indique que la variable <em>densité de population</em> a une forte autocorrélation spatiale positive (<a href="#fig-IMoranLoiNormale">figure&nbsp;<span>2.13</span></a>), avec des valeurs fortes dans les aires de diffusion contiguës dans la partie centrale de la ville et des valeurs faibles dans les aires de diffusion contiguës dans les secteurs périphériques (<a href="#fig-CartoADDRSherbrooke">figure&nbsp;<span>2.12</span></a>).</p>
<div id="fig-IMoranLoiNormale" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/IdeMoran.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.13: Résultats du <em>I</em> de Moran selon l’hypothèse de la loi normale</figcaption></figure>
</div>
</section><section id="sec-023143" class="level5" data-number="2.3.1.4.3"><h5 data-number="2.3.1.4.3" class="anchored" data-anchor-id="sec-023143">
<span class="header-section-number">2.3.1.4.3</span> Étape 3. Identification de la plus forte autocorrélation spatiale selon les différentes matrices</h5>
<p>La syntaxe ci-dessous permet de calculer la statistique du <em>I</em> de Moran avec plusieurs matrices de pondération spatiale.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Création d'un vecteur pour les noms des matrices</span></span>
<span><span class="va">VecteurMatrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"W.Queen"</span>, <span class="st">"W.Rook"</span>, <span class="st">"W.Rook2"</span>, <span class="st">"W.Rook3"</span>, <span class="st">"W.Rook4"</span>, <span class="st">"W.Rook5"</span>,</span>
<span>                     <span class="st">"W.Connect2500m"</span>,</span>
<span>                     <span class="st">"W.InvDistances"</span>, <span class="st">"W.InvDistances2"</span>,</span>
<span>                     <span class="st">"W_InvDistancesReduite"</span>, <span class="st">"W_InvDistances2Reduite"</span>,</span>
<span>                     <span class="st">"W.InvDistances_2500"</span>, <span class="st">"W.InvDistances_5000"</span>,</span>
<span>                     <span class="st">"W.InvDistances2_2500"</span>,<span class="st">"W.InvDistances2_5000"</span>,</span>
<span>                     <span class="st">"W.k2"</span>, <span class="st">"W.k3"</span>, <span class="st">"W.k4"</span>, <span class="st">"W.k5"</span><span class="op">)</span></span>
<span><span class="co">## Création d'une liste pour toutes les matrices</span></span>
<span><span class="va">ListeMatrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">W.Queen</span>, <span class="va">W.Rook</span>, <span class="va">W.Rook2</span>, <span class="va">W.Rook3</span>, <span class="va">W.Rook4</span>, <span class="va">W.Rook5</span>,</span>
<span>                      <span class="va">W.Connect2500m</span>,</span>
<span>                      <span class="va">W.InvDistances</span>, <span class="va">W.InvDistances2</span>,</span>
<span>                      <span class="va">W_InvDistancesReduite</span>, <span class="va">W_InvDistances2Reduite</span>,</span>
<span>                      <span class="va">W.InvDistances_2500</span>, <span class="va">W.InvDistances2_2500</span>,</span>
<span>                      <span class="va">W.InvDistances2_2500</span>, <span class="va">W.InvDistances2_5000</span>,</span>
<span>                      <span class="va">W.k2</span>, <span class="va">W.k3</span>, <span class="va">W.k4</span>, <span class="va">W.k5</span><span class="op">)</span></span>
<span><span class="co">## Vecteur pour le I de Moran et la valeur de p</span></span>
<span><span class="va">MoranI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">i</span><span class="op">&lt;-</span><span class="fl">0</span></span>
<span><span class="co">## Boucle pour calculer le I de Moran avec la liste des matrices</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">ListeMatrices</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="va">i</span><span class="op">&lt;-</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span></span>
<span>   <span class="va">Test</span> <span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">HabKm2</span>,</span>
<span>                   listw<span class="op">=</span><span class="va">e</span>, </span>
<span>                   zero.policy<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                   nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span>   <span class="va">MoranI</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">Test</span><span class="op">$</span><span class="va">statistic</span></span>
<span>   <span class="va">Pvalue</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Test</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Création d'un DataFrame avec les valeurs du I de Moran et de p</span></span>
<span><span class="va">MoranData1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Matrices<span class="op">=</span><span class="va">VecteurMatrices</span>,</span>
<span>                         MoranIs<span class="op">=</span><span class="va">MoranI</span>,</span>
<span>                         Pvalues<span class="op">=</span><span class="va">Pvalue</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">MoranData1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Matrices    MoranIs Pvalues
1                 W.Queen 0.43371458   0.001
2                  W.Rook 0.44970946   0.001
3                 W.Rook2 0.32509097   0.001
4                 W.Rook3 0.21527754   0.001
5                 W.Rook4 0.12614476   0.001
6                 W.Rook5 0.07129756   0.001
7          W.Connect2500m 0.25583250   0.001
8          W.InvDistances 0.10632882   0.001
9         W.InvDistances2 0.27216034   0.001
10  W_InvDistancesReduite 0.28566705   0.001
11 W_InvDistances2Reduite 0.38836327   0.001
12    W.InvDistances_2500 0.32115230   0.001
13    W.InvDistances_5000 0.40350492   0.001
14   W.InvDistances2_2500 0.40350492   0.001
15   W.InvDistances2_5000 0.34988630   0.001
16                   W.k2 0.51070049   0.001
17                   W.k3 0.44458619   0.001
18                   W.k4 0.44800959   0.001
19                   W.k5 0.43874109   0.001</code></pre>
</div>
</div>
<p>La lecture détaillée du <a href="#tbl-TableauIMoranMatrices">tableau&nbsp;<span>2.3</span></a> permet d’avancer plusieurs constats intéressants&nbsp;:</p>
<ul>
<li><p>D’emblée, signalons que toutes les valeurs sont positives et significatives, témoignant d’une autocorrélation spatiale positive.</p></li>
<li><p>Concernant les <strong>matrices de contiguïté</strong>, la dépendance spatiale est plus forte selon le partage d’un segment que d’un nœud (0,4497 contre 0,4337). Par conséquent, si nous devons choisir une matrice de contiguïté, il serait préférable d’utiliser celle définie selon le partage d’une chaîne (<em>Rook</em>).</p></li>
<li><p>Sans surprise, plus nous ajoutons des <strong>ordres d’adjacence</strong>, plus la valeur de la statistique du <em>I</em> de Moran est faible, passant de 0,3251 à 0,0713 du deuxième au cinquième ordre.</p></li>
<li><p>La valeur du <em>I</em> de Moran avec une <strong>matrice de connectivité</strong> avec 2500&nbsp;mètres est de 0,2558. Elle est plus faible que celles de l’inverse de la distance et l’inverse de la distance au carré, avec le même seuil de 2500&nbsp;mètres (0,3212 et 0,4035).</p></li>
<li><p>Concernant les <strong>matrices de proximité</strong>, la méthode de l’inverse de la distance au carré, qui accorde un poids plus important aux entités spatiales très proches (comparativement à l’inverse de la distance), renvoie des valeurs toujours plus élevées, et ce, que la matrice soit complète ou réduite. Aussi, les matrices de distance réduites présentent toujours des valeurs plus fortes que celles complètes.</p></li>
<li><p>Concernant les matrices <strong>selon le critère des plus proches voisins</strong>, l’autocorrélation spatiale diminue légèrement de <em>k</em>&nbsp;=&nbsp;2 à <em>k</em>&nbsp;=&nbsp;5. D’ailleurs, la valeur la plus forte est pour deux voisins (<em>I</em>&nbsp;=&nbsp;0,5107). Toutefois, retenir uniquement deux voisins est discutable puisque les AD sont très majoritairement contiguës à plus de deux autres AD (sur les 249 AD, seuls 9 sont contiguës à deux autres AD selon le partage d’un segment). Pour le vérifier, tapez&nbsp;<code>summary(W.Rook)</code> et analysez le tableau sous la ligne <code>Link number distribution</code>.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TableauIMoranMatrices" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.3: Résultats du I de Moran selon les différentes matrices</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Nom</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">I de Moran</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">p (999 permutations)</th>
</tr></thead>
<tbody>
<tr class="odd" data-grouplength="2">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices de contiguïté</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Queen</td>
<td style="text-align: left;">Partage d’un nœud</td>
<td style="text-align: center;">0,4337</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Rook</td>
<td style="text-align: left;">Partage d’un segment</td>
<td style="text-align: center;">0,4497</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even" data-grouplength="4">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices de contiguïté selon le partage d’un segment et ordre d'adjacence</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Rook2</td>
<td style="text-align: left;">Ordre 2</td>
<td style="text-align: center;">0,3251</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Rook3</td>
<td style="text-align: left;">Ordre 3</td>
<td style="text-align: center;">0,2153</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Rook4</td>
<td style="text-align: left;">Ordre 4</td>
<td style="text-align: center;">0,1261</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Rook5</td>
<td style="text-align: left;">Ordre 5</td>
<td style="text-align: center;">0,0713</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd" data-grouplength="1">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices de connectivité</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.Connect2500m</td>
<td style="text-align: left;">2500 mètres</td>
<td style="text-align: center;">0,2558</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd" data-grouplength="2">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices de distance (complètes)</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.InvDistances</td>
<td style="text-align: left;">Inverse de la distance</td>
<td style="text-align: center;">0,1063</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.InvDistances2</td>
<td style="text-align: left;">Inverse de la distance au carré</td>
<td style="text-align: center;">0,2722</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even" data-grouplength="2">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices de distance (réduites)</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W_InvDistancesReduite</td>
<td style="text-align: left;">Inverse de la distance</td>
<td style="text-align: center;">0,2857</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W_InvDistances2Reduite</td>
<td style="text-align: left;">Inverse de la distance au carré</td>
<td style="text-align: center;">0,3884</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd" data-grouplength="4">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices de distance avec un seuil maximal</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.InvDistances_2500</td>
<td style="text-align: left;">Inverse de la distance (2500 mètres)</td>
<td style="text-align: center;">0,3212</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.InvDistances_5000</td>
<td style="text-align: left;">Inverse de la distance (5000 mètres)</td>
<td style="text-align: center;">0,4035</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.InvDistances2_2500</td>
<td style="text-align: left;">Inverse de la distance au carré (2500 mètres)</td>
<td style="text-align: center;">0,4035</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.InvDistances2_5000</td>
<td style="text-align: left;">Inverse de la distance au carré (5000 mètres)</td>
<td style="text-align: center;">0,3499</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even" data-grouplength="4">
<td colspan="4" style="border-bottom: 1px solid"><strong>Matrices selon le critère des plus proches voisins</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.k2</td>
<td style="text-align: left;">2 voisins</td>
<td style="text-align: center;">0,5107</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.k3</td>
<td style="text-align: left;">3 voisins</td>
<td style="text-align: center;">0,4446</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.k4</td>
<td style="text-align: left;">4 voisins</td>
<td style="text-align: center;">0,4480</td>
<td style="text-align: center;">0,001</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">W.k5</td>
<td style="text-align: left;">5 voisins</td>
<td style="text-align: center;">0,4387</td>
<td style="text-align: center;">0,001</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><strong>Quelle est la matrice avec laquelle la dépendance spatiale de la variable est la plus forte?</strong></p>
<p>Pour la trouver, nous construisons un graphique avec les valeurs du <em>I</em> de Moran triées par ordre décroissant. La valeur la plus forte est obtenue avec la matrice selon les deux plus proches voisins, suivie de la matrice <em>Rook</em>. Quoi qu’il en soit, il serait plus judicieux de privilégier la matrice de contiguïté selon le partage d’un segment comme expliqué plus haut.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">MoranData1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Matrices</span>,<span class="va">MoranIs</span><span class="op">)</span>, y<span class="op">=</span><span class="va">MoranIs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Matrices</span>,<span class="va">MoranIs</span><span class="op">)</span>, </span>
<span>                    xend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Matrices</span>,<span class="va">MoranIs</span><span class="op">)</span>, </span>
<span>                    y<span class="op">=</span><span class="fl">0</span>, yend<span class="op">=</span><span class="va">MoranIs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span> size<span class="op">=</span><span class="fl">4</span>,fill<span class="op">=</span><span class="st">"red"</span>,shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Matrice de pondération spatiale"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"I de Moran"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-loliplotMoran1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-loliplotMoran1-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.14: Valeurs du <em>I</em> de Moran selon les différentes matrices de pondération spatiale</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-023144" class="level5" data-number="2.3.1.4.4"><h5 data-number="2.3.1.4.4" class="anchored" data-anchor-id="sec-023144">
<span class="header-section-number">2.3.1.4.4</span> Étape 4. Comparaison des valeurs du <em>I</em> de Moran pour plusieurs variables avec la même matrice</h5>
<p>La syntaxe ci-dessous permet de calculer la statistique du <em>I</em> de Moran pour plusieurs variables (<a href="#fig-CarteQuatreVariables">figure&nbsp;<span>2.15</span></a>) avec la même matrice de pondération spatiale (ici, matrice de contiguïté selon le partage d’un segment).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-CarteQuatreVariables" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-CarteQuatreVariables-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.15: Quatre variables sélectionnées pour les AD de la ville de Sherbrooke</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Vecteur pour les variables à analyser</span></span>
<span><span class="va">listeVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PctLog1960_Av"</span>, <span class="st">"RevMedMenage"</span> , <span class="st">"PctProprieta"</span>, <span class="st">"PctPop0_14"</span><span class="op">)</span></span>
<span><span class="co">## Vecteur pour le I de Moran et la valeur de p</span></span>
<span><span class="va">MoranI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">VarName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">i</span><span class="op">&lt;-</span><span class="fl">0</span></span>
<span><span class="co">## Boucle pour calculer le I de Moran pour les différentes variables</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">listeVars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">i</span><span class="op">&lt;-</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="va">Test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">[[</span><span class="va">e</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                   listw<span class="op">=</span><span class="va">W.Rook</span>,</span>
<span>                   zero.policy<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                   nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span>  <span class="va">MoranI</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">Test</span><span class="op">$</span><span class="va">statistic</span>,<span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">VarName</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">e</span></span>
<span>  <span class="va">Pvalue</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Test</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Création d'un DataFrame avec les valeurs du I de Moran et de p</span></span>
<span><span class="va">MoranData2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Variable<span class="op">=</span><span class="va">listeVars</span>,</span>
<span>                         MoranIs<span class="op">=</span><span class="va">MoranI</span>,</span>
<span>                         Pvalues<span class="op">=</span><span class="va">Pvalue</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">MoranData2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Variable MoranIs Pvalues
1 PctLog1960_Av  0.7071   0.001
2  RevMedMenage  0.6168   0.001
3  PctProprieta  0.6028   0.001
4    PctPop0_14  0.4474   0.001</code></pre>
</div>
</div>
<p>De nouveau, en quelques lignes de code, il est aisé de réaliser un graphique pour comparer les valeurs du <em>I</em> de Moran pour les différentes variables (<a href="#fig-loliplotMoran2">figure&nbsp;<span>2.16</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">MoranData2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Variable</span>,<span class="va">MoranIs</span><span class="op">)</span>, y<span class="op">=</span><span class="va">MoranIs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Variable</span>,<span class="va">MoranIs</span><span class="op">)</span>, xend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Variable</span>,<span class="va">MoranIs</span><span class="op">)</span>, y<span class="op">=</span><span class="fl">0</span>, yend<span class="op">=</span><span class="va">MoranIs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span> size<span class="op">=</span><span class="fl">4</span>,fill<span class="op">=</span><span class="st">"red"</span>,shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Variable continue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"I de Moran"</span><span class="op">)</span><span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-loliplotMoran2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-loliplotMoran2-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.16: Valeurs du <em>I</em> de Moran pour les quatre variables</figcaption></figure>
</div>
</div>
</div>
</section></section></section><section id="sec-0232" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-0232">
<span class="header-section-number">2.3.2</span> Statistiques de comptage de jointure (<em>Join Count Statistics</em>)</h3>
<p>Pour évaluer l’autocorrélation spatiale d’une variable qualitative dichotomique (binaire) ou polychotomique (catégorielle), il convient d’utiliser les <strong><em>Join Count Statistics</em></strong>, qui peuvent être traduits par <strong>statistiques de comptage de jointure</strong>. Ces tests permettent de répondre à la question suivante&nbsp;: est-ce que le voisinage ou la proximité des entités spatiales augmente significativement les chances qu’elles partagent la même valeur (modalité) par rapport à ce que le hasard produirait <span class="citation" data-cites="cliff1981spatial">(<a href="references.html#ref-cliff1981spatial" role="doc-biblioref">Cliff et Ord 1981</a>)</span>?</p>
<div class="bloc_objectif">
<div class="bloc_objectif-header">
<div class="bloc_objectif-icon">

</div>
<p><strong>Autocorrélation spatiale sur une variable qualitative</strong></p>
</div>
<div class="bloc_objectif-body">
<p>Ces statistiques permettent ainsi de vérifier si la distribution des modalités d’une variable binaire ou nominale est dispersée aléatoirement dans l’espace d’étude ou si elle tend à se regrouper spatialement. Voici quelques exemples applicatifs&nbsp;:</p>
<ul>
<li><p><strong>Variable binaire</strong> (oui/non; absence/présence d’un phénomène) avec habituellement des valeurs de 0 ou 1. Dans une ville, les parcelles commerciales sont-elles distribuées aléatoirement ou tendent-elle à se regrouper?</p></li>
<li><p><strong>Variable qualitative nominale</strong>. À la suite d’une élection dans un pays donné, il s’agit de vérifier si les districts électoraux adjacents ont significativement été remportés par des personnes candidates du même parti. Autre exemple, la répartition d’espèces d’arbres sur un territoire donné est-elle aléatoire ou favorise-t-elle la proximité entre certaines espèces?</p></li>
</ul>
</div>
</div>
<section id="sec-02321" class="level4" data-number="2.3.2.1"><h4 data-number="2.3.2.1" class="anchored" data-anchor-id="sec-02321">
<span class="header-section-number">2.3.2.1</span> Formulation des statistiques de comptage de jointure</h4>
<section id="sec-023211" class="level5" data-number="2.3.2.1.1"><h5 data-number="2.3.2.1.1" class="anchored" data-anchor-id="sec-023211">
<span class="header-section-number">2.3.2.1.1</span> Application à une variable binaire</h5>
<p>Pour décrire le fonctionnement de ces tests, nous utilisons deux situations fictives avec toutes deux 36&nbsp;entités spatiales, dont 9&nbsp;avec la valeur de 1 (noir, soit <em>B</em> par convention) et 27&nbsp;avec la valeur de 0 (blanc, soit <em>W</em> par convention) (<a href="#fig-JoinCountTest">figure&nbsp;<span>2.17</span></a>). La relation d’adjacence entre les entités spatiales est ici mesurée à partir d’une matrice de contiguïté selon le partage d’un segment qui est représentée avec un graphe à la <a href="#fig-JoinCountTest">figure&nbsp;<span>2.17</span></a> (b).</p>
<div id="fig-JoinCountTest" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/JoinCountTest.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.17: Illustration de l’autocorrélation spatiale pour une variable binaire</figcaption></figure>
</div>
</section><section id="sec-0232111" class="level5" data-number="2.3.2.1.2"><h5 data-number="2.3.2.1.2" class="anchored" data-anchor-id="sec-0232111">
<span class="header-section-number">2.3.2.1.2</span> Comptage des jointures</h5>
<p>Le comptage des entités voisines partageant la même valeur (BB et WW, soit une autocorrélation spatiale positive) et inversement (WB, soit une autocorrélation spatiale négative) est réalisé comme suit&nbsp;:</p>
<ul>
<li>
<strong>Le nombre de voisins partageant la valeur de 1 (autocorrélation positive)</strong> est obtenu avec l’<a href="#eq-JoinCountStatisticBB">équation&nbsp;<span>2.12</span></a>. Lorsque deux entités ne sont pas adjacentes, alors <span class="math inline">\(w_{ij}=0\)</span> et donc <span class="math inline">\(w_{ij}x_ix_j = 0\)</span>. Par contre, lorsqu’elles sont voisines, trois cas de figure sont possibles&nbsp;:
<ul>
<li>
<strong>Toutes deux ont la valeur de 1</strong>, alors <span class="math inline">\(x_ix_j=1\times1 = 1\)</span>.</li>
<li>Toutes deux ont la valeur de 0, alors <span class="math inline">\(x_ix_j=0\times0 = 0\)</span>.</li>
<li>Elles ont des valeurs différentes, alors <span class="math inline">\(x_ix_j=1\times0 = 0\)</span>.</li>
</ul>
</li>
</ul>
<p><span id="eq-JoinCountStatisticBB"><span class="math display">\[
O_{BB} = \frac{1}{2} \Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij} x_i x_j \text{ avec :}
\tag{2.12}\]</span></span></p>
<p><em>n</em> étant le nombre d’entités spatiales dans la couche géographique; <span class="math inline">\(w_{ij}\)</span> étant la valeur de la matrice de contiguïté non standardisée entre <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span> (1 quand elles sont voisines, sinon 0), <span class="math inline">\(x_i\)</span> et <span class="math inline">\(x_j\)</span> étant les valeurs de la variable binaire (0 ou 1) pour les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>.</p>
<ul>
<li>
<strong>Le nombre de voisins partageant la valeur de 0 (autocorrélation positive)</strong> est obtenu avec l’<a href="#eq-JoinCountStatisticWW">équation&nbsp;<span>2.13</span></a> avec les cas suivants lorsque les deux entités sont voisines&nbsp;:
<ul>
<li>Toutes deux avec la valeur de 1, alors <span class="math inline">\((1-x_i) (1-x_j)=(1-1)\times(1-1) = 0 \times 0 = 0\)</span>.</li>
<li>
<strong>Toutes deux avec la valeur de 0</strong>, alors <span class="math inline">\((1-x_i) (1-x_j)=(1-0)\times(1-0) = 1 \times 1 = 1\)</span>.</li>
<li>Avec des valeurs différentes, alors <span class="math inline">\((1-x_i) (1-x_j)=(1-1)\times(1-0) = 0 \times 1 = 0\)</span>.</li>
</ul>
</li>
</ul>
<p><span id="eq-JoinCountStatisticWW"><span class="math display">\[
O_{WW} = \frac{1}{2} \Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij} (1-x_i) (1-x_j)
\tag{2.13}\]</span></span></p>
<ul>
<li>
<strong>Le nombre de voisins ne partageant pas la même valeur (autocorrélation négative)</strong> est obtenu avec l’<a href="#eq-JoinCountStatisticWB">équation&nbsp;<span>2.14</span></a> avec les cas suivants lorsque les deux entités sont voisines&nbsp;:
<ul>
<li>Toutes deux avec la valeur de 1, alors <span class="math inline">\((x_i-x_j)^2=(1-1)^2 = 0\)</span>.</li>
<li>Toutes deux avec la valeur de 0, alors <span class="math inline">\((x_i-x_j)^2=(0-0)^2 = 0\)</span>.</li>
<li>
<strong>Avec des valeurs différentes</strong>, alors <span class="math inline">\((x_i-x_j)^2=(1-0)^2 = 1\)</span>.</li>
</ul>
</li>
</ul>
<p><span id="eq-JoinCountStatisticWB"><span class="math display">\[
O_{BW} = \frac{1}{2} \Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij} \left(x_i-x_j \right)^2
\tag{2.14}\]</span></span></p>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Note</strong></p>
</div>
<div class="bloc_notes-body">
<p>Pour les trois équations ci-dessus, les sommes sont divisées par 2 puisque les mêmes résultats sont obtenus entre les paires (<span class="math inline">\(i,j\)</span>) et (<span class="math inline">\(j,i\)</span>). La somme des voisins partageant les mêmes valeurs (<span class="math inline">\(O_{BB}\)</span> et <span class="math inline">\(O_{WW}\)</span>) et ayant des valeurs différentes (<span class="math inline">\(O_{BW}\)</span>) est égale à la somme de la matrice de contiguïté (<span class="math inline">\(S_0\)</span>) divisée par deux (<a href="#eq-JoinCountStatistic4">équation&nbsp;<span>2.15</span></a>).</p>
<p><span id="eq-JoinCountStatistic4"><span class="math display">\[
  O_{BB} +  O_{WW} +  O_{BW} = \frac{1}{2}S_0= \frac{1}{2} \Sigma_{i=1}^n \Sigma_{j=1}^n w_{ij}
\tag{2.15}\]</span></span></p>
</div>
</div>
<p>Les résultats des comptages pour les situations A et B (<a href="#fig-JoinCountTest">figure&nbsp;<span>2.17</span></a>) sont présentés au <a href="#tbl-TableauJC">tableau&nbsp;<span>2.4</span></a>. Ils démontrent clairement que les regroupements des valeurs de 0 et 1 sont bien plus importants pour la situation A (BB&nbsp;=&nbsp;12 et WW&nbsp;=&nbsp;42) que celle de B (BB&nbsp;=&nbsp;1 et WW&nbsp;=&nbsp;33). Reste à vérifier si ces résultats sont significatifs, c’est-à-dire s’ils diffèrent de ce que le hasard produirait.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TableauJC" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.4: Comptages des jointures</caption>
<thead><tr class="header">
<th style="text-align: left;">Situation</th>
<th style="text-align: right;">BB</th>
<th style="text-align: right;">WW</th>
<th style="text-align: right;">WB</th>
<th style="text-align: right;">Somme</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A (forte autocorrélation spatiale)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">B (absence autocorrélation spatiale)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">60</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-0232112" class="level5" data-number="2.3.2.1.3"><h5 data-number="2.3.2.1.3" class="anchored" data-anchor-id="sec-0232112">
<span class="header-section-number">2.3.2.1.3</span> Tests statistiques</h5>
<p>Il existe deux approches d’inférence pour déterminer si des observations voisines tendent à produire certaines paires de catégories (BB, WW ou WB) plus souvent que le hasard&nbsp;: les tests reposant sur la loi binomiale et les tests par permutations. Notez que la seconde approche est habituellement privilégiée.</p>
<p><strong>Tests selon la loi binomiale</strong></p>
<p>Ces tests permettent d’obtenir les valeurs attendues des paires BB, WW et WB pour une absence d’autocorrélation spatiale, puis des valeurs de Z (<a href="#eq-JoinCountStatisticsZ">équation&nbsp;<span>2.16</span></a>) et de <em>p</em>.</p>
<p><span id="eq-JoinCountStatisticsZ"><span class="math display">\[
Z_{WW} = \frac{O[WW] - E[WW]}{\sqrt{\text{Var}[WW]}} \\
Z_{BB} = \frac{O[BB] - E[BB]}{\sqrt{\text{Var}[BB]}} \\
Z_{WB} = \frac{O[WB] - E[WB]}{\sqrt{\text{Var}[WB]}}\text{ avec :}
\tag{2.16}\]</span></span></p>
<p><span class="math inline">\(O[WW]\)</span>, <span class="math inline">\(O[BB]\)</span> et <span class="math inline">\(O[WB]\)</span> étant les nombres de paires observées; <span class="math inline">\(E[WW]\)</span>, <span class="math inline">\(E[BB]\)</span> et <span class="math inline">\(E[WB]\)</span> étant les nombres de paires attendues et <span class="math inline">\(\text{Var}[WW]\)</span>, <span class="math inline">\(\text{Var}[BB]\)</span> et <span class="math inline">\(\text{Var}[WB]\)</span> leurs variances selon la loi binomiale pour une distribution aléatoire. Pour une description détaillée des formules des valeurs attendues et des variances selon les deux types d’échantillons (indépendant et dépendant) et selon le type de matrice de pondération spatiale (standardisée ou non), consultez l’ouvrage de Wong et Lee <span class="citation" data-cites="wong2005statistical">(<a href="references.html#ref-wong2005statistical" role="doc-biblioref">2005</a>)</span>.</p>
<p>Aussi, le calcul des valeurs de Z repose sur deux cas de figure&nbsp;:</p>
<ol type="1">
<li><p><strong>Échantillon dépendant</strong> (<em>non free Sampling</em>). Le nombre de valeurs possibles de chaque catégorie est défini en amont et ne peut pas changer. Prenons l’exemple suivant&nbsp;: nous souhaitons vérifier si deux restaurants voisins ont tendance à avoir une licence d’alcool (BB) ou non (WW). Si le nombre de licences d’alcool est réglementé, alors la probabilité d’en avoir une dépend du nombre de licences en circulation (échantillon dépendant).</p></li>
<li><p><strong>Échantillon indépendant</strong> (<em>free Sampling</em>). Pour chaque entité spatiale, la probabilité d’avoir une catégorie est indépendante du nombre d’observations. En d’autres termes, il n’y a pas un nombre défini d’observations pour chaque catégorie (W ou B) qui sont réparties entre les entités spatiales (échantillon indépendant).</p></li>
</ol>
<p>Bien distinguer ces deux configurations est essentiel, car elles affectent directement les valeurs des variances et par ricochet celles de Z et de <em>p</em> (voir les tableaux&nbsp;<a href="#tbl-TableauJC2">tableau&nbsp;<span>2.5</span></a> et <a href="#tbl-TableauJC">tableau&nbsp;<span>2.4</span></a>). Avec un test basé sur un échantillon indépendant pour la situation&nbsp;A, nous concluons que les valeurs de 1 et de 0 (BB et WW) ne sont pas distribuées aléatoirement puisque <em>p</em>&nbsp;&lt;&nbsp;0,05, ce qui traduit une autocorrélation spatiale. Par contre, pour la situation&nbsp;B, toutes les valeurs de <em>p</em> sont supérieures à 0,05, ce qui ne nous permet pas de rejeter l’hypothèse nulle d’une distribution aléatoire selon la loi binomiale.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TableauJC2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.5: Statistiques de comptage de jointures pour BB (tests basés sur la loi binomiale)</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">O[BB]</th>
<th style="text-align: right;">E[BB]</th>
<th style="text-align: right;">Var[BB]</th>
<th style="text-align: right;">Z</th>
<th style="text-align: right;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A (échantillon dépendant)</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">33,43</td>
<td style="text-align: right;">3,73</td>
<td style="text-align: right;">4,439</td>
<td style="text-align: right;">0,000</td>
</tr>
<tr class="even">
<td style="text-align: left;">A (échantillon indépendant)</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">33,75</td>
<td style="text-align: right;">45,98</td>
<td style="text-align: right;">1,217</td>
<td style="text-align: right;">0,112</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B (échantillon dépendant)</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">33,43</td>
<td style="text-align: right;">3,73</td>
<td style="text-align: right;">-0,222</td>
<td style="text-align: right;">0,588</td>
</tr>
<tr class="even">
<td style="text-align: left;">B (échantillon indépendant)</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">33,75</td>
<td style="text-align: right;">45,98</td>
<td style="text-align: right;">-0,111</td>
<td style="text-align: right;">0,544</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TableauJC3" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.6: Statistiques de comptage de jointures pour WW (tests basés sur la loi binomiale)</caption>
<thead><tr class="header">
<th style="text-align: left;">Situation et test</th>
<th style="text-align: right;">O[WW]</th>
<th style="text-align: right;">E[WW]</th>
<th style="text-align: right;">Var[WW]</th>
<th style="text-align: right;">Z</th>
<th style="text-align: right;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A (échantillon dépendant)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">3,43</td>
<td style="text-align: right;">2,09</td>
<td style="text-align: right;">5,922</td>
<td style="text-align: right;">0,000</td>
</tr>
<tr class="even">
<td style="text-align: left;">B (échantillon indépendant)</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">3,75</td>
<td style="text-align: right;">6,98</td>
<td style="text-align: right;">3,122</td>
<td style="text-align: right;">0,001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B (échantillon dépendant)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3,43</td>
<td style="text-align: right;">2,09</td>
<td style="text-align: right;">-1,678</td>
<td style="text-align: right;">0,953</td>
</tr>
<tr class="even">
<td style="text-align: left;">B (échantillon indépendant)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3,75</td>
<td style="text-align: right;">6,98</td>
<td style="text-align: right;">-1,041</td>
<td style="text-align: right;">0,851</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Tests par permutations</strong></p>
<p>Cette seconde approche d’inférence est très simple et consiste à&nbsp;:</p>
<ol type="1">
<li>Mélanger les observations du jeu de données de nombreuses fois (habituellement 999).</li>
<li>Pour chaque permutation, compter les jointures BB, WW et WB.</li>
<li>Estimer la pseudo valeur de <em>p</em> à partir de l’<a href="#eq-JoinCountPermutation">équation&nbsp;<span>2.17</span></a>. Cette valeur peut être interprétée comme la probabilité que le hasard génère plus souvent une paire (BB, WW ou WB) que ce qui est observé avec le jeu de données initial.</li>
</ol>
<p><span id="eq-JoinCountPermutation"><span class="math display">\[
  \text{Pseudo valeur de } p = (M+1)/ (R+1) \text{ avec :}
\tag{2.17}\]</span></span></p>
<p><span class="math inline">\(M\)</span> étant le nombre de fois que le comptage de jointures (BB ou WW par exemple) est égal ou supérieur à la valeur de référence (<span class="math inline">\(O_{BB}\)</span> ou <span class="math inline">\(O_{WW}\)</span> par exemple) et <span class="math inline">\(R\)</span> étant le nombre de permutations (habituellement 999).</p>
<p>En guise d’exemple, nous réalisons 999 permutations des valeurs de la situation&nbsp;A qui comprend 12&nbsp;paires de BB, 42 de WW et 6 de WB. Les comptages de BB et WW pour ces 999 permutations sont représentés à la <a href="#fig-JoinCountStatisticPermFigA">figure&nbsp;<span>2.18</span></a>. Nous constatons qu’elles sont toujours inférieures aux valeurs de référence (BB&nbsp;=&nbsp;12 et WW&nbsp;=&nbsp;42; lignes bleues). Par conséquent, la pseudo valeur de <em>p</em> est égale à <span class="math inline">\((0+1)/(999+1)=\text{0,001}\)</span>. Cela signifie que nous ne pouvons pas rejeter l’hypothèse nulle stipulant que les distributions des paires BB et WW sont dues au hasard.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-JoinCountStatisticPermFigA" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-JoinCountStatisticPermFigA-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.18: Résultats des 999 permutations pour la situation A</figcaption></figure>
</div>
</div>
</div>
<p>Effectuons la même démarche pour la situation B avec une seule paire de BB et 33&nbsp;paires de WW (<a href="#fig-JoinCountStatisticPermFigB">figure&nbsp;<span>2.19</span></a>)&nbsp;:</p>
<ul>
<li><p>pour BB, il y a 984 permutations qui ont une valeur supérieure ou égale à 1. La pseudo valeur de <em>p</em> est égale à <span class="math inline">\((984+1)/(999+1)=\text{0,985}\)</span>.</p></li>
<li><p>pour WW, il y a 653 permutations qui ont une valeur supérieure ou égale à 1. La pseudo valeur de <em>p</em> est égale à <span class="math inline">\((653+1)/(999+1)=\text{0,653}\)</span>.</p></li>
</ul>
<p>Par conséquent, nous validons l’hypothèse nulle stipulant que les distributions des paires BB et WW sont dues au hasard pour la situation B.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-JoinCountStatisticPermFigB" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-JoinCountStatisticPermFigB-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.19: Résultats des 999 permutations pour la situation B</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_astuce">
<div class="bloc_astuce-header">
<div class="bloc_astuce-icon">

</div>
<p><strong>Comment réaliser une permutation aléatoire des valeurs d’un vecteur dans R?</strong></p>
</div>
<div class="bloc_astuce-body">
<p>Dans R, la fonction <code>sample(x)</code> permet de permuter les valeurs d’un vecteur.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Valeurs initiales pour les 36 observations (cas A)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">Carres</span><span class="op">$</span><span class="va">CasA</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 0 0 0 1 1 1 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Valeurs permutées</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">Carres</span><span class="op">$</span><span class="va">CasA</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 1 0 0 0 0 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 1 1 1 0</code></pre>
</div>
</div>
</div>
</div>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Importance de la matrice de voisinage pour le <em>Join count Test</em></strong></p>
</div>
<div class="bloc_attention-body">
<p>Quelle que soit la méthode utilisée pour effectuer le <em>Join count Test</em>, le test est sensible à la définition de la matrice de voisinage, définie selon le partage d’un segment ou d’un nœud (<em>Queen</em> ou <em>Rook</em>). Elle affecte directement le nombre de paires observées et attendues et donc le niveau de significativité de l’autocorrélation spatiale.</p>
</div>
</div>
</section></section><section id="sec-02322" class="level4" data-number="2.3.2.2"><h4 data-number="2.3.2.2" class="anchored" data-anchor-id="sec-02322">
<span class="header-section-number">2.3.2.2</span> Mise en œuvre dans R</h4>
<div class="bloc_objectif">
<div class="bloc_objectif-header">
<div class="bloc_objectif-icon">

</div>
<p><strong>Calcul des statistiques de comptage de jointure dans R</strong></p>
</div>
<div class="bloc_objectif-body">
<p>Pour illustrer le calcul des statistiques de comptage de jointure (<em>Join Count Statistics</em>) dans R, nous utilisons une couche des aires de diffusion (AD) de la ville de Sherbrooke afin de répondre à la question suivante&nbsp;: les AD avec une majorité de locataires et celles avec une majorité de propriétaires sont-elles significativement voisines les unes des autres (autocorrélation spatiale positive) à Sherbrooke?</p>
</div>
</div>
<p>Dans le code ci-dessous, nous importons la couche géographique, créons une variable binaire indiquant si l’aire de diffusion a ou non une majorité de locataires et finalement, cartographions cette variable. Sans surprise, les AD avec une majorité de locataires sont concentrées dans la partie centrale de la ville (<a href="#fig-MajLoc">figure&nbsp;<span>2.20</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Chargement des données des aires de diffusion de la ville de Sherbrooke</span></span>
<span><span class="va">ADSherb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/chap02/Recen2021Sherbrooke.gpkg"</span>, </span>
<span>                   layer<span class="op">=</span><span class="st">"DR_SherbADDonnees2021"</span>,</span>
<span>                   quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Création de la variable binaire</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">maj_locataires</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">Locataire</span> <span class="op">&gt;</span> <span class="va">ADSherb</span><span class="op">$</span><span class="va">Proprietaire</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">maj_locataires</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">maj_locataires</span>,</span>
<span>                                 levels <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                                 labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Propriétaires"</span>, <span class="st">"Locataires"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Cartographie de la variable binaire</span></span>
<span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">ADSherb</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span>col<span class="op">=</span><span class="st">"maj_locataires"</span>, </span>
<span>          palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#ededed"</span>, <span class="st">"#706f6f"</span><span class="op">)</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Groupe majoritaire"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_scale_bar</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_credits</span><span class="op">(</span><span class="st">"Source : Statistique Canada, 2021."</span>, align <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-MajLoc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-MajLoc-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.20: Aires de diffusion avec une majorité de locataires ou de propriétaires, Sherbrooke, 2021</figcaption></figure>
</div>
</div>
</div>
<p>Pour calculer les statistiques de comptage de jointure, nous utilisons une matrice de contiguïté selon le partage d’un nœud (<em>Queen</em>). Notez que pour ces statistiques, il est préférable de ne pas standardiser la matrice spatiale (<code>style = "B"</code>), car nous souhaitons compter le nombre de paires formées par les deux catégories d’AD.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">ADSherb</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">WQueen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour réaliser les tests selon la méthode d’inférence basée sur la loi binomiale, nous utilisons la fonction <code>joincount.test</code> du <em>package</em> <code>spdep</code>. Le paramètre <code>sampling = "free"</code> permet de spécifier le calcul des variances selon un échantillon indépendant, puisque les nombres d’AD dans lesquelles les locataires ou les propriétaires sont majoritaires n’ont pas de limites fixes.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/joincount.test.html">joincount.test</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">maj_locataires</span>, listw <span class="op">=</span> <span class="va">WQueen</span>, sampling <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Join count test under free sampling

data:  ADSherb$maj_locataires 
weights: WQueen 

Std. deviate for Propriétaires = 3.2832, p-value = 0.0005132
alternative hypothesis: greater
sample estimates:
Same colour statistic           Expectation              Variance 
             244.0000              163.4227              602.3289 


    Join count test under free sampling

data:  ADSherb$maj_locataires 
weights: WQueen 

Std. deviate for Locataires = 3.7367, p-value = 9.324e-05
alternative hypothesis: greater
sample estimates:
Same colour statistic           Expectation              Variance 
             319.0000              214.8323              777.1427 </code></pre>
</div>
</div>
<p>Les résultats du test présentés à la <a href="#fig-joincountTest">figure&nbsp;<span>2.21</span></a> s’interprètent comme suit&nbsp;:</p>
<ul>
<li><p><strong>a. Valeurs observées</strong>&nbsp;: 244 AD sont voisines et majoritairement occupées par des propriétaires contre 319 pour les locataires.</p></li>
<li><p><strong>b. Valeurs attendues</strong>&nbsp;: 163,4227 pour une majorité de propriétaires et 214,8323 pour une majorité de locataires.</p></li>
<li><p><strong>c.&nbsp;variances</strong> pour les deux groupes selon la loi binomiale avec un échantillon indépendant (602,3289 et 777,1427).</p></li>
<li><p><strong>d.&nbsp;Valeurs Z</strong>, soit <span class="math inline">\((244-\text{163,4227})/\sqrt{\text{602,3289}}=\text{3,2832}\)</span> et <span class="math inline">\((319-\text{214,8323})/\sqrt{\text{777,1427}}=\text{3,7367}\)</span>.</p></li>
<li><p><strong>e. Valeurs de <em>p</em></strong> sont inférieures à 0,005, signalant que les deux modalités de la variable binaire sont significativement autocorrélées positivement selon la matrice de contiguïté.</p></li>
</ul>
<div id="fig-joincountTest" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/JointCountTest_Locataires.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.21: Résultats des statistiques de comptage de jointure avec la fonction <code>joincount.test</code></figcaption></figure>
</div>
<p>À des fins de comparaison, nous effectuons le calcul des statistiques de comptage de jointure avec l’approche d’inférence selon le test des permutations (999) avec la fonction <code>joincount.mc</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/joincount.mc.html">joincount.mc</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">maj_locataires</span>, listw <span class="op">=</span> <span class="va">WQueen</span>, nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of join-count statistic

data:  ADSherb$maj_locataires 
weights: WQueen 
number of simulations + 1: 1000 

Join-count statistic for Propriétaires = 244, rank of observed
statistic = 1000, p-value = 0.001
alternative hypothesis: greater
sample estimates:
    mean of simulation variance of simulation 
              162.8989               111.4337 


    Monte-Carlo simulation of join-count statistic

data:  ADSherb$maj_locataires 
weights: WQueen 
number of simulations + 1: 1000 

Join-count statistic for Locataires = 319, rank of observed statistic =
1000, p-value = 0.001
alternative hypothesis: greater
sample estimates:
    mean of simulation variance of simulation 
              213.8448               128.1032 </code></pre>
</div>
</div>
<p>L’approche d’inférence basée sur les permutations signale aussi que les deux distributions sont significativement autocorrélées spatialement (<em>p</em>&nbsp;=&nbsp;0,001).</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Fonction <code>joincount.multi</code></strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Pour une variable qualitative comprenant plus de deux modalités (catégories), utilisez la fonction <code>joincount.multi</code> du <em>package</em> <code>spdep</code>. Cependant, celle-ci ne renvoie pas de valeurs de <em>p</em>, mais uniquement des valeurs de Z et des variances pour chaque modalité. Il est possible d’obtenir des valeurs de <em>p</em> en utilisant la fonction <code>pnorm</code> et surtout en ajustant ces valeurs de <em>p</em> pour contrôler l’effet de la multiplication des tests de significativité avec la fonction <code>p.adjust</code>.</p>
</div>
</div>
</section></section><section id="sec-0233" class="level3" data-number="2.3.3"><h3 data-number="2.3.3" class="anchored" data-anchor-id="sec-0233">
<span class="header-section-number">2.3.3</span> Indice de Lee&nbsp;: autocorrélation spatiale dans un contexte bivarié</h3>
<p>À la <a href="#sec-0231">section&nbsp;<span>2.3.1</span></a>, nous avons vu que le <em>I</em> de Moran permet d’évaluer le degré d’autocorrélation spatiale d’une variable continue, c’est-à-dire de vérifier si les entités spatiales proches ou voisines ont tendance à avoir des valeurs (dis)similaires pour une seule variable continue. Il est logique de vouloir étendre cette analyse à un contexte bivarié&nbsp;: est-ce que deux variables continues partagent ou non une relation marquée par de l’autocorrélation spatiale? En d’autres termes, l’association spatiale bivariée cherche à capturer la présence d’un patron spatial commun pour les deux variables <span class="citation" data-cites="lee2001developing">(<a href="references.html#ref-lee2001developing" role="doc-biblioref">Lee 2001</a>)</span>.</p>
<section id="sec-02331" class="level4" data-number="2.3.3.1"><h4 data-number="2.3.3.1" class="anchored" data-anchor-id="sec-02331">
<span class="header-section-number">2.3.3.1</span> Formulation de l’indice de Lee</h4>
<p>Il est important de distinguer la corrélation (non spatiale) entre deux variables et l’autocorrélation spatiale entre deux variables. La première mesure à quel point deux variables tendent à avoir une relation linéaire positive ou négative, alors que la seconde mesure la présence d’un patron spatial commun. Prenons l’exemple d’un jeu de données fictives avec 25&nbsp;observations et deux variables continues <em>X</em> et <em>Y</em> (<a href="#tbl-TabFictives2Vars">tableau&nbsp;<span>2.7</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TabFictives2Vars" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.7: Jeu de données fictives avec 25 observations et deux variables</caption>
<thead><tr class="header">
<th style="text-align: center;">X</th>
<th style="text-align: center;">Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">-0,37</td>
<td style="text-align: center;">-3,04</td>
</tr>
<tr class="even">
<td style="text-align: center;">0,42</td>
<td style="text-align: center;">1,62</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-2,01</td>
<td style="text-align: center;">-7,57</td>
</tr>
<tr class="even">
<td style="text-align: center;">1,33</td>
<td style="text-align: center;">7,19</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1,81</td>
<td style="text-align: center;">5,99</td>
</tr>
<tr class="even">
<td style="text-align: center;">1,18</td>
<td style="text-align: center;">8,17</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0,49</td>
<td style="text-align: center;">0,15</td>
</tr>
<tr class="even">
<td style="text-align: center;">-1,57</td>
<td style="text-align: center;">-14,43</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-4,77</td>
<td style="text-align: center;">-16,86</td>
</tr>
<tr class="even">
<td style="text-align: center;">-4,08</td>
<td style="text-align: center;">-10,49</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1,53</td>
<td style="text-align: center;">6,28</td>
</tr>
<tr class="even">
<td style="text-align: center;">-2,96</td>
<td style="text-align: center;">-6,90</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-1,91</td>
<td style="text-align: center;">4,51</td>
</tr>
<tr class="even">
<td style="text-align: center;">1,44</td>
<td style="text-align: center;">6,57</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0,37</td>
<td style="text-align: center;">-1,48</td>
</tr>
<tr class="even">
<td style="text-align: center;">0,84</td>
<td style="text-align: center;">-1,53</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-1,32</td>
<td style="text-align: center;">-2,79</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0,76</td>
<td style="text-align: center;">-0,24</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-5,73</td>
<td style="text-align: center;">-17,78</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0,44</td>
<td style="text-align: center;">1,95</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-1,05</td>
<td style="text-align: center;">-5,75</td>
</tr>
<tr class="even">
<td style="text-align: center;">-2,90</td>
<td style="text-align: center;">-6,22</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-1,82</td>
<td style="text-align: center;">-6,51</td>
</tr>
<tr class="even">
<td style="text-align: center;">0,09</td>
<td style="text-align: center;">-2,91</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3,42</td>
<td style="text-align: center;">9,77</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Ces deux variables sont caractérisées par une forte corrélation linéaire positive avec un coefficient de corrélation de Pearson proche de&nbsp;1 (<a href="#fig-FigCorrelation">figure&nbsp;<span>2.22</span></a>).</p>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Retour sur la notion de corrélation entre deux variables continues</strong>.</p>
</div>
<div class="bloc_notes-body">
<p>Pour un rappel sur la notion de corrélation entre deux variables continues, notamment sur l’interprétation du coefficient de corrélation de Pearson, nous vous invitons à lire la <a href="https://laeq.github.io/LivreMethoQuantBolR/sect043.html">section suivante</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-FigCorrelation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-FigCorrelation-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.22: Relation entre deux variables continues et coefficients de corrélation de Pearson</figcaption></figure>
</div>
</div>
</div>
<p>Cependant, cette information relative à la corrélation entre les deux variables ne nous permet pas d’appréhender leurs caractéristiques spatiales. En effet, ce tableau de données peut correspondre aux différents patrons spatiaux. En examinant les cartes <strong>a</strong> à <strong>d</strong> de la <a href="#fig-ExMapBivar">figure&nbsp;<span>2.23</span></a>, nous constatons l’absence de tout patron spatial apparent. Par contre, à la <a href="#fig-ExMapBivar">figure&nbsp;<span>2.23</span></a> (e), nous observons une configuration spatiale particulière&nbsp;: à la fois, une forte autocorrélation spatiale positive univariée de chacune des deux variables (X et Y) et une forte autocorrélation spatiale positive bivariée puisque les deux patrons spatiaux de X et Y sont similaires.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ExMapBivar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-ExMapBivar-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.23: Exemples de patrons spatiaux sans et avec autocorrélation spatiale dans un contexte bivarié</figcaption></figure>
</div>
</div>
</div>
<p>Maintenant que nous avons fait la distinction entre la <strong>corrélation bivariée</strong> et <strong>l’autocorrélation spatiale bivariée</strong>, nous pouvons présenter un indicateur d’autocorrélation spatiale globale bivariée, soit l’indice de Lee <span class="citation" data-cites="lee2001developing">(<a href="references.html#ref-lee2001developing" role="doc-biblioref">2001</a>)</span>. Cet indicateur est construit à partir du produit de l’autocorrélation univariée de chacune des deux variables (numérateur) et de la corrélation de Pearson entre les versions spatialement décalées de ces variables (dénominateur). La formule de l’indicateur est la suivante&nbsp;:</p>
<p><span id="eq-Lee1"><span class="math display">\[
\begin{aligned}
L_{X, Y}=\frac{n}{\sum_i\left(\sum_j v_{i j}\right)^2} \cdot \frac{\sum_i\left[\left(\sum_j v_{i j}\left(x_j-\bar{x}\right)\right) \cdot\left(\sum_j v_{i j}\left(y_j-\bar{y}\right)\right)\right]}{\sqrt{\sum_i\left(x_i-\bar{x}\right)^2} \sqrt{\sum_i\left(y_i-\bar{y}\right)^2}}
\end{aligned}
\tag{2.18}\]</span></span></p>
<p>Si la matrice de pondération spatiale est standardisée en ligne, l’indice de Lee est simplifié comme suit&nbsp;:</p>
<p><span id="eq-Lee2"><span class="math display">\[
\begin{aligned}
L_{X, Y}= \frac{\sum_i\left[\left(\sum_j v_{i j}\left(x_j-\bar{x}\right)\right) \cdot\left(\sum_j v_{i j}\left(y_j-\bar{y}\right)\right)\right]}{\sqrt{\sum_i\left(x_i-\bar{x}\right)^2} \sqrt{\sum_i\left(y_i-\bar{y}\right)^2}}
\end{aligned}
\tag{2.19}\]</span></span></p>
<p>Cet indicateur varie entre −1 (autocorrélation spatiale bivariée négative) et +1 (autocorrélation bivariée positive).</p>
<p>Nous présentons trois cas à la <a href="#fig-ExMapBivar3">figure&nbsp;<span>2.24</span></a> pour illustrer son interprétation. Prenons trois variables X, Y et X’, avec X’ étant l’inverse spatial de X. Pour simplifier l’exemple, ces trois variables ne peuvent avoir que trois valeurs (1, 2 ou 3).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ExMapBivar3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-ExMapBivar3-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.24: Patrons spatiaux de X, Y et X’</figcaption></figure>
</div>
</div>
</div>
<p>Si nous calculons l’autocorrélation spatiale entre toutes les paires de variables avec une matrice de contiguïté standardisée, nous obtenons la matrice au <a href="#tbl-ExampleBivarLeeTab1">tableau&nbsp;<span>2.8</span></a>. Les résultats démontrent que les variables X et Y partagent un patron d’autocorrélation spatiale positive modérée (0,327), alors que les variables X et X’ partagent un patron d’autocorrélation spatiale négative (−0,512). En d’autres termes, les endroits où X tend à avoir des regroupements d’observations avec des valeurs fortes, X’ tend à avoir des regroupements d’observations avec des valeurs faibles.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-ExampleBivarLeeTab1" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.8: Indice de Lee global</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">X</th>
<th style="text-align: center;">Y</th>
<th style="text-align: center;">X’</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0,327</td>
<td style="text-align: center;">-0,512</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y</td>
<td style="text-align: center;">0,327</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">-0,293</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X’</td>
<td style="text-align: center;">-0,512</td>
<td style="text-align: center;">-0,293</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="bloc_astuce">
<div class="bloc_astuce-header">
<div class="bloc_astuce-icon">

</div>
<p><strong>Significativité du test de Lee</strong></p>
</div>
<div class="bloc_astuce-body">
<p>Au même titre que pour les indicateurs vus précédemment, il est possible de tester si l’indice de Lee obtenu est significativement différent de 0 avec des permutations Monte-Carlo.</p>
</div>
</div>
</section><section id="sec-02332" class="level4" data-number="2.3.3.2"><h4 data-number="2.3.3.2" class="anchored" data-anchor-id="sec-02332">
<span class="header-section-number">2.3.3.2</span> Mise en œuvre dans R</h4>
<p>Pour décrire le calcul de l’indice de Lee dans R, nous utilisons le jeu de données spatiales <code>LyonIris</code> du <em>package</em> <code>geocmeans</code> qui comprend quatre variables environnementales&nbsp;: le bruit routier (Lden dB(A)) (<code>Lden</code>), le dioxyde d’azote (ug/m<sup>3</sup>) (<code>NO2</code>), les particules fines PM<sub>2,5</sub> (<code>PM25</code>) et la canopée (%) (<code>VegHautPrt</code>) pour les îlots regroupés pour l’information statistique (IRIS) de l’agglomération lyonnaise (<a href="#fig-datageocmeans1">figure&nbsp;<span>2.25</span></a>).</p>
<div id="fig-datageocmeans1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureDataLyon.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.25: Cartographie des variables du jeu de données LyonIris</figcaption></figure>
</div>
<p>Il est facile de calculer l’indice de Lee en utilisant les fonctions <code>lee.test(x, y, listw)</code>,<code>lee.mc(x, y, listw)</code> ou <code>lee(x, y, listw, n)</code> du package <code>spdep</code>. Par exemple, le code ci-dessous permet de le calculer pour les variables <code>Lden</code> et <code>NO2</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JeremyGelb/geocmeans">geocmeans</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"LyonIris"</span><span class="op">)</span></span>
<span><span class="co">## Matrice de pondération spatiale de contiguïté standardisée</span></span>
<span><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Wmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">nb</span>, style <span class="op">=</span> <span class="st">'W'</span><span class="op">)</span></span>
<span><span class="co">## Calcul de l'indice de Lee entre les deux variables</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.test.html">lee.test</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lden</span>, <span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>, listw <span class="op">=</span> <span class="va">Wmat</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Lee's L statistic randomisation

data:  LyonIris$Lden ,  LyonIris$NO2 
weights: Wmat  

Lee's L statistic standard deviate = 17.135, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Lee's L statistic       Expectation          Variance 
     0.4072785543      0.1243825152      0.0002725625 </code></pre>
</div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.mc.html">lee.mc</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lden</span>, <span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>, listw <span class="op">=</span> <span class="va">Wmat</span>, nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Lee's L

data:  LyonIris$Lden ,  LyonIris$NO2 
weights: Wmat  
number of simulations + 1: 1000 

statistic = 0.40728, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Si vous analysez plusieurs variables simultanément, il est pertinent de construire à la fois une matrice de corrélation et une matrice d’autocorrélation spatiale bivariée. Pour cette dernière, la diagonale peut être remplacée par le <em>I</em> de Moran de chaque variable.</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Liste des variables à analyser</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>,<span class="st">"NO2"</span>,<span class="st">"PM25"</span>,<span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Calcul de la matrice de corrélation de Pearson</span></span>
<span><span class="va">corr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">[</span><span class="va">vars</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## Calcul d'une matrice d'autocorrélation spatiale bivariée (indice de Lee)</span></span>
<span><span class="va">bivar_autocor_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">row_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.html">lee</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[[</span><span class="va">x1</span><span class="op">]</span><span class="op">]</span>, <span class="va">LyonIris</span><span class="op">[[</span><span class="va">x2</span><span class="op">]</span><span class="op">]</span>, listw <span class="op">=</span> <span class="va">Wmat</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">L</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Remplacement de la diagonale par les valeurs du I de Moran</span></span>
<span><span class="va">moranIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.html">moran</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="va">Wmat</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span>, S0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">bivar_autocor_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">moranIs</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-LeeCorrTable" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.9: Matrice de corrélation de Pearson</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Lden</th>
<th style="text-align: center;">NO2</th>
<th style="text-align: center;">PM25</th>
<th style="text-align: center;">VegHautPrt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lden</td>
<td style="text-align: center;">1,000</td>
<td style="text-align: center;">0,623</td>
<td style="text-align: center;">0,489</td>
<td style="text-align: center;">-0,227</td>
</tr>
<tr class="even">
<td style="text-align: left;">NO2</td>
<td style="text-align: center;">0,623</td>
<td style="text-align: center;">1,000</td>
<td style="text-align: center;">0,901</td>
<td style="text-align: center;">-0,283</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PM25</td>
<td style="text-align: center;">0,489</td>
<td style="text-align: center;">0,901</td>
<td style="text-align: center;">1,000</td>
<td style="text-align: center;">-0,392</td>
</tr>
<tr class="even">
<td style="text-align: left;">VegHautPrt</td>
<td style="text-align: center;">-0,227</td>
<td style="text-align: center;">-0,283</td>
<td style="text-align: center;">-0,392</td>
<td style="text-align: center;">1,000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Sans surprise, les différents polluants sont corrélés positivement entre eux et moyennement corrélés négativement avec le couvert végétal. La corrélation la plus forte s’observe entre le dioxyde d’azote et les particules fines (<em>r</em>&nbsp;=&nbsp;0,901; <a href="#tbl-LeeCorrTable">tableau&nbsp;<span>2.9</span></a>).</p>
<p>La lecture de la diagonale du <a href="#tbl-LeeBiarAutoCorrTable">tableau&nbsp;<span>2.10</span></a> permet de constater que les deux polluants atmosphériques sont les plus fortement spatialement autocorrélés (<em>I</em> de Moran de 0,82 et 0,94). Leur valeur de l’indice de Lee est aussi très forte (0,79), indiquant qu’ils tendent à varier de façon conjointe dans l’espace. En revanche, l’autocorrélation spatiale entre le bruit environnemental (Lden) et le dioxyde d’azote (indice de Lee de 0,41) est à peine plus forte que celle entre le Lden et les particules fines (indice de Lee de 0,38) alors que l’écart de la corrélation entre ces paires de variables est bien plus important (respectivement de 0,62 et 0,49). La corrélation non spatiale marquée entre le bruit et le dioxyde d’azote ne se traduit que par une autocorrélation spatiale bivariée modérée (0,41). La géographie de ces deux pollutions ne peut donc se résumer à un patron commun.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-LeeBiarAutoCorrTable" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.10: Matrice d’autocorrélation spatiale globale bivariée (indice de Lee)</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Lden</th>
<th style="text-align: center;">NO2</th>
<th style="text-align: center;">PM25</th>
<th style="text-align: center;">VegHautPrt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lden</td>
<td style="text-align: center;">0,561</td>
<td style="text-align: center;">0,407</td>
<td style="text-align: center;">0,379</td>
<td style="text-align: center;">-0,231</td>
</tr>
<tr class="even">
<td style="text-align: left;">NO2</td>
<td style="text-align: center;">0,407</td>
<td style="text-align: center;">0,819</td>
<td style="text-align: center;">0,789</td>
<td style="text-align: center;">-0,283</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PM25</td>
<td style="text-align: center;">0,379</td>
<td style="text-align: center;">0,789</td>
<td style="text-align: center;">0,935</td>
<td style="text-align: center;">-0,412</td>
</tr>
<tr class="even">
<td style="text-align: left;">VegHautPrt</td>
<td style="text-align: center;">-0,231</td>
<td style="text-align: center;">-0,283</td>
<td style="text-align: center;">-0,412</td>
<td style="text-align: center;">0,585</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section></section><section id="sec-024" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="sec-024">
<span class="header-section-number">2.4</span> Autocorrélation spatiale locale</h2>
<p>Nous avons vu que les statistiques d’autocorrélation spatiale globale comme le <em>I</em> de Moran (<a href="#sec-0231">section&nbsp;<span>2.3.1</span></a>), les statistiques de comptage de jointures (<a href="#sec-0232">section&nbsp;<span>2.3.2</span></a>) et l’indice de Lee (<a href="#sec-0233">section&nbsp;<span>2.3.3</span></a>) renvoient une valeur pour l’ensemble de l’espace d’étude. Une fois démontrée la présence d’autocorrélation spatiale globale (positive ou négative), il est pertinent de réaliser une analyse de l’autocorrélation spatiale locale afin de vérifier si chaque entité spatiale est significativement (dis)semblable de celles voisines ou proches. Comme l’indique l’adjectif <em>locale</em>, les mesures d’autocorrélation spatiale locale renvoient des valeurs pour chacune des entités spatiales.</p>
<section id="sec-0241" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="sec-0241">
<span class="header-section-number">2.4.1</span> Statistiques locales de Getis et Ord&nbsp;: repérer les points chauds et froids pour une variable continue</h3>
<section id="sec-02411" class="level4" data-number="2.4.1.1"><h4 data-number="2.4.1.1" class="anchored" data-anchor-id="sec-02411">
<span class="header-section-number">2.4.1.1</span> Formulation des statistiques locale de Getis et Ord</h4>
<p>Les statistiques locales de Getis et Ord permettent d’évaluer la similarité d’une entité spatiale avec celles voisines ou proches en fonction <strong>d’une variable continue</strong> <span class="citation" data-cites="getis1992analysis ord1995local">(<a href="references.html#ref-getis1992analysis" role="doc-biblioref">Getis et Ord 1992</a>; <a href="references.html#ref-ord1995local" role="doc-biblioref">Ord et Getis 1995</a>)</span>. Autrement dit, elles nous informent si les valeurs fortes et les valeurs faibles d’une variable continue se regroupent significativement dans l’espace, et ce, avec n’importe quel type de matrice de contiguïté, de proximité, de plus proches voisins, etc. Cartographier ces statistiques permet alors de vérifier simultanément l’existence d’agrégats spatiaux de valeurs fortes (<strong>points chauds</strong>) et d’agrégats spatiaux de valeurs faibles (<strong>points froids</strong>).</p>
<p>Il existe deux versions légèrement différentes de ces mesures locales <span class="citation" data-cites="getis1992analysis ord1995local">(<a href="references.html#ref-getis1992analysis" role="doc-biblioref">Getis et Ord 1992</a>; <a href="references.html#ref-ord1995local" role="doc-biblioref">Ord et Getis 1995</a>)</span>&nbsp;:</p>
<ol type="1">
<li><p><span class="math inline">\(G_i\)</span> tient compte uniquement des entités voisines ou proches à l’entité spatiale <span class="math inline">\(i\)</span>. Ainsi, <span class="math inline">\(\Sigma_{j=1}^n w_{ij}x_j\)</span> représente la moyenne pondérée (par les poids de la matrice de pondération spatiale standardisée en ligne) de la variable continue <span class="math inline">\(X\)</span> dans les entités voisines ou proches.</p></li>
<li><p><span class="math inline">\(G_i^*\)</span> tient compte à la fois des valeurs des entités voisines ou proches, mais aussi de celle de <span class="math inline">\(i\)</span>.</p></li>
</ol>
<p>Toutefois, nous cartographions rarement les valeurs de <span class="math inline">\(G_i\)</span> et de <span class="math inline">\(G_i^*\)</span>, mais plutôt celles de <span class="math inline">\(Z(G_i)\)</span> et de <span class="math inline">\(Z(G_i^*)\)</span> (<a href="#eq-LocalGetis">équation&nbsp;<span>2.20</span></a> et <a href="#eq-LocalGetisStar">équation&nbsp;<span>2.21</span></a>) qui représentent la cote&nbsp;Z qui, lorsque positive, indique un agrégat de valeurs plus élevées que la moyenne, et qui, lorsque négative, indique un agrégat de valeurs plus faibles que la moyenne <span class="citation" data-cites="bivand2018comparing">(<a href="references.html#ref-bivand2018comparing" role="doc-biblioref">Bivand et Wong 2018</a>)</span>.</p>
<p>À première vue, ces deux formules peuvent sembler quelque peu complexes! Retenez simplement que le numérateur est la différence entre <span class="math inline">\(G_i\)</span> ou <span class="math inline">\(G_i^*\)</span> et la valeur attendue de <span class="math inline">\(G_i\)</span> ou de <span class="math inline">\(G_i^*\)</span> pour une distribution aléatoire (soit globalement la moyenne de la variable), tandis que le dénominateur représente l’écart-type de <span class="math inline">\(G_i\)</span> ou de <span class="math inline">\(G_i^*\)</span>.</p>
<p><span id="eq-LocalGetis"><span class="math display">\[
Z(G_i) = \frac{\bigr[ \Sigma_{j=1}^n w_{ij}x_j \bigr] - \bigr[ (\Sigma_{j=1}^nw_{ij}) \bar x_i \bigr]}
{s_i \sqrt{ \Bigr[ \Bigl((n-1)\Sigma_{j=1}^nw_{ij}^2-(\Sigma_{j=1}^nw_{ij})^2\Bigl) \Bigr] / (n-1) } } = \frac{G_i - \mathbb{E}(G_i)}{\sqrt{Var(G_i)}} \text{, }i \neq j
\tag{2.20}\]</span></span></p>
<p><span class="math display">\[\text{avec } \bar x_i=\frac{\Sigma_{j=1}^nx_j}{n-1}  \text{, et } s_i = \sqrt{ \frac{\Sigma_{j=1}^nx_j^2}{n-1}-\bar x^2} \text{, } i \neq j\]</span> <span id="eq-LocalGetisStar"><span class="math display">\[
Z(G_i^*) = \frac{\bigr[ \Sigma_{j=1}^n w_{ij}x_j \bigr] - \bigr[ (\Sigma_{j=1}^nw_{ij}) \bar x^* \bigr]}
{s^* \sqrt{ \Bigr[ \Bigl((n-1)\Sigma_{j=1}^nw_{ij}^2-(\Sigma_{j=1}^nw_{ij})^2\Bigl) \Bigr] / (n-1) } } = \frac{G_i^* - \mathbb{E}(G_i^*)}{\sqrt{Var(G_i^*)}}\text{, tous }
\tag{2.21}\]</span></span></p>
<p><span class="math display">\[\text{avec } \bar x^*=\frac{\Sigma_{j=1}^nx_j}{n}  \text{, et } s^* = \sqrt{ \frac{\Sigma_{j=1}^nx_j^2}{n}-\bar x^{*2}} \text{, tous } j\]</span> avec&nbsp;:</p>
<ul>
<li><p><em>n</em>, le nombre d’entités spatiales dans la couche géographique;</p></li>
<li><p><span class="math inline">\(w_{ij}\)</span>, la valeur de la pondération spatiale entre les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>;</p></li>
<li><p><span class="math inline">\(x_j\)</span>, la valeur de variable continue <span class="math inline">\(X\)</span> pour l’entité spatiale <span class="math inline">\(j\)</span>;</p></li>
<li><p><span class="math inline">\(\bar{x^*}\)</span>, la valeur moyenne de la variable pour toutes les observations;</p></li>
<li><p><span class="math inline">\(\bar{x_i}\)</span>, la valeur moyenne de la variable pour toutes les observations sauf <span class="math inline">\(i\)</span>.</p></li>
</ul>
<div class="bloc_astuce">
<div class="bloc_astuce-header">
<div class="bloc_astuce-icon">

</div>
<p><strong>Deux manières de calculer</strong> <span class="math inline">\(Z(G_i)\)</span> et <span class="math inline">\(Z(G_i^*)\)</span> avec le <em>package</em> <code>spdep</code></p>
</div>
<div class="bloc_astuce-body">
<ul>
<li>la fonction <code>localG</code> vous renvoie les valeurs de cote Z (<em>Z-score</em> en anglais) des statistiques de Getis et Ord avec les formules décrites plus haut.</li>
<li>la fonction <code>localG_perm</code> permet de les obtenir avec la méthode Monte-Carlo (avec habituellement 999&nbsp;permutations).</li>
</ul>
<p><strong>Cartographie des cotes Z</strong></p>
<p>À partir des cotes Z, utilisez les bornes des classes suivantes et la palette de couleurs <code>-RdBu</code>&nbsp;:</p>
<ul>
<li>Minimum à -3,29 : point froid significatif avec <em>p</em>&nbsp;&lt;&nbsp;0,001 (bleu foncé).</li>
<li>-3,29 à -2,58 : point froid significatif avec <em>p</em>&nbsp;&lt;&nbsp;0,01 (bleu).</li>
<li>-2,58 à -1,96 : point froid significatif avec <em>p</em>&nbsp;&lt;&nbsp;0,05 (bleu pâle).</li>
<li>-1,96 à 1,96 : non significatif (gris).</li>
<li>1,96 à 2,58 : point chaud significatif avec <em>p</em>&nbsp;&lt;&nbsp;0,05 (rouge pâle).</li>
<li>2,58 à 3,29 : point chaud significatif avec <em>p</em>&nbsp;&lt;&nbsp;0,01 (rouge).</li>
<li>3,29 à Maximum : point chaud significatif avec *p&nbsp;&lt;0&nbsp;,001 (rouge foncé).</li>
</ul>
<p>Avec la palette <code>-RdBu</code>, les points froids et les points chauds sont respectivement bleus et rouges comme les pastilles de votre robinet! Bref, un beau travail de plomberie!</p>
<p>Pour un rappel sur la cote Z et les valeurs de <em>p</em> associées, consultez <a href="https://pro.arcgis.com/fr/pro-app/latest/tool-reference/spatial-statistics/what-is-a-z-score-what-is-a-p-value.htm">ce lien</a>.</p>
</div>
</div>
</section><section id="sec-02412" class="level4" data-number="2.4.1.2"><h4 data-number="2.4.1.2" class="anchored" data-anchor-id="sec-02412">
<span class="header-section-number">2.4.1.2</span> Mise en œuvre dans R</h4>
<p>La syntaxe ci-dessous calcule les deux statistiques locales avec <code>localG</code> et <code>localG_perm</code> pour le revenu moyen des ménages pour les aires de diffusion de 2021 de la ville de Sherbrooke.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Rook1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">AD.DR</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## Matrice de pondération</span></span>
<span><span class="va">W.RookG</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook1</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">W.RookStar</span> <span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/include.self.html">include.self</a></span><span class="op">(</span><span class="va">Rook1</span><span class="op">)</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># matrice incluant elle-même</span></span>
<span><span class="co">## Calcul du Z(Gi) et du Z(Gi*)</span></span>
<span><span class="va">localGetis</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localG.html">localG</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>, <span class="va">W.RookG</span><span class="op">)</span></span>
<span><span class="va">localGetisStar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localG.html">localG</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>, <span class="va">W.RookStar</span><span class="op">)</span></span>
<span><span class="co">## Calcul avec la méthode Monte-Carlo (999 permutations)</span></span>
<span><span class="va">localGetis.MC999</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localG.html">localG_perm</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>, <span class="va">W.RookG</span>, nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">localGetis.StarMC999</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localG.html">localG_perm</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>, <span class="va">W.RookStar</span>, nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="co">## Sommaires statistiques</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">localGetis</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-3.80885 -1.70432 -0.09828 -0.04120  1.41123  3.91835 </code></pre>
</div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">localGetisStar</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-4.04870 -1.88689 -0.13297 -0.03841  1.54641  4.10379 </code></pre>
</div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">localGetis.MC999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-3.80885 -1.70432 -0.09828 -0.04120  1.41123  3.91835 </code></pre>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">localGetis.StarMC999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-4.04870 -1.88689 -0.13297 -0.03841  1.54641  4.10379 </code></pre>
</div>
</div>
<p>Cartographions ces valeurs et repérons les regroupements de valeurs significativement fortes et faibles avec les statistiques de Getis et Ord (<a href="#fig-GetisLocaleClassique">figure&nbsp;<span>2.26</span></a> et <a href="#fig-GetisLocaleMC">figure&nbsp;<span>2.27</span></a>). Les quatre cartes sont très semblables et permettent de repérer un regroupement de valeurs faibles dans le centre-ville et un autre de valeurs fortes dans l’est de la ville.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-GetisLocaleClassique" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-GetisLocaleClassique-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.26: Points chauds et froids du revenu médian des ménages selon les statistiques de Getis et Ord (méthode classique)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Enregistrement les résultats dans deux champs de la couche des AD</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_localGetis.MC999</span> <span class="op">&lt;-</span> <span class="va">localGetis.MC999</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_localGetis.StarMC999</span> <span class="op">&lt;-</span> <span class="va">localGetis.StarMC999</span></span>
<span><span class="va">coupures</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">3.29</span>, <span class="op">-</span><span class="fl">2.58</span>, <span class="op">-</span><span class="fl">1.96</span>, <span class="fl">1.96</span>, <span class="fl">2.58</span>, <span class="fl">3.29</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co"># Définition des intervalles et des noms des classes</span></span>
<span><span class="va">classes.intervalles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">3.29</span>, <span class="op">-</span><span class="fl">2.58</span>, <span class="op">-</span><span class="fl">1.96</span>, <span class="fl">1.96</span>, <span class="fl">2.58</span>, <span class="fl">3.29</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">classes.noms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Point froid (p = 0,05)"</span>, </span>
<span>                 <span class="st">"Point froid (p = 0,01)"</span>, </span>
<span>                 <span class="st">"Point froid (p = 0,001)"</span>, </span>
<span>                 <span class="st">"Non significatif"</span>,</span>
<span>                 <span class="st">"Point chaud (p = 0,05)"</span>, </span>
<span>                 <span class="st">"Point chaud (p = 0,01)"</span>, </span>
<span>                 <span class="st">"Point chaud (p = 0,001)"</span><span class="op">)</span></span>
<span><span class="co"># Création d'un champ avec les noms des classes</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_localGetis.MC999P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_localGetis.MC999</span>, </span>
<span>                                breaks <span class="op">=</span> <span class="va">classes.intervalles</span>, </span>
<span>                                labels <span class="op">=</span> <span class="va">classes.noms</span><span class="op">)</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_localGetis.StarMC999P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_localGetis.StarMC999</span>, </span>
<span>                                  breaks <span class="op">=</span> <span class="va">classes.intervalles</span>, </span>
<span>                                  labels <span class="op">=</span> <span class="va">classes.noms</span><span class="op">)</span></span>
<span><span class="co">## Cartographie pour le Z(Gi) Mont-Carlo</span></span>
<span><span class="va">Carte3</span> <span class="op">=</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span><span class="st">"RevMed_localGetis.MC999P"</span>, </span>
<span>                        title<span class="op">=</span><span class="st">"Z(Gi)"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_layout</span><span class="op">(</span>frame <span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## Cartographie pour le Z(Gi)* Mont-Carlo</span></span>
<span><span class="va">Carte4</span> <span class="op">=</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span><span class="st">"RevMed_localGetis.StarMC999P"</span>,</span>
<span>                        title<span class="op">=</span><span class="st">"Z(Gi*)"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_layout</span><span class="op">(</span>frame <span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu">tm_credits</span><span class="op">(</span><span class="st">"Auteurs : Geoffroy et Jessie Chaux."</span>, </span>
<span>           position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.7</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span><span class="co">## Composition avec les deux cartes</span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">Carte3</span>, <span class="va">Carte4</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GetisLocaleMC" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-GetisLocaleMC-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.27: Points chauds et froids du revenu médian des ménages selon les statistiques de Getis et Ord (999 permutations Monte-Carlo)</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-0242" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="sec-0242">
<span class="header-section-number">2.4.2</span> Version locale du <em>I</em> de Moran</h3>
<section id="sec-02421" class="level4" data-number="2.4.2.1"><h4 data-number="2.4.2.1" class="anchored" data-anchor-id="sec-02421">
<span class="header-section-number">2.4.2.1</span> Formulation de la version locale du <em>I</em> de Moran</h4>
<p>Une version locale du <em>I</em> de Moran (<span class="math inline">\(I_i\)</span>) a été proposée par Luc Anselin <span class="citation" data-cites="anselin1995local">(<a href="references.html#ref-anselin1995local" role="doc-biblioref">1995</a>)</span>. Elle permet de vérifier si une entité spatiale est voisine ou proche –&nbsp;dépendamment de la matrice spatiale utilisée –&nbsp;d’entités spatiales avec des valeurs semblables (contexte d’autocorrélation spatiale locale positive) ou dissemblables (contexte d’autocorrélation spatiale locale négative). Le <em>I</em> de Moran local s’écrit&nbsp;:</p>
<p><span id="eq-LocalIMoran"><span class="math display">\[
I_i = \frac{(x_i-\bar{X})\Sigma_{j=1}^n w_{ij}(x_j-\bar{X})}
{\frac{1}{n} \Sigma_{i=1}^n(x_i-\bar{X})^2} =  \frac{z_i \Sigma_{j=1}^n z_j}{\frac{1}{n}\Sigma_{i=1}^n z_i^2} \text{, } i \ne j
\tag{2.22}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(z_i\)</span> étant la valeur de la variable continue centrée <span class="math inline">\(X\)</span> pour l’entité spatiale <span class="math inline">\(i\)</span>, c’est-à-dire simplement l’écart de <span class="math inline">\(i\)</span> à la moyenne de <span class="math inline">\(X\)</span> (<span class="math inline">\(x_i - \bar X\)</span>).</li>
<li>
<span class="math inline">\(z_j\)</span> étant la valeur de la variable centrée de <span class="math inline">\(X\)</span> pour l’entité spatiale <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(w_{ij}\)</span> étant la valeur de la matrice de pondération spatiale standardisée en ligne entre <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(n\)</span> étant le nombre d’entités spatiales dans la couche géographique.</li>
</ul>
<p>Comme pour la version globale, il est possible de tester la significativité du <em>I</em> de Moran local de manière classique (selon la loi normale) ou avec l’approche Monte-Carlo (avec habituellement 999&nbsp;permutations).</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Test de significativité du <em>I</em> de Moran local</strong>.</p>
</div>
<div class="bloc_aller_loin-body">
<p>Pour comprendre les différentes variantes pour tester la significativité <span class="citation" data-cites="anselin1995local sokal1998local">(<a href="references.html#ref-anselin1995local" role="doc-biblioref">Anselin 1995</a>; <a href="references.html#ref-sokal1998local" role="doc-biblioref">Sokal, Oden et Thomson 1998</a>)</span>, consultez Bivand et Wong <span class="citation" data-cites="bivand2018comparing">(<a href="references.html#ref-bivand2018comparing" role="doc-biblioref">2018</a>)</span> ou l’ouvrage de Dubé et Legros <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014</a>)</span>.</p>
</div>
</div>
</section><section id="sec-02422" class="level4" data-number="2.4.2.2"><h4 data-number="2.4.2.2" class="anchored" data-anchor-id="sec-02422">
<span class="header-section-number">2.4.2.2</span> Mise en œuvre dans R</h4>
<p>Le calcul du <em>I</em> de Moran local s’opère avec les fonctions <code>localmoran</code> et <code>localMoranI.mc</code> du <em>package</em> <code>spdep</code> (voir la syntaxe ci-dessous). Comme pour la version globale, les résultats du <em>I</em> de Moran local sont les mêmes pour les deux fonctions, seules les valeurs de <em>p</em> peuvent varier.</p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Calcul du I de Moran local</span></span>
<span><span class="va">localMoranI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>,  <span class="co"># variable</span></span>
<span>                          <span class="va">W.RookG</span><span class="op">)</span>             <span class="co"># matrice de pondération spatiale</span></span>
<span><span class="co">## Calcul du I de Moran local avec la méthode Monte-Carlo</span></span>
<span><span class="va">localMoranI.mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran_perm</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>, <span class="co"># variable</span></span>
<span>                             <span class="va">W.RookG</span>,                 <span class="co"># matrice de pondération spatiale</span></span>
<span>                             nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>              <span class="co"># nombre de permutations       </span></span>
<span><span class="co">## Sommaires statistiques</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">localMoranI</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Ii                E.Ii                Var.Ii               Z.Ii        
 Min.   :-0.90053   Min.   :-3.054e-02   Min.   :0.0000003   Min.   :-1.9962  
 1st Qu.: 0.08313   1st Qu.:-5.368e-03   1st Qu.:0.0370546   1st Qu.: 0.4539  
 Median : 0.49029   Median :-2.755e-03   Median :0.1339044   Median : 1.4404  
 Mean   : 0.61678   Mean   :-4.032e-03   Mean   :0.2149974   Mean   : 1.2503  
 3rd Qu.: 0.97602   3rd Qu.:-8.287e-04   3rd Qu.:0.2510284   3rd Qu.: 2.1938  
 Max.   : 3.37625   Max.   :-8.000e-09   Max.   :1.8207164   Max.   : 3.9184  
 Pr(z != E(Ii))     
 Min.   :0.0000892  
 1st Qu.:0.0282519  
 Median :0.1268505  
 Mean   :0.2467939  
 3rd Qu.:0.3948293  
 Max.   :0.9833048  </code></pre>
</div>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">localMoranI.mc</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Ii                E.Ii                Var.Ii               Z.Ii        
 Min.   :-0.90053   Min.   :-0.0665060   Min.   :0.0000003   Min.   :-2.0090  
 1st Qu.: 0.08313   1st Qu.:-0.0098391   1st Qu.:0.0375827   1st Qu.: 0.4371  
 Median : 0.49029   Median :-0.0005803   Median :0.1378011   Median : 1.3857  
 Mean   : 0.61678   Mean   :-0.0033491   Mean   :0.2181999   Mean   : 1.2349  
 3rd Qu.: 0.97602   3rd Qu.: 0.0038691   3rd Qu.:0.2598807   3rd Qu.: 2.1366  
 Max.   : 3.37625   Max.   : 0.0384581   Max.   :1.8977038   Max.   : 3.9251  
 Pr(z != E(Ii))      Pr(z != E(Ii)) Sim Pr(folded) Sim      Skewness       
 Min.   :0.0000867   Min.   :0.0020     Min.   :0.0010   Min.   :-0.44387  
 1st Qu.:0.0326292   1st Qu.:0.0240     1st Qu.:0.0120   1st Qu.:-0.21290  
 Median :0.1302435   Median :0.1360     Median :0.0680   Median :-0.11157  
 Mean   :0.2498439   Mean   :0.2546     Mean   :0.1273   Mean   :-0.01317  
 3rd Qu.:0.3932316   3rd Qu.:0.4120     3rd Qu.:0.2070   3rd Qu.: 0.21125  
 Max.   :0.9889440   Max.   :0.9980     Max.   :0.4990   Max.   : 0.42086  
    Kurtosis       
 Min.   :-0.61550  
 1st Qu.:-0.27268  
 Median :-0.16995  
 Mean   :-0.16364  
 3rd Qu.:-0.05963  
 Max.   : 0.32046  </code></pre>
</div>
</div>
<p>Avec la cartographie du <em>I</em> de Moran local, nous repérons localement l’autocorrélation spatiale positive (valeurs similaires, fortes ou faibles localement) et l’autocorrélation spatiale négative (valeurs dissemblables localement) (<a href="#fig-Chap02CartoIMoranLocal">figure&nbsp;<span>2.28</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Ajout de champs pour le I de Moran local</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_IlocalMoran.MC999</span> <span class="op">&lt;-</span> <span class="va">localMoranI.mc</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMed_IlocalMoran.MC999p</span> <span class="op">&lt;-</span> <span class="va">localMoranI.mc</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## Cartographie</span></span>
<span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">=</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span><span class="st">"RevMed_IlocalMoran.MC999"</span>, title<span class="op">=</span><span class="st">"I Moran local"</span>, </span>
<span>                        style<span class="op">=</span><span class="st">"cont"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>         <span class="fu">tm_layout</span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte2</span> <span class="op">=</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu">tm_polygons</span><span class="op">(</span>col<span class="op">=</span> <span class="st">"RevMed_IlocalMoran.MC999p"</span>, title<span class="op">=</span><span class="st">"valeur de p"</span>,</span>
<span>                    palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"green"</span>, <span class="st">"lightgreen"</span>, <span class="st">"gray"</span><span class="op">)</span>,  lwd <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                    legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                    title <span class="op">=</span><span class="st">"En %"</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_layout</span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## Combinaison des deux cartes</span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Chap02CartoIMoranLocal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-Chap02CartoIMoranLocal-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.28: Cartographie du <em>I</em> de Moran local et de la valeur de <em>p</em> associée</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-0243" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="sec-0243">
<span class="header-section-number">2.4.3</span> Typologie basée sur le diagramme de Moran</h3>
<section id="sec-02431" class="level4" data-number="2.4.3.1"><h4 data-number="2.4.3.1" class="anchored" data-anchor-id="sec-02431">
<span class="header-section-number">2.4.3.1</span> Formulation de la typologie basée sur le diagramme de Moran dans un contexte univarié</h4>
<p>La typologie basée sur le diagramme de Moran a été proposée par Luc Anselin <span class="citation" data-cites="anselin1996chapter">(<a href="references.html#ref-anselin1996chapter" role="doc-biblioref">1996</a>)</span>. L’idée est fort simple, mais extrêmement efficace! Avant tout, la variable continue est centrée réduite (cote <span class="math inline">\(z\)</span>, <em>z-score</em> en anglais). Pour un rappel sur la cote <span class="math inline">\(z\)</span>, consultez la <a href="https://laeq.github.io/LivreMethoQuantBolR/sect025.html#sect02552">section suivante</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>. La moyenne est ainsi égale à&nbsp;0 et l’écart-type à&nbsp;1. Puis, il s’agit de construire un nuage de points entre&nbsp;:</p>
<ol type="1">
<li>Les valeurs de la variable centrée réduite (Z) <strong>sur l’axe des X</strong> pour les entités spatiales de la couche géographique.</li>
<li>Les valeurs de la variable centrée réduite spatialement décalée obtenues avec les pondérations spatiales de la matrice <span class="math inline">\(W\)</span> (voir l’encadré ci-dessous).</li>
</ol>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Comment calculer une variable spatialement décalée avec une matrice de pondération spatiale?</strong></p>
</div>
<div class="bloc_notes-body">
<p>À la <a href="#fig-Chap02FigureVariableSpatialementDecalee">figure&nbsp;<span>2.29</span></a>, nous détaillons le calcul de la valeur d’une variable spatialement décalée pour l’entité spatiale <strong>A</strong> à partir d’une matrice de contiguïté (selon le partage d’un segment) standardisée en ligne. Notez que <strong>A</strong> est adjacente à quatre entités spatiales (b, c, d et e).</p>
<div id="fig-Chap02FigureVariableSpatialementDecalee" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap02/FigureVariableSpatialementDecalee.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.29: Illustration du calcul d’une variable spatialement décalée</figcaption></figure>
</div>
<p>Dans R, la syntaxe est fort simple pour créer une cote <span class="math inline">\(z\)</span> et une variable spatiale décalée&nbsp;:</p>
<p><code>zx &lt;- (x - mean(x))/sd(x)     # variable X centrée réduite (cote z)</code></p>
<p><code>wzx &lt;- lag.listw(listW,zx)    # variable X centrée réduite spatialement décalée</code></p>
</div>
</div>
<p>Analysons les différents éléments du diagramme de Moran à la <a href="#fig-NuagePointsMoran">figure&nbsp;<span>2.30</span></a>&nbsp;:</p>
<ul>
<li>La droite de régression résume la relation linéaire entre la variable spatialement décalée (<span class="math inline">\(W.ZX\)</span>) et l’originale (<span class="math inline">\(ZX\)</span>). D’ailleurs, le coefficient de régression pour la variable <span class="math inline">\(ZX\)</span>, soit la pente de la droite, équivaut au <em>I</em> de Moran!</li>
<li>Les traits pointillés représentent les moyennes des deux variables, toutes deux égales à 0 puisqu’elles sont centrées-réduites (cote <span class="math inline">\(z\)</span>).</li>
</ul>
<p>Pour analyser ce nuage, nous le décomposons en quatre quadrants&nbsp;:</p>
<ol type="1">
<li><p>Le quadrant <strong>HH (<em>High-High</em>)</strong> en haut à droite regroupe des entités spatiales avec des valeurs <strong>fortes</strong> (H) qui sont voisines ou proches d’autres entités spatiales avec aussi des valeurs <strong>fortes</strong> (H). Nous sommes donc en présence <strong>d’autocorrélation spatiale locale positive avec des valeurs fortes (HH)</strong>.</p></li>
<li><p>Le quadrant <strong>LL (<em>Low-Low</em>)</strong> en bas à gauche regroupe des entités spatiales avec des valeurs <strong>faibles</strong> (L) qui sont voisines ou proches d’autres entités spatiales avec aussi des valeurs <strong>faibles</strong> (L). Nous sommes donc en présence <strong>d’autocorrélation spatiale locale positive avec des valeurs faibles (LL)</strong>.</p></li>
<li><p>Le quadrant <strong>HL (<em>High-Low</em>)</strong> en bas à droite regroupe des entités spatiales avec des valeurs <strong>fortes</strong> (H) qui sont voisines ou proches d’autres entités spatiales avec des valeurs <strong>faibles</strong> (L). Nous sommes donc en présence <strong>d’autocorrélation spatiale locale négative (HL)</strong>. Avec humour, un collègue économiste, Jean Dubé, qualifie ce quadrant de <strong>village gaulois</strong> (Obélix, Astérix et leurs compagnons sont très forts et ils sont entourés de voisins romains plus faibles…).</p></li>
<li><p>Le quadrant <strong>LH (<em>Low-High</em>)</strong> en haut à gauche regroupe des entités spatiales avec des valeurs <strong>faibles</strong> (L) qui sont voisines ou proches d’autres entités spatiales avec des valeurs <strong>fortes</strong> (H). Nous sommes donc en présence <strong>d’autocorrélation spatiale locale négative (LH)</strong>.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-NuagePointsMoran" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-NuagePointsMoran-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.30: Diagramme de Moran</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-02432" class="level4" data-number="2.4.3.2"><h4 data-number="2.4.3.2" class="anchored" data-anchor-id="sec-02432">
<span class="header-section-number">2.4.3.2</span> Mise en œuvre dans R</h4>
<p>Pour créer le diagramme de Moran, nous avons écrit la fonction <code>DiagMoranUnivarie</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"code_complementaire/DiagrammeMoran.R"</span><span class="op">)</span></span>
<span><span class="co">## Réalisation du diagramme de Moran avec la fonction DiagMoranUnivarie</span></span>
<span><span class="fu">DiagMoranUnivarie</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>,</span>
<span>  listW <span class="op">=</span> <span class="va">W.Rook</span>,</span>
<span>  titre <span class="op">=</span> <span class="st">"Diagramme de Moran (matrice de contiguïté selon le partage d'un segment)"</span>,</span>
<span>  titreAxeX <span class="op">=</span> <span class="st">"ZX : Revenu médian des ménages centré réduit"</span>,</span>
<span>  titreAxeY <span class="op">=</span> <span class="st">"WZ : Variable ZX spatialement décalée"</span>,</span>
<span>  AfficheAide<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-Autocorrelation_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Reste à déterminer si l’autocorrélation spatiale locale pour ces quatre quadrants est significative. Rien de plus simple, il suffit d’utiliser la valeur de <em>p</em> du <em>I</em> de Moran local (<a href="#sec-0242">section&nbsp;<span>2.4.2</span></a>). Nous choisissons un seuil de signification (habituellement <em>p</em>&nbsp;=&nbsp;0,05) et obtenons ainsi la typologie comprenant cinq catégories&nbsp;:</p>
<ul>
<li>Autocorrélation spatiale locale positive et significative (<em>p</em>&nbsp;&lt;&nbsp;0,05).
<ol type="1">
<li>HH</li>
<li>LL</li>
</ol>
</li>
<li>Autocorrélation spatiale locale négative et significative (<em>p</em>&nbsp;&lt;&nbsp;0,05).
<ol start="3" type="1">
<li>HL</li>
<li>LH</li>
</ol>
</li>
</ul>
<ol start="5" type="1">
<li>Autocorrélation spatiale locale non significative (<em>p</em>&nbsp;&gt;&nbsp;0,05).</li>
</ol>
<p>Le code R ci-dessous permet d’obtenir la typologie de l’autocorrélation spatiale avec le <em>I</em> de Moran local pour le revenu médian des ménages avec une matrice de contiguïté selon le partage d’un segment (<em>Rook</em>). La <a href="#fig-TypoIMoran">figure&nbsp;<span>2.31</span></a> dénote surtout une autocorrélation spatiale positive importante (respectivement 33 et 48&nbsp;aires de diffusion classées <em>HH</em> et <em>LL</em>), comparativement à l’autocorrélation spatiale négative qui ne comprend qu’une aire de diffusion (LH).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">## Cote Z (variable centrée réduite)</span></span>
<span><span class="va">zx</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span><span class="op">)</span></span>
<span><span class="co">## variable X centrée réduite spatialement décalée avec une matrice Rook</span></span>
<span><span class="va">wzx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lag.listw.html">lag.listw</a></span><span class="op">(</span><span class="va">W.Rook</span>, <span class="va">zx</span><span class="op">)</span>    </span>
<span><span class="co">## I de Moran local (notez que vous pouvez aussi utiliser la fonction localmoran_perm)</span></span>
<span><span class="va">localMoranI</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran.html">localmoran</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">RevMedMenage</span>, <span class="va">W.Rook</span><span class="op">)</span></span>
<span><span class="co">#localMoranI.mc   &lt;- localmoran_perm(AD.DR$RevMedMenage, W.Rook, n=999)</span></span>
<span><span class="va">plocalMoranI</span>  <span class="op">&lt;-</span> <span class="va">localMoranI</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## Choix d'un seuil de signification</span></span>
<span><span class="va">signif</span> <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="co">## Construction de la typologie</span></span>
<span><span class="va">Typologie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">localMoranI</span><span class="op">)</span><span class="op">$</span><span class="va">quadr</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="va">Typologie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">localMoranI</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">signif</span> <span class="op">~</span> <span class="va">Typologie</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Non sign."</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Enregistrement de la typologie dans un champ</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">TypoIMoran.RevMedian</span> <span class="op">&lt;-</span> <span class="va">Typologie</span></span>
<span><span class="va">AD.DR</span><span class="op">$</span><span class="va">TypoIMoran.RevMedian</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">TypoIMoran.RevMedian</span>,</span>
<span>                                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"High-High"</span>, <span class="st">"High-Low"</span>, <span class="st">"Low-Low"</span>, <span class="st">"Low-High"</span>, <span class="st">"Non sign."</span><span class="op">)</span>,</span>
<span>                                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HH"</span>, <span class="st">"HL"</span>, <span class="st">"LL"</span>, <span class="st">"LH"</span>, <span class="st">"Non sign."</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">AD.DR</span><span class="op">$</span><span class="va">TypoIMoran.RevMedian</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       HH        HL        LL        LH Non sign.      &lt;NA&gt; 
       33         0        48         1       167         0 </code></pre>
</div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Couleurs</span></span>
<span><span class="va">Couleurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HH"</span> <span class="op">=</span> <span class="st">"#FF0000"</span>,</span>
<span>              <span class="st">"HL"</span> <span class="op">=</span> <span class="st">"#f4ada8"</span>,</span>
<span>              <span class="st">"LL"</span> <span class="op">=</span><span class="st">"#0000FF"</span>,</span>
<span>              <span class="st">"LH"</span> <span class="op">=</span><span class="st">"#a7adf9"</span>,</span>
<span>              <span class="st">"Non sign."</span> <span class="op">=</span> <span class="st">"#eeeeee"</span><span class="op">)</span></span>
<span><span class="co">## Cartographie</span></span>
<span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">AD.DR</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"TypoIMoran.RevMedian"</span>, </span>
<span>              palette <span class="op">=</span> <span class="va">Couleurs</span>, </span>
<span>              title <span class="op">=</span><span class="st">"Autocorrélation spatiale locale"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_credits</span><span class="op">(</span><span class="st">"HH : Positive dans un contexte de valeurs fortes (HH)</span></span>
<span><span class="st">              LL : Négative dans un contexte de valeurs faibles (LL)</span></span>
<span><span class="st">              HL : Positive dans un contexte de valeurs fortes (HL)</span></span>
<span><span class="st">              LH : Négative dans un contexte de valeurs fortes (LH) </span></span>
<span><span class="st">              Non sign. : Non significative"</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>             position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span>
<span>             align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>frame<span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend.title.size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"center"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-TypoIMoran" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-TypoIMoran-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.31: Typologie de l’autocorrélation spatiale locale avec le <em>I</em> de Moran local</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Ne pas confondre les statistiques locales de Getis et Ord et la typologie avec le <em>I</em> de Moran local</strong>.</p>
</div>
<div class="bloc_attention-body">
<p>Succinctement, ces deux familles de mesures renvoient deux typologies différentes&nbsp;:</p>
<ul>
<li><p>Le <em>I</em> de Moran local comprend cinq classes&nbsp;: HH, LL, HL, LH et non significatif.</p></li>
<li><p>Les statistiques locales de Getis et Ord comprennent trois classes&nbsp;: points chauds (sensiblement l’équivalent de HH), points froids (sensiblement l’équivalent de LL) et non significatifs.</p></li>
</ul>
</div>
</div>
</section></section><section id="sec-0244" class="level3" data-number="2.4.4"><h3 data-number="2.4.4" class="anchored" data-anchor-id="sec-0244">
<span class="header-section-number">2.4.4</span> Version locale des statistiques de comptage de jointure (<em>Join Count Statistics</em>)</h3>
<p>Une version locale des statistiques de comptage de jointure a été proposée par Luc Anselin et Xun Li <span class="citation" data-cites="anselin2019operational">(<a href="references.html#ref-anselin2019operational" role="doc-biblioref">2019</a>)</span>. Au même titre que la version locale du <em>I</em> de Moran, elle consiste à désagréger localement le calcul de l’indicateur global. Pour chaque observation, nous comptons ainsi le nombre de paires 0-0 (WW) ou 1-1 (BB) pour une variable binaire.</p>
<p>Pour déterminer si les associations 0-0 et 1-1 sont plus fréquentes que celles attendues du hasard, il est recommandé d’utiliser un test d’inférence par permutations. Ce test n’est actuellement pas implémenté dans <code>spdep</code>, mais il est disponible dans le <em>package</em> <code>rgeoda</code> avec la fonction <code>local_joincount</code>. Nous reprenons ici l’exemple des deux variables identifiant une majorité de locataires (<code>loc_maj</code>) ou de propriétaires (<code>proprio_maj</code>) pour les aires de diffusion (AD) de la ville de Sherbrooke.</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geodacenter/rgeoda/">rgeoda</a></span><span class="op">)</span></span>
<span><span class="co">## Définition de la matrice de contiguïté avec rgeoda</span></span>
<span><span class="va">wmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html">queen_weights</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">)</span></span>
<span><span class="co">## Création de deux variables binaires avec des valeurs de 0 et 1</span></span>
<span><span class="co">## pour les locataires et propriétaires</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">loc_maj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">Locataire</span> <span class="op">&gt;</span> <span class="va">ADSherb</span><span class="op">$</span><span class="va">Proprietaire</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">proprio_maj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">Proprietaire</span> <span class="op">&gt;</span> <span class="va">ADSherb</span><span class="op">$</span><span class="va">Locataire</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## Calcul de la version locale du join count test</span></span>
<span><span class="va">testLoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_joincount.html">local_joincount</a></span><span class="op">(</span><span class="va">wmat</span>, <span class="va">ADSherb</span><span class="op">[</span><span class="st">"loc_maj"</span><span class="op">]</span>, permutations <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">testPro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_joincount.html">local_joincount</a></span><span class="op">(</span><span class="va">wmat</span>, <span class="va">ADSherb</span><span class="op">[</span><span class="st">"proprio_maj"</span><span class="op">]</span>, permutations <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Avec le code ci-dessous, nous cartographions les AD en fonction des seuils de significativité de la version locale du test. Sans surprise, les AD avec une autocorrélation spatiale significative sont les suivantes&nbsp;:</p>
<ul>
<li>celles au centre de la ville de Sherbrooke avec une majorité de locataires (<a href="#fig-LocalJointCountStatCarto">figure&nbsp;<span>2.32</span></a>, a);</li>
<li>celles de l’ouest de la ville avec une majorité de propriétaires (<a href="#fig-LocalJointCountStatCarto">figure&nbsp;<span>2.32</span></a>, b).</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">## Sauvegarde des résultats</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">testLoc_pvals</span> <span class="op">&lt;-</span> <span class="va">testLoc</span><span class="op">$</span><span class="va">p_vals</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">testPro_pvals</span> <span class="op">&lt;-</span> <span class="va">testPro</span><span class="op">$</span><span class="va">p_vals</span></span>
<span><span class="co">## Calcul d'une variable avec les seuils de significativité pour les locataires</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">clusterLoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">ADSherb</span><span class="op">$</span><span class="va">testLoc_pvals</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">ADSherb</span><span class="op">$</span><span class="va">testLoc_pvals</span> <span class="op">&gt;=</span> <span class="fl">0.01</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  <span class="va">ADSherb</span><span class="op">$</span><span class="va">testLoc_pvals</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">clusterLoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">clusterLoc</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non significatif (p &gt; 0,05)"</span>, </span>
<span>                                     <span class="st">"p = 0,05"</span>,<span class="st">"p = 0,01"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Calcul d'une variable avec les seuils de significativité pour les propriétaires</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">clusterPro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">ADSherb</span><span class="op">$</span><span class="va">testPro_pvals</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">ADSherb</span><span class="op">$</span><span class="va">testPro_pvals</span> <span class="op">&gt;=</span> <span class="fl">0.01</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  <span class="va">ADSherb</span><span class="op">$</span><span class="va">testPro_pvals</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ADSherb</span><span class="op">$</span><span class="va">clusterPro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ADSherb</span><span class="op">$</span><span class="va">clusterPro</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non significatif (p &gt; 0,05)"</span>, </span>
<span>                                     <span class="st">"p = 0,05"</span>,<span class="st">"p = 0,01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Cartographie des résultats</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">ADSherb</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"clusterLoc"</span>, </span>
<span>          palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#f0f0f0"</span>, <span class="st">"#fc9272"</span>, <span class="st">"#de2d26"</span><span class="op">)</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Seuil de significativité"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>            legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend.outside.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"a. Locataires majoritaires"</span>,</span>
<span>            title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">ADSherb</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"clusterPro"</span>, </span>
<span>          palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#f0f0f0"</span>, <span class="st">"#fc9272"</span>, <span class="st">"#de2d26"</span><span class="op">)</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Seuil de significativité"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>            legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend.outside.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"b. Propriétaires majoritaires"</span>,</span>
<span>            title.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-LocalJointCountStatCarto" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-LocalJointCountStatCarto-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.32: Cartographie de la version locale des statistiques de comptage de jointure</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0245" class="level3" data-number="2.4.5"><h3 data-number="2.4.5" class="anchored" data-anchor-id="sec-0245">
<span class="header-section-number">2.4.5</span> Version locale de l’indice de Lee</h3>
<section id="sec-02451" class="level4" data-number="2.4.5.1"><h4 data-number="2.4.5.1" class="anchored" data-anchor-id="sec-02451">
<span class="header-section-number">2.4.5.1</span> Formulation de la version locale de l’indice de Lee</h4>
<p>Dans le cas de l’autocorrélation spatiale bivariée, l’indice de Lee dispose aussi d’une version locale. Plus exactement, la version globale de l’indice correspond à l’agrégation des contributions locales de chaque observation. En cartographiant ces contributions locales, il est possible de se faire une idée de la relation spatiale entre les deux variables à l’étude. La version locale de l’indice est définie par l’<a href="#eq-LocalLee">équation&nbsp;<span>2.23</span></a>.</p>
<p><span id="eq-LocalLee"><span class="math display">\[
L_i=\frac{n \cdot\left[\left(\sum_i w_{i j}\left(x_j-\bar{x}\right)\right)\left(\sum_i w_{i j}\left(y_j-\bar{y}\right)\right)\right]}{\sqrt{\sum_i\left(x_i-\bar{x}\right)^2} \sqrt{\sum_i\left(y_i-\bar{y}\right)^2}}=\frac{n \cdot\left(\tilde{x}_i-\bar{x}\right)\left(\tilde{y}_i-\bar{y}\right)}{\sqrt{\sum_i\left(x_i-\bar{x}\right)^2} \sqrt{\sum_i\left(y_i-\bar{y}\right)^2}}
\tag{2.23}\]</span></span></p>
<p>Avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(n\)</span>, le nombre d’observations;</li>
<li>
<span class="math inline">\(W_{ij}\)</span>, la valeur de la pondération spatiale entre les entités spatiales <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>;</li>
<li>
<span class="math inline">\(\bar{x}\)</span>, la moyenne de la variable <em>x</em>;</li>
<li>
<span class="math inline">\(\bar{y}\)</span>, la moyenne de la variable <em>y</em>.</li>
</ul></section><section id="sec-02452" class="level4" data-number="2.4.5.2"><h4 data-number="2.4.5.2" class="anchored" data-anchor-id="sec-02452">
<span class="header-section-number">2.4.5.2</span> Mise en œuvre dans R</h4>
<p>Reprenons notre exemple précédent sur les pollutions atmosphériques à Lyon. Nous avions observé que le dioxyde d’azote partageait un patron d’autocorrélation spatiale positive forte avec les particules fines, et un patron moins prononcé avec le bruit. Nous allons observer ces deux relations à l’échelle locale.</p>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JeremyGelb/geocmeans">geocmeans</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"LyonIris"</span><span class="op">)</span></span>
<span><span class="co">## Liste de variables à analyser</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>,<span class="st">"NO2"</span>,<span class="st">"PM25"</span>,<span class="st">"VegHautPrt"</span><span class="op">)</span></span>
<span><span class="co">## Matrice de pondération spatiale Queen standardisée</span></span>
<span><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>, queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Wmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">nb</span>, style <span class="op">=</span> <span class="st">'W'</span><span class="op">)</span></span>
<span><span class="co">## Calcul de la version locale de l'indice de Lee entre </span></span>
<span><span class="co"># NO2 et PM25</span></span>
<span><span class="va">Lee_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.html">lee</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>, <span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span>, listw <span class="op">=</span> <span class="va">Wmat</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># NO2 et DBA</span></span>
<span><span class="va">Lee_2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.html">lee</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>, <span class="va">LyonIris</span><span class="op">$</span><span class="va">Lden</span>, listw <span class="op">=</span> <span class="va">Wmat</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans le <em>package</em> <code>spdep</code>, aucune fonction ne permet de calculer un test d’inférence pour les valeurs locales de Lee. Nous pouvons cependant assez facilement obtenir des pseudo valeurs de <em>p</em> en réalisant 999&nbsp;permutations aléatoires et en comptant combien de fois les valeurs obtenues au hasard sont plus grandes ou plus petites que celles obtenues dans les données initiales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Nous créons une matrice à deux colonnes remplies de zéros qui </span></span>
<span><span class="co">## servira à compter le nombre de fois où les valeurs des permutations </span></span>
<span><span class="co">## sont au-dessus ou en dessous des valeurs réelles</span></span>
<span><span class="va">p_vals_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="va">p_vals_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">999</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Permutation aléatoire de l'ordre des observations</span></span>
<span>  <span class="va">perm_data</span> <span class="op">&lt;-</span> <span class="va">LyonIris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="co"># Calcul de l'indice de Lee sur les données permutées</span></span>
<span>  <span class="va">Lee_1_perm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.html">lee</a></span><span class="op">(</span><span class="va">perm_data</span><span class="op">$</span><span class="va">NO2</span>, <span class="va">perm_data</span><span class="op">$</span><span class="va">PM25</span>, listw <span class="op">=</span> <span class="va">Wmat</span>, n <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span>  <span class="va">Lee_2_perm</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lee.html">lee</a></span><span class="op">(</span><span class="va">perm_data</span><span class="op">$</span><span class="va">NO2</span>, <span class="va">perm_data</span><span class="op">$</span><span class="va">Lden</span>, listw <span class="op">=</span> <span class="va">Wmat</span>, n <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span>  <span class="co"># Test pour vérifier si les valeurs obtenues sont plus grandes</span></span>
<span>  <span class="va">test1</span> <span class="op">&lt;-</span> <span class="va">Lee_1</span><span class="op">$</span><span class="va">localL</span> <span class="op">&lt;</span> <span class="va">Lee_1_perm</span><span class="op">$</span><span class="va">localL</span></span>
<span>  <span class="va">test2</span> <span class="op">&lt;-</span> <span class="va">Lee_2</span><span class="op">$</span><span class="va">localL</span> <span class="op">&lt;</span> <span class="va">Lee_2_perm</span><span class="op">$</span><span class="va">localL</span></span>
<span>  <span class="co"># Ajout du résultat aux matrices de valeurs de p</span></span>
<span>  <span class="va">p_vals_1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_vals_1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">test1</span></span>
<span>  <span class="va">p_vals_2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_vals_2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">test2</span></span>
<span>  <span class="co"># Test pour vérifier si les valeurs obtenues sont plus petites</span></span>
<span>  <span class="va">test1</span> <span class="op">&lt;-</span> <span class="va">Lee_1</span><span class="op">$</span><span class="va">localL</span> <span class="op">&gt;</span> <span class="va">Lee_1_perm</span><span class="op">$</span><span class="va">localL</span></span>
<span>  <span class="va">test2</span> <span class="op">&lt;-</span> <span class="va">Lee_2</span><span class="op">$</span><span class="va">localL</span> <span class="op">&gt;</span> <span class="va">Lee_2_perm</span><span class="op">$</span><span class="va">localL</span></span>
<span>  <span class="co"># Ajout du résultat aux matrices de valeurs de p</span></span>
<span>  <span class="va">p_vals_1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_vals_1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">test1</span></span>
<span>  <span class="va">p_vals_2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_vals_2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">test2</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Ajout des données originales</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee1</span> <span class="op">&lt;-</span> <span class="va">Lee_1</span><span class="op">$</span><span class="va">localL</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee2</span> <span class="op">&lt;-</span> <span class="va">Lee_2</span><span class="op">$</span><span class="va">localL</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee1_p_higher</span> <span class="op">&lt;-</span> <span class="va">p_vals_1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fl">999</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee1_p_lower</span> <span class="op">&lt;-</span> <span class="va">p_vals_1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fl">999</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee2_p_higher</span> <span class="op">&lt;-</span> <span class="va">p_vals_2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fl">999</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee2_p_lower</span> <span class="op">&lt;-</span> <span class="va">p_vals_2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fl">999</span></span>
<span></span>
<span><span class="co">## Cartographie des résultats avec deux cartes dans lesquelles</span></span>
<span><span class="co">## les valeurs non significatives au seuil 0,01 sont représentées en gris clair.</span></span>
<span><span class="va">test_sign1</span> <span class="op">&lt;-</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee1_p_higher</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">|</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee1_p_lower</span> <span class="op">&lt;</span> <span class="fl">0.01</span></span>
<span><span class="va">map1</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu">tm_borders</span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="va">test_sign1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">'Lee1'</span>, n <span class="op">=</span> <span class="fl">5</span>, style <span class="op">=</span> <span class="st">'kmeans'</span>, midpoint <span class="op">=</span> <span class="fl">0</span>, palette <span class="op">=</span> <span class="st">'-RdBu'</span>,</span>
<span>              legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span>, text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>              title <span class="op">=</span> <span class="st">'Indice de Lee'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="op">!</span><span class="va">test_sign1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">'lightgrey'</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">FALSE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"a. NO2 versus PM25"</span>, title.size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_credits</span><span class="op">(</span>text<span class="op">=</span><span class="st">"Gris : non significatif (p &gt; 0,001)."</span>,</span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_sign2</span> <span class="op">&lt;-</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee2_p_higher</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">|</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">Lee2_p_lower</span> <span class="op">&lt;</span> <span class="fl">0.01</span></span>
<span><span class="va">map2</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span><span class="fu">tm_borders</span><span class="op">(</span>col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="va">test_sign2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">'Lee2'</span>, n <span class="op">=</span> <span class="fl">5</span>, style <span class="op">=</span> <span class="st">'kmeans'</span>, palette <span class="op">=</span> <span class="st">'-RdBu'</span>,</span>
<span>              legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span>, text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>              title <span class="op">=</span> <span class="st">'Indice de Lee'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="op">!</span><span class="va">test_sign2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">'lightgrey'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">FALSE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"b. NO2 versus Lden"</span>, title.size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_credits</span><span class="op">(</span>text<span class="op">=</span><span class="st">"Gris : non significatif (p &gt; 0,001)."</span>,</span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RIGHT"</span>, <span class="st">"BOTTOM"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">map1</span>, <span class="va">map2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-localLeeMaps" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-localLeeMaps-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.33: Cartographie des valeurs de l’indice de Lee local</figcaption></figure>
</div>
</div>
</div>
<p>À la <a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a> (a), nous constatons une forte autocorrélation spatiale bivariée positive dans deux secteurs de l’agglomération&nbsp;:</p>
<ul>
<li><p>Au centre avec des entités spatiales ayant des valeurs fortes pour les deux variables.</p></li>
<li><p>Dans les zones périphériques au nord, à l’est et à l’ouest avec des entités spatiales ayant des valeurs faibles pour les deux variables.</p></li>
</ul>
<p>À la <a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a> (b), nous observons trois patrons d’autocorrélation spatiale bivariée&nbsp;:</p>
<ul>
<li><p>Autocorrélation spatiale positive pour des entités spatiales au centre de l’agglomération avec des valeurs fortes de bruit et de dioxyde d’azote.</p></li>
<li><p>Autocorrélation spatiale positive pour des entités spatiales au nord de l’agglomération avec des valeurs faibles de bruit et de dioxyde d’azote.</p></li>
<li><p>Autocorrélation spatiale négative à l’est de l’agglomération avec des valeurs fortes pour le bruit, mais faibles pour le dioxyde d’azote.</p></li>
</ul>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Autocorrélation spatiale multivariée</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Il est possible d’analyser l’autocorrélation spatiale dans un contexte multivarié. Cependant, ces méthodes sont parfois difficiles à interpréter, car l’augmentation de la dimensionnalité des données analysées ajoute un haut niveau d’abstraction. Si ces méthodes vous intéressent, nous vous recommandons de jeter un œil à&nbsp;:</p>
<ul>
<li><p>L’indice de Geary multivarié local <span class="citation" data-cites="anselin2019local">(<a href="references.html#ref-anselin2019local" role="doc-biblioref">Anselin 2019</a>)</span>, qui peut être calculé facilement dans R (avec la fonction <code>local_multigeary</code> du <em>package</em> <code>rgeoda</code>) en faisant la moyenne des valeurs locales de l’indice de Geary univarié.</p></li>
<li><p>Les méthodes factorielles intégrant l’espace, dont l’analyse en composantes principales spatiales (<em>spatial principal component analysis</em> en anglais, SPCA) <span class="citation" data-cites="jombart2008revealing">(<a href="references.html#ref-jombart2008revealing" role="doc-biblioref">Jombart et al. 2008</a>)</span> qui permet d’identifier des facteurs maximisant le produit de la variance expliquée d’un ensemble de variables continues et l’autocorrélation spatiale de ces facteurs (mesurée avec le <em>I</em> de Moran). Dans R, les <em>packages</em> pertinents pour ces méthodes sont <code>adegenet</code> et <code>ade4</code>.</p></li>
</ul>
</div>
</div>
</section></section><section id="sec-0246" class="level3" data-number="2.4.6"><h3 data-number="2.4.6" class="anchored" data-anchor-id="sec-0246">
<span class="header-section-number">2.4.6</span> Typologie basée sur le diagramme de Moran dans un contexte bivarié</h3>
<section id="sec-02461" class="level4" data-number="2.4.6.1"><h4 data-number="2.4.6.1" class="anchored" data-anchor-id="sec-02461">
<span class="header-section-number">2.4.6.1</span> Formulation de la typologie basée sur le diagramme de Moran dans un contexte bivarié</h4>
<p>À la <a href="#sec-0243">section&nbsp;<span>2.4.3</span></a>, nous avons décrit la construction du diagramme de Moran dans un contexte univarié avec la variable centrée réduite (<strong>ZX</strong>) sur l’axe des X et la variable centrée réduite spatialement décalée (<strong>WZX</strong>) sur l’axe des Y. Par la suite, ce diagramme est décomposé en quatre quadrants (HH, LL, HL, LH). Cette démarche peut être adaptée à un contexte bivarié avec deux variables continues, c’est-à-dire avec <strong>ZX</strong> et <strong>WZY</strong> pour construire le diagramme. Les quatre quadrants s’interprètent alors comme suit (<a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a>)&nbsp;:</p>
<ol type="1">
<li><p><strong>HH (<em>High-High</em>)</strong> regroupe des entités spatiales avec des valeurs fortes (H) pour la variable X qui sont voisines ou proches d’autres entités spatiales avec des valeurs fortes pour la variable Y (H). Nous sommes donc en présence <strong>d’autocorrélation spatiale locale bivariée positive avec des valeurs fortes (HH)</strong>.</p></li>
<li><p><strong>LL (<em>Low-Low</em>)</strong> regroupe des entités spatiales avec des valeurs faibles (L) pour la variable X qui sont voisines ou proches d’autres entités spatiales avec des valeurs faibles pour la variable Y (L). Nous sommes donc en présence <strong>d’autocorrélation spatiale locale bivariée positive avec des valeurs faibles (LL)</strong>.</p></li>
<li><p><strong>HL (<em>High-Low</em>)</strong> regroupe des entités spatiales avec des valeurs fortes (H) pour la variable X qui sont voisines ou proches d’autres entités spatiales avec des valeurs faibles pour la variable Y (L), soit de <strong>l’autocorrélation spatiale locale bivariée négative (HL)</strong>.</p></li>
<li><p><strong>LH (<em>Low-High</em>)</strong> regroupe des entités spatiales avec des valeurs faibles (L) pour la variable X qui sont voisines ou proches d’autres entités spatiales avec des valeurs fortes (H) pour la variable Y, soit de <strong>l’autocorrélation spatiale bivariée locale négative (LH)</strong>.</p></li>
</ol>
<p>Pour déterminer si l’autocorrélation spatiale locale (positive ou négative) pour les quatre est significative, nous utilisons la valeur de <em>p</em> de la version locale du <em>I</em> de Moran bivariée (habituellement p = 0,05).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-NuagePointsMoranBivariee" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-NuagePointsMoranBivariee-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.34: Diagramme de Moran dans un contexte bivarié</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Non-symétrie du <em>I</em> de Moran bivarié et du diagramme de Moran dans un contexte bivarié</strong></p>
</div>
<div class="bloc_attention-body">
<p>À titre de rappel, le diagramme est construit avec <strong>ZX</strong> et <strong>WZY</strong>, tout comme l’indice de Moran bivarié. Par conséquent, les résultats entre <strong>ZX</strong> et <strong>WZY</strong> (<a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a>, a) et <strong>ZY</strong> et <strong>WZX</strong> (<a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a>, b) ne sont pas identiques!</p>
</div>
</div>
</section><section id="sec-02462" class="level4" data-number="2.4.6.2"><h4 data-number="2.4.6.2" class="anchored" data-anchor-id="sec-02462">
<span class="header-section-number">2.4.6.2</span> Mise en œuvre dans R</h4>
<p>Pour créer le diagramme de Moran dans un contexte bivarié, nous avons écrit la fonction <code>DiagMoranUnivarie</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"code_complementaire/DiagrammeMoran.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="co">## Matrice de contiguïté</span></span>
<span><span class="va">Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">W.Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Réalisation du diagramme de Moran avec la fonction DiagMoranBivarie</span></span>
<span><span class="va">Diag1</span> <span class="op">&lt;-</span> <span class="fu">DiagMoranBivarie</span><span class="op">(</span>x <span class="op">=</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span>,</span>
<span>                 listW <span class="op">=</span> <span class="va">W.Queen</span>,</span>
<span>                 titre <span class="op">=</span> <span class="st">"Diagramme de Moran"</span>,</span>
<span>                 titreAxeX <span class="op">=</span> <span class="st">"ZX : Dioxyde d'azote (NO2)"</span>,</span>
<span>                 titreAxeY <span class="op">=</span> <span class="st">"WZY : Particules fines (PM2,5)"</span>,</span>
<span>                 AfficheAide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Diag2</span> <span class="op">&lt;-</span> <span class="fu">DiagMoranBivarie</span><span class="op">(</span>x <span class="op">=</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>,</span>
<span>                 listW <span class="op">=</span> <span class="va">W.Queen</span>,</span>
<span>                 titre <span class="op">=</span> <span class="st">"Diagramme de Moran"</span>,</span>
<span>                 titreAxeX <span class="op">=</span> <span class="st">"ZX : Particules fines (PM2,5)"</span>,</span>
<span>                 titreAxeY <span class="op">=</span> <span class="st">"WZY : Dioxyde d'azote (NO2)"</span>,</span>
<span>                 AfficheAide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">Diag1</span>, <span class="va">Diag2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-Autocorrelation_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pour mettre en œuvre la typologie, vous pouvez utiliser soit la fonction <code>local_bimoran</code> du <em>package</em> <code>rgeoda</code>, soit la fonction <code>localmoran_bv</code> du <em>package</em> <code>spdep</code>. Cette dernière est mobilisée dans le code ci-dessous pour obtenir la typologie de l’autocorrélation spatiale bivariée entre&nbsp;:</p>
<ul>
<li><p>Le dioxyde d’azote (<strong>ZX</strong>) et les particules fines (<strong>ZWY</strong>) (<a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a>, a).</p></li>
<li><p>Les particules fines (<strong>ZX</strong>) et le dioxyde d’azote (<strong>ZWY</strong>) (<a href="#fig-localLeeMaps">figure&nbsp;<span>2.33</span></a>, b).</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span>
<span><span class="co">## Matrice de contiguïté</span></span>
<span><span class="va">Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">W.Queen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Queen</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">## Variables centrées réduites</span></span>
<span><span class="va">z.no2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span><span class="op">)</span></span>
<span><span class="va">z.pm25</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span><span class="op">)</span></span>
<span><span class="co">## Variables spatialement décalées</span></span>
<span><span class="va">wz.no2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lag.listw.html">lag.listw</a></span><span class="op">(</span><span class="va">W.Queen</span>, <span class="va">z.no2</span><span class="op">)</span></span>
<span><span class="va">wz.pm25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lag.listw.html">lag.listw</a></span><span class="op">(</span><span class="va">W.Queen</span>, <span class="va">z.pm25</span><span class="op">)</span></span>
<span><span class="co">## I de Moran local bivarié</span></span>
<span><span class="va">localMoranBivariee_NO2_PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran_bv.html">localmoran_bv</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>, <span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span>, <span class="va">W.Queen</span>, nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">localMoranBivariee_PM25_NO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/localmoran_bv.html">localmoran_bv</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">PM25</span>, <span class="va">LyonIris</span><span class="op">$</span><span class="va">NO2</span>, <span class="va">W.Queen</span>, nsim <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="co">## Valeur de p du I de Moran bivariée</span></span>
<span><span class="va">plocalMoranI_NO2_PM25</span>  <span class="op">&lt;-</span> <span class="va">localMoranBivariee_NO2_PM25</span><span class="op">[</span>, <span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">plocalMoranI_PM25_NO2</span>  <span class="op">&lt;-</span> <span class="va">localMoranBivariee_PM25_NO2</span><span class="op">[</span>, <span class="fl">7</span><span class="op">]</span></span>
<span><span class="co">## Choix d'un seuil de signification</span></span>
<span><span class="va">signif</span> <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="co">## Construction de la typologie NO2 versus PM25</span></span>
<span><span class="va">TypoNO2_PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.no2</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.pm25</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"1. HH"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">TypoNO2_PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.no2</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.pm25</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"2. LL"</span>, <span class="va">TypoNO2_PM25</span><span class="op">)</span></span>
<span><span class="va">TypoNO2_PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.no2</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.pm25</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"3. HL"</span>, <span class="va">TypoNO2_PM25</span><span class="op">)</span></span>
<span><span class="va">TypoNO2_PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.no2</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.pm25</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"4. LH"</span>, <span class="va">TypoNO2_PM25</span><span class="op">)</span></span>
<span><span class="va">TypoNO2_PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">plocalMoranI_NO2_PM25</span> <span class="op">&gt;</span> <span class="va">signif</span>, <span class="st">"Non sign"</span>, <span class="va">TypoNO2_PM25</span><span class="op">)</span></span>
<span><span class="co">## Construction de la typologie PM25 versus NO2 </span></span>
<span><span class="va">TypoPM25_NO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.pm25</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.no2</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"1. HH"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">TypoPM25_NO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.pm25</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.no2</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"2. LL"</span>, <span class="va">TypoPM25_NO2</span><span class="op">)</span></span>
<span><span class="va">TypoPM25_NO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.pm25</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.no2</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"3. HL"</span>, <span class="va">TypoPM25_NO2</span><span class="op">)</span></span>
<span><span class="va">TypoPM25_NO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.pm25</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">wz.no2</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"4. LH"</span>, <span class="va">TypoPM25_NO2</span><span class="op">)</span></span>
<span><span class="va">TypoPM25_NO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">plocalMoranI_PM25_NO2</span> <span class="op">&gt;</span> <span class="va">signif</span>, <span class="st">"Non sign"</span>, <span class="va">TypoPM25_NO2</span><span class="op">)</span></span>
<span><span class="co">## Enregistrement des résultats dans la couche LyonIRS</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">TypoNO2_PM25</span> <span class="op">&lt;-</span> <span class="va">TypoNO2_PM25</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">TypoPM25_NO2</span> <span class="op">&lt;-</span> <span class="va">TypoPM25_NO2</span></span>
<span><span class="co">## Couleurs</span></span>
<span><span class="va">Couleurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1. HH"</span> <span class="op">=</span> <span class="st">"#FF0000"</span>,</span>
<span>              <span class="st">"2. LL"</span> <span class="op">=</span><span class="st">"#0000FF"</span>,</span>
<span>              <span class="st">"3. HL"</span> <span class="op">=</span> <span class="st">"#f4ada8"</span>,</span>
<span>              <span class="st">"4. LH"</span> <span class="op">=</span><span class="st">"#a7adf9"</span>,</span>
<span>              <span class="st">"Non sign"</span> <span class="op">=</span> <span class="st">"#eeeeee"</span><span class="op">)</span></span>
<span><span class="co">## Cartographie</span></span>
<span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"TypoNO2_PM25"</span>,</span>
<span>              palette <span class="op">=</span> <span class="va">Couleurs</span>,</span>
<span>              title <span class="op">=</span><span class="st">"Typologie"</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_layout</span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                      legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      legend.outside.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span>,</span>
<span>                      title <span class="op">=</span> <span class="st">"a. NO2 versus PM2,5"</span>,</span>
<span>                      title.size <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">tm_polygons</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"TypoPM25_NO2"</span>,</span>
<span>              palette <span class="op">=</span> <span class="va">Couleurs</span>,</span>
<span>              title <span class="op">=</span><span class="st">"Typologie"</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu">tm_layout</span><span class="op">(</span>frame <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                      legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      legend.outside.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span>,</span>
<span>                      title <span class="op">=</span> <span class="st">"b. PM2,5 versus NO2"</span>,</span>
<span>                      title.size <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-TypoDiagBivariee" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-TypoDiagBivariee-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.35: Typologies basées sur le diagramme de Moran dans un contexte bivarié</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Autocorrélation spatiale locale dans un contexte bivarié pour les variables binaires</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>À la <a href="#sec-0244">section&nbsp;<span>2.4.4</span></a>, nous avons abordé les statistiques locales de comptage de jointure. Tout comme la version locale de <em>I</em> de Moran, elles peuvent être adaptées à un contexte bivarié avec deux variables binaires. Pour ce faire, vous pouvez utiliser la fonction <code>local_bijoincount</code> du <em>package</em> <code>rgeoda</code>.</p>
</div>
</div>
</section></section><section id="sec-0247" class="level3" data-number="2.4.7"><h3 data-number="2.4.7" class="anchored" data-anchor-id="sec-0247">
<span class="header-section-number">2.4.7</span> Autocorrélation locale pour une variable qualitative (catégorielle)&nbsp;: l’indicateur ELSA</h3>
<section id="sec-02471" class="level4" data-number="2.4.7.1"><h4 data-number="2.4.7.1" class="anchored" data-anchor-id="sec-02471">
<span class="header-section-number">2.4.7.1</span> Formulation de l’indicateur ELSA</h4>
<p>Récemment, un indicateur basé sur la mesure de l’entropie locale a été proposé pour mesurer l’autocorrélation spatiale locale d’une variable qualitative comprenant plusieurs modalités (catégories) <span class="citation" data-cites="naimi2019elsa">(<a href="references.html#ref-naimi2019elsa" role="doc-biblioref">Naimi et al. 2019</a>)</span>. Cet indicateur ELSA (<em>Entropy-based local indicator of spatial association</em>), qui varie de 0 (autocorrélation spatiale parfaite) à 1 (forte hétérogénéité spatiale), est calculé comme suit&nbsp;:</p>
<p><span id="eq-ELSA1"><span class="math display">\[
\begin{aligned}
E_i=E_{a i} \times E_{c i} \\
&amp; E_{a i}=\frac{\sum_j \omega_{i j} d_{i j}}{\max \{d\} \sum_j \omega_{i j}}, j \neq i \\
&amp; E_{c i}=-\frac{\sum_{k=1}^{m_\omega} p_k \log _2\left(p_k\right)}{\log _2 m_i}, j \neq i \\
&amp; m_i=\left\{\begin{array}{l}
m \text { if } \sum_j \omega_{i j}&gt;m \\
\sum_j \omega_{i j}, \text { otherwise }
\end{array}\right. \\
&amp; d_{i j}=\left|c_i-c_j\right|
\end{aligned}
\tag{2.24}\]</span></span></p>
<p>Il s’agit donc du produit de deux termes, soit <span class="math inline">\(E_{a i}\)</span> et <span class="math inline">\(E_{c i}\)</span>. Le premier mesure la dissimilarité entre l’observation <em>i</em> et ses voisins <em>j</em>. Le second est l’indice d’entropie de Shannon et quantifie la diversité des observations voisines de <em>i</em>.</p>
<p>L’indicateur ELSA a la particularité de tenir compte du degré de dissimilarité entre les modalités (catégories) de la variable qualitative à l’étude. Aussi, il permet de spécifier qu’une catégorie <em>A</em> est plus ressemblante à une catégorie <em>B</em> qu’à une catégorie <em>C</em>. Or, nous supposons habituellement que <em>A</em> est différent de <em>B</em> et de <em>C</em>, ce qui produit une matrice des distances sémantiques binaire, telle que présentée au <a href="#tbl-TabMatriceSemantique1">tableau&nbsp;<span>2.11</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TabMatriceSemantique1" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.11: Matrice des distances sémantiques classique (binaire)</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Toutefois, si nous considérons que les catégories <em>A</em> et <em>B</em> sont plus proches entre elles que de la catégorie <em>C</em>, la matrice des distances sémantiques devrait être différente comme présentée au <a href="#tbl-TabMatriceSemantique2">tableau&nbsp;<span>2.12</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TabMatriceSemantique2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.12: Matrice des distances sémantiques modifiée</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: center;">0,0</td>
<td style="text-align: center;">0,5</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: center;">0,5</td>
<td style="text-align: center;">0,0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Pour déterminer si l’autocorrélation spatiale est significative, Babak Naimi et ses collègues <span class="citation" data-cites="naimi2019elsa">(<a href="references.html#ref-naimi2019elsa" role="doc-biblioref">2019</a>)</span> proposent une approche par simulations Monte-Carlo, très semblable aux tests par permutations vus pour les autres mesures d’autocorrélation spatiale.</p>
</section><section id="sec-02472" class="level4" data-number="2.4.7.2"><h4 data-number="2.4.7.2" class="anchored" data-anchor-id="sec-02472">
<span class="header-section-number">2.4.7.2</span> Mise en œuvre dans R</h4>
<p>Nous illustrons ici comment calculer l’indice <em>ELSA</em> sur des données matricielles (<em>raster</em>) avec une image dérivée d’un modèle numérique de terrain (élévation) et d’une image d’un indice de végétation par différence normalisée (NDVI) (<a href="#fig-figLaval">figure&nbsp;<span>2.36</span></a>). Cette image est en accès libre sur le <a href="https://observatoire.cmm.qc.ca/produits/donnees-georeferencees/#indice_canopee">portail de données</a> de la Communauté métropolitaine de Montréal. Pour accélérer les calculs, nous avons extrait une petite partie de l’image qui couvre une zone de la ville de Laval. Cette image classifie le territoire en quatre catégories&nbsp;:</p>
<ol type="1">
<li>Minéral bas (&lt;&nbsp;3&nbsp;mètres et NDVI&nbsp;&lt;&nbsp;0,3) (route, stationnement, etc.).</li>
<li>Minéral haut (&gt;=&nbsp;3&nbsp;mètres et NDVI&nbsp;&lt;&nbsp;0,3) (construction).</li>
<li>Végétal bas (&lt;&nbsp;3&nbsp;mètres et NDVI&nbsp;&gt;=&nbsp;0,3) (culture, gazon, etc.).</li>
<li>Végétal haut (&gt;=&nbsp;3&nbsp;mètres et NDVI&nbsp;&gt;=&nbsp;0,3) (canopée).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JeremyGelb/geocmeans">geocmeans</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="co">## Chargement du raster</span></span>
<span><span class="va">laval_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="st">"data/chap02/65005_IndiceCanopee_2021_sub.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">laval_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#fbd4b4"</span>, <span class="st">"#e36c0a"</span>, <span class="st">"#92d050"</span>, <span class="st">"#76923c"</span><span class="op">)</span>,</span>
<span>            style <span class="op">=</span> <span class="st">'cat'</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Classe (catégorie)"</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1. Minéral bas"</span>, <span class="st">"2. Minéral haut"</span>,</span>
<span>                       <span class="st">"3. Végétal bas"</span>, <span class="st">"4. Végétal haut"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-figLaval" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-figLaval-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.36: Données matricielles sur une portion du territoire de Laval</figcaption></figure>
</div>
</div>
</div>
<p>Pour calculer l’indicateur ELSA, nous devons premièrement définir une matrice de voisinage. Pour ce faire, nous créons plusieurs fenêtres circulaires de taille différente (100, 200, 300 et 400&nbsp;mètres; <a href="#fig-chap02FigureCirculaWindow">figure&nbsp;<span>2.37</span></a>). Notez que la résolution spatiale de l’image utilisée est de 5&nbsp;m&nbsp;x&nbsp;5&nbsp;m, ce qui est possible de vérifier avec la fonction <code><a href="https://rdrr.io/pkg/terra/man/dimensions.html">terra::res</a></code>. La <a href="#fig-chap02FigureCirculaWindow">figure&nbsp;<span>2.37</span></a> illustre la taille des différentes matrices spatiales circulaires que nous allons construire. Chaque pixel de la zone en noir sera considéré comme un voisin du pixel central pour lequel l’indicateur <em>ELSA</em> sera calculé.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-chap02FigureCirculaWindow" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-chap02FigureCirculaWindow-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.37: Illustration des matrices spatiales circulaires sur une image</figcaption></figure>
</div>
</div>
</div>
<p>En plus de la matrice spatiale, nous devons définir une matrice de dissimilarité entre les modalités (catégories) de la variable qualitative. Nous proposons de considérer que les catégories <strong>Végétal haut</strong> et <strong>Végétal bas</strong> ont une distance de 0,5 entre elles, tout comme les catégories de surface <strong>Minéral bas</strong> et <strong>Minéral haut</strong>. Par contre, la distance est fixée à 1 entre les surfaces végétales et celles minérales (<a href="#tbl-TabMatriceSemantiqueELSA">tableau&nbsp;<span>2.13</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-TabMatriceSemantiqueELSA" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;2.13: Matrice de dissimilarité entre les catégories de l’image</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">MB</th>
<th style="text-align: center;">MH</th>
<th style="text-align: center;">VB</th>
<th style="text-align: center;">VH</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Minéral bas (MB)</td>
<td style="text-align: center;">0,0</td>
<td style="text-align: center;">0,5</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">1,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Minéral haut (MH)</td>
<td style="text-align: center;">0,5</td>
<td style="text-align: center;">0,0</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">1,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Végétal bas (VB)</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">0,0</td>
<td style="text-align: center;">0,5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Végétal haut (VH)</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">1,0</td>
<td style="text-align: center;">0,5</td>
<td style="text-align: center;">0,0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Finalement, nous calculons l’indicateur d’autocorrélation spatiale ELSA avec uniquement des rayons de 100 et de 400&nbsp;mètres afin de limiter le temps de calcul. Pour ce faire, nous utilisons le <em>package</em> <code>geocmeans</code> et ses fonctions <code>circular_window</code> et <code>elsa_raster</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Avec geocmeans, la première catégorie doit avoir la valeur 0</span></span>
<span><span class="va">laval_data</span> <span class="op">&lt;-</span> <span class="va">laval_data</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="co">## Définition des fenêtres circulaires à 100 et 400 mètre</span></span>
<span><span class="va">w100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/circular_window.html">circular_window</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">w400</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/circular_window.html">circular_window</a></span><span class="op">(</span><span class="fl">400</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## Calcul de l'indicateur ELSA</span></span>
<span><span class="va">elsa_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/elsa_raster.html">elsa_raster</a></span><span class="op">(</span><span class="va">laval_data</span>, <span class="va">w100</span>, <span class="va">matrice_dissim</span><span class="op">)</span></span>
<span><span class="va">elsa_400</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/elsa_raster.html">elsa_raster</a></span><span class="op">(</span><span class="va">laval_data</span>, <span class="va">w400</span>, <span class="va">matrice_dissim</span><span class="op">)</span></span>
<span><span class="co">## Cartographie des résultats</span></span>
<span><span class="va">carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">elsa_100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, n <span class="op">=</span> <span class="fl">6</span>, </span>
<span>            legend.is.portrait <span class="op">=</span> <span class="cn">FALSE</span>, title <span class="op">=</span> <span class="st">"ELSA 100m"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.outside.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>            legend.stack <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>            legend.text.size <span class="op">=</span> <span class="fl">.55</span><span class="op">)</span></span>
<span><span class="va">carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">elsa_400</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, n <span class="op">=</span> <span class="fl">6</span>, </span>
<span>            legend.is.portrait <span class="op">=</span> <span class="cn">FALSE</span>, title <span class="op">=</span> <span class="st">"ELSA 400m"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.outside.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>            legend.stack <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>            legend.text.size <span class="op">=</span> <span class="fl">.55</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">carte1</span>, <span class="va">carte2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-chap02FigureElsaLaval" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-chap02FigureElsaLaval-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.38: Cartographie des valeurs ELSA obtenues</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-chap02FigureElsaLaval">figure&nbsp;<span>2.38</span></a> révèle que l’utilisation d’une matrice circulaire de 400&nbsp;mètres lisse trop les résultats. Par conséquent, nous privilégions ceux obtenus avec une matrice circulaire de 100&nbsp;mètres. Puis, avec le code ci-dessous, nous souhaitons identifier les bâtiments avec un environnement immédiat (défini à 100&nbsp;mètres) avec une forte hétérogénéité spatiale, c’est-à-dire végétalisé.</p>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Nous isolons les bâtiments avec forte dissimilarité à proximité</span></span>
<span><span class="co"># la valeur de l'image de sortie (buildings_green) sera 1</span></span>
<span><span class="va">buildings_green</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">laval_data</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">elsa_100</span> <span class="op">&gt;=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="co"># Nous isolons les bâtiments avec faible dissimilarité à proximité</span></span>
<span><span class="co"># la valeur de l'image de sortie (buildings_other) sera 2</span></span>
<span><span class="va">buildings_other</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">laval_data</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">elsa_100</span> <span class="op">&lt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="co"># Nous combinons les deux images</span></span>
<span><span class="va">raster_buildings</span> <span class="op">&lt;-</span> <span class="va">buildings_green</span> <span class="op">+</span> <span class="va">buildings_other</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_tiles.html">tm_basemap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Esri.WorldImagery"</span>, <span class="st">"OpenStreetMap"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">raster_buildings</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="fl">0</span><span class="op">)</span>,  <span class="st">"green"</span>, <span class="st">"grey"</span><span class="op">)</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Bâtiments"</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Transparent (0) : autre que bâtiments"</span>,</span>
<span>                       <span class="st">"Vert (1) : forte dissimilarité"</span>, </span>
<span>                       <span class="st">"Gris (2) : faible dissimilarité"</span><span class="op">)</span>,</span>
<span>            style <span class="op">=</span> <span class="st">'cat'</span>, zindex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e69034e356aca9763715" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e69034e356aca9763715">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap001",1]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Esri.WorldImagery",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addRasterImage","args":["data:image/png;base64,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",[[45.627983010947,-73.6998417458048],[45.6096134260689,-73.6685051154794]],1,null,"tmap001","raster_buildings"]},{"method":"addLegend","args":[{"colors":["#FFFFFF","#00FF00","#BEBEBE"],"labels":["Transparent (0) : autre que bâtiments","Vert (1) : forte dissimilarité","Gris (2) : faible dissimilarité"],"na_color":null,"na_label":"NA","opacity":0,"position":"topright","type":"unknown","title":"Bâtiments","extra":null,"layerId":"legend001","className":"info legend raster_buildings","group":"raster_buildings"}]},{"method":"addLayersControl","args":[["Esri.WorldImagery","OpenStreetMap"],"raster_buildings",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[45.6096134260689,45.627983010947],"lng":[-73.6998417458048,-73.6685051154794]},"fitBounds":[45.6096552357132,-73.6998417458048,45.627983010947,-73.6685183691791,[]]},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Sur la carte ci-dessus, nous distinguons clairement deux groupes de bâtiments avec une forte hétérogénéité spatiale dans leur environnement immédiat (en vert)&nbsp;: ceux en bordure du quartier résidentiel et ceux situés le long des rangs Saint-Elzéar Est et Haut-Saint-François au nord-ouest. À l’inverse, les bâtiments au cœur du quartier résidentiel de banlieue affichent une faible hétérogénéité spatiale dans leur environnement immédiat (en gris).</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Indicateur ELSA : données vectorielles et test d’inférence</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p><strong>Données vectorielles</strong></p>
<p>Si les données sont vectorielles et non matricielles, il convient alors d’utiliser la fonction <code>elsa_vector</code> du <em>package</em> <code>geocmeans</code>.</p>
<p><strong>Indicateur ELSA et test d’inférence</strong></p>
<p>Dans les fonctions <code>elsa_raster</code> et <code>elsa_vector</code>, aucun test d’inférence n’est implémenté pour obtenir une valeur de <em>p</em> locale. Toutefois, il est assez facile dans R d’appliquer la méthode par simulation Monte-Carlo décrite dans l’article de Naimi <em>et al.</em> <span class="citation" data-cites="naimi2019elsa">(<a href="references.html#ref-naimi2019elsa" role="doc-biblioref">2019</a>)</span>. Appliquée à des données matricielles, la démarche est la suivante&nbsp;:</p>
<ul>
<li><p>Créer 999 images dont les valeurs des pixels sont tirées aléatoirement avec remplacement.</p></li>
<li><p>Recalculer l’indicateur ELSA pour chaque image.</p></li>
<li><p>Pour chaque pixel, compter le nombre de fois où la valeur observée de l’indicateur ELSA est supérieure ou égale à celles des 999 valeurs simulées.</p></li>
</ul>
<p>La pseudo valeur de <em>p</em> pour chaque pixel <em>i</em> s’écrit alors&nbsp;:</p>
<p><span id="eq-PseudoValeurpELSEA"><span class="math display">\[
  \text{Pseudo valeur de } p_i = (M+1) / (R+1) \text{ avec :}
\tag{2.25}\]</span></span></p>
<p><span class="math inline">\(M\)</span> étant le nombre de fois que la valeur observée est supérieure ou égale à la valeur simulée (<span class="math inline">\(E_i \ge E^*_{ir}\)</span>) <span class="citation" data-cites="naimi2019elsa">(<a href="references.html#ref-naimi2019elsa" role="doc-biblioref">Naimi et al. 2019</a>, pp.&nbsp;33-35)</span>.</p>
</div>
</div>
<p>Appliquons la démarche ci-dessous dans R pour obtenir une pseudo valeur pour l’indicateur ELSA obtenu sur l’image avec un rayon de 100&nbsp;mètres. Notez que pour améliorer la vitesse de calcul, nous convertissons notre objet <code><a href="https://rdrr.io/pkg/terra/man/rast.html">terra::rast</a></code> en une matrice.</p>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Conversion des données matricielles en matrice</span></span>
<span><span class="va">base_data</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html">values</a></span><span class="op">(</span><span class="va">laval_data</span>, format <span class="op">=</span> <span class="st">"matrice"</span><span class="op">)</span></span>
<span><span class="co">## calcul de la proportion de chaque catégorie</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">ncell</a></span><span class="op">(</span><span class="va">base_data</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">base_data</span><span class="op">)</span> <span class="op">/</span> <span class="va">N</span></span>
<span><span class="co">## Conversion de l'indicateur ELSA (à 100 mètres) en matrice</span></span>
<span><span class="va">base_elsa</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html">values</a></span><span class="op">(</span><span class="va">elsa_100</span>, format <span class="op">=</span> <span class="st">"matrice"</span><span class="op">)</span></span>
<span><span class="co">## Création d'une matrice qui contiendra les pseudo valeurs de p</span></span>
<span><span class="va">p_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">base_elsa</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">base_elsa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Lancement des 999 simulations</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">999</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># pour chaque simulation, nous tirons au hasard la valeur de chaque pixel</span></span>
<span>  <span class="va">sim_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Nous enregistrons les valeurs tirées au hasard dans une matrice</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sim_values</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">base_elsa</span><span class="op">)</span></span>
<span>  <span class="co"># Calcul de la valeur de ELSA simulée</span></span>
<span>  <span class="va">sim_elsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geocmeans/man/elsa_raster.html">elsa_raster</a></span><span class="op">(</span><span class="va">sim_values</span>, <span class="va">w100</span>, <span class="va">matrice_dissim</span><span class="op">)</span></span>
<span>  <span class="co"># Comparaison des valeurs de l'indicateur ELSA (valeurs simulées versus observées)</span></span>
<span>  <span class="va">comp_matrix</span> <span class="op">&lt;-</span> <span class="va">base_elsa</span> <span class="op">&gt;=</span> <span class="va">sim_elsa</span></span>
<span>  <span class="co"># Ajout à notre matrice des valeurs de p</span></span>
<span>  <span class="va">p_matrix</span> <span class="op">&lt;-</span> <span class="va">p_matrix</span> <span class="op">+</span> <span class="va">comp_matrix</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Conversion des comptages en pseudo valeur de p</span></span>
<span><span class="va">p_values</span> <span class="op">&lt;-</span> <span class="va">p_matrix</span> <span class="op">/</span> <span class="op">(</span><span class="fl">999</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans la matrice obtenue, les pseudos valeurs de <em>p</em> représentent la probabilité que l’indice de <em>ELSA</em> obtenu sur les données réelles soit inférieur à celui obtenu si les données étaient réparties aléatoirement sur le territoire. Une pseudo valeur de <em>p</em> inférieure à 0,001 signifie donc qu’il n’y aurait que 0,1&nbsp;% de chance que le hasard produise un patron d’autocorrélation spatiale plus fort que celui observé avec les données initiales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">raster_p_vals</span> <span class="op">&lt;-</span> <span class="va">laval_data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html">values</a></span><span class="op">(</span><span class="va">raster_p_vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">p_values</span> <span class="op">&lt;=</span> <span class="fl">0.001</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">raster_p_vals</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>            style <span class="op">=</span> <span class="st">'cat'</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Significativité"</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non significatif (p &gt; 0,001)"</span>,</span>
<span>                       <span class="st">"Significatif (p &lt;= 0,001)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.outside.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">elsa_100</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, n <span class="op">=</span> <span class="fl">6</span>, </span>
<span>            legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"ELSA 100 mètres"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.outside.position <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Carte3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">laval_data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#fbd4b4"</span>, <span class="st">"#e36c0a"</span>, <span class="st">"#92d050"</span>, <span class="st">"#76923c"</span><span class="op">)</span>,</span>
<span>            style <span class="op">=</span> <span class="st">'cat'</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Classe (catégorie)"</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1. Minéral bas"</span>,</span>
<span>                       <span class="st">"2. Minéral haut"</span>,</span>
<span>                       <span class="st">"3. Végétal bas"</span>,</span>
<span>                       <span class="st">"4. Végétal haut"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.outside.position <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"center"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte3</span>, <span class="va">Carte2</span>, <span class="va">Carte1</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-chap02FigureElsaPval" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="02-Autocorrelation_files/figure-html/fig-chap02FigureElsaPval-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;2.39: Cartographie des valeurs de <em>p</em> de l’indicateur ELSA</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-chap02FigureElsaPval">figure&nbsp;<span>2.39</span></a> montre en rouge les pixels situés dans des secteurs avec une forte autocorrélation spatiale, soit ceux principalement végétalisés ou principalement minéralisés.</p>
</section></section></section><section id="sec-025" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="sec-025">
<span class="header-section-number">2.5</span> Quiz de révision du chapitre</h2>
<div id="Chap02" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chap02;
  window.onload = function() {
    quizz_Chap02 = new Quiz('Chap02', [['1', '2', '3', '4'],'2','1',['1', '2', '3'],'1',['1', '2'],'3',['1', '3', '4']]);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
Parmi les matrices de pondération spatiale ci-dessous, lesquelles sont des matrices de contiguïté?
</div>
<div>
Relisez au besoin la <a href="#sec-022">section&nbsp;<span>2.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Partage d’un nœud</label>
</td>
<td>
<input type="checkbox" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>Partage d’un segment</label>
</td>
<td>
<input type="checkbox" name="q1" value="2">
</td>
</tr>
<tr>
<td>
<label>Partage d’un nœud et ordre d’adjacence</label>
</td>
<td>
<input type="checkbox" name="q1" value="3">
</td>
</tr>
<tr>
<td>
<label>Partage d’un segment et ordre d’adjacence</label>
</td>
<td>
<input type="checkbox" name="q1" value="4">
</td>
</tr>
<tr>
<td>
<label>Connectivité selon la distance</label>
</td>
<td>
<input type="checkbox" name="q1" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
En anglais, comment est appelée une matrice selon le partage d’un nœud?
</div>
<div>
Relisez au besoin le début de la <a href="#sec-022">section&nbsp;<span>2.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Rook</label>
</td>
<td>
<input type="radio" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>Queen</label>
</td>
<td>
<input type="radio" name="q2" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comparativement à une matrice de l’inverse de la distance, une matrice de l’inverse de la distance au carré accorde un poids plus important aux entités proches.
</div>
<div>
Relisez au besoin la <a href="#sec-02223">section&nbsp;<span>2.2.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les avantages de la standardisation en ligne des matrices de pondération spatiale?
</div>
<div>
Relisez au besoin la <a href="#sec-0223">section&nbsp;<span>2.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>La somme de chaque ligne est égale à 1.</label>
</td>
<td>
<input type="checkbox" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>La somme de l’ensemble de la matrice est égale au nombre d’entités spatiales.</label>
</td>
<td>
<input type="checkbox" name="q4" value="2">
</td>
</tr>
<tr>
<td>
<label>La standardisation permet de comparer la dépendance spatiale selon différentes matrices.</label>
</td>
<td>
<input type="checkbox" name="q4" value="3">
</td>
</tr>
<tr>
<td>
<label>La standardisation augmente la vitesse des calculs.</label>
</td>
<td>
<input type="checkbox" name="q4" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelle est la différence entre les deux mesures locales de Getis et Ord?
</div>
<div>
Relisez au besoin la <a href="#sec-0241">section&nbsp;<span>2.4.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Gi* tient compte à la fois des valeurs des entités voisines ou proches, mais aussi de celle de i.</label>
</td>
<td>
<input type="radio" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>Contrairement à Gi, Gi* a un z-score.</label>
</td>
<td>
<input type="radio" name="q5" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Parmi les quatre catégories de la typologie basée sur le nuage de points du I de Moran, lesquelles renvoient à de l’autocorrélation spatiale locale positive?
</div>
<div>
Relisez au besoin la <a href="#sec-0243">section&nbsp;<span>2.4.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>HH</label>
</td>
<td>
<input type="checkbox" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>LL</label>
</td>
<td>
<input type="checkbox" name="q6" value="2">
</td>
</tr>
<tr>
<td>
<label>HL</label>
</td>
<td>
<input type="checkbox" name="q6" value="3">
</td>
</tr>
<tr>
<td>
<label>LH</label>
</td>
<td>
<input type="checkbox" name="q6" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le village gaulois correspond à quelle catégorie?
</div>
<div>
Relisez au besoin la <a href="#sec-0243">section&nbsp;<span>2.4.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>HH</label>
</td>
<td>
<input type="radio" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>LL</label>
</td>
<td>
<input type="radio" name="q7" value="2">
</td>
</tr>
<tr>
<td>
<label>HL</label>
</td>
<td>
<input type="radio" name="q7" value="3">
</td>
</tr>
<tr>
<td>
<label>LH</label>
</td>
<td>
<input type="radio" name="q7" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelles sont les trois manières de tester la significativité des mesures d’autocorrélation globales?
</div>
<div>
Relisez au besoin la <a href="#sec-02313">section&nbsp;<span>2.3.1.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Avec l’hypothèse de la normalité</label>
</td>
<td>
<input type="checkbox" name="q8" value="1">
</td>
</tr>
<tr>
<td>
<label>En relançant plusieurs fois les calculs</label>
</td>
<td>
<input type="checkbox" name="q8" value="2">
</td>
</tr>
<tr>
<td>
<label>Avec l’hypothèse de la randomisation</label>
</td>
<td>
<input type="checkbox" name="q8" value="3">
</td>
</tr>
<tr>
<td>
<label>Avec la méthode Monte-Carlo (habituellement avec 999 échantillons)</label>
</td>
<td>
<input type="checkbox" name="q8" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chap02);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>
</section><section id="sec-026" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="sec-026">
<span class="header-section-number">2.6</span> Exercices de révision</h2>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 2.</strong> Construction de matrices de pondération spatiale</p>
</div>
<div class="bloc_exercice-body">
<p>Construisez les matrices de pondération spatiale suivante pour la région métropolitaine de Québec&nbsp;:</p>
<ul>
<li>Matrice de pondération spatiale selon le partage d’un segment commun (voir la <a href="#sec-02241">section&nbsp;<span>2.2.4.1</span></a>).</li>
<li>Matrice de pondération spatiale selon l’inverse de la distance au carré, à partir de la distance maximale et un SR et son voisin le plus proche (voir la <a href="#sec-02244">section&nbsp;<span>2.2.4.4</span></a>).</li>
<li>Matrice de pondération spatiale selon le critère des plus proches voisins (<em>k</em>&nbsp;=&nbsp;2) (voir la <a href="#sec-02245">section&nbsp;<span>2.2.4.5</span></a>).</li>
</ul>
<p>Complétez le code ci-dessous.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Importation de la couche des secteurs de recensement</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>SRQc <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/chap02/exercice/RMRQuebecSR2021.shp"</span>, <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Matrice selon le partage d'un segment (Rook)</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>Rook <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>W.Rook <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Coordonnées des centroïdes des entités spatiales</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(SRQc))</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Matrice de l'inverse de la distance réduite</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Trouver le plus proche voisin avec la fonction knn2nb</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>plusprochevoisin.max <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1,coords)))</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Voisins les plus proches avec le seuil de distance maximal</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>Voisins.DistMax <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Distances avec le seuil maximum</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse de la distance au carré</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>InvDistances2 <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrices de pondération spatiale standardisées en ligne</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>W_InvDistances2 <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Matrice des plus proches voisins avec k = 2</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>k2 <span class="ot">&lt;-</span> À compléter</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>W.k2 <span class="ot">&lt;-</span>  À compléter</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="10-Exercices.html#sec-10022">section&nbsp;<span>9.2.2</span></a>.</p>
</div>
</div>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 3.</strong> Calcul du <em>I</em> de Moran global</p>
</div>
<p>Calculez le <em>I</em> de Moran global pour la variable <code>D1pct</code> (pourcentage du premier décile de revenu des familles économiques) de la couche <code>SRQc</code> avec les différentes matrices de pondération spatiale (voir la <a href="#sec-02322">section&nbsp;<span>2.3.2.2</span></a>). Complétez le code ci-dessous.</p>
<div class="bloc_exercice-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Cartographie de la variable</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(SRQc)<span class="sc">+</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">"D1pct"</span>, <span class="at">title =</span> <span class="st">"Premier décile de revenu (%)"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">"quantile"</span>, <span class="at">n=</span><span class="dv">5</span>, <span class="at">palette=</span><span class="st">"Greens"</span>)<span class="sc">+</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> F)<span class="sc">+</span><span class="fu">tm_scale_bar</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="do">## I de Moran avec la méthode Monte-Carlo avec 999 permutations</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># utilisez la fonction moran.mc</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="co"># avec la matrice W.Rook</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>À compléter</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="co"># avec la matrice W_InvDistances2Reduite</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>À compléter</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="co"># avec la matrice W.k2</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>À compléter</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quelle matrice de pondération spatiale donne la dépendance spatiale la plus forte? Correction à la <a href="10-Exercices.html#sec-10023">section&nbsp;<span>9.2.3</span></a>.</p>
</div>
</div>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 3.</strong> Mesures d’autocorrélation spatiale locales</p>
</div>
<div class="bloc_exercice-body">
<p>Calculez et cartographiez les mesures d’autocorrélation spatiale locale pour la variable <code>D1pct</code> de la couche <code>SRQc</code> avec la matrice spatiale <code>W.Rook</code>&nbsp;:</p>
<ul>
<li>Mesure <span class="math inline">\(G_i\)</span> de Getis et Ord (voir la <a href="#sec-0241">section&nbsp;<span>2.4.1</span></a>).</li>
<li>Typologie du nuage de points du <em>I</em> de Moran avec la fonction <code>localmoran</code> (voir la <a href="#sec-0243">section&nbsp;<span>2.4.3</span></a>).</li>
</ul>
<p>Complétez le code ci-dessous.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Calcul du Z(Gi)</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>SRQc<span class="sc">$</span>D1pct_localGetis <span class="ot">&lt;-</span> <span class="fu">localG</span>(À compléter, </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                                À compléter, </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Définition des intervalles et des noms des classes</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>classes.intervalles <span class="ot">=</span> À compléter</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>classes.noms <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Point froid (p = 0,001)"</span>, </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Point froid (p = 0,01)"</span>, </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Point froid (p = 0,05)"</span>, </span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Non significatif"</span>,</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Point chaud (p = 0,05)"</span>, </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Point chaud (p = 0,01)"</span>, </span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Point chaud (p = 0,001)"</span>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Création d'un champ avec les noms des classes</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>SRQc<span class="sc">$</span>D1pct_localGetisP <span class="ot">&lt;-</span> <span class="fu">cut</span>(SRQc<span class="sc">$</span>D1pct_localGetis,</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">breaks =</span> classes.intervalles,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">labels =</span> classes.noms)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Cartographie</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>À compléter</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Typologie LISA</span></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Cote Z (variable centrée réduite)</span></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>zx <span class="ot">&lt;-</span> À compléter</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="do">## variable X centrée réduite spatialement décalée avec une matrice Rook</span></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>wzx <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(À compléter)</span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a><span class="do">## I de Moran local (notez que vous pouvez aussi utiliser la fonction localmoran_perm)</span></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>localMoranI  <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(À compléter)</span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>plocalMoranI <span class="ot">&lt;-</span> localMoranI[, <span class="dv">5</span>]</span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Choisir un seuil de signification</span></span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Construction de la typologie</span></span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>Typologie <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(zx <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> wzx <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"1. HH"</span>, <span class="cn">NA</span>)</span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a>Typologie <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(zx <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> wzx <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"2. LL"</span>, Typologie)</span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>Typologie <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(zx <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> wzx <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"3. HL"</span>, Typologie)</span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>Typologie <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(zx <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> wzx <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"4. LH"</span>, Typologie)</span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a>Typologie <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(plocalMoranI <span class="sc">&gt;</span> signif, <span class="st">"Non sign"</span>, Typologie)  <span class="co"># Non significatif</span></span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Enregistrement de la typologie dans un champ</span></span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>SRQc<span class="sc">$</span>TypoIMoran.D1pct <span class="ot">&lt;-</span> Typologie</span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Couleurs</span></span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a>Couleurs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"lightpink"</span>, <span class="st">"skyblue2"</span>, <span class="st">"lightgray"</span>)</span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Couleurs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1. HH"</span>,<span class="st">"2. LL"</span>,<span class="st">"3. HL"</span>,<span class="st">"4. LH"</span>,<span class="st">"Non sign"</span>)</span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Cartographie</span></span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>À compléter</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="10-Exercices.html#sec-10024">section&nbsp;<span>9.2.4</span></a>.</p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-anselin1995local" class="csl-entry" role="listitem">
Anselin, Luc. 1995. <span>«&nbsp;Local indicators of spatial association—LISA.&nbsp;»</span> <em>Geographical analysis</em> 27 (2): 93‑115. <a href="https://doi.org/10.1111/j.1538-4632.1995.tb00338.x">https://doi.org/10.1111/j.1538-4632.1995.tb00338.x</a>.
</div>
<div id="ref-anselin1996chapter" class="csl-entry" role="listitem">
———. 1996. <span>«&nbsp;The Moran scatterplot as an ESDA tool to Assess Local Instability in Spatial Association.&nbsp;»</span> In <em>Spatial Analytical Perspectives on GIS</em>, sous la dir. de Manfred M Fischer, 121‑137. Taylor &amp; Francis Group. <a href="https://doi.org/10.1201/9780203739051">https://doi.org/10.1201/9780203739051</a>.
</div>
<div id="ref-anselin2019local" class="csl-entry" role="listitem">
———. 2019. <span>«&nbsp;A local indicator of multivariate spatial association: extending Geary’s C.&nbsp;»</span> <em>Geographical Analysis</em> 51 (2): 133‑150. <a href="https://doi.org/10.1111/gean.12164">https://doi.org/10.1111/gean.12164</a>.
</div>
<div id="ref-anselin2019operational" class="csl-entry" role="listitem">
Anselin, Luc et Xun Li. 2019. <span>«&nbsp;Operational local join count statistics for cluster detection.&nbsp;»</span> <em>Journal of geographical systems</em> 21: 189‑210. <a href="https://doi.org/10.1007/s10109-019-00299-x">https://doi.org/10.1007/s10109-019-00299-x</a>.
</div>
<div id="ref-RBoldAir" class="csl-entry" role="listitem">
Apparicio, Philippe et Jérémy Gelb. 2022. <em>Méthodes quantitatives en sciences sociales : un grand bol d’R</em>. FabriqueREL, Licence CC BY-SA. <a href="https://laeq.github.io/LivreMethoQuantBolR/">https://laeq.github.io/LivreMethoQuantBolR/</a>.
</div>
<div id="ref-ApparicioGelbrevisited" class="csl-entry" role="listitem">
Apparicio, Philippe, Jérémy Gelb, Anne-Sophie Dubé, Simon Kingham, Lise Gauvin et Éric Robitaille. 2017. <span>«&nbsp;The approaches to measuring the potential spatial access to urban health services revisited: distance types and aggregation-error issues.&nbsp;»</span> <em>International journal of health geographics</em> 16 (1): 32. <a href="https://doi.org/10.1186/s12942-017-0105-9">https://doi.org/10.1186/s12942-017-0105-9</a>.
</div>
<div id="ref-bivand2018comparing" class="csl-entry" role="listitem">
Bivand, Roger et David WS Wong. 2018. <span>«&nbsp;Comparing implementations of global and local indicators of spatial association.&nbsp;»</span> <em>Test</em> 27 (3): 716‑748. <a href="https://doi.org/10.1007/s11749-018-0599-x">https://doi.org/10.1007/s11749-018-0599-x</a>.
</div>
<div id="ref-cliff1981spatial" class="csl-entry" role="listitem">
Cliff, Andrew David et J Keith Ord. 1981. <em>Spatial processes: models &amp; applications</em>. Taylor &amp; Francis.
</div>
<div id="ref-dube2014econometrie" class="csl-entry" role="listitem">
Dubé, Jean et Diègo Legros. 2014. <em>Econom<span>é</span>trie spatiale appliqu<span>é</span>e des microdonn<span>é</span>es</em>. ISTE Group.
</div>
<div id="ref-geary1954contiguity" class="csl-entry" role="listitem">
Geary, Robert C. 1954. <span>«&nbsp;The contiguity ratio and statistical mapping.&nbsp;»</span> <em>The incorporated statistician</em> 5 (3): 115‑146. <a href="https://doi.org/10.2307/2986645">https://doi.org/10.2307/2986645</a>.
</div>
<div id="ref-getis1992analysis" class="csl-entry" role="listitem">
Getis, Arthur et J Keith Ord. 1992. <span>«&nbsp;The analysis of spatial association by use of distance statistics.&nbsp;»</span> <em>Geographical analysis</em> 24 (3): 189‑206. <a href="https://doi.org/10.1111/j.1538-4632.1992.tb00261.x">https://doi.org/10.1111/j.1538-4632.1992.tb00261.x</a>.
</div>
<div id="ref-jombart2008revealing" class="csl-entry" role="listitem">
Jombart, T, S Devillard, Anne-Béatrice Dufour et D Pontier. 2008. <span>«&nbsp;Revealing cryptic spatial patterns in genetic variability by a new multivariate method.&nbsp;»</span> <em>Heredity</em> 101 (1): 92‑103. <a href="https://doi.org/10.1038/hdy.2008.34">https://doi.org/10.1038/hdy.2008.34</a>.
</div>
<div id="ref-lee2001developing" class="csl-entry" role="listitem">
Lee, Sang-Il. 2001. <span>«&nbsp;Developing a bivariate spatial association measure: an integration of Pearson’s r and Moran’s I.&nbsp;»</span> <em>Journal of geographical systems</em> 3: 369‑385. <a href="https://doi.org/10.1007/s101090100064">https://doi.org/10.1007/s101090100064</a>.
</div>
<div id="ref-moran1950test" class="csl-entry" role="listitem">
Moran, Patrick. 1950. <span>«&nbsp;A test for the serial independence of residuals.&nbsp;»</span> <em>Biometrika</em> 37 (1/2): 178‑181. <a href="https://doi.org/10.2307/2332162">https://doi.org/10.2307/2332162</a>.
</div>
<div id="ref-naimi2019elsa" class="csl-entry" role="listitem">
Naimi, Babak, Nicholas AS Hamm, Thomas A Groen, Andrew K Skidmore, Albertus G Toxopeus et Sara Alibakhshi. 2019. <span>«&nbsp;ELSA: Entropy-based local indicator of spatial association.&nbsp;»</span> <em>Spatial statistics</em> 29: 66‑88. <a href="https://doi.org/10.1016/j.spasta.2018.10.001">https://doi.org/10.1016/j.spasta.2018.10.001</a>.
</div>
<div id="ref-ord1995local" class="csl-entry" role="listitem">
Ord, J Keith et Arthur Getis. 1995. <span>«&nbsp;Local spatial autocorrelation statistics: distributional issues and an application.&nbsp;»</span> <em>Geographical analysis</em> 27 (4): 286‑306. <a href="https://doi.org/10.1111/j.1538-4632.1995.tb00912.x">https://doi.org/10.1111/j.1538-4632.1995.tb00912.x</a>.
</div>
<div id="ref-sokal1998local" class="csl-entry" role="listitem">
Sokal, Robert R, Neal L Oden et Barbara A Thomson. 1998. <span>«&nbsp;Local spatial autocorrelation in a biological model.&nbsp;»</span> <em>Geographical Analysis</em> 30 (4): 331‑354. <a href="https://doi.org/10.1111/j.1538-4632.1998.tb00406.x">https://doi.org/10.1111/j.1538-4632.1998.tb00406.x</a>.
</div>
<div id="ref-tobler1970computer" class="csl-entry" role="listitem">
Tobler, Waldo R. 1970. <span>«&nbsp;A computer movie simulating urban growth in the Detroit region.&nbsp;»</span> <em>Economic geography</em> 46 (sup1): 234‑240. <a href="https://doi.org/10.2307/143141">https://doi.org/10.2307/143141</a>.
</div>
<div id="ref-wong2005statistical" class="csl-entry" role="listitem">
Wong, David WS et Jay Lee. 2005. <em>Statistical analysis of geographic information with ArcView GIS and ArcGIS</em>. Wiley.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./01-ManipulationDonneesSpatiales.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manipulation des données spatiales dans&nbsp;R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-MethodesRepartitionPonctuelle.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Méthodes de répartition ponctuelle</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes d’analyse spatiale : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>