<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes d’analyse spatiale : un grand bol d’R - 7&nbsp; Introduction aux modèles de régression spatiale</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-ClassificationsSpatiales.html" rel="next">
<link href="./06-AnalyseReseauEvenements.html" rel="prev">
<link href="./images/introduction/Couverture_16_01-01.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-RegressionSpatiales.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes d’analyse spatiale : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Données spatiales et R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-ManipulationDonneesSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manipulation des données spatiales dans&nbsp;R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Autocorrélation spatiale</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Autocorrelation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Autocorrélation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Méthodes de répartition ponctuelle et de détections d’agrégats spatiaux</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-MethodesRepartitionPonctuelle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Méthodes de répartition ponctuelle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-AgregatsSpatiaux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Méthodes de détection d’agrégats spatiaux et spatio-temporels</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Analyses de données avec des réseaux de transport</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-AnalyseReseau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mesures d’accessibilité spatiale selon différents modes de transport</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-AnalyseReseauEvenements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyses d’évènements localisés sur un réseau</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Régressions spatiales et classifications spatiales</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-RegressionSpatiales.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ClassificationsSpatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Échantillonnage, interpolation et désagrégation spatiales</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-EchantillonnageSpatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Méthodes d’échantillonnage spatial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-InterpolationSpatiale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Méthodes d’interpolation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-DesagregationSpatiale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Méthodes de déségrégation spatiale</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 7. Exercices et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Exercices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Correction des exercices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-071" id="toc-sec-071" class="nav-link active" data-scroll-target="#sec-071"><span class="header-section-number">7.1</span> Modèles économétriques spatiaux</a>
  <ul class="collapse">
<li><a href="#sec-0711" id="toc-sec-0711" class="nav-link" data-scroll-target="#sec-0711"><span class="header-section-number">7.1.1</span> Bref retour sur la régression linéaire multiple</a></li>
  <li><a href="#sec-0712" id="toc-sec-0712" class="nav-link" data-scroll-target="#sec-0712"><span class="header-section-number">7.1.2</span> Les différents modèles spatiaux autorégressifs</a></li>
  <li><a href="#sec-0713" id="toc-sec-0713" class="nav-link" data-scroll-target="#sec-0713"><span class="header-section-number">7.1.3</span> Quel modèle choisir?</a></li>
  </ul>
</li>
  <li>
<a href="#sec-072" id="toc-sec-072" class="nav-link" data-scroll-target="#sec-072"><span class="header-section-number">7.2</span> Modèles généralisés additifs (GAM) avec une <em>spline</em> bivariée sur les coordonnées géographiques</a>
  <ul class="collapse">
<li><a href="#sec-0721" id="toc-sec-0721" class="nav-link" data-scroll-target="#sec-0721"><span class="header-section-number">7.2.1</span> Principe de base d’un GAM intégrant l’espace</a></li>
  <li><a href="#sec-0722" id="toc-sec-0722" class="nav-link" data-scroll-target="#sec-0722"><span class="header-section-number">7.2.2</span> Construction d’un modèle GAM dans R</a></li>
  </ul>
</li>
  <li>
<a href="#sec-073" id="toc-sec-073" class="nav-link" data-scroll-target="#sec-073"><span class="header-section-number">7.3</span> Régression géographiquement pondérée</a>
  <ul class="collapse">
<li><a href="#sec-0731" id="toc-sec-0731" class="nav-link" data-scroll-target="#sec-0731"><span class="header-section-number">7.3.1</span> Principe de base</a></li>
  <li><a href="#sec-0732" id="toc-sec-0732" class="nav-link" data-scroll-target="#sec-0732"><span class="header-section-number">7.3.2</span> Construction et analyse du modèle GWR dans R</a></li>
  </ul>
</li>
  <li><a href="#sec-074" id="toc-sec-074" class="nav-link" data-scroll-target="#sec-074"><span class="header-section-number">7.4</span> Quiz de révision du chapitre</a></li>
  <li><a href="#sec-075" id="toc-sec-075" class="nav-link" data-scroll-target="#sec-075"><span class="header-section-number">7.5</span> Exercices de révision</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesAnalyseSpatiale/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap07" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction aux modèles de régression spatiale</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Depuis une trentaine d’années, économètres, épidémiologistes et géographes développent et utilisent abondamment des méthodes de régression intégrant l’espace&nbsp;: modèles économétriques spatiaux, modèles géographiquement pondérés, analyses multiniveaux, etc. L’objectif de ce chapitre est de donner un aperçu de ces méthodes. Nous y décrivons principalement les différents modèles économétriques spatiaux, les modèles généralisés additifs avec une <em>spline</em> bivariée sur les coordonnées géographiques et les modèles géographiquement pondérés.</p>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour importer et manipuler des fichiers géographiques&nbsp;:
<ul>
<li>
<code>sf</code> pour importer et manipuler des données vectorielles.</li>
<li>
<code>raster</code> et <code>terra</code> pour manipuler des données matricielles.</li>
</ul>
</li>
<li>Pour construire des cartes et des graphiques&nbsp;:
<ul>
<li>
<code>tmap</code> est certainement le meilleur <em>package</em> pour la cartographie.</li>
<li>
<code>ggplot2</code> pour construire des graphiques.</li>
</ul>
</li>
<li>Pour construire des modèles spatiaux&nbsp;:
<ul>
<li>
<code>spdep</code> pour construire des matrices de pondération spatiales et calculer le <em>I</em> de Moran.</li>
<li>
<code>spatialreg</code> pour construire des modèles économétriques spatiaux.</li>
<li>
<code>mgcv</code> pour construire des modèles généralisés additifs avec une <em>spline</em> sur les coordonnées géographiques.</li>
<li>
<code>spgwr</code> pour construire des régressions géographiquement pondérées.</li>
</ul>
</li>
</ul>
</div>
</div>
<p>Pour décrire les différents modèles, nous proposons d’utiliser le jeu de données spatiales <code>LyonIris</code> du <em>package</em> <code>geocmeans</code>. Ce jeu de données spatiales pour l’agglomération lyonnaise (France) comprend dix variables, dont quatre environnementales (EN) et six socioéconomiques (SE), pour les îlots regroupés pour l’information statistique (IRIS) de l’agglomération lyonnaise (<a href="#tbl-datageocmeans">tableau&nbsp;<span>7.1</span></a> et <a href="#fig-datacarto">figure&nbsp;<span>7.1</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-datageocmeans" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;7.1: Statistiques descriptives du jeu de données LyonIris</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 46%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Intitulé</th>
<th style="text-align: center;">Type</th>
<th style="text-align: right;">Moy.</th>
<th style="text-align: right;">E.-T.</th>
<th style="text-align: right;">Min.</th>
<th style="text-align: right;">Max.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lden</td>
<td style="text-align: left;">Lden</td>
<td style="text-align: left;">Bruit routier (Lden dB(A))</td>
<td style="text-align: center;">EN</td>
<td style="text-align: right;">55,6</td>
<td style="text-align: right;">4,9</td>
<td style="text-align: right;">33,9</td>
<td style="text-align: right;">71,7</td>
</tr>
<tr class="even">
<td style="text-align: left;">NO2</td>
<td style="text-align: left;">NO2</td>
<td style="text-align: left;">Dioxyde d’azote (ug/m<sup>3</sup>)</td>
<td style="text-align: center;">EN</td>
<td style="text-align: right;">28,7</td>
<td style="text-align: right;">7,9</td>
<td style="text-align: right;">12,0</td>
<td style="text-align: right;">60,2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PM25</td>
<td style="text-align: left;">PM25</td>
<td style="text-align: left;">Particules fines (PM<span class="math inline">\(_{2,5}\)</span>)</td>
<td style="text-align: center;">EN</td>
<td style="text-align: right;">16,8</td>
<td style="text-align: right;">2,1</td>
<td style="text-align: right;">11,3</td>
<td style="text-align: right;">21,9</td>
</tr>
<tr class="even">
<td style="text-align: left;">VegHautPrt</td>
<td style="text-align: left;">VegHautPrt</td>
<td style="text-align: left;">Canopée (%)</td>
<td style="text-align: center;">EN</td>
<td style="text-align: right;">18,7</td>
<td style="text-align: right;">10,1</td>
<td style="text-align: right;">1,7</td>
<td style="text-align: right;">53,8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct0_14</td>
<td style="text-align: left;">Pct0_14</td>
<td style="text-align: left;">Moins de 15 ans (%)</td>
<td style="text-align: center;">SE</td>
<td style="text-align: right;">18,5</td>
<td style="text-align: right;">5,7</td>
<td style="text-align: right;">0,0</td>
<td style="text-align: right;">54,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pct_65</td>
<td style="text-align: left;">Pct_65</td>
<td style="text-align: left;">65 ans et plus (%)</td>
<td style="text-align: center;">SE</td>
<td style="text-align: right;">16,2</td>
<td style="text-align: right;">5,9</td>
<td style="text-align: right;">0,0</td>
<td style="text-align: right;">45,1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct_Img</td>
<td style="text-align: left;">Pct_Img</td>
<td style="text-align: left;">Immigrants (%)</td>
<td style="text-align: center;">SE</td>
<td style="text-align: right;">14,5</td>
<td style="text-align: right;">9,1</td>
<td style="text-align: right;">0,0</td>
<td style="text-align: right;">59,8</td>
</tr>
<tr class="even">
<td style="text-align: left;">TxChom1564</td>
<td style="text-align: left;">TxChom1564</td>
<td style="text-align: left;">Taux de chômage</td>
<td style="text-align: center;">SE</td>
<td style="text-align: right;">14,8</td>
<td style="text-align: right;">8,1</td>
<td style="text-align: right;">0,0</td>
<td style="text-align: right;">98,8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct_brevet</td>
<td style="text-align: left;">Pct_brevet</td>
<td style="text-align: left;">Personnes à faible scolarité (%)</td>
<td style="text-align: center;">SE</td>
<td style="text-align: right;">23,5</td>
<td style="text-align: right;">12,6</td>
<td style="text-align: right;">0,0</td>
<td style="text-align: right;">100,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">NivVieMed</td>
<td style="text-align: left;">NivVieMed</td>
<td style="text-align: left;">Médiane du niveau de vie (milliers d’euros)</td>
<td style="text-align: center;">SE</td>
<td style="text-align: right;">21,8</td>
<td style="text-align: right;">4,9</td>
<td style="text-align: right;">11,3</td>
<td style="text-align: right;">38,7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="fig-datacarto" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap07/FigureDataLyon.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.1: Cartographie des variables du jeu de données LyonIris</figcaption></figure>
</div>
<section id="sec-071" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-071">
<span class="header-section-number">7.1</span> Modèles économétriques spatiaux</h2>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Régression linéaire multiple et modèles économétriques spatiaux</strong></p>
</div>
<div class="bloc_attention-body">
<p>Dans cette section, nous décrivons uniquement les modèles économétriques spatiaux dont la variable dépendante est continue. Sommairement, ces modèles sont des extensions de la régression linéaire multiple dans laquelle est intégrée l’autocorrélation spatiale. Avant de lire cette section, il faut donc bien maîtriser la régression linéaire multiple. Si ce n’est pas le cas, nous vous invitons vivement à lire le <a href="https://serieboldr.github.io/MethodesQuantitatives/07-regressionlineaire.html">chapitre suivant</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>.</p>
<p>Ces deux dernières décennies, plusieurs ouvrages traitant des modèles économétriques spatiaux ont été publiés, surtout en anglais <span class="citation" data-cites="lesage2008introduction anselin2014modern bivand2008applied">(<a href="references.html#ref-lesage2008introduction" role="doc-biblioref">LeSage et Pace 2008</a>; <a href="references.html#ref-anselin2014modern" role="doc-biblioref">Anselin et Rey 2014</a>; <a href="references.html#ref-bivand2008applied" role="doc-biblioref">Bivand et al. 2008</a>)</span>. Ils méritent grandement d’être consultés, tout comme l’excellent livre en français de Jean Dubé et Diègo Legros <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014</a>)</span>.</p>
</div>
</div>
<p><strong>Pourquoi recourir à des modèles économétriques spatiaux?</strong></p>
<p>Dans un modèle, les résidus (<span class="math inline">\(\epsilon\)</span>) sont la différence entre les valeurs observées (<span class="math inline">\(y_i\)</span>) et les valeurs prédites par le modèle (<span class="math inline">\(\widehat{y_i}\)</span>). Une des hypothèses de la régression linéaire multiple est que les observations doivent être indépendantes les unes des autres (<em>indépendance du terme d’erreur</em>). Le non-respect de cette hypothèse produit des résultats biaisés, notamment pour les coefficients de régression.</p>
<p>Lorsque les observations sont des entités spatiales (polygones, points par exemple), si les résidus du modèle sont autocorrélés spatialement, il y a un problème de dépendance spatiale du modèle. Autrement dit, les observations ne sont pas spatialement indépendantes les unes des autres. Pour vérifier la dépendance spatiale d’un modèle, il suffit de calculer le <em>I</em> de Moran sur les résidus du modèle, comme décrit au chapitre&nbsp;2 (<a href="02-Autocorrelation.html#sec-023">section&nbsp;<span>2.3</span></a>).</p>
<p>Autrement dit, un modèle de régression construit avec des données spatiales ne devrait pas avoir des résidus spatialement autocorrélés. Or, les modèles économétriques spatiaux permettent justement d’intégrer l’autocorrélation spatiale de différentes manières afin de s’assurer que l’hypothèse de l’indépendance du terme d’erreur est respectée.</p>
<section id="sec-0711" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="sec-0711">
<span class="header-section-number">7.1.1</span> Bref retour sur la régression linéaire multiple</h3>
<p>À titre de rappel, la régression linéaire multiple permet de prédire et d’expliquer une variable dépendante (<span class="math inline">\(Y\)</span>) en fonction de plusieurs variables indépendantes (<span class="math inline">\(X\)</span>). L’équation de régression s’écrit alors&nbsp;:</p>
<p><span id="eq-regmultiple1"><span class="math display">\[
y_i = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\ldots+ \beta_{k}x_{ki} + \epsilon_{i}
\tag{7.1}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y_i\)</span>, la valeur de la variable dépendante <em>Y</em> pour l’observation <em>i</em>.</li>
<li>
<span class="math inline">\(\beta_{0}\)</span>, la constante, soit la valeur prédite pour <em>Y</em> quand toutes les variables indépendantes sont égales à&nbsp;0.</li>
<li>
<span class="math inline">\(k\)</span> le nombre de variables indépendantes.</li>
<li>
<span class="math inline">\(\beta_{1}\)</span> à <span class="math inline">\(\beta_{k}\)</span>, les coefficients de régression pour les variables indépendantes de 1 à <em>k</em> (<span class="math inline">\(X_{1}\)</span> à <span class="math inline">\(X_{k}\)</span>).</li>
<li>
<span class="math inline">\(\epsilon_{i}\)</span>, le résidu pour l’observation de <em>i</em>, soit la partie de la valeur de <span class="math inline">\(y_i\)</span> qui n’est pas expliquée par le modèle de régression.</li>
</ul>
<p>Il existe plusieurs écritures simplifiées de cette équation. Dans le cadre de ce chapitre, nous utilisons la forme matricielle suivante&nbsp;:</p>
<p><span id="eq-MCO"><span class="math display">\[
y = X\beta + \epsilon
\tag{7.2}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, un vecteur de dimension <span class="math inline">\(n \times 1\)</span> pour la variable dépendante, soit une colonne avec <em>n</em> observations.</li>
<li>
<span class="math inline">\(X\)</span>, une matrice de dimension <span class="math inline">\(n \times (k + 1)\)</span> pour les <em>k</em> variables indépendantes, incluant une autre colonne (avec la valeur de 1 pour les <em>n</em> observations) pour la constante, d’où <span class="math inline">\(k + 1\)</span>.</li>
<li>
<span class="math inline">\(\beta\)</span>, un vecteur de dimension <span class="math inline">\(k + 1\)</span>, soit les coefficients de régression pour les <em>k</em> variables et la constante.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, un vecteur de dimension <span class="math inline">\(n \times 1\)</span> pour les résidus.</li>
</ul>
<p><strong>Construction du modèle MCO dans R</strong></p>
<p>Avec la fonction <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, il est facile de construire un modèle de régression linéaire multiple basé sur la méthode des moindres carrés ordinaires (MCO). Dans le code ci-dessous, la formule de l’équation du modèle est donc <code>NO2 ~ Pct0_14+Pct_65+Pct_Img+Pct_brevet+NivVieMed</code>. Notez que la variable dépendante et les variables indépendantes sont séparées avec un tilde (<code>~</code>). Quant à la fonction <code>summary(NomDuModèle)</code>, elle affiche les résultats du modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Appel des différents packages utilisés dans le chapitre</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'spdep' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'spData' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Construction du modèle</span></span>
<span><span class="va">Modele.MCO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="co">## Résultats du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.MCO</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + 
    NivVieMed, data = LyonIris)

Residuals:
    Min      1Q  Median      3Q     Max 
-27.733  -4.457  -0.499   3.507  29.160 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 49.43296    2.99550  16.502  &lt; 2e-16 ***
Pct0_14     -0.53352    0.06305  -8.461 2.94e-16 ***
Pct_65      -0.15047    0.05627  -2.674  0.00774 ** 
Pct_Img      0.28287    0.05113   5.532 5.12e-08 ***
Pct_brevet  -0.24004    0.03721  -6.451 2.63e-10 ***
NivVieMed   -0.31625    0.10180  -3.107  0.00200 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.685 on 500 degrees of freedom
Multiple R-squared:  0.2832,    Adjusted R-squared:  0.276 
F-statistic:  39.5 on 5 and 500 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><strong>Dépendance spatiale du modèle MCO?</strong></p>
<p>Pour vérifier si ce modèle linéaire multiple a un problème de dépendance spatiale, nous calculons le <em>I</em> de Moran sur ses résidus avec la fonction <code>lm.morantest</code>, puis nous les cartographions.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Matrice de contiguïté selon le partage d'un segment (Rook)</span></span>
<span><span class="va">Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">W.Rook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Rook</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co"># Autocorrélation spatiale globale des résidus</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html">lm.morantest</a></span><span class="op">(</span><span class="va">Modele.MCO</span>, <span class="va">W.Rook</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Global Moran I for regression residuals

data:  
model: lm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet +
NivVieMed, data = LyonIris)
weights: W.Rook

Moran I statistic standard deviate = 21.266, p-value &lt; 2.2e-16
alternative hypothesis: two.sided
sample estimates:
Observed Moran I      Expectation         Variance 
     0.587312061     -0.005375800      0.000776745 </code></pre>
</div>
</div>
<p>Avec une valeur du <em>I</em> de Moran de 0,587 (<em>p</em>&nbsp;&lt;&nbsp;0,001), les résidus sont fortement autocorrélés spatialement, traduisant ainsi un problème de dépendance spatiale du modèle MCO et la nécessité de recourir à des modèles économétriques spatiaux. La cartographie des résidus à la <a href="#fig-figCartoResMCO">figure&nbsp;<span>7.2</span></a> corrobore ce résultat.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span><span class="co">## Ajout de la colonne dans LyonIris avec les valeurs des résidus</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">ModeleMCO.Residus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">Modele.MCO</span><span class="op">)</span></span>
<span><span class="co">## Cartographie</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"ModeleMCO.Residus"</span>, n <span class="op">=</span> <span class="fl">5</span>, style <span class="op">=</span> <span class="st">"quantile"</span>, </span>
<span>          legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"-RdBu"</span>, title <span class="op">=</span> <span class="st">"Résidus"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-figCartoResMCO" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-figCartoResMCO-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.2: Cartographie des résidus du modèle de régression multiple</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0712" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="sec-0712">
<span class="header-section-number">7.1.2</span> Les différents modèles spatiaux autorégressifs</h3>
<p>Selon Jean Dubé et Diègo Legros, «&nbsp;cinq raisons peuvent motiver le choix d’un modèle autorégressif&nbsp;: la présence d’externalités, les effets d’entraînement, l’omission de variables importantes, la présence d’hétérogénéité spatiale des comportements, les effets mixtes&nbsp;» <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014, 120</a>)</span>. Les effets mixtes peuvent être la combinaison d’externalités avec des effets d’entraînement ou encore d’externalités avec l’omission d’une ou de plusieurs variables importantes spatialement structurées.</p>
<section id="sec-07121" class="level4" data-number="7.1.2.1"><h4 data-number="7.1.2.1" class="anchored" data-anchor-id="sec-07121">
<span class="header-section-number">7.1.2.1</span> Modèle SLX&nbsp;: autocorrélation spatiale sur les variables indépendantes</h4>
<p>Dans un modèle SLX, l’autocorrélation spatiale est intégrée au niveau des variables indépendantes. Autrement dit, les variables indépendantes spatialement décalées (<span class="math inline">\(WX\)</span>) sont introduites aussi dans le modèle. Par conséquent, la valeur de chaque unité spatiale du modèle est ainsi expliquée à la fois par ses propres caractéristiques et celles dans le voisinage ou à proximité en fonction de la matrice de pondération spatiale (<span class="math inline">\(W\)</span>).</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Rappel sur les variables spatialement décalées</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Dans le chapitre 2 sur l’autocorrélation spatiale, nous avons vu comment calculer une variable spatialement décalée avec une matrice de pondération spatiale (<a href="02-Autocorrelation.html#fig-Chap02FigureVariableSpatialementDecalee">figure&nbsp;<span>2.29</span></a>). À titre de rappel, lorsque cette dernière est standardisée en ligne, elle correspond à la valeur moyenne dans le voisinage.</p>
</div>
</div>
<p>L’idée est alors d’introduire des <strong>externalités</strong> puisque les caractéristiques des entités spatiales proches ou voisines peuvent avoir un effet sur la variable dépendante <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">Dubé et Legros 2014</a>)</span>. L’équation du modèle SLX, qui est estimée selon la méthode des moindres carrés ordinaires (comme la régression linéaire multiple), s’écrit alors&nbsp;:</p>
<p><span id="eq-SLX"><span class="math display">\[
y = X\beta + WX\theta + \epsilon
\tag{7.3}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, la variable dépendante.</li>
<li>
<span class="math inline">\(X\)</span>, les variables indépendantes.</li>
<li>
<span class="math inline">\(\beta\)</span>, les coefficients des variables indépendantes.</li>
<li>
<span class="math inline">\(W\)</span>, la matrice de pondération spatiale.</li>
<li>
<span class="math inline">\(WX\)</span>, les variables indépendantes spatiales décalées.</li>
<li>
<span class="math inline">\(\theta\)</span>, les coefficients des variables indépendantes spatiales décalées.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, les résidus.</li>
</ul>
<p><strong>Construction du modèle SLX dans R</strong></p>
<p>Le modèle SLX est construit avec la fonction <code>lmSLX</code> du <em>package</em> <code>spatialreg</code> <span class="citation" data-cites="bivand2021review">(<a href="references.html#ref-bivand2021review" role="doc-biblioref">Bivand, Millo et Piras 2021</a>)</span>. Remarquez, dans le code ci-dessous, le paramètre <code>listw=W.Rook</code> qui est utilisé pour spécifier la matrice de pondération spatiale.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spatialreg/">spatialreg</a></span><span class="op">)</span></span>
<span><span class="co">## Construction du modèle</span></span>
<span><span class="va">Modele.SLX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/SLX.html">lmSLX</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                   listw<span class="op">=</span><span class="va">W.Rook</span>,     <span class="co"># matrice de pondération spatiale</span></span>
<span>                   data <span class="op">=</span> <span class="va">LyonIris</span><span class="op">)</span>  <span class="co"># dataframe</span></span>
<span><span class="co">## Résultats du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.SLX</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula(paste("y ~ ", paste(colnames(x)[-1], collapse = "+"))), 
    data = as.data.frame(x), weights = weights)

Coefficients:
                Estimate    Std. Error  t value     Pr(&gt;|t|)  
(Intercept)      5.068e+01   4.188e+00   1.210e+01   1.040e-29
Pct0_14         -2.040e-01   6.268e-02  -3.255e+00   1.211e-03
Pct_65          -3.771e-02   5.361e-02  -7.033e-01   4.822e-01
Pct_Img          1.041e-01   4.849e-02   2.146e+00   3.235e-02
Pct_brevet      -7.363e-02   3.550e-02  -2.074e+00   3.857e-02
NivVieMed       -1.844e-01   1.106e-01  -1.667e+00   9.617e-02
lag.Pct0_14     -7.759e-01   1.030e-01  -7.537e+00   2.315e-13
lag.Pct_65      -6.454e-02   9.115e-02  -7.081e-01   4.792e-01
lag.Pct_Img      6.465e-01   8.593e-02   7.524e+00   2.526e-13
lag.Pct_brevet  -3.013e-01   6.157e-02  -4.893e+00   1.344e-06
lag.NivVieMed   -1.805e-02   1.750e-01  -1.031e-01   9.179e-01</code></pre>
</div>
</div>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Effets directs, indirects et totaux</strong></p>
</div>
<div class="bloc_attention-body">
<p>La formulation d’un modèle SLX implique deux types d’effets pour les variables indépendantes (<span class="math inline">\(X\)</span>)&nbsp;:</p>
<ul>
<li><p>les <strong>effets directs</strong>, soit ceux des caractéristiques des entités spatiales. Ils correspondent aux coefficients <span class="math inline">\(\beta\)</span> des variables indépendantes (<span class="math inline">\(X\)</span>). Autrement dit, pour une observation <span class="math inline">\(i\)</span>, à chaque augmentation d’une unité d’une caractéristique <span class="math inline">\(X\)</span>, la valeur de <span class="math inline">\(y_i\)</span> va varier (augmenter ou diminuer) en fonction du coefficient <span class="math inline">\(\beta\)</span>.</p></li>
<li><p>les <strong>effets indirects</strong>, soit ceux des caractéristiques des entités spatiales voisines ou proches définies selon la matrice de pondération spatiale. Ils correspondent aux coefficients <span class="math inline">\(\theta\)</span> des variables indépendantes spatialement décalées (<span class="math inline">\(WX\)</span>). Autrement dit, les valeurs de <span class="math inline">\(WX\)</span> des entités spatiales proches ou voisines <span class="math inline">\(j\)</span> de <span class="math inline">\(i\)</span> vont aussi être amenées à varier, impactant alors les valeurs <span class="math inline">\(y_j\)</span> selon les coefficients <span class="math inline">\(\theta\)</span>.</p></li>
</ul>
<p>Prenons l’exemple d’un modèle visant à prédire le prix de vente des maisons dans une ville en fonction de leurs caractéristiques des maisons, dont la superficie du jardin. Il est probable que plus la superficie du jardin de la maison <span class="math inline">\(i\)</span> augmente, plus le prix de vente augmente également (<strong>effet direct</strong>, coefficient <span class="math inline">\(\beta\)</span>). Cette augmentation de la taille du jardin aura aussi un impact sur le prix des maisons voisines puisque leur prix est dépendant de la taille des jardins des maisons voisines. Ainsi, chaque maison <span class="math inline">\(j\)</span>, voisine de <span class="math inline">\(i\)</span> verra son prix augmenter à cause de l’augmentation de la taille du jardin de la maison <span class="math inline">\(i\)</span> (<strong>effet indirect</strong>).</p>
<p>Pour capturer l’impact total sur le prix des maisons d’une augmentation de la superficie du jardin de la maison <span class="math inline">\(i\)</span>, il suffit de sommer son effet direct (augmentation du prix de la maison <span class="math inline">\(i\)</span>) et son effet indirect (augmentation du prix des maisons <span class="math inline">\(j\)</span>) pour obtenir son effet total.</p>
<p>Le code suivant permet de calculer ces effets directs et indirects.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Effets directs, indirects et totaux (uniquement les coefficients)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.SLX</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (SlX, glht):
                Direct    Indirect      Total
Pct0_14    -0.20403803 -0.77590830 -0.9799463
Pct_65     -0.03770918 -0.06453809 -0.1022473
Pct_Img     0.10406359  0.64653923  0.7506028
Pct_brevet -0.07363272 -0.30128171 -0.3749144
NivVieMed  -0.18440960 -0.01804718 -0.2024568</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Effets directs, indirects et totaux (coefficients, valeurs de z et de p)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.SLX</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (SlX, glht, n-k):
                Direct    Indirect      Total
Pct0_14    -0.20403803 -0.77590830 -0.9799463
Pct_65     -0.03770918 -0.06453809 -0.1022473
Pct_Img     0.10406359  0.64653923  0.7506028
Pct_brevet -0.07363272 -0.30128171 -0.3749144
NivVieMed  -0.18440960 -0.01804718 -0.2024568
========================================================
Standard errors:
               Direct   Indirect      Total
Pct0_14    0.06268202 0.10295210 0.10045332
Pct_65     0.05361420 0.09114695 0.08556272
Pct_Img    0.04849085 0.08593145 0.08060028
Pct_brevet 0.03549819 0.06157121 0.05975821
NivVieMed  0.11063207 0.17499339 0.14911021
========================================================
Z-values:
               Direct   Indirect     Total
Pct0_14    -3.2551283 -7.5365951 -9.755241
Pct_65     -0.7033432 -0.7080664 -1.194998
Pct_Img     2.1460460  7.5238953  9.312658
Pct_brevet -2.0742665 -4.8932234 -6.273857
NivVieMed  -1.6668729 -0.1031306 -1.357766

p-values:
           Direct    Indirect   Total     
Pct0_14    0.0011334 4.8184e-14 &lt; 2.22e-16
Pct_65     0.4818419 0.47890    0.23209   
Pct_Img    0.0318693 5.3069e-14 &lt; 2.22e-16
Pct_brevet 0.0380546 9.9198e-07 3.5221e-10
NivVieMed  0.0955397 0.91786    0.17454   </code></pre>
</div>
</div>
<p>À la lecture des valeurs de <em>p</em>, nous constatons que seule la variable <code>Pct0_14</code> a un impact direct et indirect significatif au seuil 0,01. L’augmentation d’un point de pourcentage de la population de moins de 15 ans est associé localement à une réduction de 0,20 de la concentration annuelle du dioxyde d’azote. Chez les entités voisines, cette réduction est de 0,78 et l’effet total est donc une réduction de 0,98.</p>
</div>
</div>
<p><strong>Dépendance spatiale du modèle SLX?</strong></p>
<p>Ce modèle a-t-il corrigé le problème de dépendance spatiale du modèle de régression linéaire classique? Avec une valeur du <em>I</em> de Moran de 0,605 (<em>p</em>&nbsp;&lt;&nbsp;0,001), les résidus sont toujours fortement autocorrélés spatialement (<a href="#fig-figCartoResSLX">figure&nbsp;<span>7.3</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html">lm.morantest</a></span><span class="op">(</span><span class="va">Modele.SLX</span>, <span class="va">W.Rook</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Global Moran I for regression residuals

data:  
model: lm(formula = formula(paste("y ~ ", paste(colnames(x)[-1],
collapse = "+"))), data = as.data.frame(x), weights = weights)
weights: W.Rook

Moran I statistic standard deviate = 21.951, p-value &lt; 2.2e-16
alternative hypothesis: two.sided
sample estimates:
Observed Moran I      Expectation         Variance 
    0.6046602748    -0.0072844321     0.0007771643 </code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">LyonIris</span><span class="op">$</span><span class="va">SLX.Residus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">Modele.SLX</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SLX.Residus"</span>, n <span class="op">=</span> <span class="fl">5</span>, style <span class="op">=</span> <span class="st">"quantile"</span>, </span>
<span>          legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"-RdBu"</span>, title <span class="op">=</span> <span class="st">"Résidus"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-figCartoResSLX" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-figCartoResSLX-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.3: Cartographie des résidus du modèle SLX</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-07122" class="level4" data-number="7.1.2.2"><h4 data-number="7.1.2.2" class="anchored" data-anchor-id="sec-07122">
<span class="header-section-number">7.1.2.2</span> Modèle SAR&nbsp;: autocorrélation spatiale sur la variable dépendante</h4>
<p>Dans le modèle SAR (aussi appelé SAR-LAG), l’autocorrélation spatiale est intégrée au niveau de la variable dépendante (<span class="math inline">\(Wy\)</span>), qui est ainsi spatialement décalée. L’idée générale est que la valeur de la variable dépendante pour une observation (<span class="math inline">\(y_i\)</span>) peut être influencée par les valeurs de <span class="math inline">\(y\)</span> des observations voisines et proches. L’exemple le plus classique est le prix de vente des maisons&nbsp;: il est influencé à la fois par les caractéristiques intrinsèques de la maison (<span class="math inline">\(X\)</span>, par exemple, la superficie habitable, le nombre de chambres à coucher, de salles de bains, etc.) et par le prix de vente des maisons voisines (<span class="math inline">\(Wy\)</span>). Jean Dubé et Diègo Legros <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014</a>)</span> qualifient ce phénomène «&nbsp;<strong>d’effets d’entraînement ou d’effets de débordement</strong> (<em>spillover effects</em>)&nbsp;» <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">2014, 123</a>)</span>. L’équation du modèle SAR s’écrit alors&nbsp;:</p>
<p><span id="eq-SLM"><span class="math display">\[
y = Wy\rho + X\beta + \epsilon
\tag{7.4}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, la variable dépendante.</li>
<li>
<span class="math inline">\(W\)</span>, la matrice de pondération spatiale.</li>
<li>
<span class="math inline">\(Wy\)</span>, la variable dépendante spatialement décalée.</li>
<li>
<span class="math inline">\(\rho\)</span> (prononcez <em>rho</em>), le coefficient de la variable dépendante spatialement décalée. Il varie de -1 à 1.</li>
<li>
<span class="math inline">\(X\)</span>, les variables indépendantes.</li>
<li>
<span class="math inline">\(\beta\)</span>, les coefficients des variables indépendantes.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, les résidus.</li>
</ul>
<p><strong>Construction du modèle SAR dans R</strong></p>
<p>Le modèle SAR est construit avec la fonction <code>lagsarlm</code> du <em>package</em> <code>spatialreg</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Construction du modèle</span></span>
<span><span class="va">Modele.SAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                              listw<span class="op">=</span><span class="va">W.Rook</span>,    <span class="co"># matrice de pondération spatiale</span></span>
<span>                              data <span class="op">=</span> <span class="va">LyonIris</span>, <span class="co"># dataframe</span></span>
<span>                              type <span class="op">=</span> <span class="st">'lag'</span><span class="op">)</span>    <span class="co"># Modèle lag par défaut</span></span>
<span><span class="co">## Résultats du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.SAR</span>, Nagelkerke<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:lagsarlm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + 
    NivVieMed, data = LyonIris, listw = W.Rook, type = "lag")

Residuals:
      Min        1Q    Median        3Q       Max 
-12.86859  -1.88111  -0.49760   0.94464  18.21351 

Type: lag 
Coefficients: (asymptotic standard errors) 
             Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)  7.838906   1.646232  4.7617 1.919e-06
Pct0_14     -0.098708   0.030554 -3.2306  0.001235
Pct_65      -0.034543   0.026957 -1.2814  0.200044
Pct_Img      0.030241   0.024491  1.2348  0.216917
Pct_brevet  -0.019234   0.017855 -1.0772  0.281384
NivVieMed   -0.098413   0.048985 -2.0090  0.044534

Rho: 0.87939, LR test value: 620.31, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.01942
    z-value: 45.283, p-value: &lt; 2.22e-16
Wald statistic: 2050.5, p-value: &lt; 2.22e-16

Log likelihood: -1366.157 for lag model
ML residual variance (sigma squared): 10.181, (sigma: 3.1908)
Nagelkerke pseudo-R-squared: 0.78962 
Number of observations: 506 
Number of parameters estimated: 8 
AIC: 2748.3, (AIC for lm: 3366.6)
LM test for residual autocorrelation
test value: 0.6198, p-value: 0.43112</code></pre>
</div>
</div>
<p>Dans les résultats ci-dessus, la valeur de <em>rho</em> est de 0,88 (LR&nbsp;=&nbsp;620, <em>p</em>&nbsp;&lt;&nbsp;0,001), traduisant un très fort effet d’entraînement. Autrement dit, lorsqu’en moyenne la concentration de dioxyde d’azote augmente dans les IRIS voisines (<span class="math inline">\(Wy\)</span>), elle augmente aussi fortement chaque IRIS (<span class="math inline">\(y\)</span>).</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Effets directs, indirects et totaux</strong></p>
</div>
<div class="bloc_attention-body">
<p>Tout comme le modèle SLX vu précédemment, la formulation du modèle SAR-LAG implique des effets particuliers. Reprenons l’exemple d’un modèle prédisant le prix de vente des maisons avec cette fois-ci un modèle de type SAR-LAG&nbsp;:</p>
<ol type="1">
<li>L’augmentation de la superficie du jardin de la maison <span class="math inline">\(i\)</span> va faire augmenter le prix de la maison <span class="math inline">\(i\)</span> (<span class="math inline">\(y_i\)</span>).</li>
<li>Cette augmentation de prix de la maison <span class="math inline">\(i\)</span> aura un impact sur les voisins de <span class="math inline">\(i\)</span>, soit les maisons <span class="math inline">\(j\)</span>, car leur prix dépend du prix de la maison <span class="math inline">\(i\)</span> au travers du terme <span class="math inline">\(Wy\rho\)</span> du modèle. Par exemple, si <span class="math inline">\(\rho\)</span> vaut 0,8, alors 80% de l’augmentation du prix de <span class="math inline">\(i\)</span> va se répercuter sur le prix des maisons <span class="math inline">\(j\)</span>.</li>
<li>De même, les voisines des maisons <span class="math inline">\(j\)</span>, les maisons <span class="math inline">\(k\)</span> vont aussi être impactées par le changement de prix des maisons <span class="math inline">\(j\)</span> et ainsi de suite de voisins en voisins.</li>
<li>Au final, la maison <span class="math inline">\(i\)</span> verra son prix augmenter encore plus, car le prix de ses voisines aura augmenté par effet de rétroaction.</li>
</ol>
<p>Ce processus de propagation est appelé l’effet d’entraînement ou de débordement (<em>spillover</em>) en économétrie.</p>
<p>L’effet original de l’augmentation de la taille du jardin sur la maison <span class="math inline">\(i\)</span>, combiné à l’augmentation par rétroaction, est appelé l’effet direct. L’effet cumulé de l’augmentation de la taille du jardin sur toutes les autres maisons (<span class="math inline">\(\neq i\)</span>) est appelé l’effet indirect. La somme des effets indirects et des directs est appelée effets totaux.</p>
<p>À nouveau, il est possible d’utiliser la fonction <code>impacts</code> pour calculer ces effets directs et indirects.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Effets directs, indirects et totaux (uniquement les coefficients)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.SAR</span>, listw <span class="op">=</span> <span class="va">W.Rook</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (lag, exact):
                Direct   Indirect      Total
Pct0_14    -0.13878038 -0.6796248 -0.8184052
Pct_65     -0.04856624 -0.2378349 -0.2864012
Pct_Img     0.04251743  0.2082131  0.2507306
Pct_brevet -0.02704205 -0.1324283 -0.1594703
NivVieMed  -0.13836534 -0.6775923 -0.8159576</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Effets directs, indirects et totaux (coefficients, valeurs de z et de p)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.SAR</span>, listw <span class="op">=</span> <span class="va">W.Rook</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>, zstats <span class="op">=</span> <span class="cn">TRUE</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (lag, exact):
                Direct   Indirect      Total
Pct0_14    -0.13878038 -0.6796248 -0.8184052
Pct_65     -0.04856624 -0.2378349 -0.2864012
Pct_Img     0.04251743  0.2082131  0.2507306
Pct_brevet -0.02704205 -0.1324283 -0.1594703
NivVieMed  -0.13836534 -0.6775923 -0.8159576
========================================================
Simulation results ( variance matrix):
========================================================
Simulated standard errors
               Direct  Indirect     Total
Pct0_14    0.04326929 0.2417407 0.2805365
Pct_65     0.03830263 0.2006507 0.2378901
Pct_Img    0.03475601 0.1811266 0.2149674
Pct_brevet 0.02459614 0.1286788 0.1527126
NivVieMed  0.06890889 0.3708196 0.4362971

Simulated z-values:
              Direct  Indirect     Total
Pct0_14    -3.246311 -2.913823 -3.011569
Pct_65     -1.270341 -1.210825 -1.225820
Pct_Img     1.208218  1.156290  1.169608
Pct_brevet -1.058156 -1.007896 -1.019702
NivVieMed  -2.029437 -1.895991 -1.931979

Simulated p-values:
           Direct    Indirect  Total   
Pct0_14    0.0011691 0.0035703 0.002599
Pct_65     0.2039632 0.2259623 0.220266
Pct_Img    0.2269633 0.2475626 0.242159
Pct_brevet 0.2899845 0.3135046 0.307870
NivVieMed  0.0424138 0.0579612 0.053362</code></pre>
</div>
</div>
<p>L’interprétation des effets directs se rapproche de celle des coefficients classiques. Ainsi, selon ce modèle, l’augmentation du niveau de vie médian de 1000&nbsp;€ dans un IRIS est associée avec une diminution moyenne de la concentration de dioxyde d’azote de 0,14 dans cet IRIS. L’effet total est de -0.82, indiquant qu’en moyenne, l’augmentation de 1000&nbsp;€ du niveau de vie médian dans un IRIS est associée avec une diminution moyenne de 0,82 de la concentration de dioxyde d’azote dans l’ensemble des IRIS. Au final, l’effet indirect est simplement la différence entre l’effet total et l’effet direct. Nous pouvons constater ici que les effets indirects sont plus importants que les effets directs.</p>
</div>
</div>
<p><strong>Dépendance spatiale du modèle SAR?</strong></p>
<p>Ce modèle a-t-il corrigé le problème de dépendance spatiale du modèle de régression linéaire classique? Avec une valeur du <em>I</em> de Moran de -0,014 (<em>p</em>&nbsp;=&nbsp;0,654), les résidus ne sont plus spatialement autocorrélés (<a href="#fig-figCartoResSAR">figure&nbsp;<span>7.4</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Autocorrélation spatiale des résidus</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.SAR</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  resid(Modele.SAR) 
weights: W.Rook  
number of simulations + 1: 1000 

statistic = -0.014281, observed rank = 335, p-value = 0.665
alternative hypothesis: greater</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Cartographie des résidus</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">SAR.Residus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.SAR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"SAR.Residus"</span>, n <span class="op">=</span> <span class="fl">5</span>, style <span class="op">=</span> <span class="st">"quantile"</span>, </span>
<span>          legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"-RdBu"</span>, title <span class="op">=</span> <span class="st">"Résidus"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-figCartoResSAR" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-figCartoResSAR-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.4: Cartographie des résidus du modèle SAR</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-07123" class="level4" data-number="7.1.2.3"><h4 data-number="7.1.2.3" class="anchored" data-anchor-id="sec-07123">
<span class="header-section-number">7.1.2.3</span> Modèle SEM&nbsp;: autocorrélation spatiale sur le terme d’erreur</h4>
<p>Dans le modèle SEM (<em>Spatial Error Model</em>, appelé aussi <em>SAR-ERROR</em>), l’intégration de l’autocorrélation spatiale est réalisée sur le terme d’erreur, ce qui pourrait se justifier par l’omission d’une variable dépendante spatialement structurée <span class="citation" data-cites="dube2014econometrie">(<a href="references.html#ref-dube2014econometrie" role="doc-biblioref">Dubé et Legros 2014, 126</a>)</span>. L’équation du modèle SEM s’écrit&nbsp;:</p>
<p><span id="eq-SEM"><span class="math display">\[
y = X\beta + u \textrm{, } u = \lambda Wu + \epsilon
\tag{7.5}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, la variable dépendante.</li>
<li>
<span class="math inline">\(W\)</span>, la matrice de pondération spatiale.</li>
<li>
<span class="math inline">\(\lambda\)</span> (prononcez <em>lambda</em>), le coefficient sur le terme d’erreur spatialement décalé. Il varie de -1 à 1.</li>
<li>
<span class="math inline">\(X\)</span>, les variables indépendantes.</li>
<li>
<span class="math inline">\(\beta\)</span>, les coefficients des variables indépendantes.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, les résidus.</li>
</ul>
<p><strong>Construction du modèle SAR dans R</strong></p>
<p>Le modèle SEM est construit avec la fonction <code>errorsarlm</code> du <em>package</em> <code>spatialreg</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Construction du modèle</span></span>
<span><span class="va">Modele.SEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                         listw<span class="op">=</span><span class="va">W.Rook</span>,    <span class="co"># matrice de pondération spatiale</span></span>
<span>                         data <span class="op">=</span> <span class="va">LyonIris</span><span class="op">)</span> <span class="co"># dataframe</span></span>
<span><span class="co">## Résultats du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.SEM</span>, Nagelkerke<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:errorsarlm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + 
    NivVieMed, data = LyonIris, listw = W.Rook)

Residuals:
      Min        1Q    Median        3Q       Max 
-12.86150  -1.83161  -0.44106   0.91029  17.94924 

Type: error 
Coefficients: (asymptotic standard errors) 
             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) 30.544576   2.358173 12.9526  &lt; 2e-16
Pct0_14     -0.035019   0.033393 -1.0487  0.29431
Pct_65      -0.026039   0.028970 -0.8988  0.36874
Pct_Img     -0.016770   0.026176 -0.6407  0.52175
Pct_brevet   0.023708   0.019074  1.2430  0.21388
NivVieMed   -0.146309   0.060273 -2.4274  0.01521

Lambda: 0.91138, LR test value: 613.15, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.01651
    z-value: 55.201, p-value: &lt; 2.22e-16
Wald statistic: 3047.2, p-value: &lt; 2.22e-16

Log likelihood: -1369.737 for error model
ML residual variance (sigma squared): 9.9971, (sigma: 3.1618)
Nagelkerke pseudo-R-squared: 0.78662 
Number of observations: 506 
Number of parameters estimated: 8 
AIC: 2755.5, (AIC for lm: 3366.6)</code></pre>
</div>
</div>
<p>Dans les résultats ci-dessus, la valeur de <em>lambda</em> est de 0,91 (LR&nbsp;=&nbsp;613, <em>p</em>&nbsp;&lt;&nbsp;0,001), traduisant une très forte autocorrélation spatiale sur le terme d’erreur.</p>
<p><strong>Dépendance spatiale du modèle SEM?</strong></p>
<p>Ce modèle a-t-il corrigé le problème de dépendance spatiale du modèle de régression linéaire classique? Avec une valeur du <em>I</em> de Moran de -0,013 (<em>p</em>&nbsp;=&nbsp;0,614), les résidus ne sont plus spatialement autocorrélés.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Autocorrélation spatiale des résidus</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.SEM</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  resid(Modele.SEM) 
weights: W.Rook  
number of simulations + 1: 1000 

statistic = -0.011827, observed rank = 361, p-value = 0.639
alternative hypothesis: greater</code></pre>
</div>
</div>
</section><section id="sec-07124" class="level4" data-number="7.1.2.4"><h4 data-number="7.1.2.4" class="anchored" data-anchor-id="sec-07124">
<span class="header-section-number">7.1.2.4</span> Modèle SDM&nbsp;: autocorrélation spatiale sur la variable dépendante et les variables indépendantes</h4>
<p>Le modèle SDM (<em>Spatial Durbin Model</em>) est un modèle mixte qui intègre à la fois l’autocorrélation spatiale sur la variable dépendante (<span class="math inline">\(Wy\)</span>, <strong>effets d’entraînement ou de débordement</strong>) et sur les variables indépendantes (<span class="math inline">\(WX\)</span>, <strong>externalités</strong>). Il s’écrit alors&nbsp;:</p>
<p><span id="eq-SDM"><span class="math display">\[
y = Wy\rho + X\beta + WX\theta + \epsilon
\tag{7.6}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, la variable dépendante.</li>
<li>
<span class="math inline">\(W\)</span>, la matrice de pondération spatiale.</li>
<li>
<span class="math inline">\(Wy\)</span>, la variable dépendante spatialement décalée.</li>
<li>
<span class="math inline">\(\rho\)</span>, le coefficient de la variable dépendante spatialement décalée.</li>
<li>
<span class="math inline">\(X\)</span>, les variables indépendantes.</li>
<li>
<span class="math inline">\(\beta\)</span>, les coefficients des variables indépendantes.</li>
<li>
<span class="math inline">\(WX\)</span>, les variables indépendantes spatiales décalées.</li>
<li>
<span class="math inline">\(\theta\)</span>, les coefficients des variables indépendantes spatiales décalées.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, les résidus.</li>
</ul>
<p><strong>Construction du modèle SDM dans R</strong></p>
<p>Le modèle SDM est construit avec la fonction <code>lagsarlm</code> du <em>package</em> <code>spatialreg</code>. Notez que le paramètre <code>type = "mixed"</code> spécifie l’utilisation d’un modèle mixte.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Construction du modèle</span></span>
<span><span class="va">Modele.DurbinSpatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">lagsarlm</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                       listw <span class="op">=</span> <span class="va">W.Rook</span>,    <span class="co"># matrice de pondération spatiale</span></span>
<span>                       data <span class="op">=</span> <span class="va">LyonIris</span>,   <span class="co"># dataframe</span></span>
<span>                       type <span class="op">=</span> <span class="st">"mixed"</span><span class="op">)</span></span>
<span><span class="co">## Résultats du modèles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span>, Nagelkerke<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:lagsarlm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + 
    NivVieMed, data = LyonIris, listw = W.Rook, type = "mixed")

Residuals:
      Min        1Q    Median        3Q       Max 
-12.60922  -1.77753  -0.43909   0.99252  18.15526 

Type: mixed 
Coefficients: (asymptotic standard errors) 
                 Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)     8.1130457  2.5671301  3.1604 0.001576
Pct0_14        -0.0574046  0.0344908 -1.6643 0.096043
Pct_65         -0.0238715  0.0293647 -0.8129 0.416256
Pct_Img         0.0048364  0.0266560  0.1814 0.856025
Pct_brevet      0.0112746  0.0195259  0.5774 0.563656
NivVieMed      -0.1463876  0.0605853 -2.4162 0.015682
lag.Pct0_14    -0.1242574  0.0581170 -2.1381 0.032512
lag.Pct_65      0.0255480  0.0499646  0.5113 0.609125
lag.Pct_Img     0.1559952  0.0482138  3.2355 0.001214
lag.Pct_brevet -0.0883930  0.0342496 -2.5809 0.009856
lag.NivVieMed   0.1032469  0.0960201  1.0753 0.282257

Rho: 0.84127, LR test value: 492.38, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.023363
    z-value: 36.009, p-value: &lt; 2.22e-16
Wald statistic: 1296.7, p-value: &lt; 2.22e-16

Log likelihood: -1353.106 for mixed model
ML residual variance (sigma squared): 9.9845, (sigma: 3.1598)
Nagelkerke pseudo-R-squared: 0.8002 
Number of observations: 506 
Number of parameters estimated: 13 
AIC: 2732.2, (AIC for lm: 3222.6)
LM test for residual autocorrelation
test value: 0.0748, p-value: 0.78447</code></pre>
</div>
</div>
<p><strong>Effets directs, indirects et totaux</strong></p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Effets directs, indirects et totaux (uniquement les coefficients)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span>, listw <span class="op">=</span> <span class="va">W.Rook</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (mixed, exact):
                Direct    Indirect       Total
Pct0_14    -0.12369039 -1.02079497 -1.14448536
Pct_65     -0.02177191  0.03233406  0.01056215
Pct_Img     0.06632543  0.94692639  1.01325182
Pct_brevet -0.01903815 -0.46681402 -0.48585217
NivVieMed  -0.15403413 -0.11775603 -0.27179016</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Effets directs, indirects et totaux (coefficients, valeurs de z et de p)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span>, listw <span class="op">=</span> <span class="va">W.Rook</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>, zstats <span class="op">=</span> <span class="cn">TRUE</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (mixed, exact):
                Direct    Indirect       Total
Pct0_14    -0.12369039 -1.02079497 -1.14448536
Pct_65     -0.02177191  0.03233406  0.01056215
Pct_Img     0.06632543  0.94692639  1.01325182
Pct_brevet -0.01903815 -0.46681402 -0.48585217
NivVieMed  -0.15403413 -0.11775603 -0.27179016
========================================================
Simulation results ( variance matrix):
========================================================
Simulated standard errors
               Direct  Indirect     Total
Pct0_14    0.04430686 0.3395464 0.3693651
Pct_65     0.03580240 0.2904877 0.3147007
Pct_Img    0.03235258 0.2693100 0.2884844
Pct_brevet 0.02426162 0.1997187 0.2152533
NivVieMed  0.06935759 0.4874925 0.5237558

Simulated z-values:
               Direct   Indirect       Total
Pct0_14    -2.8084985 -3.0195552 -3.11267848
Pct_65     -0.6501741  0.1179942  0.03494771
Pct_Img     2.0634538  3.5520890  3.54740508
Pct_brevet -0.7157838 -2.3167129 -2.23019527
NivVieMed  -2.1842635 -0.2165114 -0.49076865

Simulated p-values:
           Direct    Indirect   Total     
Pct0_14    0.0049773 0.00253146 0.00185398
Pct_65     0.5155797 0.90607224 0.97212144
Pct_Img    0.0390695 0.00038219 0.00038905
Pct_brevet 0.4741249 0.02051938 0.02573448
NivVieMed  0.0289429 0.82858918 0.62359008</code></pre>
</div>
</div>
<p><strong>Dépendance spatiale du modèle SDM?</strong></p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  resid(Modele.DurbinSpatial) 
weights: W.Rook  
number of simulations + 1: 1000 

statistic = -0.0046127, observed rank = 470, p-value = 0.53
alternative hypothesis: greater</code></pre>
</div>
</div>
</section><section id="sec-07125" class="level4" data-number="7.1.2.5"><h4 data-number="7.1.2.5" class="anchored" data-anchor-id="sec-07125">
<span class="header-section-number">7.1.2.5</span> Modèle SDEM&nbsp;: autocorrélation spatiale sur les variables indépendantes et sur le terme d’erreur</h4>
<p>Le modèle SDEM (<em>Spatial Durbin Error Model</em> en anglais) est un autre modèle mixte qui intègre à la fois l’autocorrélation spatiale sur les valeurs indépendantes (<span class="math inline">\(WX\)</span>, <strong>externalités</strong>) et sur le terme d’erreur (<span class="math inline">\(u = \lambda Wu + \epsilon\)</span>). Il s’écrit alors&nbsp;:</p>
<p><span id="eq-SDEM"><span class="math display">\[
y = X\beta + WX\theta + u \textrm{, } u = \lambda Wu + \epsilon
\tag{7.7}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, la variable dépendante.</li>
<li>
<span class="math inline">\(W\)</span>, la matrice de pondération spatiale.</li>
<li>
<span class="math inline">\(X\)</span>, les variables indépendantes.</li>
<li>
<span class="math inline">\(\beta\)</span>, les coefficients des variables indépendantes.</li>
<li>
<span class="math inline">\(WX\)</span>, les variables dépendantes spatiales décalées.</li>
<li>
<span class="math inline">\(\theta\)</span>, les coefficients des variables indépendantes spatiales décalées.</li>
<li>
<span class="math inline">\(\lambda\)</span> (prononcez <em>lambda</em>), le coefficient sur le terme d’erreur spatialement décalé.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, les résidus.</li>
</ul>
<p><strong>Construction du modèle SDEM dans R</strong></p>
<p>Le modèle SDEM est construit avec la fonction <code>errorsarlm</code> du <em>package</em> <code>spatialreg</code>. Notez que le paramètre <code>etype = "mixed"</code> spécifie l’utilisation d’un modèle mixte.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Construction du modèle</span></span>
<span><span class="va">Modele.DurbinErreur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                                  listw<span class="op">=</span><span class="va">W.Rook</span>,    <span class="co"># matrice de pondération spatiale</span></span>
<span>                                  data <span class="op">=</span> <span class="va">LyonIris</span>, <span class="co"># dataframe</span></span>
<span>                                  etype <span class="op">=</span> <span class="st">'emixed'</span><span class="op">)</span></span>
<span><span class="co">## Résultats du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span>, Nagelkerke<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:errorsarlm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + 
    NivVieMed, data = LyonIris, listw = W.Rook, etype = "emixed")

Residuals:
      Min        1Q    Median        3Q       Max 
-12.99324  -1.82407  -0.45644   1.06084  18.21108 

Type: error 
Coefficients: (asymptotic standard errors) 
                Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)    37.061010   6.501018  5.7008 1.192e-08
Pct0_14        -0.081998   0.041699 -1.9664   0.04925
Pct_65         -0.026329   0.034714 -0.7585   0.44817
Pct_Img         0.004656   0.031028  0.1501   0.88072
Pct_brevet      0.009785   0.023884  0.4097   0.68203
NivVieMed      -0.167855   0.068005 -2.4683   0.01358
lag.Pct0_14    -0.176747   0.102345 -1.7270   0.08417
lag.Pct_65      0.010533   0.089183  0.1181   0.90599
lag.Pct_Img     0.092785   0.079704  1.1641   0.24437
lag.Pct_brevet -0.038048   0.056688 -0.6712   0.50211
lag.NivVieMed  -0.102531   0.172405 -0.5947   0.55204

Lambda: 0.8976, LR test value: 464.09, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.018242
    z-value: 49.204, p-value: &lt; 2.22e-16
Wald statistic: 2421, p-value: &lt; 2.22e-16

Log likelihood: -1367.25 for error model
ML residual variance (sigma squared): 10.046, (sigma: 3.1696)
Nagelkerke pseudo-R-squared: 0.78871 
Number of observations: 506 
Number of parameters estimated: 13 
AIC: 2760.5, (AIC for lm: 3222.6)</code></pre>
</div>
</div>
<p><strong>Effets directs, indirects et totaux</strong></p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Effets directs, indirects et totaux (uniquement les coefficients)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span>, listw <span class="op">=</span> <span class="va">W.Rook</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (SDEM, glht):
                 Direct    Indirect       Total
Pct0_14    -0.081997642 -0.17674683 -0.25874447
Pct_65     -0.026329370  0.01053248 -0.01579689
Pct_Img     0.004656039  0.09278511  0.09744115
Pct_brevet  0.009784961 -0.03804813 -0.02826317
NivVieMed  -0.167855498 -0.10253070 -0.27038620</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Effets directs, indirects et totaux (coefficients, valeurs de z et de p)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/impacts.html">impacts</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span>, listw <span class="op">=</span> <span class="va">W.Rook</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>, zstats <span class="op">=</span> <span class="cn">TRUE</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (SDEM, glht, n):
                 Direct    Indirect       Total
Pct0_14    -0.081997642 -0.17674683 -0.25874447
Pct_65     -0.026329370  0.01053248 -0.01579689
Pct_Img     0.004656039  0.09278511  0.09744115
Pct_brevet  0.009784961 -0.03804813 -0.02826317
NivVieMed  -0.167855498 -0.10253070 -0.27038620
========================================================
Standard errors:
               Direct   Indirect      Total
Pct0_14    0.04169878 0.10234506 0.13146453
Pct_65     0.03471367 0.08918350 0.11192948
Pct_Img    0.03102807 0.07970364 0.09949722
Pct_brevet 0.02388387 0.05668833 0.07344175
NivVieMed  0.06800483 0.17240549 0.21172909
========================================================
Z-values:
               Direct   Indirect      Total
Pct0_14    -1.9664279 -1.7269698 -1.9681695
Pct_65     -0.7584727  0.1180989 -0.1411325
Pct_Img     0.1500589  1.1641264  0.9793354
Pct_brevet  0.4096890 -0.6711810 -0.3848379
NivVieMed  -2.4682880 -0.5947067 -1.2770385

p-values:
           Direct   Indirect Total   
Pct0_14    0.049249 0.084173 0.049049
Pct_65     0.448168 0.905989 0.887765
Pct_Img    0.880718 0.244373 0.327414
Pct_brevet 0.682034 0.502105 0.700358
NivVieMed  0.013576 0.552040 0.201589</code></pre>
</div>
</div>
<p><strong>Dépendance spatiale du modèle SDEM?</strong></p>
<p>Avec une valeur du <em>I</em> de Moran de -0,010 (<em>p</em>&nbsp;=&nbsp;0,619), les résidus du modèle SDEM ne sont pas spatialement autocorrélés.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  resid(Modele.DurbinErreur) 
weights: W.Rook  
number of simulations + 1: 1000 

statistic = -0.010362, observed rank = 403, p-value = 0.597
alternative hypothesis: greater</code></pre>
</div>
</div>
</section></section><section id="sec-0713" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="sec-0713">
<span class="header-section-number">7.1.3</span> Quel modèle choisir?</h3>
<section id="sec-07131" class="level4" data-number="7.1.3.1"><h4 data-number="7.1.3.1" class="anchored" data-anchor-id="sec-07131">
<span class="header-section-number">7.1.3.1</span> Tests du multiplicateur de Lagrange sur le modèle MCO</h4>
<p>L’utilisation des tests du multiplicateur de Lagrange (simple et robuste) a été largement popularisée par Anselin <em>et al.</em> <span class="citation" data-cites="anselin1996simple">(<a href="references.html#ref-anselin1996simple" role="doc-biblioref">1996</a>)</span> pour vérifier si le recours à un modèle autorégressif est nécessaire, comparativement à un modèle de régression classique (MCO). Les tests sont calculés sur le modèle MCO avec la fonction <code>lm.LMtests</code> et une matrice de pondération spatiale. Ces tests permettent aussi de choisir entre les modèles SAR et SEM. La démarche suivante peut être utilisée pour choisir un modèle&nbsp;:</p>
<ol type="1">
<li>Si toutes les valeurs des tests (simples et robustes) sont non significatives (<em>p</em>&nbsp;&gt;&nbsp;0,05), alors le recours à un modèle autorégressif n’est pas nécessaire. Nous pouvons conserver le modèle de régression classique (MCO).</li>
<li>Si les valeurs de <code>LMlag</code> ou <code>RLMlag</code> sont non significatives (<em>p</em>&nbsp;&gt;&nbsp;0,05), alors le recours au modèle SAR n’est pas nécessaire.</li>
<li>Si les valeurs de <code>LMerr</code> ou <code>RLMerr</code> sont non significatives (<em>p</em>&nbsp;&gt;&nbsp;0,05), alors le recours au modèle SEM n’est pas nécessaire.</li>
<li>Si les valeurs de <code>RLMlag</code> et <code>RLMerr</code> sont significatives (<em>p</em>&nbsp;&lt;&nbsp;0,001), nous choisissons le modèle ayant la plus forte statistique.</li>
</ol>
<p>Dans les résultats ci-dessous, nous ne retenons pas le modèle SEM car la valeur de 0,740 pour le <code>RLMerr</code> n’est pas significative (<em>p</em>&nbsp;=&nbsp;0,3898). Par contre, les valeurs de <code>LMlag</code> et de <code>RLMlag</code> (555 et 123) sont significatives, ce qui justifie la sélection du modèle SAR.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.RStests.html">lm.LMtests</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">Modele.MCO</span>,</span>
<span>                   listw <span class="op">=</span> <span class="va">W.Rook</span>,</span>
<span>                   test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LMlag"</span>,<span class="st">"LMerr"</span>,<span class="st">"RLMlag"</span>,<span class="st">"RLMerr"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Rao's score (a.k.a Lagrange multiplier) diagnostics for spatial
    dependence
data:  
model: lm(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet +
NivVieMed, data = LyonIris)
test weights: listw
 
         statistic parameter p.value    
RSlag    554.65778         1  &lt;2e-16 ***
RSerr    432.83282         1  &lt;2e-16 ***
adjRSlag 122.56452         1  &lt;2e-16 ***
adjRSerr   0.73955         1  0.3898    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section><section id="sec-07132" class="level4" data-number="7.1.3.2"><h4 data-number="7.1.3.2" class="anchored" data-anchor-id="sec-07132">
<span class="header-section-number">7.1.3.2</span> Comparaison des modèles mixtes et non mixtes</h4>
<p>Nous avons vu qu’il existe deux modèles mixtes (SDM et SDEM). Il convient alors de vérifier si le recours d’un modèle mixte est justifié comparativement à un modèle non mixte. Dans le code ci-dessous, nous vérifions si le modèle SDM est statistiquement différent du modèle SAR avec les fonctions <code>LR.Sarlm</code> et <code>anova</code>. Les résultats signalent un écart significatif des valeurs du log-vraisemblance (26,101, <em>p</em>&nbsp;&lt;&nbsp;0,001). Par conséquent, ce modèle mixte a un apport significatif.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## SDM et SEM sont-ils significativement différents?</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">LR.Sarlm</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span>, <span class="va">Modele.SAR</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Likelihood ratio for spatial linear models

data:  
Likelihood ratio = 26.101, df = 5, p-value = 8.528e-05
sample estimates:
Log likelihood of Modele.DurbinSpatial           Log likelihood of Modele.SAR 
                             -1353.106                              -1366.157 </code></pre>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span>, <span class="va">Modele.SAR</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     Model df    AIC  logLik Test L.Ratio    p-value
Modele.DurbinSpatial     1 13 2732.2 -1353.1    1                   
Modele.SAR               2  8 2748.3 -1366.2    2  26.101 8.5283e-05</code></pre>
</div>
</div>
<p>À l’inverse, la différence entre les valeurs du log-vraisemblance des modèles SDEM et SEM n’est pas significative (4,9728, <em>p</em>&nbsp;=&nbsp;0,42), signalant que l’utilisation d’un modèle SDEM comparativement à un modèle SEM n’est pas nécessaire.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## SDEM et SEM sont-ils significativement différents?</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/sarlm_tests.html">LR.Sarlm</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span>, <span class="va">Modele.SEM</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Likelihood ratio for spatial linear models

data:  
Likelihood ratio = 4.9728, df = 5, p-value = 0.4192
sample estimates:
Log likelihood of Modele.DurbinErreur          Log likelihood of Modele.SEM 
                            -1367.250                             -1369.737 </code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span>, <span class="va">Modele.SEM</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Model df    AIC  logLik Test L.Ratio p-value
Modele.DurbinErreur     1 13 2760.5 -1367.2    1                
Modele.SEM              2  8 2755.5 -1369.7    2  4.9728  0.4192</code></pre>
</div>
</div>
</section><section id="sec-07133" class="level4" data-number="7.1.3.3"><h4 data-number="7.1.3.3" class="anchored" data-anchor-id="sec-07133">
<span class="header-section-number">7.1.3.3</span> Mesures AIC et BIC et dépendance spatiale</h4>
<p>Le critère d’information d’Akaike (AIC) et le critère d’information bayésien (BIC) sont largement utilisés pour évaluer la qualité d’ajustement du modèle. Plus leurs valeurs sont faibles, meilleur est le modèle. Il est donc possible de comparer leurs valeurs pour les différents modèles (MCO, SLX, SAR, SEM, SDM et SDEM). Nous pouvons aussi comparer l’autocorrélation spatiale des résidus des modèles avec le <em>I</em> de Moran.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Valeurs d'AIC et de BIC</span></span>
<span><span class="va">AICs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">Modele.MCO</span>, <span class="va">Modele.SLX</span>, <span class="va">Modele.SAR</span>, <span class="va">Modele.SEM</span>, </span>
<span>            <span class="va">Modele.DurbinSpatial</span>, <span class="va">Modele.DurbinErreur</span><span class="op">)</span></span>
<span><span class="va">BICs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">Modele.MCO</span>, <span class="va">Modele.SLX</span>, <span class="va">Modele.SAR</span>, <span class="va">Modele.SEM</span>, </span>
<span>            <span class="va">Modele.DurbinSpatial</span>, <span class="va">Modele.DurbinErreur</span><span class="op">)</span></span>
<span><span class="co">## Autocorrélation spatiale des résidus</span></span>
<span><span class="va">IMoran.MCO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.MCO</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">IMoran.SLX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.SLX</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">IMoran.SLM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.SAR</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">IMoran.SEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.SEM</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">IMoran.DurbinS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.DurbinSpatial</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">IMoran.DurbinE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.DurbinErreur</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">MoranI.s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">IMoran.MCO</span><span class="op">$</span><span class="va">statistic</span>, <span class="va">IMoran.SLX</span><span class="op">$</span><span class="va">statistic</span>,</span>
<span>             <span class="va">IMoran.SLM</span><span class="op">$</span><span class="va">statistic</span>, <span class="va">IMoran.SEM</span><span class="op">$</span><span class="va">statistic</span>,</span>
<span>             <span class="va">IMoran.DurbinS</span><span class="op">$</span><span class="va">statistic</span>, <span class="va">IMoran.DurbinE</span><span class="op">$</span><span class="va">statistic</span><span class="op">)</span></span>
<span><span class="va">MoranI.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">IMoran.MCO</span><span class="op">$</span><span class="va">p.value</span>, <span class="va">IMoran.SLX</span><span class="op">$</span><span class="va">p.value</span>,</span>
<span>             <span class="va">IMoran.SLM</span><span class="op">$</span><span class="va">p.value</span>, <span class="va">IMoran.SEM</span><span class="op">$</span><span class="va">p.value</span>,</span>
<span>             <span class="va">IMoran.DurbinS</span><span class="op">$</span><span class="va">p.value</span>, <span class="va">IMoran.DurbinE</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span>
<span><span class="co">## Tableau</span></span>
<span><span class="va">Comparaison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Modele <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MCO"</span>, <span class="st">"SLX"</span>, <span class="st">"SAR"</span>, <span class="st">"SEM"</span>, <span class="st">"Durbin S"</span>, <span class="st">"Durbin E"</span><span class="op">)</span>,</span>
<span>                          AIC <span class="op">=</span> <span class="va">AICs</span><span class="op">$</span><span class="va">AIC</span>,</span>
<span>                          BIC <span class="op">=</span> <span class="va">BICs</span><span class="op">$</span><span class="va">BIC</span>,</span>
<span>                          dl <span class="op">=</span> <span class="va">AICs</span><span class="op">$</span><span class="va">df</span>,</span>
<span>                          MoranI <span class="op">=</span> <span class="va">MoranI.s</span>,</span>
<span>                          MoranIp <span class="op">=</span> <span class="va">MoranI.p</span><span class="op">)</span></span>
<span><span class="va">Comparaison</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Modele      AIC      BIC dl       MoranI MoranIp
1      MCO 3366.626 3396.212  7  0.587312061   0.001
2      SLX 3222.594 3273.313 12  0.604660275   0.001
3      SAR 2748.314 2782.126  8 -0.014281059   0.641
4      SEM 2755.474 2789.286  8 -0.011826605   0.620
5 Durbin S 2732.212 2787.157 13 -0.004612686   0.536
6 Durbin E 2760.501 2815.446 13 -0.010361653   0.612</code></pre>
</div>
</div>
<p>Quelques lignes de code suffisent pour créer deux graphiques permettant de comparer visuellement les résultats des différents modèles (<a href="#fig-GraphComparaison">figure&nbsp;<span>7.5</span></a>). Les résultats démontrent que&nbsp;:</p>
<ul>
<li>Les modèles MCO et SLX ont un problème de dépendance spatiale puisque leurs résidus sont significativement autocorrélés spatialement. Par conséquent, ils ne devraient pas être retenus.</li>
<li>Les modèles SDM, SAR et SEM sont les plus performants avec les valeurs d’AIC les plus faibles.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="co">## Graphique pour l'autocorrélation spatiale</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Comparaison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Modele</span>,<span class="va">MoranI</span><span class="op">)</span>, y<span class="op">=</span><span class="va">MoranI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Modele</span>, <span class="va">MoranI</span><span class="op">)</span>,</span>
<span>                   xend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Modele</span>, <span class="va">MoranI</span><span class="op">)</span>,</span>
<span>                   y<span class="op">=</span><span class="fl">0</span>, yend<span class="op">=</span><span class="va">MoranI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span> size<span class="op">=</span><span class="fl">4</span>,fill<span class="op">=</span><span class="st">"red"</span>,shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Modèle"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"I de Moran"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Autocorrélation spatiale des résidus"</span>,</span>
<span>       caption<span class="op">=</span><span class="st">"Plus la valeur du I de Moran est faible, \nmoins il y a d'autocorrélation spatiale."</span><span class="op">)</span></span>
<span><span class="co">## Graphique pour les valeurs d'AIC</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Comparaison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Modele</span>,<span class="va">AIC</span><span class="op">)</span>, y<span class="op">=</span><span class="va">AIC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Modele</span>, <span class="va">AIC</span><span class="op">)</span>,</span>
<span>                   xend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Modele</span>, <span class="va">AIC</span><span class="op">)</span>,</span>
<span>                   y<span class="op">=</span><span class="fl">0</span>, yend<span class="op">=</span><span class="va">AIC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span> size<span class="op">=</span><span class="fl">4</span>,fill<span class="op">=</span><span class="st">"red"</span>,shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Modèle"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"AIC"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Qualité d'ajustement du modèle"</span>,</span>
<span>       caption<span class="op">=</span><span class="st">"Plus la valeur d'AIC est faible, \nplus le modèle est performant."</span><span class="op">)</span></span>
<span><span class="co">## Figure avec les deux graphiques</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GraphComparaison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GraphComparaison-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.5: Comparaison des différents modèles</figcaption></figure>
</div>
</div>
</div>
</section></section></section><section id="sec-072" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-072">
<span class="header-section-number">7.2</span> Modèles généralisés additifs (GAM) avec une <em>spline</em> bivariée sur les coordonnées géographiques</h2>
<p>Les modèles généralisés additifs (<em>Generalized additive models</em> en anglais) permettent d’intégrer à la fois des effets linéaires et des effets non linéaires avec des <em>splines</em>. Ils peuvent alors être utilisés en intégrant une <em>spline</em> bivariée sur les coordonnées géographiques des centroïdes des entités spatiales.</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Modèles généralisés additifs</strong></p>
</div>
<div class="bloc_attention-body">
<p>Pour une description détaillée des modèles généralisés additifs, nous vous invitons vivement à lire le <a href="https://serieboldr.github.io/MethodesQuantitatives/11-GAM.html">chapitre suivant</a> <span class="citation" data-cites="RBoldAir">(<a href="references.html#ref-RBoldAir" role="doc-biblioref">Apparicio et Gelb 2022</a>)</span>.</p>
</div>
</div>
<section id="sec-0721" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="sec-0721">
<span class="header-section-number">7.2.1</span> Principe de base d’un GAM intégrant l’espace</h3>
<p>Avec une <em>spline</em> bivariée sur les coordonnées géographiques, l’équation d’un modèle généralisé additif s’écrit&nbsp;:</p>
<p><span id="eq-GAM"><span class="math display">\[
g(Y) \ = \beta_{0} \ + X\beta + s(CoordX,CoordY) \ + \epsilon
\tag{7.8}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\(y\)</span>, la variable dépendante.</li>
<li>
<span class="math inline">\(\beta_{0}\)</span>, la constante.</li>
<li>
<span class="math inline">\(X\)</span>, les variables indépendantes.</li>
<li>
<span class="math inline">\(\beta\)</span>, les coefficients des variables dépendantes.</li>
<li>
<span class="math inline">\(s(CoordX,CoordY)\)</span>, <em>spline</em> bivariée sur les coordonnées <em>x</em> et <em>y</em>.</li>
<li>
<span class="math inline">\(\epsilon\)</span>, les résidus.</li>
</ul>
<p>L’intérêt de recourir à une <em>spline</em> bivariée sur les coordonnées géographiques est double&nbsp;:</p>
<ol type="1">
<li><p>Contrôler l’effet de la localisation sur la variable dépendante (<span class="math inline">\(y\)</span>). Les coefficients des autres variables indépendantes sont ainsi obtenus une fois l’espace pris en compte.</p></li>
<li><p>Évaluer l’effet de la localisation (patron spatial), une fois les autres variables indépendantes contrôlées. Autrement dit, toutes choses étant égales par ailleurs, quel est l’effet de la localisation sur la variable dépendante?</p></li>
</ol></section><section id="sec-0722" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="sec-0722">
<span class="header-section-number">7.2.2</span> Construction d’un modèle GAM dans R</h3>
<section id="sec-07221" class="level4" data-number="7.2.2.1"><h4 data-number="7.2.2.1" class="anchored" data-anchor-id="sec-07221">
<span class="header-section-number">7.2.2.1</span> Réalisation du modèle GAM</h4>
<p>Pour construire des modèles GAM dans R, nous utilisons la fonction <code>gam</code> du <em>package</em> <code>mgcv</code> <span class="citation" data-cites="wood2011fast">(<a href="references.html#ref-wood2011fast" role="doc-biblioref">Wood 2011</a>)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co">## Ajout des coordonnées X et Y dans LyonIris </span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">## Construction du modèle GAM</span></span>
<span><span class="va">Modele.GAM1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span>  <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span><span class="op">+</span></span>
<span>                          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span>,    <span class="co"># spline sur les coordonnées X, Y</span></span>
<span>                    data <span class="op">=</span> <span class="va">LyonIris</span><span class="op">)</span>  <span class="co"># dataframe</span></span>
<span><span class="co">## Résultats du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.GAM1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + NivVieMed + s(X, 
    Y)

Parametric coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 30.402313   2.156322  14.099   &lt;2e-16 ***
Pct0_14     -0.053641   0.046224  -1.160    0.246    
Pct_65      -0.056310   0.038476  -1.463    0.144    
Pct_Img      0.008033   0.035397   0.227    0.821    
Pct_brevet   0.043874   0.027518   1.594    0.112    
NivVieMed   -0.043282   0.072461  -0.597    0.551    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
        edf Ref.df     F p-value    
s(X,Y) 26.5  28.62 27.22  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.715   Deviance explained = 73.3%
GCV = 18.814  Scale est. = 17.605    n = 506</code></pre>
</div>
</div>
<p>Les résultats ci-dessus signalent que la localisation a un effet très significatif puisque (s(X,Y) = 26,5 avec <em>p</em>&nbsp;&lt;&nbsp;0,001). Notez que la valeur de <em>p</em> permet de déterminer si la <em>spline</em> bivariée (et donc l’espace) a ou non un effet significatif. Si la valeur de <em>p</em> est supérieure à 0,05, alors il n’est pas nécessaire de conserver la <em>spline</em> bivariée sur les coordonnées géographiques.</p>
<p>De plus, le code ci-dessous permet de constater que le modèle GAM est plus performant que le modèle linéaire multiple classique (MCO).</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">Modele.MCO</span>, <span class="va">Modele.GAM1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + NivVieMed
Model 2: NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + NivVieMed + s(X, 
    Y)
  Res.Df     RSS   Df Sum of Sq      F    Pr(&gt;F)    
1  500.0 22346.0                                    
2  473.5  8336.1 26.5     14010 30.029 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Nous pouvons aussi introduire une <em>spline</em> plus complexe en augmentant le nombre de nœuds à 40.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Modele.GAM2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span>  <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span><span class="op">+</span></span>
<span>                          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, k<span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Modele.GAM2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + NivVieMed + s(X, 
    Y, k = 40)

Parametric coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 30.372093   2.088160  14.545   &lt;2e-16 ***
Pct0_14     -0.055294   0.044285  -1.249   0.2124    
Pct_65      -0.049122   0.036870  -1.332   0.1834    
Pct_Img      0.002226   0.033722   0.066   0.9474    
Pct_brevet   0.052229   0.026315   1.985   0.0478 *  
NivVieMed   -0.050991   0.070081  -0.728   0.4672    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
         edf Ref.df     F p-value    
s(X,Y) 35.68  38.51 24.27  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.747   Deviance explained = 76.7%
GCV = 17.014  Scale est. = 15.613    n = 506</code></pre>
</div>
</div>
<p>La valeur plus faible d’AIC pour le second modèle GAM signale qu’il est plus performant que le premier.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">Modele.MCO</span>, <span class="va">Modele.GAM1</span>, <span class="va">Modele.GAM2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  df      AIC
Modele.MCO   7.00000 3366.626
Modele.GAM1 33.50046 2920.682
Modele.GAM2 42.67520 2868.355</code></pre>
</div>
</div>
</section><section id="sec-07222" class="level4" data-number="7.2.2.2"><h4 data-number="7.2.2.2" class="anchored" data-anchor-id="sec-07222">
<span class="header-section-number">7.2.2.2</span> Visualisation de l’effet de l’espace</h4>
<p>Pour visualiser les prédictions du modèle dans l’espace, toutes choses étant égales par ailleurs, nous utilisons la fonction <code>vis.gam</code> (<a href="#fig-EffetLocalisation1">figure&nbsp;<span>7.6</span></a>). Les contours signalent qu’au centre de Lyon, les valeurs de dioxyde d’azote sont les plus élevées et dépassent même 40&nbsp;<span class="math inline">\(\mu\)</span>g/m<sup>3</sup>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/vis.gam.html">vis.gam</a></span><span class="op">(</span><span class="va">Modele.GAM2</span>, view<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"contour"</span>, color<span class="op">=</span><span class="st">"terrain"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-EffetLocalisation1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-EffetLocalisation1-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.6: Visualisation des prédictions dans l’espace avec la fonction <code>vis.gam</code></figcaption></figure>
</div>
</div>
</div>
<p>Toutefois, il est plus intéressant de la représenter dans un <em>raster</em>, une fois contrôlées les autres variables indépendantes. Pour ce faire, six étapes sont nécessaires&nbsp;:</p>
<ol type="1">
<li>Créer une <em>grid</em>.</li>
<li>Fixer les autres paramètres à leur moyenne respective.</li>
<li>Calculer la prédiction pour la localisation.</li>
<li>Centrer la prédiction.</li>
<li>Construire le <em>raster</em> avec les prédictions.</li>
<li>Découper et cartographier le <em>raster</em>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span>
<span><span class="co">## Étape 1 : création d'une grid pour la prédiction de 100 mètres de résolution spatiale</span></span>
<span><span class="va">Xcoords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span><span class="op">-</span><span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span><span class="op">+</span><span class="fl">100</span><span class="op">)</span>, by<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">Ycoords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">-</span><span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">+</span><span class="fl">100</span><span class="op">)</span>, by<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">PredDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">Xcoords</span>,<span class="va">Ycoords</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html">names</a></span><span class="op">(</span><span class="va">PredDF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="co">## Étape 2 : fixation de tous les autres paramètres à leur moyenne</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">Var</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VegHautPrt"</span>,<span class="st">"Pct0_14"</span>,<span class="st">"Pct_65"</span>,<span class="st">"Pct_Img"</span>,<span class="st">"Pct_brevet"</span>, <span class="st">"NivVieMed"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">PredDF</span><span class="op">[[</span><span class="va">Var</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[[</span><span class="va">Var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Étape 3 : calcul de la prédiction</span></span>
<span><span class="va">PredDF</span><span class="op">$</span><span class="va">PM25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">Modele.GAM2</span>,newdata<span class="op">=</span><span class="va">PredDF</span><span class="op">)</span></span>
<span><span class="co">## Étape 4 : centrage de la prédiction (sans la constante)</span></span>
<span><span class="va">PredDF</span><span class="op">$</span><span class="va">CenterPredPM25</span> <span class="op">&lt;-</span> <span class="va">PredDF</span><span class="op">$</span><span class="va">PM25</span> <span class="op">-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">PredDF</span><span class="op">$</span><span class="va">PM25</span><span class="op">)</span></span>
<span><span class="co">### Étape 5 : construction du raster</span></span>
<span><span class="va">rasterGAM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span><span class="op">(</span><span class="va">PredDF</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"CenterPredPM25"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="va">rasterGAM</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="st">"Spatial"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rasterGAM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">rasterGAM</span><span class="op">)</span></span>
<span><span class="co">### Étape 6 : découpage et cartographie du raster</span></span>
<span><span class="va">LyonIris.SpatVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html">vect</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="va">rasterGAM</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html">mask</a></span><span class="op">(</span><span class="va">rasterGAM</span>, <span class="va">LyonIris.SpatVector</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">rasterGAM</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-EffetLocalisation2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-EffetLocalisation2-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.7: Visualisation de l’effet de la localisation centrée sur zéro</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-EffetLocalisation2">figure&nbsp;<span>7.7</span></a> signale que dans le centre de Lyon, le dioxyde d’azote est plus élevé de 10 à 20&nbsp;<span class="math inline">\(\mu\)</span>g/m<sup>3</sup>, toutes choses étant égales par ailleurs. À l’inverse, dans les zones périphériques, il est faible. Cela signale un net patron spatial décroissant du centre vers la périphérie.</p>
</section><section id="sec-07223" class="level4" data-number="7.2.2.3"><h4 data-number="7.2.2.3" class="anchored" data-anchor-id="sec-07223">
<span class="header-section-number">7.2.2.3</span> Dépendance spatiale du modèle GAM</h4>
<p>Par contre, bien que l’autocorrélation spatiale des résidus du modèle GAM soit plus faible que pour le modèle MCO (<em>I</em> de Moran de 0,337 contre 0,570 avec <em>p</em>&nbsp;&lt;&nbsp;0,001), il reste que le problème de la dépendance spatiale n’est pas corrigé.</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.mc.html">moran.mc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">Modele.GAM2</span><span class="op">)</span>, <span class="va">W.Rook</span>, nsim<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  resid(Modele.GAM2) 
weights: W.Rook  
number of simulations + 1: 1000 

statistic = 0.33664, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
</section></section></section><section id="sec-073" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-073">
<span class="header-section-number">7.3</span> Régression géographiquement pondérée</h2>
<p>La régression géographiquement pondérée (<em>geographically weighted regression</em> - GWR, en anglais) a été proposée par Fotheringham <em>et al.</em> <span class="citation" data-cites="fotheringham2003geographically">(<a href="references.html#ref-fotheringham2003geographically" role="doc-biblioref">2003</a>)</span> pour modéliser une variable continue. Depuis, plusieurs extensions ont été proposées, notamment des GWR mixtes, des GWR logistiques ou Poisson. Dans le cadre de cette section, nous abordons uniquement sa forme classique (variable dépendante continue).</p>
<section id="sec-0731" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="sec-0731">
<span class="header-section-number">7.3.1</span> Principe de base</h3>
<p><strong>Pourquoi recourir à la GWR?</strong></p>
<p>Dans la <a href="#sec-071">section&nbsp;<span>7.1</span></a>, nous avons vu que les modèles autorégressifs visent à contrôler la <strong>dépendance spatiale</strong> d’un modèle de régression classique (MCO), afin d’améliorer l’estimation des coefficients de régression. L’objectif des modèles de régression géographiquement pondérée est différent&nbsp;: ils visent à analyser les variations spatiales de la relation entre la variable dépendante et les variables indépendantes.</p>
<p>Autrement dit, les modèles GWR visent à explorer <strong>l’instabilité spatiale du modèle MCO</strong> afin d’analyser localement la relation entre la variable dépendante et les variables indépendantes. Pour une description détaillée en français de la GWR, consultez Apparicio <em>et al.</em> <span class="citation" data-cites="apparicio2007modelisation">(<a href="references.html#ref-apparicio2007modelisation" role="doc-biblioref">2007</a>)</span>.</p>
<p><strong>Formulation de la GWR</strong></p>
<p>Contrairement à la régression linéaire classique et aux modèles spatiaux autorégressifs qui produisent une équation pour l’ensemble du tableau de données, la GWR produit une équation pour chaque unité spatiale <em>i</em> et ainsi, des valeurs locales de R<sup>2</sup>, <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_k\)</span>, <em>t</em> de Student, etc. La résolution de cette équation de régression locale est aussi basée sur la méthode des moindres carrés et sur une matrice de pondération W(i) dont les valeurs décroissent en fonction de la distance séparant les unités <em>i</em> et <em>j</em>. Autrement dit, plus <em>j</em> est proche de <em>i</em>, plus sa pondération est élevée et donc plus son «&nbsp;rôle&nbsp;» dans la détermination de l’équation de régression locale de <em>i</em> est important.</p>
<p>De la sorte, la GWR est une extension de la régression linéaire multiple classique où <span class="math inline">\((u_i, v_i)\)</span> représente les coordonnées géographiques du centroïde de l’unité spatiale et où les paramètres <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta_k\)</span> peuvent varier dans l’espace (<a href="#eq-GWR">équation&nbsp;<span>7.9</span></a>).</p>
<p><span id="eq-GWR"><span class="math display">\[
y_i = \beta_0(u_i, v_i)+ \sum_{j=1}^k \beta_j(u_i, v_i)x_{ij}+ \epsilon_i
\tag{7.9}\]</span></span></p>
<p>avec&nbsp;:</p>
<ul>
<li>
<span class="math inline">\((u_i, v_i)\)</span>, les coordonnées géographiques de l’unité spatiale <em>i</em>.</li>
<li>
<span class="math inline">\(y_i\)</span>, la variable dépendante pour l’unité spatiale <em>i</em>.</li>
<li>
<span class="math inline">\(\beta_0(u_i, v_i)\)</span>, la constante pour l’unité spatiale <em>i</em> aux coordonnées géographiques <span class="math inline">\((u_i, v_i)\)</span>.</li>
<li>
<span class="math inline">\(\beta_j(u_i, v_i)\)</span>, le coefficient de régression pour la variable <span class="math inline">\(x_j\)</span> (avec <em>k</em> variables indépendantes) pour l’unité spatiale <em>i</em> aux coordonnées géographiques <span class="math inline">\((u_i, v_i)\)</span>.</li>
<li>
<span class="math inline">\(x_{ij}\)</span>, la valeur de la variable indépendante <span class="math inline">\(x_j\)</span> pour l’unité spatiale <em>i</em>.</li>
<li>
<span class="math inline">\(\epsilon_i\)</span>, le terme d’erreur pour l’unité spatiale <em>i</em>.</li>
</ul>
<p>Fotheringham <em>et al.</em> <span class="citation" data-cites="fotheringham2003geographically">(<a href="references.html#ref-fotheringham2003geographically" role="doc-biblioref">2003</a>)</span> proposent deux fonctions <em>kernel</em> pour définir la pondération W(i) dans le modèle GWR&nbsp;: une fonction gaussienne (<a href="#eq-kernelgaussien">équation&nbsp;<span>7.10</span></a>) et une fonction bicarrée (<a href="#eq-kernelbicarree">équation&nbsp;<span>7.11</span></a>) où <span class="math inline">\(d_{ij}\)</span> représente la distance euclidienne entre les points <em>i</em> et <em>j</em> et <em>b</em>, le rayon de zone d’influence autour du point <em>i</em> (<em>bandwidth</em>). Il existe une différence fondamentale entre les deux&nbsp;: la fonction gaussienne accorde un poids non nul à tous les points de l’espace d’étude aussi loin soient-ils, tandis que la fonction bicarrée ne tient pas compte des points distants à plus de <em>b</em> mètres de <em>i</em>, tel qu’illustré à la <a href="#fig-GWRKernels">figure&nbsp;<span>7.8</span></a> avec une valeur fixée à 5000&nbsp;mètres en guise d’exemple.</p>
<p><span id="eq-kernelgaussien"><span class="math display">\[
w_{ij} = exp[-.5(d_{ij}/b)^2]
\tag{7.10}\]</span></span></p>
<p><span id="eq-kernelbicarree"><span class="math display">\[
w_{ij} = [1-(d_{ij}/b)^2]^2 \text{ si } d_{ij}&lt; b \text{, sinon } w_{ij}=0
\tag{7.11}\]</span></span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-GWRKernels" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GWRKernels-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.8: Fonctions kernel pour définir la matrice de pondération W(i)</figcaption></figure>
</div>
</div>
</div>
<p>Dans le modèle GWR, la valeur de <em>b</em> est soit fixée par la personne utilisatrice, soit optimisée avec la valeur de CV (<em>cross-validation</em>) ou celle de l’AIC. Notez qu’il est possible d’optimiser la taille de la zone d’influence à partir de la distance euclidienne ou du nombre de plus proches voisins.</p>
</section><section id="sec-0732" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-0732">
<span class="header-section-number">7.3.2</span> Construction et analyse du modèle GWR dans R</h3>
<p>Pour construire un modèle GWR dans R, nous utilisons le <em>package</em> <code>spgwr</code> <span class="citation" data-cites="packagesGWR">(<a href="references.html#ref-packagesGWR" role="doc-biblioref">Bivand et Yu 2023</a>)</span>. La construction d’un modèle GWR comprend les étapes suivantes&nbsp;:</p>
<ol type="1">
<li><p>Sélection de la taille de la zone d’influence (<em>bandwidth</em>) optimale.</p></li>
<li><p>Réalisation de la GWR avec la taille de la zone d’influence optimale.</p></li>
<li><p>Comparaison des modèles MCO et GWR.</p></li>
<li><p>Cartographie des résultats du modèle GWR (R<sup>2</sup>, coefficients, valeurs de <em>t</em>, etc.).</p></li>
</ol>
<section id="sec-07321" class="level4" data-number="7.3.2.1"><h4 data-number="7.3.2.1" class="anchored" data-anchor-id="sec-07321">
<span class="header-section-number">7.3.2.1</span> Définition de la taille de la zone d’influence</h4>
<p>La sélection de la taille de la zone d’influence optimale est réalisée avec la fonction <code>gwr.sel</code> pour laquelle&nbsp;:</p>
<ul>
<li><p>le paramètre <code>gweight</code> permet de spécifier une fonction <em>kernel</em> gaussienne (<code>gwr.gauss</code>) ou bicarrée (<code>gwr.gauss</code>).</p></li>
<li><p>le paramètre <code>adapt</code> permet de spécifier si vous optimisez le nombre de plus proches voisins (<code>adapt=TRUE</code>) ou la distance (<code>adapt=FALSE</code>).</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rsbivand/spgwr/">spgwr</a></span><span class="op">)</span></span>
<span><span class="co">## Optimisation du nombre de voisins avec le CV</span></span>
<span><span class="va">bwaCV.voisins</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span>  <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                          data <span class="op">=</span> <span class="va">LyonIris</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"cv"</span>,          <span class="co"># Méthode cv ou AIC</span></span>
<span>                          gweight<span class="op">=</span><span class="va">gwr.bisquare</span>,   <span class="co"># gwr.gauss ou gwr.bisquare</span></span>
<span>                          adapt<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          RMSE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          longlat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span>,<span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Optimisation du nombre de voisins avec l'AIC</span></span>
<span><span class="va">bwaAIC.voisins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span>  <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                          data <span class="op">=</span> <span class="va">LyonIris</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"AIC"</span>,          <span class="co"># Méthode cv ou AIC</span></span>
<span>                          gweight<span class="op">=</span><span class="va">gwr.bisquare</span>,    <span class="co"># gwr.gauss ou gwr.bisquare</span></span>
<span>                          adapt<span class="op">=</span><span class="cn">TRUE</span>,              <span class="co"># adaptatif</span></span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          RMSE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          longlat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span>,<span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Optimisation de la distance avec le CV</span></span>
<span><span class="va">bwnaCV.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span>  <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">LyonIris</span>,</span>
<span>                           method <span class="op">=</span> <span class="st">"cv"</span>,     <span class="co"># méthode cv ou AIC</span></span>
<span>                           gweight<span class="op">=</span><span class="va">gwr.Gauss</span>, <span class="co"># gwr.gauss ou gwr.bisquare</span></span>
<span>                           adapt<span class="op">=</span><span class="cn">FALSE</span>,       <span class="co"># non adaptatif</span></span>
<span>                           verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           RMSE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           longlat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span>,<span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Optimisation de la distance avec l'AIC</span></span>
<span><span class="va">bwnaAIC.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span>  <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>                          data <span class="op">=</span> <span class="va">LyonIris</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"AIC"</span>,      <span class="co"># méthode cv ou AIC</span></span>
<span>                          gweight<span class="op">=</span><span class="va">gwr.Gauss</span>,   <span class="co"># gwr.gauss ou gwr.bisquare</span></span>
<span>                          adapt<span class="op">=</span><span class="cn">FALSE</span>,         <span class="co"># non adaptatif</span></span>
<span>                          RMSE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          longlat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span>,<span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Affichage des résultats d'optimisation </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Sélection de la taille de la zone optimale (bandwidth)"</span>,</span>
<span>    <span class="st">"\n avec le nombre de plus proches voisins :"</span>,</span>
<span>    <span class="st">"\n  CV ="</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html">round</a></span><span class="op">(</span><span class="va">bwaCV.voisins</span>,<span class="fl">4</span><span class="op">)</span>, <span class="st">"nombre de voisins ="</span>, </span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html">round</a></span><span class="op">(</span><span class="va">bwaCV.voisins</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"\n  AIC ="</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html">round</a></span><span class="op">(</span><span class="va">bwaAIC.voisins</span>,<span class="fl">4</span><span class="op">)</span>, <span class="st">"nombre de voisins ="</span>, </span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html">round</a></span><span class="op">(</span><span class="va">bwaAIC.voisins</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"\nSélection de la taille de la zone optimale (bandwidth) avec la distance :"</span>,</span>
<span>    <span class="st">"\n  CV ="</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html">round</a></span><span class="op">(</span><span class="va">bwnaCV.dist</span>, <span class="fl">0</span><span class="op">)</span>,  <span class="st">"mètres"</span>,</span>
<span>    <span class="st">"\n  AIC ="</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html">round</a></span><span class="op">(</span><span class="va">bwnaAIC.dist</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"mètres"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sélection de la taille de la zone optimale (bandwidth) 
 avec le nombre de plus proches voisins : 
  CV = 0.1818 nombre de voisins = 92 
  AIC = 0.1067 nombre de voisins = 54 
Sélection de la taille de la zone optimale (bandwidth) avec la distance : 
  CV = 1315 mètres 
  AIC = 1662 mètres</code></pre>
</div>
</div>
<p>Les résultats ci-dessus montrent que le nombre de plus proches voisins pourrait être de 92 selon l’approche <em>cross-validation</em> et de 54 selon la méthode basée sur l’AIC. Si la valeur de <em>b</em> est basée sur la distance, elle serait alors optimale à 1315 et 1662&nbsp;mètres selon les deux méthodes.</p>
</section><section id="sec-07322" class="level4" data-number="7.3.2.2"><h4 data-number="7.3.2.2" class="anchored" data-anchor-id="sec-07322">
<span class="header-section-number">7.3.2.2</span> Réalisation de la GWR</h4>
<p>Avec la fonction <code>gwr</code>, nous estimons un modèle GWR avec un <em>kernel</em> bicarré et un nombre optimisé de plus voisins selon la méthode CV, soit 92.</p>
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Modele.GWR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/gwr.html">gwr</a></span><span class="op">(</span><span class="va">NO2</span> <span class="op">~</span> <span class="va">Pct0_14</span><span class="op">+</span><span class="va">Pct_65</span><span class="op">+</span><span class="va">Pct_Img</span><span class="op">+</span><span class="va">Pct_brevet</span><span class="op">+</span><span class="va">NivVieMed</span>,</span>
<span>              data <span class="op">=</span> <span class="va">LyonIris</span>,</span>
<span>              adapt<span class="op">=</span><span class="va">bwaCV.voisins</span>,</span>
<span>              gweight<span class="op">=</span><span class="va">gwr.bisquare</span>,</span>
<span>              hatmatrix<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>              se.fit<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>              coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">$</span><span class="va">X</span>,<span class="va">LyonIris</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>              longlat<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le code ci-dessous permet de renvoyer les statistiques univariées des coefficients des 506 régressions locales, réalisées pour chacune des 506&nbsp;entités spatiales (IRIS), et les statistiques d’ajustement du modèle (AIC, R<sup>2</sup> global, etc.)</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Modele.GWR</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
gwr(formula = NO2 ~ Pct0_14 + Pct_65 + Pct_Img + Pct_brevet + 
    NivVieMed, data = LyonIris, coords = cbind(LyonIris$X, LyonIris$Y), 
    gweight = gwr.bisquare, adapt = bwaCV.voisins, hatmatrix = TRUE, 
    longlat = F, se.fit = TRUE)
Kernel function: gwr.bisquare 
Adaptive quantile: 0.1818192 (about 92 of 506 data points)
Summary of GWR coefficient estimates at data points:
                  Min.   1st Qu.    Median   3rd Qu.      Max.  Global
X.Intercept. 12.429518 30.249511 38.619342 48.038863 60.098584 49.4330
Pct0_14      -1.094802 -0.360556 -0.215643 -0.047687  0.382801 -0.5335
Pct_65       -0.715331 -0.158253 -0.031353  0.076086  0.464992 -0.1505
Pct_Img      -0.331892 -0.049146  0.077177  0.240755  0.670433  0.2829
Pct_brevet   -0.655221 -0.221655 -0.084954  0.047835  0.598456 -0.2400
NivVieMed    -1.140895 -0.560649 -0.214717  0.193768  1.311228 -0.3162
Number of data points: 506 
Effective number of parameters (residual: 2traceS - traceS'S): 107.1278 
Effective degrees of freedom (residual: 2traceS - traceS'S): 398.8722 
Sigma (residual: 2traceS - traceS'S): 4.118116 
Effective number of parameters (model: traceS): 81.53263 
Effective degrees of freedom (model: traceS): 424.4674 
Sigma (model: traceS): 3.992025 
Sigma (ML): 3.656286 
AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 2945.674 
AIC (GWR p. 96, eq. 4.22): 2829.504 
Residual sum of squares: 6764.424 
Quasi-global R2: 0.783008 </code></pre>
</div>
</div>
</section><section id="sec-07323" class="level4" data-number="7.3.2.3"><h4 data-number="7.3.2.3" class="anchored" data-anchor-id="sec-07323">
<span class="header-section-number">7.3.2.3</span> Comparaison des modèles MCO et GWR</h4>
<p>Le R<sup>2</sup> global du modèle GWR est bien supérieur au modèle classique MCO (0,783 contre 0,283). Fotheringham <em>et al.</em> <span class="citation" data-cites="fotheringham2003geographically">(<a href="references.html#ref-fotheringham2003geographically" role="doc-biblioref">2003</a>)</span> proposent plusieurs tests pour comparer les modèles GWR et classique qui sont implémentés dans le <em>package</em> <code>spgwr</code> (fonctions <code>anova(Modele.GWR)</code>, <code>anova(Modele.GWR, approx=TRUE)</code>, <code>LMZ.F1GWR.test(Modele.GWR)</code>, <code>LMZ.F2GWR.test(Modele.GWR)</code>.</p>
<p>Si les valeurs de <em>p</em> de ces tests sont inférieures à 0,05, alors le modèle GWR améliore de façon significative la capacité prédictive du modèle de régression globale, ce que confirment les résultats ci-dessous.</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">Modele.GWR</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table 
                    Df  Sum Sq Mean Sq F value
OLS Residuals     6.00 22346.0                
GWR Improvement 101.13 15581.6 154.078        
GWR Residuals   398.87  6764.4  16.959  9.0854</code></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">Modele.GWR</span>, approx<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table 
approximate degrees of freedom (only tr(S))
                     Df  Sum Sq Mean Sq F value
OLS Residuals     6.000 22346.0                
GWR Improvement  75.533 15581.6 206.290        
GWR Residuals   424.467  6764.4  15.936  12.945</code></pre>
</div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/LMZ.F3GWR.test.html">LMZ.F1GWR.test</a></span><span class="op">(</span><span class="va">Modele.GWR</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Leung et al. (2000) F(1) test

data:  Modele.GWR
F = 0.37946, df1 = 430.81, df2 = 500.00, p-value &lt; 2.2e-16
alternative hypothesis: less
sample estimates:
SS OLS residuals SS GWR residuals 
       22346.021         6764.424 </code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/LMZ.F3GWR.test.html">LMZ.F2GWR.test</a></span><span class="op">(</span><span class="va">Modele.GWR</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Leung et al. (2000) F(2) test

data:  Modele.GWR
F = 3.4476, df1 = 142.92, df2 = 500.00, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
  SS OLS residuals SS GWR improvement 
          22346.02           15581.60 </code></pre>
</div>
</div>
<p>Un autre test (<code>LMZ.F3GWR.test</code>) permet de répondre à la question suivante&nbsp;: est-ce que les coefficients de régression du modèle GWR varient spatialement de façon significative? Les résultats ci-dessous démontrent que c’est le cas pour toutes les variables indépendantes et la constante (<em>p</em>&nbsp;&lt;&nbsp;0,001).</p>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rsbivand.github.io/spgwr/reference/LMZ.F3GWR.test.html">LMZ.F3GWR.test</a></span><span class="op">(</span><span class="va">Modele.GWR</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Leung et al. (2000) F(3) test

            F statistic Numerator d.f. Denominator d.f.     Pr(&gt;)    
(Intercept)      2.2771       134.3880           430.81 1.629e-10 ***
Pct0_14          2.7767       141.7244           430.81 5.636e-16 ***
Pct_65           2.0918       169.0472           430.81 8.399e-10 ***
Pct_Img          1.9486       106.4400           430.81 1.550e-06 ***
Pct_brevet       2.4445       121.2830           430.81 1.629e-11 ***
NivVieMed        3.6926       138.8118           430.81 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section><section id="sec-07324" class="level4" data-number="7.3.2.4"><h4 data-number="7.3.2.4" class="anchored" data-anchor-id="sec-07324">
<span class="header-section-number">7.3.2.4</span> Cartographie des résultats du modèle GWR</h4>
<p>Dans un premier temps, nous ajoutons les valeurs locales des R<sup>2</sup>, des coefficients de régression et des valeurs de <em>t</em> dans la couche <code>sf</code>. Notez que les résultats locaux de la GWR sont stockés dans l’objet <code>Modele.GWR$SDF</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Récupération du R carré local</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">GWR.R2</span> <span class="op">&lt;-</span> <span class="va">Modele.GWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">localR2</span></span>
<span><span class="co">## Récupération des coefficients de régression et calcul des valeurs de t locales</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html">names</a></span><span class="op">(</span><span class="va">Modele.GWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "sum.w"              "(Intercept)"        "Pct0_14"           
 [4] "Pct_65"             "Pct_Img"            "Pct_brevet"        
 [7] "NivVieMed"          "(Intercept)_se"     "Pct0_14_se"        
[10] "Pct_65_se"          "Pct_Img_se"         "Pct_brevet_se"     
[13] "NivVieMed_se"       "gwr.e"              "pred"              
[16] "pred.se"            "localR2"            "(Intercept)_se_EDF"
[19] "Pct0_14_se_EDF"     "Pct_65_se_EDF"      "Pct_Img_se_EDF"    
[22] "Pct_brevet_se_EDF"  "NivVieMed_se_EDF"   "pred.se"           </code></pre>
</div>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">VarsIndep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pct0_14"</span>, <span class="st">"Pct_65"</span>, <span class="st">"Pct_Img"</span>, <span class="st">"Pct_brevet"</span>, <span class="st">"NivVieMed"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">VarsIndep</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Nom des nouvelles variables</span></span>
<span>  <span class="va">var.coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"GWR."</span>, <span class="st">"B_"</span>, <span class="va">e</span><span class="op">)</span></span>
<span>  <span class="va">var.t</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"GWR."</span>, <span class="st">"T_"</span>, <span class="va">e</span><span class="op">)</span></span>
<span>  <span class="co"># Récupération des coefficients pour les variables indépendantes</span></span>
<span>  <span class="va">LyonIris</span><span class="op">[[</span><span class="va">var.coef</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Modele.GWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">[[</span><span class="va">e</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># Calcul des valeurs de t pour les variables indépendantes</span></span>
<span>  <span class="va">LyonIris</span><span class="op">[[</span><span class="va">var.t</span><span class="op">]</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="va">Modele.GWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">[[</span><span class="va">e</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">Modele.GWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">e</span>, <span class="st">"_se"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Cartographie des R<sup>2</sup> locaux</strong></p>
<p>Le code ci-dessous permet ensuite de cartographier les R<sup>2</sup> locaux de la GWR (<a href="#fig-GWRR2">figure&nbsp;<span>7.9</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.R2"</span>, </span>
<span>          palette<span class="op">=</span><span class="st">"YlOrBr"</span>, </span>
<span>          n<span class="op">=</span><span class="fl">5</span>, style<span class="op">=</span><span class="st">"quantile"</span>,</span>
<span>          legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"R2 locaux"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GWRR2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GWRR2-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.9: Cartographie des R carrés locaux de la GWR</figcaption></figure>
</div>
</div>
</div>
<p><strong>Cartographie des coefficients de régression</strong></p>
<p>Le code ci-dessous permet ensuite de cartographier les coefficients locaux de la GWR (<a href="#fig-GWRCoeffReg">figure&nbsp;<span>7.10</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.B_Pct0_14"</span>, palette<span class="op">=</span><span class="st">"YlOrBr"</span>, n<span class="op">=</span><span class="fl">4</span>, style<span class="op">=</span><span class="st">"pretty"</span>,</span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Moins de 15 ans (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.B_Pct_65"</span>, palette<span class="op">=</span><span class="st">"YlOrBr"</span>, n<span class="op">=</span><span class="fl">4</span>, style<span class="op">=</span><span class="st">"pretty"</span>, </span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"65 ans et plus (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Carte3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.B_Pct_Img"</span>, palette<span class="op">=</span><span class="st">"YlOrBr"</span>, n<span class="op">=</span><span class="fl">4</span>, style<span class="op">=</span><span class="st">"pretty"</span>, </span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Immigrants (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Carte4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.B_Pct_brevet"</span>, palette<span class="op">=</span><span class="st">"YlOrBr"</span>, n<span class="op">=</span><span class="fl">4</span>, style<span class="op">=</span><span class="st">"pretty"</span>, </span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Faible scolarité (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Carte5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.B_NivVieMed"</span>, palette<span class="op">=</span><span class="st">"YlOrBr"</span>, n<span class="op">=</span><span class="fl">4</span>, style<span class="op">=</span><span class="st">"pretty"</span>, </span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Niveau de vie (€1000)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, <span class="va">Carte3</span>, <span class="va">Carte4</span>, <span class="va">Carte5</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GWRCoeffReg" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GWRCoeffReg-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.10: Cartographie des coefficients de régression de la GWR</figcaption></figure>
</div>
</div>
</div>
<p><strong>Cartographie des valeurs de <em>t</em></strong></p>
<p>Pour cartographier les valeurs de <em>t</em>, nous utilisons les seuils de ± 1,96, 2,58 et 3,29, indiquant des seuils de signification à 5&nbsp;%, 1&nbsp;% et 0,1&nbsp;% (<a href="#fig-GWRValT">figure&nbsp;<span>7.11</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">classes.intervalles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">3.29</span>, <span class="op">-</span><span class="fl">2.58</span>, <span class="op">-</span><span class="fl">1.96</span>, <span class="fl">1.96</span>, <span class="fl">2.58</span>, <span class="fl">3.29</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.T_Pct0_14"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, </span>
<span>                  breaks <span class="op">=</span> <span class="va">classes.intervalles</span>,</span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Moins de 15 ans (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.T_Pct_65"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>,</span>
<span>                  breaks <span class="op">=</span> <span class="va">classes.intervalles</span>,</span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"65 ans et plus (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.T_Pct_Img"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, </span>
<span>                  breaks <span class="op">=</span> <span class="va">classes.intervalles</span>,</span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Immigrants (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.B_Pct_brevet"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, </span>
<span>                  breaks <span class="op">=</span> <span class="va">classes.intervalles</span>,</span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                  title <span class="op">=</span> <span class="st">"Faible scolarité (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Carte5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"GWR.T_NivVieMed"</span>, palette<span class="op">=</span><span class="st">"-RdBu"</span>, </span>
<span>                 breaks <span class="op">=</span> <span class="va">classes.intervalles</span>,</span>
<span>                  legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text.separator <span class="op">=</span> <span class="st">"à"</span><span class="op">)</span>,</span>
<span>                 title <span class="op">=</span> <span class="st">"Niveau de vie (€1000)"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span>, legend.outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, <span class="va">Carte3</span>, <span class="va">Carte4</span>, <span class="va">Carte5</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GWRValT" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GWRValT-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.11: Cartographie des valeurs de <em>t</em> de la GWR</figcaption></figure>
</div>
</div>
</div>
<p><strong>Cartographie du nombre de variables significatives</strong></p>
<p>Nous pouvons aussi cartographier le nombre de variables localement significatives aux seuils de 5&nbsp;% et 1&nbsp;%.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Identifier la variable plus significative avec les valeurs de t</span></span>
<span><span class="va">VarsT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"GWR.T_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pct0_14"</span>, <span class="st">"Pct_65"</span>, <span class="st">"Pct_Img"</span>, <span class="st">"Pct_brevet"</span>, <span class="st">"NivVieMed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Lyon.df</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span></span>
<span><span class="va">Lyon.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Lyon.df</span><span class="op">[</span>,<span class="va">VarsT</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">PlusSign</span> <span class="op">&lt;-</span> <span class="va">VarsT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Lyon.df</span><span class="op">[</span><span class="va">VarsT</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">which.max</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">PlusSign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">PlusSign</span>, <span class="fl">7</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">PlusSign</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">MaxAbsTvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Lyon.df</span><span class="op">[</span><span class="va">VarsT</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span></span>
<span><span class="va">PlusSign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">MaxAbsTvalue</span><span class="op">&lt;</span><span class="fl">1.96</span>, <span class="st">"Aucune"</span>, <span class="va">PlusSign</span><span class="op">)</span></span>
<span><span class="co">## Nombre de variables significatives au seuil de 5%, soit abs(t)= 1,96)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NbSignif_1.96</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html">rowSums</a></span><span class="op">(</span><span class="va">Lyon.df</span> <span class="op">&gt;</span> <span class="fl">1.96</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">NbSignif_2.58</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html">rowSums</a></span><span class="op">(</span><span class="va">Lyon.df</span> <span class="op">&gt;</span> <span class="fl">2.58</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">LyonIris</span><span class="op">$</span><span class="va">PlusSign</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">PlusSign</span><span class="op">)</span></span>
<span><span class="co">## Cartographie</span></span>
<span><span class="va">Carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"NbSignif_1.96"</span>, palette<span class="op">=</span><span class="st">"Reds"</span>,</span>
<span>                 title <span class="op">=</span> <span class="st">"Sign. au seuil de 5%"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"NbSignif_2.58"</span>, palette<span class="op">=</span><span class="st">"Reds"</span>, </span>
<span>                 title <span class="op">=</span> <span class="st">"Sign. au seuil de 1%"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">Carte1</span>, <span class="va">Carte2</span>, ncol<span class="op">=</span><span class="fl">2</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GWRNNsign" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GWRNNsign-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.12: Nombre de variables significatives aux seuils de 5% et 1%</figcaption></figure>
</div>
</div>
</div>
<p><strong>Cartographie de la variable la plus significative avec la valeur de <em>t</em></strong></p>
<p>Finalement, le code ci-dessous permet de repérer la variable la plus significative au seuil de 5&nbsp;%, c’est-à-dire avec la plus forte valeur absolue pour la valeur de <em>t</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_borders</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"gray25"</span>, lwd<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"PlusSign"</span>, palette<span class="op">=</span><span class="st">"Set1"</span>, </span>
<span>                 title <span class="op">=</span> <span class="st">"Variable la plus significative"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>frame<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GWRPlussign" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="07-RegressionSpatiales_files/figure-html/fig-GWRPlussign-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;7.13: Variable indépendante la plus significative au seuil de 5&nbsp;%</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Extensions de la GWR classique</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>À titre de rappel, la GWR classique permet de modéliser une variable dépendante continue. Plusieurs extensions ont été proposées, notamment&nbsp;:</p>
<ul>
<li><p>La GWR mixte qui permet de spécifier des variables indépendantes variant spatialement et d’autres étant fixes <span class="citation" data-cites="fotheringham2003geographically">(<a href="references.html#ref-fotheringham2003geographically" role="doc-biblioref">Fotheringham, Brunsdon et Charlton 2003</a>)</span>.</p></li>
<li><p>Les GWR logistique (pour une variable dépendante binaire) et Poisson (pour une variable dépendante de comptage) <span class="citation" data-cites="fotheringham2003geographically">(<a href="references.html#ref-fotheringham2003geographically" role="doc-biblioref">Fotheringham, Brunsdon et Charlton 2003</a>)</span>.</p></li>
<li><p>La régression géographiquement et temporellement pondérée (<em>Geographical and temporal weighted regression</em>&nbsp;–&nbsp;GTWR) <span class="citation" data-cites="fotheringham2015geographical">(<a href="references.html#ref-fotheringham2015geographical" role="doc-biblioref">Fotheringham, Crespo et Yao 2015</a>)</span>.</p></li>
<li><p>La régression géographiquement pondérée multiéchelle (<em>Multiscale geographically weighted regression</em>&nbsp;–&nbsp;MGWR) <span class="citation" data-cites="fotheringham2017multiscale">(<a href="references.html#ref-fotheringham2017multiscale" role="doc-biblioref">Fotheringham, Yang et Kang 2017</a>)</span>.</p></li>
<li><p>L’analyse en composantes principales géographiquement pondérée (<em>Geographically weighted principal components analysis</em>&nbsp;–&nbsp;GWR&nbsp;PCA) <span class="citation" data-cites="harris2011geographically">(<a href="references.html#ref-harris2011geographically" role="doc-biblioref">Harris, Brunsdon et Charlton 2011</a>)</span>.</p></li>
</ul>
</div>
</div>
</section></section></section><section id="sec-074" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="sec-074">
<span class="header-section-number">7.4</span> Quiz de révision du chapitre</h2>
<div id="Chap07" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chap07;
  window.onload = function() {
    quizz_Chap07 = new Quiz('Chap07', ['2','2','1','3',['1', '2'],['2', '3'],'2','1','1']);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
Qu’est-ce que la dépendance spatiale d’un modèle de régression?
</div>
<div>
Relisez au besoin la <a href="#sec-0711">section&nbsp;<span>7.1.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Lorsque les variables indépendantes sont fortement corrélées entre elles.</label>
</td>
<td>
<input type="radio" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>Lorsque les résidus du modèle sont fortement autocorrélés spatialement.</label>
</td>
<td>
<input type="radio" name="q1" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle SLX, l’autocorrélation est introduite au niveau de :
</div>
<div>
Relisez au besoin la <a href="#sec-07121">section&nbsp;<span>7.1.2.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Variable dépendante</label>
</td>
<td>
<input type="radio" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>Variables indépendantes</label>
</td>
<td>
<input type="radio" name="q2" value="2">
</td>
</tr>
<tr>
<td>
<label>Terme d’erreur</label>
</td>
<td>
<input type="radio" name="q2" value="3">
</td>
</tr>
<tr>
<td>
<label>Variable dépendante et variables indépendantes</label>
</td>
<td>
<input type="radio" name="q2" value="4">
</td>
</tr>
<tr>
<td>
<label>Variable dépendante et terme d’erreur</label>
</td>
<td>
<input type="radio" name="q2" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle SAR, l’autocorrélation est introduite au niveau de :
</div>
<div>
Relisez au besoin la <a href="#sec-07122">section&nbsp;<span>7.1.2.2</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Variable dépendante</label>
</td>
<td>
<input type="radio" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>Variables indépendantes</label>
</td>
<td>
<input type="radio" name="q3" value="2">
</td>
</tr>
<tr>
<td>
<label>Terme d’erreur</label>
</td>
<td>
<input type="radio" name="q3" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle SEM, l’autocorrélation est introduite au niveau de :
</div>
<div>
Relisez au besoin la <a href="#sec-07123">section&nbsp;<span>7.1.2.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Variable dépendante</label>
</td>
<td>
<input type="radio" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>Variables indépendantes</label>
</td>
<td>
<input type="radio" name="q4" value="2">
</td>
</tr>
<tr>
<td>
<label>Terme d’erreur</label>
</td>
<td>
<input type="radio" name="q4" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle mixte SDM, l’autocorrélation est introduite au niveau de :
</div>
<div>
Relisez au besoin la <a href="#sec-07124">section&nbsp;<span>7.1.2.4</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Variable dépendante</label>
</td>
<td>
<input type="checkbox" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>Variables indépendantes</label>
</td>
<td>
<input type="checkbox" name="q5" value="2">
</td>
</tr>
<tr>
<td>
<label>Terme d’erreur</label>
</td>
<td>
<input type="checkbox" name="q5" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle SDEM, l’autocorrélation est introduite au niveau de :
</div>
<div>
Relisez au besoin la <a href="#sec-07125">section&nbsp;<span>7.1.2.5</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Variable dépendante</label>
</td>
<td>
<input type="checkbox" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>Variables indépendantes</label>
</td>
<td>
<input type="checkbox" name="q6" value="2">
</td>
</tr>
<tr>
<td>
<label>Terme d’erreur</label>
</td>
<td>
<input type="checkbox" name="q6" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment est intégré l’espace dans un modèle généralisé additif?
</div>
<div>
Relisez au besoin la <a href="#sec-0721">section&nbsp;<span>7.2.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Avec une variable spatialement décalée</label>
</td>
<td>
<input type="radio" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>Avec une spline bivariée sur les coordonnées x et y</label>
</td>
<td>
<input type="radio" name="q7" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un modèle de régression géographiquement pondérée permet d’explorer
</div>
<div>
Relisez le deuxième encadré à la <a href="#sec-0731">section&nbsp;<span>7.3.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>L’instabilité spatiale du modèle</label>
</td>
<td>
<input type="radio" name="q8" value="1">
</td>
</tr>
<tr>
<td>
<label>La dépendance du modèle</label>
</td>
<td>
<input type="radio" name="q8" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un modèle de régression géographiquement pondérée produit autant de régressions que d’entités spatiales dans le jeu de données à l’étude.
</div>
<div>
Relisez le deuxième encadré à la <a href="#sec-0731">section&nbsp;<span>7.3.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q9" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q9" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chap07);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>
</section><section id="sec-075" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="sec-075">
<span class="header-section-number">7.5</span> Exercices de révision</h2>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 1.</strong> Réalisation de modèles de régression autorégressifs spatiaux</p>
</div>
<div class="bloc_exercice-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrice de contiguïté selon le partage d'un segment (Rook)</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/chap07/DonneesLyon.Rdata"</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>Rook <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(LyonIris, <span class="at">queen=</span><span class="cn">FALSE</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>Rook <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(LyonIris, <span class="at">queen=</span><span class="cn">FALSE</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>W.Rook <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(Rook, <span class="at">zero.policy=</span><span class="cn">TRUE</span>, <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Modèles</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="st">"PM25 ~  Pct0_14+Pct_65+Pct_Img+Pct_brevet+NivVieMed"</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>Modele.SLX <span class="ot">&lt;-</span> à compléter</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>Modele.SAR <span class="ot">&lt;-</span> à compléter</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>Modele.SEM <span class="ot">&lt;-</span> à compléter</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>Modele.DurbinSpatial <span class="ot">&lt;-</span> à compléter</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>Modele.DurbinErreur <span class="ot">&lt;-</span> à compléter</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="12-Exercices.html#sec-12071">section&nbsp;<span>12.7.1</span></a>.</p>
</div>
</div>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 2.</strong> Réalisation d’un modèle GAM</p>
</div>
<div class="bloc_exercice-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/chap07/DonneesLyon.Rdata"</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajout des coordonnées x et y</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> à compléter</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>X <span class="ot">&lt;-</span> à compléter</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>Y <span class="ot">&lt;-</span> à compléter</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction du modèle</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="st">"PM25 ~  Pct0_14+Pct_65+Pct_Img+Pct_brevet+NivVieMed"</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>Modele.GAM2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(NO2 <span class="sc">~</span>  à compléter</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>                          à compléter,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> LyonIris)</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Modele.GAM2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="12-Exercices.html#sec-12072">section&nbsp;<span>12.7.2</span></a>.</p>
</div>
</div>
<div class="bloc_exercice">
<div class="bloc_exercice-header">
<div class="bloc_exercice-icon">

</div>
<p><strong>Exercice 2.</strong> Réalisation d’un modèle GWR</p>
</div>
<div class="bloc_exercice-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spgwr)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/chap07/DonneesLyon.Rdata"</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajout des coordonnées x et y</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> à compléter</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>X <span class="ot">&lt;-</span> à compléter</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>LyonIris<span class="sc">$</span>Y <span class="ot">&lt;-</span> à compléter</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimisation du nombre de voisins avec le CV</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="st">"PM25 ~ Pct0_14+Pct_65+Pct_Img+Pct_brevet+NivVieMed"</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>bwaCV.voisins  <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(à compléter)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimisation du nombre de voisins avec l'AIC</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>bwaCV.voisins  <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(à compléter)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Réalisation de la GWR</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>Modele.GWR <span class="ot">&lt;-</span> <span class="fu">gwr</span>(à compléter)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage des résultats</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>Modele.GWR</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Correction à la <a href="12-Exercices.html#sec-12073">section&nbsp;<span>12.7.3</span></a>.</p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-anselin1996simple" class="csl-entry" role="listitem">
Anselin, Luc, Anil K Bera, Raymond Florax et Mann J Yoon. 1996. <span>«&nbsp;Simple diagnostic tests for spatial dependence.&nbsp;»</span> <em>Regional science and urban economics</em> 26 (1): 77‑104. <a href="https://doi.org/10.1016/0166-0462(95)02111-6">https://doi.org/10.1016/0166-0462(95)02111-6</a>.
</div>
<div id="ref-anselin2014modern" class="csl-entry" role="listitem">
Anselin, Luc et Sergio J Rey. 2014. <em>Modern spatial econometrics in practice: A guide to GeoDa, GeoDaSpace and PySAL</em>. GeoDa Press LLC.
</div>
<div id="ref-RBoldAir" class="csl-entry" role="listitem">
Apparicio, Philippe et Jérémy Gelb. 2022. <em>Méthodes quantitatives en sciences sociales : un grand bol d’R</em>. FabriqueREL, Licence CC BY-SA. <a href="https://serieboldr.github.io/MethodesQuantitatives/">https://serieboldr.github.io/MethodesQuantitatives/</a>.
</div>
<div id="ref-apparicio2007modelisation" class="csl-entry" role="listitem">
Apparicio, Philippe, Anne-Marie Séguin et Xavier Leloup. 2007. <span>«&nbsp;Modélisation spatiale de la pauvreté à Montréal: apport méthodologique de la régression géographiquement pondérée.&nbsp;»</span> <em>The Canadian Geographer/Le Géographe canadien</em> 51 (4): 412‑427. <a href="https://doi.org/10.1111/j.1541-0064.2007.00189.x">https://doi.org/10.1111/j.1541-0064.2007.00189.x</a>.
</div>
<div id="ref-bivand2021review" class="csl-entry" role="listitem">
Bivand, Roger, Giovanni Millo et Gianfranco Piras. 2021. <span>«&nbsp;A review of software for spatial econometrics in R.&nbsp;»</span> <em>Mathematics</em> 9 (11): 1276. <a href="https://doi.org/10.3390/math9111276">https://doi.org/10.3390/math9111276</a>.
</div>
<div id="ref-bivand2008applied" class="csl-entry" role="listitem">
Bivand, Roger, Edzer J Pebesma, Virgilio Gómez-Rubio et Edzer Jan Pebesma. 2008. <em>Applied spatial data analysis with R</em>. Vol. 747248717. Springer.
</div>
<div id="ref-packagesGWR" class="csl-entry" role="listitem">
Bivand, Roger et Danlin Yu. 2023. <em>spgwr: Geographically Weighted Regression</em>. s.n. <a href="https://CRAN.R-project.org/package=spgwr">https://CRAN.R-project.org/package=spgwr</a>.
</div>
<div id="ref-dube2014econometrie" class="csl-entry" role="listitem">
Dubé, Jean et Diègo Legros. 2014. <em>Econom<span>é</span>trie spatiale appliqu<span>é</span>e des microdonn<span>é</span>es</em>. ISTE Group.
</div>
<div id="ref-fotheringham2003geographically" class="csl-entry" role="listitem">
Fotheringham, A Stewart, Chris Brunsdon et Martin Charlton. 2003. <em>Geographically weighted regression: the analysis of spatially varying relationships</em>. John Wiley &amp; Sons.
</div>
<div id="ref-fotheringham2015geographical" class="csl-entry" role="listitem">
Fotheringham, A Stewart, Ricardo Crespo et Jing Yao. 2015. <span>«&nbsp;Geographical and temporal weighted regression (GTWR).&nbsp;»</span> <em>Geographical Analysis</em> 47 (4). Wiley Online Library: 431‑452. <a href="https://doi.org/10.1111/gean.12071">https://doi.org/10.1111/gean.12071</a>.
</div>
<div id="ref-fotheringham2017multiscale" class="csl-entry" role="listitem">
Fotheringham, A Stewart, Wenbai Yang et Wei Kang. 2017. <span>«&nbsp;Multiscale geographically weighted regression (MGWR).&nbsp;»</span> <em>Annals of the American Association of Geographers</em> 107 (6). Taylor &amp; Francis: 1247‑1265. <a href="https://doi.org/10.1080/24694452.2017.1352480">https://doi.org/10.1080/24694452.2017.1352480</a>.
</div>
<div id="ref-harris2011geographically" class="csl-entry" role="listitem">
Harris, Paul, Chris Brunsdon et Martin Charlton. 2011. <span>«&nbsp;Geographically weighted principal components analysis.&nbsp;»</span> <em>International Journal of Geographical Information Science</em> 25 (10). Taylor &amp; Francis: 1717‑1736. <a href="https://doi.org/10.1080/13658816.2011.554838">https://doi.org/10.1080/13658816.2011.554838</a>.
</div>
<div id="ref-lesage2008introduction" class="csl-entry" role="listitem">
LeSage, James P et R. Kelly Pace. 2008. <em>An introduction to spatial econometrics</em>. 123. CRC Press.
</div>
<div id="ref-wood2011fast" class="csl-entry" role="listitem">
Wood, Simon N. 2011. <span>«&nbsp;Fast stable restricted maximum likelihood and marginal likelihood estimation of semiparametric generalized linear models.&nbsp;»</span> <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 73 (1): 3‑36. <a href="https://doi.org/10.1111/j.1467-9868.2010.00749.x">https://doi.org/10.1111/j.1467-9868.2010.00749.x</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06-AnalyseReseauEvenements.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analyses d’évènements localisés sur un réseau</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-ClassificationsSpatiales.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée spatiale</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes d’analyse spatiale : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>